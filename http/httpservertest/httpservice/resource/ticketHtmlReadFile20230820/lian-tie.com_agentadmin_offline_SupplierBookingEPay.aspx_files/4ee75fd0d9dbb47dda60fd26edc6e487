/**
 * Created by amos on 14-8-9.
 * Maintained and developed by vergil since 2015/02/01
 * Maintained and developed by oliverbi since 2019/01/28
 */
(function(global){
    if(global.__WPAV2){
        return;
    }

    //speed report
    var flag1 = 21848,
        flag2 = 1,
        flag3 = 1,
        flag_loaded = 28,
        reportCgi = 'http://report.huatuo.qq.com/report.cgi';

    // to avoid the difference when the api is not the same besides protocol
    if (location.protocol.indexOf('https') !== -1) {
        reportCgi = 'https://report.huatuo.qq.com/report.cgi';
    }

    // default platform
    var platform = 'pc',
        ua = navigator.userAgent;

    if (/(?:iphone|ipad|ipod)/i.test(ua)) {
        platform = 'ios';
    } else if(/android/i.test(ua)) {
        platform = 'android';
    }

    // conf
    var
        // env can be preset by global.__WPAENV
        env = global.__WPAENV || 'production',
        version = '4.1.0',
        // support file protocol
        //强制protocol为https
        protocol = 'https:',//location.protocol.indexOf('http') > -1 ? location.protocol : 'http:',
        hostMap = {
            development: 'dev',
            test: 'oa'
        },

        // static base can be preset by global.__WPASTATICBASE
        //todo
        //if it is https, then 'combo' should be prefixed with 'ssl'


        //staticBase = global.__WPASTATICBASE || protocol + '//' + (hostMap[env] || '') + 'combo.b.qq.com/qidian/wpa/dist/' + version,
        //本地开发时会手动传入staticBase,所以不能直接覆盖掉，先判断是否是本地的
        staticBase = global.__WPASTATICBASE,// || protocol + '//' + (hostMap[env] || '') + 'combo.b.qq.com/qidian/src/wpa/dist/' + version,

        host = protocol + '//' + (hostMap[env] || '') + 'wp.qiye.qq.com',
        // base can be preset by global.__WPABASE
        base = global.__WPABASE || host,
        // base can be preset by global.__WPAAPIBASE
        apiBase = global.__WPABAPIASE || host + '/api',
        stack = [],
        apiStack = [],
        tmpEventBucket = {},
        charset = 'utf-8';

    //重写staticBase为gtimg域名的
    if (!staticBase) {
        if (env === 'development') {
            staticBase = 'https://dev.gtimg.com';
            staticBase += '/qidian/src/wpav2/dist/' + version;
        } else if (env === 'test') {
            staticBase = 'https://oa.gtimg.com';
            staticBase += '/qidian/src/wpav2/dist/' + version;
        } else {
            staticBase = 'https://bqq.gtimg.com';
            staticBase += '/qidian/src/wpav2/dist/' + version;
        }

        // staticBase += '/qidian/src/wpa/dist/' + version;
    }


    // fetch
    var doc = document,
        head = doc.head || doc.getElementsByTagName("head")[0] || doc.documentElement,
        baseElement = head.getElementsByTagName("base")[0],
        currentlyAddingScript;

    function fetch(uri) {
        var node = doc.createElement("script"),
            sTime;

        node.charset = charset;
        node.async = true;
        node.src = uri;
        node.id = 'LBFnode';

        // For some cache cases in IE 6-8, the script executes IMMEDIATELY after
        // the end of the insert execution, so use `currentlyAddingScript` to
        // hold current node, for deriving uri in `define` call
        currentlyAddingScript = node;

        node.onload = node.onreadystatechange = function() {
            if(!this.readyState || this.readyState=='loaded' || this.readyState=='complete') {
                var eTime = +new Date(),
                    timeCost = eTime - sTime;
                // console.log('loading pk1.js time:' + (eTime - sTime));
                // var r = new Image(),
                //    params = 'flag1=' + flag1 + '&flag2=' + flag2 + '&flag3=' + flag3 + '&' + flag_loaded + '=' + timeCost;
                // r.src = reportCgi + '?appid=20282&platform=' + platform + '&speedparams=' + encodeURIComponent(params);
            }
        };

        //start to load pk1.js
        sTime = +new Date();
        // ref: #185 & http://dev.jquery.com/ticket/2709
        baseElement ?
            head.insertBefore(node, baseElement) :
            head.appendChild(node);

        currentlyAddingScript = null;
    }

    function getScriptPosition() {
        var scripts = document.getElementsByTagName('script');
        return scripts.length > 0 ? scripts[scripts.length - 1] : null;
    }


    // Public API

    var exports = global.__WPAV2 = {
        version: version,

        base: base,

        staticBase: staticBase,

        apiBase: apiBase,

        env: env,

        protocol: protocol,

        create: function(data){
            data.scriptPosition = getScriptPosition();
            stack.push(data);
        },

        on: function(type, cb){
            tmpEventBucket[type] ?
                tmpEventBucket[type].push(cb) :
                tmpEventBucket[type] = [cb];
        },

        api: function(){
            apiStack.push(arguments);
        },

        ready: function(onReady){
            exports.on('load', onReady);
        },

        getScriptPosition: getScriptPosition,

        _stack: stack,

        _apiStack: apiStack,

        _evtBkt: tmpEventBucket
    };

    // fetch packed modules
    fetch(staticBase + '/pk1.js');
})(this);

__WPAV2.create({"fkfuin":"2885768689","fkfext":"2851217606","fkfextname":"","id":"2958","name":"\u8fd0\u8425\u5904\u7406","cate":"7","type":"19","scene":"0","title":"","theme":"1","location":{"v":{"type":"3","px":"200"},"h":{"type":"3","px":"20"}},"middlePage":{"pc":"0","mobile":"1"},"qrcode":"\/\/p.qpic.cn\/qidian_pic\/0\/202307252725dececd2d2779b6c4e22d8b17bb83\/0","qrCodeImg":"\/\/p.qpic.cn\/qidian_pic\/0\/202307252725dececd2d2779b6c4e22d8b17bb83\/0","url":"https:\/\/wpa1.qq.com\/Xtbz0ATR?_type=wpa&qidian=true","download":"https:\/\/admin.qidian.qq.com\/mp\/mediaPage\/downloadQrcode3?url=http%3A%2F%2Fp.qpic.cn%2Fqidian_pic%2F0%2F202307252725dececd2d2779b6c4e22d8b17bb83%2F0","createTime":"1690973169","createrName":"YY_001","key":"4ee75fd0d9dbb47dda60fd26edc6e487","imUrl":"https:\/\/wpa1.qq.com\/5RGpwJZC?_type=wpa&qidian=true","roleIM":{"forid":"3065","type":7,"value":"1","name":"\u5ba2\u6237\u63a5\u5f85","uin":"94608","data":"94608","isDisabled":"0","isKfuin":"0","isPub":"","isOpenCompanyWords":"0","subNav":"","navRouter":"","msgDisplayed":"0","robotNav":""},"isAppUin":0,"deployList":[{"id":"52","deployTypeId":"1","deployRemarks":"","deployWebsite":""}],"source":0,"isCustomEntry":0,"isLBS":0,"isSsc":0,"setCacheTime":1691031980,"setIp":"9.148.209.141","sideBarId":"","interactNavId":"15","isNewWebim":1,"msgDisplayed":0,"updateTime":"1690973169","FCustom":{"wpaLocation":{"v":{"type":"3","px":"200"},"h":{"type":"3","px":"20"}},"middlePage":{"pc":"0","mobile":"1"},"isAppUin":0,"source":0,"isCustomEntry":0,"isLBS":0,"isSsc":0,"msgDisplayed":{"isDisplayed":0,"categoryId":"297562090103701504"}}});