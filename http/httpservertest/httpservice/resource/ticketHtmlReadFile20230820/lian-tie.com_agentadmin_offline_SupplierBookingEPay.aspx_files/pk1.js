function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}!function(e,t){"object"==(typeof exports==="undefined"?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Popper={})}(this,function(e){"use strict";function t(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function n(e){return e instanceof t(e).Element||e instanceof Element}function r(e){return e instanceof t(e).HTMLElement||e instanceof HTMLElement}function o(e){return"undefined"!=typeof ShadowRoot&&(e instanceof t(e).ShadowRoot||e instanceof ShadowRoot)}var i=Math.max,a=Math.min,s=Math.round;function f(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function c(){return!/^((?!chrome|android).)*safari/i.test(f())}function p(e,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var a=e.getBoundingClientRect(),f=1,p=1;o&&r(e)&&(f=e.offsetWidth>0&&s(a.width)/e.offsetWidth||1,p=e.offsetHeight>0&&s(a.height)/e.offsetHeight||1);var u=(n(e)?t(e):window).visualViewport,l=!c()&&i,d=(a.left+(l&&u?u.offsetLeft:0))/f,h=(a.top+(l&&u?u.offsetTop:0))/p,m=a.width/f,v=a.height/p;return{width:m,height:v,top:h,right:d+m,bottom:h+v,left:d,x:d,y:h}}function u(e){var n=t(e);return{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function l(e){return e?(e.nodeName||"").toLowerCase():null}function d(e){return((n(e)?e.ownerDocument:e.document)||window.document).documentElement}function h(e){return p(d(e)).left+u(e).scrollLeft}function m(e){return t(e).getComputedStyle(e)}function v(e){var t=m(e),n=t.overflow,r=t.overflowX,o=t.overflowY;return /auto|scroll|overlay|hidden/.test(n+o+r)}function y(e,n,o){void 0===o&&(o=!1);var i,a,f=r(n),c=r(n)&&function(e){var t=e.getBoundingClientRect(),n=s(t.width)/e.offsetWidth||1,r=s(t.height)/e.offsetHeight||1;return 1!==n||1!==r}(n),m=d(n),y=p(e,c,o),g={scrollLeft:0,scrollTop:0},b={x:0,y:0};return(f||!f&&!o)&&(("body"!==l(n)||v(m))&&(g=(i=n)!==t(i)&&r(i)?{scrollLeft:(a=i).scrollLeft,scrollTop:a.scrollTop}:u(i)),r(n)?((b=p(n,!0)).x+=n.clientLeft,b.y+=n.clientTop):m&&(b.x=h(m))),{x:y.left+g.scrollLeft-b.x,y:y.top+g.scrollTop-b.y,width:y.width,height:y.height}}function g(e){var t=p(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function b(e){return"html"===l(e)?e:e.assignedSlot||e.parentNode||(o(e)?e.host:null)||d(e)}function w(e){return["html","body","#document"].indexOf(l(e))>=0?e.ownerDocument.body:r(e)&&v(e)?e:w(b(e))}function x(e,n){var r;void 0===n&&(n=[]);var o=w(e),i=o===(null==(r=e.ownerDocument)?void 0:r.body),a=t(o),s=i?[a].concat(a.visualViewport||[],v(o)?o:[]):o,f=n.concat(s);return i?f:f.concat(x(b(s)))}function O(e){return["table","td","th"].indexOf(l(e))>=0}function j(e){return r(e)&&"fixed"!==m(e).position?e.offsetParent:null}function E(e){for(var n=t(e),i=j(e);i&&O(i)&&"static"===m(i).position;)i=j(i);return i&&("html"===l(i)||"body"===l(i)&&"static"===m(i).position)?n:i||function(e){var t=/firefox/i.test(f());if(/Trident/i.test(f())&&r(e)&&"fixed"===m(e).position)return null;var n=b(e);for(o(n)&&(n=n.host);r(n)&&["html","body"].indexOf(l(n))<0;){var i=m(n);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return n;n=n.parentNode}return null}(e)||n}var D="top",A="bottom",L="right",P="left",M="auto",k=[D,A,L,P],W="start",B="end",H="viewport",T="popper",R=k.reduce(function(e,t){return e.concat([t+"-"+W,t+"-"+B])},[]),S=[].concat(k,[M]).reduce(function(e,t){return e.concat([t,t+"-"+W,t+"-"+B])},[]),V=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function q(e){var t=new Map,n=new Set,r=[];function o(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!n.has(e)){var r=t.get(e);r&&o(r)}}),r.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){n.has(e.name)||o(e)}),r}function C(e){return e.split("-")[0]}function N(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&o(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function I(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function _(e,r,o){return r===H?I(function(e,n){var r=t(e),o=d(e),i=r.visualViewport,a=o.clientWidth,s=o.clientHeight,f=0,p=0;if(i){a=i.width,s=i.height;var u=c();(u||!u&&"fixed"===n)&&(f=i.offsetLeft,p=i.offsetTop)}return{width:a,height:s,x:f+h(e),y:p}}(e,o)):n(r)?function(e,t){var n=p(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}(r,o):I(function(e){var t,n=d(e),r=u(e),o=null==(t=e.ownerDocument)?void 0:t.body,a=i(n.scrollWidth,n.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),s=i(n.scrollHeight,n.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),f=-r.scrollLeft+h(e),c=-r.scrollTop;return"rtl"===m(o||n).direction&&(f+=i(n.clientWidth,o?o.clientWidth:0)-a),{width:a,height:s,x:f,y:c}}(d(e)))}function F(e,t,o,s){var f="clippingParents"===t?function(e){var t=x(b(e)),o=["absolute","fixed"].indexOf(m(e).position)>=0&&r(e)?E(e):e;return n(o)?t.filter(function(e){return n(e)&&N(e,o)&&"body"!==l(e)}):[]}(e):[].concat(t),c=[].concat(f,[o]),p=c[0],u=c.reduce(function(t,n){var r=_(e,n,s);return t.top=i(r.top,t.top),t.right=a(r.right,t.right),t.bottom=a(r.bottom,t.bottom),t.left=i(r.left,t.left),t},_(e,p,s));return u.width=u.right-u.left,u.height=u.bottom-u.top,u.x=u.left,u.y=u.top,u}function U(e){return e.split("-")[1]}function z(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function X(e){var t,n=e.reference,r=e.element,o=e.placement,i=o?C(o):null,a=o?U(o):null,s=n.x+n.width/2-r.width/2,f=n.y+n.height/2-r.height/2;switch(i){case D:t={x:s,y:n.y-r.height};break;case A:t={x:s,y:n.y+n.height};break;case L:t={x:n.x+n.width,y:f};break;case P:t={x:n.x-r.width,y:f};break;default:t={x:n.x,y:n.y};}var c=i?z(i):null;if(null!=c){var p="y"===c?"height":"width";switch(a){case W:t[c]=t[c]-(n[p]/2-r[p]/2);break;case B:t[c]=t[c]+(n[p]/2-r[p]/2);}}return t}function Y(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function G(e,t){return t.reduce(function(t,n){return t[n]=e,t},{})}function J(e,t){void 0===t&&(t={});var r=t,o=r.placement,i=void 0===o?e.placement:o,a=r.strategy,s=void 0===a?e.strategy:a,f=r.boundary,c=void 0===f?"clippingParents":f,u=r.rootBoundary,l=void 0===u?H:u,h=r.elementContext,m=void 0===h?T:h,v=r.altBoundary,y=void 0!==v&&v,g=r.padding,b=void 0===g?0:g,w=Y("number"!=typeof b?b:G(b,k)),x=m===T?"reference":T,O=e.rects.popper,j=e.elements[y?x:m],E=F(n(j)?j:j.contextElement||d(e.elements.popper),c,l,s),P=p(e.elements.reference),M=X({reference:P,element:O,strategy:"absolute",placement:i}),W=I(Object.assign({},O,M)),B=m===T?W:P,R={top:E.top-B.top+w.top,bottom:B.bottom-E.bottom+w.bottom,left:E.left-B.left+w.left,right:B.right-E.right+w.right},S=e.modifiersData.offset;if(m===T&&S){var V=S[i];Object.keys(R).forEach(function(e){var t=[L,A].indexOf(e)>=0?1:-1,n=[D,A].indexOf(e)>=0?"y":"x";R[e]+=V[n]*t})}return R}var K={placement:"bottom",modifiers:[],strategy:"absolute"};function Q(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function Z(e){void 0===e&&(e={});var t=e,r=t.defaultModifiers,o=void 0===r?[]:r,i=t.defaultOptions,a=void 0===i?K:i;return function(e,t,r){void 0===r&&(r=a);var i,s,f={placement:"bottom",orderedModifiers:[],options:Object.assign({},K,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],p=!1,u={state:f,setOptions:function setOptions(r){var i="function"==typeof r?r(f.options):r;l(),f.options=Object.assign({},a,f.options,i),f.scrollParents={reference:n(e)?x(e):e.contextElement?x(e.contextElement):[],popper:x(t)};var s,p,d=function(e){var t=q(e);return V.reduce(function(e,n){return e.concat(t.filter(function(e){return e.phase===n}))},[])}((s=[].concat(o,f.options.modifiers),p=s.reduce(function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e},{}),Object.keys(p).map(function(e){return p[e]})));return f.orderedModifiers=d.filter(function(e){return e.enabled}),f.orderedModifiers.forEach(function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,o=e.effect;if("function"==typeof o){var i=o({state:f,name:t,instance:u,options:r}),a=function a(){};c.push(i||a)}}),u.update()},forceUpdate:function forceUpdate(){if(!p){var e=f.elements,t=e.reference,n=e.popper;if(Q(t,n)){f.rects={reference:y(t,E(n),"fixed"===f.options.strategy),popper:g(n)},f.reset=!1,f.placement=f.options.placement,f.orderedModifiers.forEach(function(e){return f.modifiersData[e.name]=Object.assign({},e.data)});for(var r=0;r<f.orderedModifiers.length;r++)if(!0!==f.reset){var o=f.orderedModifiers[r],i=o.fn,a=o.options,s=void 0===a?{}:a,c=o.name;"function"==typeof i&&(f=i({state:f,options:s,name:c,instance:u})||f)}else f.reset=!1,r=-1}}},update:(i=function i(){return new Promise(function(e){u.forceUpdate(),e(f)})},function(){return s||(s=new Promise(function(e){Promise.resolve().then(function(){s=void 0,e(i())})})),s}),destroy:function destroy(){l(),p=!0}};if(!Q(e,t))return u;function l(){c.forEach(function(e){return e()}),c=[]}return u.setOptions(r).then(function(e){!p&&r.onFirstUpdate&&r.onFirstUpdate(e)}),u}}var $={passive:!0};var ee={name:"eventListeners",enabled:!0,phase:"write",fn:function fn(){},effect:function effect(e){var n=e.state,r=e.instance,o=e.options,i=o.scroll,a=void 0===i||i,s=o.resize,f=void 0===s||s,c=t(n.elements.popper),p=[].concat(n.scrollParents.reference,n.scrollParents.popper);return a&&p.forEach(function(e){e.addEventListener("scroll",r.update,$)}),f&&c.addEventListener("resize",r.update,$),function(){a&&p.forEach(function(e){e.removeEventListener("scroll",r.update,$)}),f&&c.removeEventListener("resize",r.update,$)}},data:{}};var te={name:"popperOffsets",enabled:!0,phase:"read",fn:function fn(e){var t=e.state,n=e.name;t.modifiersData[n]=X({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},ne={top:"auto",right:"auto",bottom:"auto",left:"auto"};function re(e){var n,r=e.popper,o=e.popperRect,i=e.placement,a=e.variation,f=e.offsets,c=e.position,p=e.gpuAcceleration,u=e.adaptive,l=e.roundOffsets,h=e.isFixed,v=f.x,y=void 0===v?0:v,g=f.y,b=void 0===g?0:g,w="function"==typeof l?l({x:y,y:b}):{x:y,y:b};y=w.x,b=w.y;var x=f.hasOwnProperty("x"),O=f.hasOwnProperty("y"),j=P,M=D,k=window;if(u){var W=E(r),H="clientHeight",T="clientWidth";if(W===t(r)&&"static"!==m(W=d(r)).position&&"absolute"===c&&(H="scrollHeight",T="scrollWidth"),W=W,i===D||(i===P||i===L)&&a===B)M=A,b-=(h&&W===k&&k.visualViewport?k.visualViewport.height:W[H])-o.height,b*=p?1:-1;if(i===P||(i===D||i===A)&&a===B)j=L,y-=(h&&W===k&&k.visualViewport?k.visualViewport.width:W[T])-o.width,y*=p?1:-1}var R,S=Object.assign({position:c},u&&ne),V=!0===l?function(e){var t=e.x,n=e.y,r=window.devicePixelRatio||1;return{x:s(t*r)/r||0,y:s(n*r)/r||0}}({x:y,y:b}):{x:y,y:b};return y=V.x,b=V.y,p?Object.assign({},S,((R={})[M]=O?"0":"",R[j]=x?"0":"",R.transform=(k.devicePixelRatio||1)<=1?"translate("+y+"px, "+b+"px)":"translate3d("+y+"px, "+b+"px, 0)",R)):Object.assign({},S,((n={})[M]=O?b+"px":"",n[j]=x?y+"px":"",n.transform="",n))}var oe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function fn(e){var t=e.state,n=e.options,r=n.gpuAcceleration,o=void 0===r||r,i=n.adaptive,a=void 0===i||i,s=n.roundOffsets,f=void 0===s||s,c={placement:C(t.placement),variation:U(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:o,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,re(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:a,roundOffsets:f})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,re(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:f})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var ie={name:"applyStyles",enabled:!0,phase:"write",fn:function fn(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var n=t.styles[e]||{},o=t.attributes[e]||{},i=t.elements[e];r(i)&&l(i)&&(Object.assign(i.style,n),Object.keys(o).forEach(function(e){var t=o[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)}))})},effect:function effect(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach(function(e){var o=t.elements[e],i=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]).reduce(function(e,t){return e[t]="",e},{});r(o)&&l(o)&&(Object.assign(o.style,a),Object.keys(i).forEach(function(e){o.removeAttribute(e)}))})}},requires:["computeStyles"]};var ae={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function fn(e){var t=e.state,n=e.options,r=e.name,o=n.offset,i=void 0===o?[0,0]:o,a=S.reduce(function(e,n){return e[n]=function(e,t,n){var r=C(e),o=[P,D].indexOf(r)>=0?-1:1,i="function"==typeof n?n(Object.assign({},t,{placement:e})):n,a=i[0],s=i[1];return a=a||0,s=(s||0)*o,[P,L].indexOf(r)>=0?{x:s,y:a}:{x:a,y:s}}(n,t.rects,i),e},{}),s=a[t.placement],f=s.x,c=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=f,t.modifiersData.popperOffsets.y+=c),t.modifiersData[r]=a}},se={left:"right",right:"left",bottom:"top",top:"bottom"};function fe(e){return e.replace(/left|right|bottom|top/g,function(e){return se[e]})}var ce={start:"end",end:"start"};function pe(e){return e.replace(/start|end/g,function(e){return ce[e]})}function ue(e,t){void 0===t&&(t={});var n=t,r=n.placement,o=n.boundary,i=n.rootBoundary,a=n.padding,s=n.flipVariations,f=n.allowedAutoPlacements,c=void 0===f?S:f,p=U(r),u=p?s?R:R.filter(function(e){return U(e)===p}):k,l=u.filter(function(e){return c.indexOf(e)>=0});0===l.length&&(l=u);var d=l.reduce(function(t,n){return t[n]=J(e,{placement:n,boundary:o,rootBoundary:i,padding:a})[C(n)],t},{});return Object.keys(d).sort(function(e,t){return d[e]-d[t]})}var le={name:"flip",enabled:!0,phase:"main",fn:function fn(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var o=n.mainAxis,i=void 0===o||o,a=n.altAxis,s=void 0===a||a,f=n.fallbackPlacements,c=n.padding,p=n.boundary,u=n.rootBoundary,l=n.altBoundary,d=n.flipVariations,h=void 0===d||d,m=n.allowedAutoPlacements,v=t.options.placement,y=C(v),g=f||(y===v||!h?[fe(v)]:function(e){if(C(e)===M)return[];var t=fe(e);return[pe(e),t,pe(t)]}(v)),b=[v].concat(g).reduce(function(e,n){return e.concat(C(n)===M?ue(t,{placement:n,boundary:p,rootBoundary:u,padding:c,flipVariations:h,allowedAutoPlacements:m}):n)},[]),w=t.rects.reference,x=t.rects.popper,O=new Map,j=!0,E=b[0],k=0;k<b.length;k++){var B=b[k],H=C(B),T=U(B)===W,R=[D,A].indexOf(H)>=0,S=R?"width":"height",V=J(t,{placement:B,boundary:p,rootBoundary:u,altBoundary:l,padding:c}),q=R?T?L:P:T?A:D;w[S]>x[S]&&(q=fe(q));var N=fe(q),I=[];if(i&&I.push(V[H]<=0),s&&I.push(V[q]<=0,V[N]<=0),I.every(function(e){return e})){E=B,j=!1;break}O.set(B,I)}if(j)for(var _=function _(e){var t=b.find(function(t){var n=O.get(t);if(n)return n.slice(0,e).every(function(e){return e})});if(t)return E=t,"break"},F=h?3:1;F>0;F--){if("break"===_(F))break}t.placement!==E&&(t.modifiersData[r]._skip=!0,t.placement=E,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function de(e,t,n){return i(e,a(t,n))}var he={name:"preventOverflow",enabled:!0,phase:"main",fn:function fn(e){var t=e.state,n=e.options,r=e.name,o=n.mainAxis,s=void 0===o||o,f=n.altAxis,c=void 0!==f&&f,p=n.boundary,u=n.rootBoundary,l=n.altBoundary,d=n.padding,h=n.tether,m=void 0===h||h,v=n.tetherOffset,y=void 0===v?0:v,b=J(t,{boundary:p,rootBoundary:u,padding:d,altBoundary:l}),w=C(t.placement),x=U(t.placement),O=!x,j=z(w),M="x"===j?"y":"x",k=t.modifiersData.popperOffsets,B=t.rects.reference,H=t.rects.popper,T="function"==typeof y?y(Object.assign({},t.rects,{placement:t.placement})):y,R="number"==typeof T?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),S=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,V={x:0,y:0};if(k){if(s){var q,N="y"===j?D:P,I="y"===j?A:L,_="y"===j?"height":"width",F=k[j],X=F+b[N],Y=F-b[I],G=m?-H[_]/2:0,K=x===W?B[_]:H[_],Q=x===W?-H[_]:-B[_],Z=t.elements.arrow,$=m&&Z?g(Z):{width:0,height:0},ee=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},te=ee[N],ne=ee[I],re=de(0,B[_],$[_]),oe=O?B[_]/2-G-re-te-R.mainAxis:K-re-te-R.mainAxis,ie=O?-B[_]/2+G+re+ne+R.mainAxis:Q+re+ne+R.mainAxis,ae=t.elements.arrow&&E(t.elements.arrow),se=ae?"y"===j?ae.clientTop||0:ae.clientLeft||0:0,fe=null!=(q=null==S?void 0:S[j])?q:0,ce=F+ie-fe,pe=de(m?a(X,F+oe-fe-se):X,F,m?i(Y,ce):Y);k[j]=pe,V[j]=pe-F}if(c){var ue,le="x"===j?D:P,he="x"===j?A:L,me=k[M],ve="y"===M?"height":"width",ye=me+b[le],ge=me-b[he],be=-1!==[D,P].indexOf(w),we=null!=(ue=null==S?void 0:S[M])?ue:0,xe=be?ye:me-B[ve]-H[ve]-we+R.altAxis,Oe=be?me+B[ve]+H[ve]-we-R.altAxis:ge,je=m&&be?function(e,t,n){var r=de(e,t,n);return r>n?n:r}(xe,me,Oe):de(m?xe:ye,me,m?Oe:ge);k[M]=je,V[M]=je-me}t.modifiersData[r]=V}},requiresIfExists:["offset"]};var me={name:"arrow",enabled:!0,phase:"main",fn:function fn(e){var t,n=e.state,r=e.name,o=e.options,i=n.elements.arrow,a=n.modifiersData.popperOffsets,s=C(n.placement),f=z(s),c=[P,L].indexOf(s)>=0?"height":"width";if(i&&a){var p=function(e,t){return Y("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:G(e,k))}(o.padding,n),u=g(i),l="y"===f?D:P,d="y"===f?A:L,h=n.rects.reference[c]+n.rects.reference[f]-a[f]-n.rects.popper[c],m=a[f]-n.rects.reference[f],v=E(i),y=v?"y"===f?v.clientHeight||0:v.clientWidth||0:0,b=h/2-m/2,w=p[l],x=y-u[c]-p[d],O=y/2-u[c]/2+b,j=de(w,O,x),M=f;n.modifiersData[r]=((t={})[M]=j,t.centerOffset=j-O,t)}},effect:function effect(e){var t=e.state,n=e.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=t.elements.popper.querySelector(r)))&&N(t.elements.popper,r)&&(t.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ve(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function ye(e){return[D,L,A,P].some(function(t){return e[t]>=0})}var ge={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function fn(e){var t=e.state,n=e.name,r=t.rects.reference,o=t.rects.popper,i=t.modifiersData.preventOverflow,a=J(t,{elementContext:"reference"}),s=J(t,{altBoundary:!0}),f=ve(a,r),c=ve(s,o,i),p=ye(f),u=ye(c);t.modifiersData[n]={referenceClippingOffsets:f,popperEscapeOffsets:c,isReferenceHidden:p,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":p,"data-popper-escaped":u})}},be=Z({defaultModifiers:[ee,te,oe,ie]}),we=[ee,te,oe,ie,ae,le,he,me,ge],xe=Z({defaultModifiers:we});e.applyStyles=ie,e.arrow=me,e.computeStyles=oe,e.createPopper=xe,e.createPopperLite=be,e.defaultModifiers=we,e.detectOverflow=J,e.eventListeners=ee,e.flip=le,e.hide=ge,e.offset=ae,e.popperGenerator=Z,e.popperOffsets=te,e.preventOverflow=he,Object.defineProperty(e,"__esModule",{value:!0})});(function(global,undefined){if(global.LBF){var lastVersion=global.LBF}var exports=global.LBF={version:"0.8.0"};var data=exports.data={};exports.noConflict=function(){lastVersion&&(global.LBF=lastVersion)};function isType(type){return function(obj){return{}.toString.call(obj)=="[object "+type+"]"}}var isObject=isType("Object");var isString=isType("String");var isArray=Array.isArray||isType("Array");var isFunction=isType("Function");var isNumber=isType("Number");var isRegExp=isType("RegExp");if(!global.isArray){global.isArray=isArray}if(!global.isObject){global.isObject=isObject}var _cid=0;function cid(){return _cid++}function forEach(arr,cb,context){context=context||this;for(var i=0,len=arr.length;i<len;i++){if(typeof arr[i]!=="undefined"){cb.call(context,arr[i],i,arr)}}}var events=data.events={};exports.on=function(name,callback){var list=events[name]||(events[name]=[]);list.push(callback);return exports};exports.off=function(name,callback){if(!(name||callback)){events=data.events={};return exports}var list=events[name];if(list){if(callback){for(var i=list.length-1;i>=0;i--){if(list[i]===callback){list.splice(i,1)}}}else{delete events[name]}}return exports};var emit=exports.emit=function(name,data){var list=events[name],fn;if(list){list=list.slice();for(var i=0,len=list.length;i<len;i++){list[i](data)}}return exports};var DIRNAME_RE=/[^?#]*\//;var DOT_RE=/\/\.\//g;var DOUBLE_DOT_RE=/\/[^/]+\/\.\.\//;var MULTI_SLASH_RE=/([^:/])\/+\//g;var EXT=/(?:js|css|less|php)$/;function dirname(path){return path.match(DIRNAME_RE)[0]}function realpath(path){path=path.replace(DOT_RE,"/");path=path.replace(MULTI_SLASH_RE,"$1/");while(path.match(DOUBLE_DOT_RE)){path=path.replace(DOUBLE_DOT_RE,"/")}return path}function normalize(path){var last=path.length-1;var lastC=path.charAt(last);if(lastC==="#"){return path.substring(0,last)}if(path.substring(last-3)===".css"){return path}return path.substring(last-2)===".js"||path.indexOf("?")>0||lastC==="/"?path:path+".js"}var PATHS_RE=/^([^/:]+)(\/.+)$/;var VARS_RE=/{([^{]+)}/g;var NAMESPACE_RE=/^[\w-_]*(?:\.[\w-_]+)*(\?[\w-_&=]*)?$/;function parseAlias(id){var alias=data.alias;return alias&&isString(alias[id])?alias[id]:id}function parseNamespace(id){var match;if(id.indexOf(".")>-1&&(match=NAMESPACE_RE.exec(id))){var ext;if(ext=match[1]){id=id.substring(0,id.lastIndexOf(ext))}ext=".js"+(ext||"");id=id.split(".").join("/")+ext}return id}function parsePaths(id){var paths=data.paths;var m;if(paths&&(m=id.match(PATHS_RE))&&isString(paths[m[1]])){id=paths[m[1]]+m[2]}return id}function parseVars(id){var vars=data.vars;if(vars&&id.indexOf("{")>-1){id=id.replace(VARS_RE,function(m,key){return isString(vars[key])?vars[key]:m})}return id}function parseMap(uri){var map=data.map;var ret=uri;if(map){for(var i=0,len=map.length;i<len;i++){var rule=map[i];ret=isFunction(rule)?rule(uri)||uri:uri.replace(rule[0],rule[1]);if(ret!==uri)break}}return ret}var ABSOLUTE_RE=/^\/\/.|:\//;var ROOT_DIR_RE=/^.*?\/\/.*?\//;function addBase(id,refUri){var ret;var first=id.charAt(0);if(ABSOLUTE_RE.test(id)){ret=id}else if(first==="."){ret=realpath((refUri?dirname(refUri):data.cwd)+id)}else if(first==="/"){var m=data.cwd.match(ROOT_DIR_RE);ret=m?m[0]+id.substring(1):id}else{ret=data.base+id}if(ret.indexOf("//")===0){ret=location.protocol+ret}return ret}function id2Uri(id,refUri){if(!id)return"";id=parseAlias(id);id=parseNamespace(id);id=parseAlias(id);id=parsePaths(id);id=parseVars(id);id=normalize(id);var uri=addBase(id,refUri);uri=parseMap(uri);return uri}var doc=document;var cwd=!location.href||location.href.indexOf("about:")===0?"":dirname(location.href);var scripts=doc.scripts;var loaderScript=doc.getElementById("LBFnode")||scripts[scripts.length-1];var loaderDir=dirname(getScriptAbsoluteSrc(loaderScript)||cwd);function getScriptAbsoluteSrc(node){return node.hasAttribute?node.src:node.getAttribute("src",4)}exports.resolve=id2Uri;var head=doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement;var baseElement=head.getElementsByTagName("base")[0];var IS_CSS_RE=/\.css(?:\?|$)/i;var currentlyAddingScript;var interactiveScript;var isOldWebKit=+navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/(\d+).*/,"$1")<536;function request(url,callback,charset){var isCSS=IS_CSS_RE.test(url);var node=doc.createElement(isCSS?"link":"script");if(charset){var cs=isFunction(charset)?charset(url):charset;if(cs){node.charset=cs}}addOnload(node,callback,isCSS,url);if(isCSS){node.rel="stylesheet";node.href=url}else{node.async=true;node.src=url}currentlyAddingScript=node;baseElement?head.insertBefore(node,baseElement):head.appendChild(node);currentlyAddingScript=null;return node}function addOnload(node,callback,isCSS,url){var supportOnload=("onload"in node);if(isCSS&&(isOldWebKit||!supportOnload)){setTimeout(function(){pollCss(node,callback)},1);return}if(supportOnload){node.onload=onload;node.onerror=function(){emit("error",{uri:url,node:node});onload()}}else{node.onreadystatechange=function(){if(/loaded|complete/.test(node.readyState)){onload()}}}function onload(){node.onload=node.onerror=node.onreadystatechange=null;if(!isCSS&&!data.debug){head.removeChild(node)}node=null;callback()}}function pollCss(node,callback){var sheet=node.sheet;var isLoaded;if(isOldWebKit){if(sheet){isLoaded=true}}else if(sheet){try{if(sheet.cssRules){isLoaded=true}}catch(ex){if(ex.name==="NS_ERROR_DOM_SECURITY_ERR"){isLoaded=true}}}setTimeout(function(){if(isLoaded){callback()}else{pollCss(node,callback)}},20)}function getCurrentScript(){if(currentlyAddingScript){return currentlyAddingScript}if(interactiveScript&&interactiveScript.readyState==="interactive"){return interactiveScript}var scripts=head.getElementsByTagName("script");for(var i=scripts.length-1;i>=0;i--){var script=scripts[i];if(script.readyState==="interactive"){interactiveScript=script;return interactiveScript}}}exports.request=request;var REQUIRE_RE=/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\/\*[\S\s]*?\*\/|\/(?:\\\/|[^/\r\n])+\/(?=[^\/])|\/\/.*|\.\s*require|(?:^|[^$])\brequire\s*\(\s*(["'])(.+?)\1\s*\)/g,SLASH_RE=/\\\\/g,REQUIRE_NAME_RE=/^function[\s]*\([\s]*([^\f\n\r\t\v,\)]+)/;function parseDependencies(code){var requireName=REQUIRE_NAME_RE.exec(code),RE=REQUIRE_RE;if(requireName&&(requireName=requireName[1])!=="require"){RE=RE.toString().replace(/require/g,requireName);RE=RE.slice(1,RE.length-2);RE=new RegExp(RE,"g")}var ret=[];code.replace(SLASH_RE,"").replace(RE,function(m,m1,m2){m2&&ret.push(m2)});return ret}var cachedMods=exports.cache={};var anonymousMeta;var fetchingList={};var fetchedList={};var callbackList={};var STATUS=Module.STATUS={FETCHING:1,SAVED:2,LOADING:3,LOADED:4,EXECUTING:5,EXECUTED:6};function Module(uri,deps){this.uri=uri;this.dependencies=deps||[];this.exports=null;this.status=0;this._waitings={};this._remain=0}Module.prototype.resolve=function(){var mod=this;var ids=mod.dependencies;var uris=[];for(var i=0,len=ids.length;i<len;i++){uris[i]=Module.resolve(ids[i],mod.uri)}return uris};Module.prototype.load=function(){var mod=this;if(mod.status>=STATUS.LOADING){return}mod.status=STATUS.LOADING;var uris=mod.resolve();emit("load",uris);var len=mod._remain=uris.length;var m;for(var i=0;i<len;i++){m=Module.get(uris[i]);if(m.status<STATUS.LOADED){m._waitings[mod.uri]=(m._waitings[mod.uri]||0)+1}else{mod._remain--}}if(mod._remain===0){mod.onload();return}var requestCache={};for(i=0;i<len;i++){m=cachedMods[uris[i]];if(m.status<STATUS.FETCHING){m.fetch(requestCache)}else if(m.status===STATUS.SAVED){m.load()}}for(var requestUri in requestCache){if(requestCache.hasOwnProperty(requestUri)){requestCache[requestUri]()}}};Module.prototype.onload=function(){var mod=this;mod.status=STATUS.LOADED;if(mod.callback){mod.callback()}var waitings=mod._waitings;var uri,m;for(uri in waitings){if(waitings.hasOwnProperty(uri)){m=cachedMods[uri];m._remain-=waitings[uri];if(m._remain===0){m.onload()}}}delete mod._waitings;delete mod._remain};Module.prototype.fetch=function(requestCache){var mod=this;var uri=mod.uri;mod.status=STATUS.FETCHING;var emitData={uri:uri};emit("fetch",emitData);var requestUri=emitData.requestUri||uri;if(!requestUri||fetchedList[requestUri]){mod.load();return}if(fetchingList[requestUri]){callbackList[requestUri].push(mod);return}fetchingList[requestUri]=true;callbackList[requestUri]=[mod];emit("request",emitData={uri:uri,requestUri:requestUri,onRequest:onRequest,charset:data.charset});if(!emitData.requested){requestCache?requestCache[emitData.requestUri]=sendRequest:sendRequest()}function sendRequest(){exports.request(emitData.requestUri,emitData.onRequest,emitData.charset)}function onRequest(){delete fetchingList[requestUri];fetchedList[requestUri]=true;if(anonymousMeta){Module.save(uri,anonymousMeta);anonymousMeta=null}var m,mods=callbackList[requestUri];delete callbackList[requestUri];while(m=mods.shift())m.load()}};Module.prototype.exec=function(){var mod=this;if(mod.status>=STATUS.EXECUTING){return mod.exports}mod.status=STATUS.EXECUTING;var uri=mod.uri;function require(id){return Module.get(require.resolve(id)).exec()}require.resolve=function(id){return Module.resolve(id,uri)};require.async=function(ids,callback){Module.use(ids,callback,uri+"_async_"+cid());return require};var factory=mod.factory;var exports=isFunction(factory)?factory(require,mod.exports={},mod):factory;if(exports===undefined){exports=mod.exports}delete mod.factory;mod.exports=exports;mod.status=STATUS.EXECUTED;emit("exec",mod);return exports};Module.resolve=function(id,refUri){var emitData={id:id,refUri:refUri};emit("resolve",emitData);return emitData.uri||exports.resolve(emitData.id,refUri)};Module.define=function(id,deps,factory){var argsLen=arguments.length;if(argsLen===1){factory=id;id=undefined}else if(argsLen===2){factory=deps;if(isArray(id)){deps=id;id=undefined}else{deps=undefined}}if(!isArray(deps)&&isFunction(factory)){deps=parseDependencies(factory.toString())}var meta={id:id,uri:Module.resolve(id),deps:deps,factory:factory};if(!meta.uri&&doc.attachEvent){var script=getCurrentScript();if(script){meta.uri=script.src}}emit("define",meta);meta.uri?Module.save(meta.uri,meta):anonymousMeta=meta};Module.save=function(uri,meta){var mod=Module.get(uri);if(mod.status<STATUS.SAVED){mod.id=meta.id||uri;mod.dependencies=meta.deps||[];mod.factory=meta.factory;mod.status=STATUS.SAVED;emit("save",mod)}};Module.get=function(uri,deps){return cachedMods[uri]||(cachedMods[uri]=new Module(uri,deps))};Module.use=function(ids,callback,uri){var mod=Module.get(uri,isArray(ids)?ids:[ids]);mod.callback=function(){var exports=[];var uris=mod.resolve();for(var i=0,len=uris.length;i<len;i++){exports[i]=cachedMods[uris[i]].exec()}if(callback){callback.apply(global,exports)}delete mod.callback};mod.load()};exports.use=function(ids,callback){Module.use(ids,callback,data.cwd+"_use_"+cid());return exports};Module.define.cmd={};exports.define=Module.define;exports.Module=Module;data.fetchedList=fetchedList;data.cid=cid;exports.require=function(id){var mod=Module.get(Module.resolve(id));if(mod.status<STATUS.EXECUTING){mod.onload();mod.exec()}return mod.exports};data.base=loaderDir;data.dir=loaderDir;data.cwd=cwd;data.charset="utf-8";exports.config=function(configData){for(var key in configData){var curr=configData[key];var prev=data[key];if(prev&&isObject(prev)){for(var k in curr){prev[k]=curr[k]}}else{if(isArray(prev)){curr=prev.concat(curr)}else if(key==="base"){if(curr.slice(-1)!=="/"){curr+="/"}curr=addBase(curr)}data[key]=curr}}emit("config",configData);return exports};var builtInMods=[["globalSettings",exports.data],["lang.forEach",forEach],["lang.isType",isType],["lang.isObject",isObject],["lang.isString",isString],["lang.isArray",isArray],["lang.isFunction",isFunction],["lang.isNumber",isNumber],["lang.isRegExp",isRegExp],["util.request",request]];global.JSON&&builtInMods.push(["lang.JSON",global.JSON]);global.jQuery&&(global.jQuery.version||"").indexOf("1.7")===0&&builtInMods.push(["lib.jQuery",global.jQuery]);forEach(builtInMods,function(each){exports.define(each[0],function(require,exports,module){module.exports=each[1]})});var Module=LBF.Module;var FETCHING=Module.STATUS.FETCHING;var data=LBF.data;var comboHash=data.comboHash={};var comboSyntax=["c/=/",",/"];var comboMaxLength=1000;var comboExcludes;var comboSuffix;LBF.on("load",setComboHash);LBF.on("fetch",setRequestUri);function setComboHash(uris){var len=uris.length;if(len<2||!data.combo){return}data.comboSyntax&&(comboSyntax=data.comboSyntax);data.comboMaxLength&&(comboMaxLength=data.comboMaxLength);data.comboSuffix&&(comboSuffix=data.comboSuffix);comboExcludes=data.comboExcludes;var needComboUris=[];for(var i=0;i<len;i++){var uri=uris[i];if(comboHash[uri]){continue}var mod=Module.get(uri);if(mod.status<FETCHING&&!isCss(uri)&&!isExcluded(uri)&&!isComboUri(uri)){needComboUris.push(uri)}}if(needComboUris.length>1){uris2paths(needComboUris)}}function setRequestUri(fetchData){if(!data.combo){return}fetchData.requestUri=comboHash[fetchData.uri]||fetchData.uri}var COMBO_ROOT_RE=/^(\S+:\/{2,3}[^\/]+\/)/;function uris2paths(uris){var paths=[],root=COMBO_ROOT_RE.exec(uris[0])[1],rootLen=root.length;forEach(uris,function(uri){paths.push(uri.substr(rootLen))});setHash(root,paths)}function setHash(root,files){var copy=[];for(var i=0,len=files.length;i<len;i++){copy[i]=files[i].replace(/\?.*$/,"")}var comboPath=root+comboSyntax[0]+copy.join(comboSyntax[1]);if(comboSuffix){comboPath+=comboSuffix}var exceedMax=comboPath.length>comboMaxLength;if(files.length>1&&exceedMax){var parts=splitFiles(files,comboMaxLength-(root+comboSyntax[0]).length);setHash(root,parts[0]);setHash(root,parts[1])}else{if(exceedMax){throw new Error("The combo url is too long: "+comboPath)}for(var i=0,len=files.length;i<len;i++){comboHash[root+files[i]]=comboPath}}}function splitFiles(files,filesMaxLength){var sep=comboSyntax[1];var s=files[0];for(var i=1,len=files.length;i<len;i++){s+=sep+files[i];if(s.length>filesMaxLength){return[files.splice(0,i),files]}}}var CSS_EXT_RET=/\.css(?:\?.*)?$/;function isCss(uri){return CSS_EXT_RET.test(uri)}function isExcluded(uri){if(comboExcludes){return comboExcludes.test?comboExcludes.test(uri):comboExcludes(uri)}}function isComboUri(uri){var syntax=data.comboSyntax||comboSyntax;var s1=syntax[0];var s2=syntax[1];return s1&&uri.indexOf(s1)>0||s2&&uri.indexOf(s2)>0}if(data.test){var test=LBF.test||(LBF.test={});test.uris2paths=uris2paths;test.paths2hash=paths2hash}})(this);LBF.config({paths:{wpa:__WPAV2.staticBase},debug:__WPAV2.env,protocol:__WPAV2.protocol,apiBase:__WPAV2.apiBase,staticBase:__WPAV2.staticBase});LBF.define("wpa.app",function(require,exports,module){var forEach=require("lang.forEach"),extend=require("lang.extend"),isFunction=require("lang.isFunction"),Event=require("util.Event"),WPA=require("wpa.proto.main"),api=require("wpa.api"),bus=require("wpa.bus"),globalSettings=require("globalSettings");module.exports=exports=__WPAV2;if(!window.__QDWPABUS){window.__QDWPABUS={}}extend(__QDWPABUS,Event);bus.init();exports.init=function(){var app=exports;var evtBkt=app._evtBkt;for(var type in evtBkt){if(evtBkt.hasOwnProperty(type)){forEach(evtBkt[type],function(listener){app.on(type,listener)})}}delete app._evtBkt;var stk=app._stack;forEach(stk,function(data){data&&app.create(data)});delete app._stack;var hookName=window["__qq_qidian_wpa"];if(hookName){var sdkObj=window[hookName];sdkObj.afterLogin=function(wpaInfo){if(typeof wpaInfo.key==="undefined"){return}var args=arguments;forEach(sdkObj._instanceQueue,function(instance){if(instance.params.key===wpaInfo.key){instance.afterLogin.apply(instance,args)}})}}app.trigger("load")};exports.ready=function(onReady){if(isFunction(onReady)){onReady()}};exports.create=function(params){try{params._sTime=+new Date;new WPA(params)}catch(e){__QDWPABUS.trigger("error",e)}};extend(exports,api,Event)});LBF.define("lang.extend",function(require,exports,module){var isPlainObject=require("lang.isPlainObject");module.exports=function(isRecursive,base,ext){var args=[].slice.apply(arguments),o=args.shift(),extFn=plain;if(typeof o==="boolean"){o=args.shift();o&&(extFn=recursive)}for(var i=0,len=args.length;i<len;i++){extFn(o,args[i])}return o;function plain(o,ext){for(var attr in ext){if(ext.hasOwnProperty(attr)){o[attr]=ext[attr]}}}function recursive(o,ext){for(var attr in ext){if(ext.hasOwnProperty(attr)){if(isPlainObject(ext[attr])){o[attr]=o[attr]||{};recursive(o[attr],ext[attr])}else{o[attr]=ext[attr]}}}}}});LBF.define("util.Event",function(require,exports){var toArray=require("lang.toArray"),Callbacks=require("util.Callbacks");var ATTR="_EVENTS";exports.on=function(type,_handler,one){var events=this[ATTR];if(!events){events=this[ATTR]={}}var callbacks=events[type]||(events[type]=Callbacks("stopOnFalse"));if(one===1){var origFn=_handler,self=this;_handler=function handler(){self.off(type,_handler);return origFn.apply(this,arguments)}}callbacks.add(_handler);return this};exports.off=function(type,handler){if(!type){this[ATTR]={};return this}var events=this[ATTR];if(!events||!events[type]){return this}if(!handler){events[type].empty();return this}events[type].remove(handler);return this};exports.trigger=function(){var args=toArray(arguments),type=args.shift(),events=this[ATTR];if(!events||!events[type]){return this}events[type].fireWith(this,args);return this};exports.once=function(type,handler){return this.on(type,handler,1)}});LBF.define("wpa.proto.main",function(require,exports,module){var extend=require("lang.extend"),Event=require("util.Event"),render=require("wpa.proto.render"),uiEvents=require("wpa.proto.uiEvents"),GUID=require("util.GUID"),ls=require("util.localStorage"),ss=require("util.sessionStorage"),kfuinCache=require("wpa.protocol.kfuin"),custom=require("wpa.proto.custom"),conf=require("wpa.conf.config"),KFUINS=conf.KFUINS,WEB_IM=conf.WEB_IM,WPAS_IM_TYPE=WEB_IM.WPAS_IM_TYPE,win=conf.gWin,browser=require("lang.browser"),isMobile=conf.isMobile,GLOBAL_WPA_NAME=conf.GLOBAL_WPA,WPAS_BASED_ON_KFUIN=conf.WPAS_BASED_ON_KFUIN,Reporter=require("wpa.protocol.Reporter"),basicCgiCall=require("wpa.proto.basicCgiCall"),getRootDomain=require("wpa.util.getRootDomain"),ids=require("wpa.util.ids"),base64=require("wpa.util.base64"),log=require("wpa.util.log"),Cookie=require("util.Cookie"),chat=require("wpa.proto.chat"),phone=require("wpa.proto.phone"),add=require("wpa.proto.add"),im=require("wpa.proto.im"),imInit=require("wpa.im.init"),Invite=require("wpa.invite.main"),socket=require("wpa.proto.socket"),getGdtClickId=require("wpa.proto.getGdtClickId"),UnreadMsgCircle=require("wpa.proto.UnreadMsgCircle"),wpaSSO=require("wpa.proto.wpaSSO"),request=require("wpa.util.requestXHR").request,_S=conf.sandbox,SandBoxObject=_S.Object,addDa=require("wpa.proto.addDa"),jsonp=require("util.jsonp"),CGIS=conf.CGIS,ENV=conf.ENV,WEB_IM_IFRAMES_LOADED=conf.WEB_IM.WEB_IM_IFRAMES_LOADED;win[GLOBAL_WPA_NAME]=win[GLOBAL_WPA_NAME]?win[GLOBAL_WPA_NAME]:new SandBoxObject;win.__WPAV2[KFUINS]=typeof win.__WPAV2[KFUINS]!=="undefined"?win.__WPAV2[KFUINS]:new SandBoxObject;win.__WPAV2[WPAS_BASED_ON_KFUIN]=typeof win.__WPAV2[WPAS_BASED_ON_KFUIN]!=="undefined"?win.__WPAV2[WPAS_BASED_ON_KFUIN]:new SandBoxObject;win.__WPAV2[WPAS_IM_TYPE]=typeof win.__WPAV2[WPAS_IM_TYPE]!=="undefined"?win.__WPAV2[WPAS_IM_TYPE]:new SandBoxObject;win["GLOBAL_WXKF_TOOLTIP_COUNT"]=win["GLOBAL_WXKF_TOOLTIP_COUNT"]||0;module.exports=exports=function exports(params){var hookName=window["__qq_qidian_wpa"];if(hookName){var sdkObj=window[hookName];if(!sdkObj._instanceQueue){sdkObj._instanceQueue=[]}sdkObj._instanceQueue.push(this)}this.initialize(params)};var proto=exports.prototype;win.__WPAV2.IM=im;var randomId=function randomId(){return _S.Math.round((_S.Math.random()||0.5)*2147483647)*+new _S.Date%10000000000};var getPid=function getPid(){var result=window.__qq_qidian_da_pid;if(!result||!/^QD\./.test(result)){result=window.__qq_qidian_da_pid=ids.createPid(true)}return result};var getQid=function getQid(){var rootDomain=getRootDomain.getRootDomain(),isCookieEnabled=getRootDomain.isCookieEnabled,_qddaz="";if(isCookieEnabled){_qddaz=Cookie.get("_qddaz");if(!_qddaz||!/^QD\./.test(_qddaz)){_qddaz=ids.createQid(true);Cookie.set("_qddaz",_qddaz,rootDomain,"/",1000*60*60*24*365)}}else{_qddaz=window.__qq_qidian_da_qid;if(!_qddaz||!/^QD\./.test(_qddaz)){_qddaz=window.__qq_qidian_da_qid=ids.createQid(true)}}return _qddaz};var bindEvents=function bindEvents(){this.on("render",function(params){Reporter.report(params.reportType,params)});this.on("click",function(params){Reporter.report(params.reportType,params)});this.on("PCChat",function(){});this.on("mobileChat",function(){});this.on("anonyChat",function(){});this.on("linkChat",function(){});this.on("gdtReport",function(params){Reporter.report(params.reportType,params)});this.on("initIm",function(){var params=this.params,kfuin=params.fkfuin,cate=params.cate;if(params.cate==conf.TYPES.IM||params.cate==conf.TYPES.QQ){this.imInit(this.params);if(params.cate==conf.TYPES.IM){if(typeof win.__WPAV2[WPAS_IM_TYPE][kfuin]!=="undefined"){win.__WPAV2[WPAS_IM_TYPE][kfuin].push(this)}else{win.__WPAV2[WPAS_IM_TYPE][kfuin]=[this]}}this.trigger("establishSocket")}});this.on("establishSocket",function(){var params=this.params,kfuin=params.fkfuin,cate=params.cate;this.establishSocket()})};var isCustom=function isCustom(params){var cate=params.cate,type=params.type;if((cate==1||cate==12)&&(type==17||type==18)||cate==5&&type==21||(cate==7||cate==10||cate==11)&&(type==15||type==16)||cate==8&&type==20){return true}};function login(wpaInfo,ssoParams,fromSession){var self=this;if(!ssoParams){wpaSSO.authError({r:100,message:"\u8BF7\u586B\u5199\u6B63\u786E\u9274\u6743\u53C2\u6570"},self);return}if(wpaInfo.key===this.params.key){var openIM=function openIM(rs){if(!rs||rs.code!=0){self.jsonpIsLoadding=false;wpaSSO.authError(rs,self);return}var data=rs.data;var authInfo={aid:data.uint64_unique_id,d2:base64.decode(data.session_ticket||""),secretKey:win.__WPAV2.secretKey=data.secret_key,auth:conf.WPA_SSO_AUTHTYPE};self.params.visitorid=data.uint64_unique_id;self.params.d2=base64.decode(data.session_ticket||"");self.params.secretKey=win.__WPAV2.secretKey=data.secret_key;self.params.auth=conf.WPA_SSO_AUTHTYPE;self.params.authInfo=authInfo;ss.setItem(wpaInfo.key,JSON.stringify({aid:data.uint64_unique_id,d2:self.params.d2||""}));if(self.hasGetVid){self.jsonpIsLoadding=false;im.sendMsgToIM(self.params);return}self.hasGetVid=true;win.__WPAV2.cgiCalls.getScaleInfo({kfuin:kfuin},self);if(imInit.isImIframeLoaded(kfuin)){onImLoaded()}else{self.on("imIframeLoaded",onImLoaded)}function onImLoaded(){self.jsonpIsLoadding=false;if(wpaInfo.open){var action=custom.getAction(self.params);self[action]&&self[action]()}}};var url=CGIS.GET_COMMON_SSO_VISITORID;var kfuin=self.params.fkfuin;if(self.jsonpIsLoadding){return}self.jsonpIsLoadding=true;var authData,authPramas;authData="auth=".concat(conf.WPA_SSO_AUTHTYPE,"&kfuin=").concat(kfuin,"&fid=").concat(wpaInfo.id,"&key=").concat(wpaInfo.key);if(fromSession){authPramas={str_session_ticket:ssoParams.d2,bytes_custom_key:base64.encode(ssoParams.aid),str_auth_info:base64.encode(authData)}}else{authData="".concat(authData,"&code=").concat(ssoParams.code,"&signature=").concat(ssoParams.signature);authPramas={str_session_ticket:"",bytes_custom_key:"",str_auth_info:base64.encode(authData)}}authPramas=Object.assign({},authPramas,{uint64_kfuin:kfuin,uint32_appid:conf.appid,str_useragent:typeof navigator!=="undefined"&&navigator.userAgent||""});request({url:url,method:"GET",data:authPramas,success:function success(rs){openIM(rs)},error:function error(err){console.log(err)}})}}proto.afterLogin=function(wpaInfo,ssoParams){login.call(this,wpaInfo,ssoParams)};proto.initialize=function(params){if(typeof window.isSSO!=="undefined"&&typeof params.isSSO==="undefined"){params.isSSO=window.isSSO}var self=this,kfuin=params.fkfuin;self.env=new SandBoxObject;if(!win.__WPAV2[KFUINS][kfuin]){win.__WPAV2[KFUINS][kfuin]={unread:{chat:0,socket:0}}}var tencentSig=conf.tencentSig;if(!params.isSSO){if(ls.getItem(tencentSig)){params.guid=ls.getItem(tencentSig)}else{var guid=ids.createRandomId();params.guid=guid;ls.setItem(tencentSig,guid)}win.__WPAV2.visitorId=params.guid}params.wpa=this;this.params=params;var pid=this.params.pid=getPid().substring(3);var qid=this.params.qid=getQid().substring(3);this.setGlobalVisitorId({vid:win.__WPAV2.visitorId,pid:pid,qid:qid});this.addDa(params.fkfuin);var wpaIden=this.params.fkfuin+"_"+this.params.id;win[GLOBAL_WPA_NAME][wpaIden]=self;if(!win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin]){win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin]=[self]}else{win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin].push(self)}bindEvents.apply(this);if(isCustom(params)){params.isCustom=true;this.custom(params)}else{self.render()}if(params.cate==12){this.generateWxkfStyle()}getGdtClickId(params);if(params.isSSO){var sessionInfo=ss.getItem(params.key);if(sessionInfo){var authInfo=JSON.parse(sessionInfo);login.call(this,{key:params.key,open:false},authInfo,true)}return}win.__WPAV2.cgiCalls.getScaleInfo({kfuin:kfuin},self)};extend(proto,Event,render,chat,uiEvents,custom,phone,add,im,imInit,UnreadMsgCircle,socket,addDa,{Invite:Invite})});LBF.define("wpa.api",function(require,exports,module){var api=exports.api={},WPA=require("wpa.proto.main"),chatProtocol=require("wpa.protocol.chat"),inviteApi=require("wpa.invite.inviteApi");api.create=function(params){return new WPA(params)};api.createCustom=function(params){return new WPA(params)};api.chat=function(params){};api.PCChat=function(params,onChat){chatProtocol.PCChat(params,onChat)};api.mobileChat=function(params,onChat){chatProtocol.mobileChat(params,onChat)};api.anonyChat=function(params,onChat){chatProtocol.anonyChat(params,onChat)};api.linkChat=function(params,onChat){chatProtocol.linkChat(params,onChat)};api.invite=function(params){inviteApi.trigger(params)}});LBF.define("wpa.bus",function(require,exports,module){var report=require("wpa.util.badjs").badjsReport,inited=false,reportFreq=0.9;exports.init=function(){if(inited){return}inited=true;__QDWPABUS.on("error",function(err){if(Math.random()>reportFreq){report(err)}})};exports.triggerError=function(err){if(window.__QDWPABUS){__QDWPABUS.trigger("error",err)}}});LBF.define("lang.isPlainObject",function(require,exports,module){var isObject=require("lang.isObject"),isWindow=function isWindow(obj){return obj&&obj===obj.window};module.exports=function(obj){if(!obj||!isObject(obj)||obj.nodeType||isWindow(obj)){return false}var hasOwn=Object.prototype.hasOwnProperty;try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var key;for(key in obj){}return key===undefined||hasOwn.call(obj,key)}});LBF.define("lang.toArray",function(require,exports,module){module.exports=function(arrayLike){return[].slice.call(arrayLike)}});LBF.define("util.Callbacks",function(require,exports,module){var Class=require("lang.Class"),forEach=require("lang.forEach"),extend=require("lang.extend"),isFunction=require("lang.isFunction"),isString=require("lang.isString"),inArray=require("lang.inArray");var REG_NOT_WHITE=/\S+/g;var optionsCache={};var createOptions=function createOptions(options){var object=optionsCache[options]={};forEach(options.match(REG_NOT_WHITE)||[],function(flag){object[flag]=true});return object};module.exports=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):extend({},options);var firing,memory,_fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function fire(data){memory=options.memory&&data;_fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function add(){if(list){var start=list.length;(function add(args){forEach(args,function(arg){if(isFunction(arg)){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&isString(arg)){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function remove(){if(list){forEach(arguments,function(arg){var index;while((index=inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function has(fn){return fn?inArray(fn,list)>-1:!!(list&&list.length)},empty:function empty(){list=[];firingLength=0;return this},disable:function disable(){list=stack=memory=undefined;return this},disabled:function disabled(){return!list},lock:function lock(){stack=undefined;if(!memory){self.disable()}return this},locked:function locked(){return!stack},fireWith:function fireWith(context,args){if(list&&(!_fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function fire(){self.fireWith(this,arguments);return this},fired:function fired(){return!!_fired}};return self}});LBF.define("wpa.proto.render",function(require,exports,module){var onIframeLoaded=require("wpa.util.onIframeLoaded"),tmplCompiler=require("wpa.util.tmplCompiler"),Style=require("wpa.util.Style"),extend=require("lang.extend"),wpaType=require("wpa.conf.wpaType"),insertIframe=require("wpa.util.insertIframe"),floatCss=require("wpa.conf.floatCss"),Events=require("wpa.conf.Events"),proxy=require("lang.proxy"),wpaTmplObj=require("wpa.conf.wpaTmpl"),inArray=require("lang.inArray"),domEvent=require("wpa.util.domEvent"),defaultConst=require("wpa.conf.defaultConst"),getSizeFunc=require("wpa.util.getSize"),conf=require("wpa.conf.config"),bindLogicEvents=require("wpa.util.bindLogicEvents"),htReport=require("wpa.util.htReport"),browser=require("lang.browser");var BOX_SHADOW="box-shadow:0 1px 15px rgba(0, 0, 0, 0.15);",IFRAME_BORDER="border: 1px solid #dadee7;",BORDER_TOP_BOTTOM="border-top: 1px solid #e3e3e3;border-bottom:1px solid #e3e3e3;",BORDER_RADIUS="border-radius: {borderRadius};",CLASS_NAME_MIDDLE="middle";var createIframe=function createIframe(params,context){wpaTmplObj.init({ratio:params.ratio});var getSize=getSizeFunc(params.ratio);var cate=params.cate,type=params.type,theme=params.theme,self=context,container=params.container,ratio=params.ratio,scene=params.scene,kfuin=params.fkfuin,key=params.key,position=params.position,targetWpaTmpl=wpaTmplObj.get(cate,type),targetWpaType=wpaType[cate][type],borderRadius=targetWpaType.borderRadius,hasBoxShadow=targetWpaType.hasBoxShadow,iframeBorder=targetWpaType.iframeBorder,floatStyle=targetWpaType.floatStyle,needPosition=inArray("position",targetWpaType.htmlRequired||[]),tempPosition="",isPC=targetWpaType.isPC,isInQQ=targetWpaType.isInQQ,cssText=targetWpaTmpl.cssText,width=isPC?targetWpaTmpl.width:getSize(targetWpaTmpl.width),height=isPC?targetWpaTmpl.height:getSize(targetWpaTmpl.height),enableFloat=typeof params.enableFloat!=="undefined"?params.enableFloat:true;if(enableFloat&&(params.position!=undefined||targetWpaTmpl.defaultPosition!=undefined||_typeof(params.location)==="object")){tempPosition=floatCss.getFloatStyle({width:width,height:height,floatStyle:floatStyle,position:params.position,location:params.location,defaultPosition:targetWpaTmpl.defaultPosition})}tempPosition+=hasBoxShadow?BOX_SHADOW:"";if(_typeof(iframeBorder)==="object"){var iframeBorderTheme=iframeBorder.theme;if(typeof iframeBorderTheme!=="undefined"&&theme==iframeBorderTheme||typeof iframeBorderTheme==="undefined"){tempPosition+="border:"+iframeBorder.width+" solid "+iframeBorder.color+";"}}tempPosition+=typeof borderRadius!=="undefined"?BORDER_RADIUS.replace("{borderRadius}",borderRadius):"";var isH5Middle=(scene==1||scene==2)&&position==0&&needPosition!==-1;if(isH5Middle){params.className=params.className+CLASS_NAME_MIDDLE+" "};tempPosition+=isH5Middle?BORDER_TOP_BOTTOM:"";tempPosition+=isInQQ?BORDER_TOP_BOTTOM:"";var iframeId=conf.WPA_ID_PREFIX+kfuin+"_"+params.id,iframeClassName="class_qidian_wpa";var strIframe="<iframe scrolling=\"no\" class=\""+iframeClassName+"\" id=\""+iframeId+"\" frameborder=\"0\" width=\""+width+"\" height=\""+height+"\" allowtransparency=\"true\" src=\"about:blank\" {style} ></iframe>";strIframe=tempPosition?strIframe.replace("{style}","style=\""+tempPosition+"\""):strIframe.replace("{style}","");var iframe;try{iframe=document.createElement(strIframe)}catch(e){iframe=document.createElement("iframe");iframe.width=width;iframe.height=height;iframe.id=iframeId;iframe.style.cssText=tempPosition;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src","about:blank");iframe.setAttribute("class",iframeClassName)}var lastScript=document.getElementById("qd"+kfuin+key)||params.scriptPosition;insertIframe({ele:iframe,lastScript:lastScript,container:container});var compiledTmpl=tmplCompiler.compile({tpl:targetWpaTmpl.tpl,params:params,htmlRequired:targetWpaType.htmlRequired});if(browser.msie){try{var accessTest=iframe.contentWindow.document}catch(e){iframe.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close()})())"}}var loaded=function loaded(){var iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document;iDoc.open();iDoc.write(["<!doctype html>","<html xmlns=\"http://www.w3.org/1999/xhtml\">","<head>","<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />",browser.msie&&iframe.src!=="about:blank"?"<script>document.domain='"+document.domain+"';</script>":"","</head>","<body>",compiledTmpl,"</body>","</html>"].join(""));iDoc.close();if(cate==12&&[3,5,15].indexOf(type)<0){context.popperWxkfQrcode(iframe,iframe.contentDocument||iWin.document,params)}if(browser.isIOS||browser.isAndroid){try{iDoc.body.addEventListener("touchmove",function(event){event.preventDefault()},false)}catch(e){}}var styleObj={self:self,name:"style",cssText:cssText,doc:iDoc};Style.add(styleObj);var eventNodes=iDoc.getElementsByName(wpaTmplObj.defaultEventTagName);bindLogicEvents(eventNodes,context);__WPAV2.trigger("inited",self.params);setTimeout(function(){context.trigger("render",extend({reportType:"render"},params))},1000)};onIframeLoaded(iframe,loaded);return iframe};var getRenderParams=function getRenderParams(_params){var dispType=_params.dispType,targetWpaTmpl=wpaTmpl[dispType],htmlRequired=wpaType[dispType].htmlRequired,width=targetWpaTmpl.width?targetWpaTmpl.width:_params.width,height=targetWpaTmpl.height?targetWpaTmpl.height:_params.height;var params={params:_params,dispType:dispType,width:width,height:height,container:_params.container,htmlRequired:htmlRequired,tmplData:_params.params,color:_params.color,targetWpaTmpl:targetWpaTmpl,borderRadius:targetWpaTmpl.borderRadius,scriptPosition:_params.scriptPosition,guid:_params.guid,cssText:targetWpaTmpl.cssText};return params};var preHandleParams=function preHandleParams(params){params.className="";if(!params.theme){params.theme=defaultConst.THEME}if(typeof params.width!=="number"){params.width="100%"}if(typeof params.height!=="number"){params.height="100%"}if(!params.btnBgColor){params.btnBgColor={}}if(!params.btnBgColor.value){params.btnBgColor.value=defaultConst.BTN_COLOR}if(!params.title){params.title=defaultConst.TITLE[params.cate]}if(!params.signature){params.signature=defaultConst.SIGNATURE[params.cate]}if(!params.btnText){params.btnText=defaultConst.BTN_TEXT[params.cate]}if(!params.ratio){params.ratio=window.devicePixelRatio}};exports.render=function(){preHandleParams(this.params);this.el=createIframe(this.params,this)};exports.remove=function(){var el=this.el;el&&el.parentNode&&el.parentNode.removeChild(el)}});LBF.define("wpa.proto.uiEvents",function(require,exports,module){var extend=require("lang.extend"),conf=require("wpa.conf.config"),TP_FORM=conf.TP_FORM,CLICK_TYPE=conf.CLICK_TYPE,ROLE_KEY=conf.ROLE_KEY,isInAdmin=conf.isInAdmin,win=conf.gWin,DISPLAY=conf.DISPLAY,DISPLAY_ACTS=DISPLAY.ACTS;ids=require("wpa.util.ids");var CPTTP_NONE=0,CPTTP_CORPWPA=1,CPTTP_STAFFWPA=2,CPTTP_FREETEL=3,CPTTP_JOINGROUP=4,CPTTP_ADDFRIEND=5,CPTTP_WXMANUAL=6,CPTTP_CHAT=7,CPTTP_ADDATTENT=8;var addParams=function addParams(params){var key=params.roleKey||ROLE_KEY.QQ,targetRole=params[key]||params[ROLE_KEY.QQ]||{};params.roleValue=targetRole.value;params.roleUin=targetRole.uin;params.roleData=targetRole.data;params.clickid=ids.createClickId();params.tpForm=TP_FORM.ICON;params.isKfuin=targetRole.isKfuin||0;params.isPub=targetRole.isPub;if(params.isPub){if(conf.isOA||conf.isDev||conf.isLocal){params.onlyMobile=false}else{params.onlyMobile=true}params.roleUin=targetRole.pub.uin;params.roleData=targetRole.data;params.value=targetRole.value}};var handleClickStart=function handleClickStart(params){var r=true;if(!params.id){r=false;alert("\u6B64\u5904\u53EA\u63D0\u4F9B\u6837\u5F0F\u9884\u89C8\uFF0C\u4E0D\u652F\u6301\u529F\u80FD\u9884\u89C8")}return r};exports.defaultEventType="click";exports.callAudioVideo=function(){var href=this.params.imUrl||this.params.url;var open=window.open(href);if(null===open||typeof open==="undefined"){window.location.href=href;return}};exports.openImUrl=function(){this.callAudioVideo()};exports.callClose=function(){this.remove();this.trigger("close")};exports.callChat=function(){var wpa=this.params.wpa;var fkfuin=wpa.params.fkfuin;var wpaId=wpa.params.id;var displayIframeId=DISPLAY.DISPLAY_IFRAME_ID+"_"+fkfuin+"_"+wpaId;var iframe=document.getElementById(displayIframeId);if(iframe){iframe.contentWindow.postMessage({act:DISPLAY_ACTS.IS_CLICKED_WPA,isClickedWpa:true},"*")}try{if(!handleClickStart(this.params)){return}this.params.roleKey=ROLE_KEY.QQ;addParams(this.params);this.params._tptype=this.params.roleQQ.value?CPTTP_CORPWPA:CPTTP_STAFFWPA;if(_typeof(win._gdtReportData)==="object"){win._gdtReportData.tptype=this.params._tptype}this.params.clickType=CLICK_TYPE.QQ;reportClick(this.params);__WPAV2.trigger("clicked",this.params);this.chat()}catch(err){__QDWPABUS.trigger("error",err)}};exports.callPhone=function(){try{if(!handleClickStart(this.params)){return}this.params.roleKey=ROLE_KEY.TEL;addParams(this.params);this.params._tptype=CPTTP_FREETEL;if(_typeof(win._gdtReportData)==="object"){win._gdtReportData.tptype=this.params._tptype}this.params.clickType=CLICK_TYPE.TEL;reportClick(this.params);__WPAV2.trigger("clicked",this.params);this.phone()}catch(err){__QDWPABUS.trigger("error",err)}};exports.callAddPal=function(){try{if(!handleClickStart(this.params)){return}this.params.roleKey=ROLE_KEY.KFEXT;addParams(this.params);this.params.clickType=CLICK_TYPE.KFEXT;reportClick(this.params);__WPAV2.trigger("clicked",this.params);this.addPal()}catch(err){__QDWPABUS.trigger("error",err)}};exports.callAddGroup=function(){try{if(!handleClickStart(this.params)){return}this.params.roleKey=ROLE_KEY.GROUP;addParams(this.params);this.params.clickType=CLICK_TYPE.GROUP;reportClick(this.params);__WPAV2.trigger("clicked",this.params);this.addGroup()}catch(err){__QDWPABUS.trigger("error",err)}};exports.callAddFan=function(){try{this.params.roleKey=ROLE_KEY.PUB;addParams(this.params);this.params.clickType=CLICK_TYPE.PUB;reportClick(this.params);__WPAV2.trigger("clicked",this.params);this.addFan()}catch(err){__QDWPABUS.trigger("error",err)}if(!handleClickStart(this.params)){return}};exports.callIm=function(){var wpa=this.params.wpa;var fkfuin=wpa.params.fkfuin;var wpaId=wpa.params.id;var displayIframeId=DISPLAY.DISPLAY_IFRAME_ID+"_"+fkfuin+"_"+wpaId;var iframe=document.getElementById(displayIframeId);if(iframe){iframe.contentWindow.postMessage({act:DISPLAY_ACTS.IS_CLICKED_WPA,isClickedWpa:true},"*")}try{this.params.roleKey=ROLE_KEY.IM;addParams(this.params);this.params.clickType=CLICK_TYPE.IM;reportClick(this.params);__WPAV2.trigger("clicked",this.params);this.im(extend({isClickWpa:true},this.params))}catch(err){__QDWPABUS.trigger("error",err)}if(!handleClickStart(this.params)){return}};function reportClick(params){params.reportType="click";params.wpa.trigger("click",params);setTimeout(function(){params.wpa.trigger("gdtReport",extend({reportType:"gdtReport"},win._gdtReportData))},120)}});LBF.define("util.GUID",function(){function S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}return function(){return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4()}});LBF.define("util.localStorage",function(require){var Cookie=require("util.Cookie"),trim=require("lang.trim"),isLSAllowed=true;try{var ls=window.localStorage;ls.setItem("lstest",1)}catch(e){isLSAllowed=false;if(window.localStorage){window.localStorage.setItem=function(){}}}var COOKIE_PREFIX="IELS";var EXPIRES=3153600000000;var doc=document,commonPattern=new RegExp("(?:^|[ ;])"+COOKIE_PREFIX+"[^=]+=([^;$])"),keyPattern=function keyPattern(key){return COOKIE_PREFIX+key},explore=function explore(callback){var attributes=doc.cookie.split(";"),i=0,length=attributes.length,items=[],match;if(callback){for(;i<length;i++){if(match=commonPattern.exec(attributes[i])){items.push(match[1]);callback(match[1])}}}else{for(;i<length;i++){(match=commonPattern.exec(attributes[i]))&&items.push(match[1])}}return items};return isLSAllowed?window.localStorage:{length:explore().length,key:function key(index){return explore()[index]||null},getItem:function getItem(key){return Cookie.get(keyPattern(key))},setItem:function setItem(key,value){Cookie.set(keyPattern(key),value,null,"/",EXPIRES);this.length=explore().length},removeItem:function removeItem(key){Cookie.del(key);this.length=explore().length},clear:function clear(){this.length=explore(function(item){Cookie.del(trim(item.split("=")[0]))}).length}}});LBF.define("util.sessionStorage",function(require){var isAllowed=true;try{var ss=window.sessionStorage;ss.setItem("lstest",1)}catch(e){isAllowed=false}var SESSION_STORAGE_PRE="WPASS_";return{setItem:function setItem(key,value){isAllowed&&ss.setItem(SESSION_STORAGE_PRE+key,value)},getItem:function getItem(key){return isAllowed&&ss.getItem(SESSION_STORAGE_PRE+key)},removeItem:function removeItem(key){isAllowed&&ss.removeItem(SESSION_STORAGE_PRE+key)}}});LBF.define("wpa.protocol.kfuin",function(require,exports,module){var jsonp=require("util.jsonp"),chatConst=require("wpa.conf.chat"),isFunction=require("lang.isFunction");var GET_KFUIN_URL=chatConst.WPL_B_QQ_COM_CONV;var kfuins={},count=0;return{get:function get(nameAccount,callback){!isFunction(callback)&&(callback=noop);if(!nameAccount||kfuins[nameAccount]){callback(kfuins[nameAccount]);return}var opts={num:nameAccount};jsonp(GET_KFUIN_URL,opts,function(rs){if(!rs||rs.r!==0){callback();return}var kfuin=kfuins[nameAccount]=rs.data.kfuin;callback(kfuin)})},set:function set(nameAccount,kfuin){kfuins[nameAccount]=kfuin}};function noop(){}});LBF.define("wpa.proto.custom",function(require,exports,module){var domEvent=require("wpa.util.domEvent"),conf=require("wpa.conf.config"),log=require("wpa.util.log"),offset=require("wpa.util.offset"),htReport=require("wpa.util.htReport"),win=conf.gWin,doc=win.document,body=doc.body,extend=require("lang.extend"),Reporter=require("wpa.protocol.Reporter"),forEach=require("lang.forEach"),wpaSSO=require("wpa.proto.wpaSSO"),ACTIONS={callChat:"callChat",callPhone:"callPhone",callAddPal:"callAddPal",callAddGroup:"callAddGroup",callAddFan:"callAddFan",callIm:"callIm",callAudioVideo:"callAudioVideo",openImUrl:"openImUrl"};var CUSTOM_TYPE_DOM=1,CUSTOM_TYPE_IMG=2;var getImgStyle=function getImgStyle(options){var zoom=options.zoom,width=options.width,height=options.height,h=options.h||{},v=options.v||{},hType=h.type,hPx=h.px,vType=v.type,vPx=v.px,ratio,customImgStyle=["position:fixed","cursor:pointer","z-index:1999999999"];if(zoom==0){if(hType==1){customImgStyle.push("left:"+hPx+"px")}else if(hType==2){customImgStyle.push("left:50%");customImgStyle.push("margin-left:-"+width/2+"px")}else{customImgStyle.push("right:"+hPx+"px")}if(vType==1){customImgStyle.push("top:"+vPx+"px")}else if(vType==2){customImgStyle.push("top:50%");customImgStyle.push("margin-top:-"+height/2+"px")}else{customImgStyle.push("bottom:"+vPx+"px")}customImgStyle.push("width:"+width+"px");customImgStyle.push("height:"+height+"px")}else if(zoom==1){customImgStyle.push("width:100%");customImgStyle.push("left:0");ratio=offset.getClientWidth()/width;height=height*ratio;customImgStyle.push("height:"+height+"px");if(vType==1){customImgStyle.push("top:"+vPx+"px")}else if(vType==2){customImgStyle.push("top:50%");customImgStyle.push("margin-top:-"+height/2+"px")}else{customImgStyle.push("bottom:"+vPx+"px")}}else{var clientHeight=offset.getClientHeight();ratio=clientHeight/height;width=width*ratio;customImgStyle.push("height:"+clientHeight+"px");customImgStyle.push("width:"+width+"px");customImgStyle.push("top:0");if(hType==1){customImgStyle.push("left:"+hPx+"px")}else if(hType==2){customImgStyle.push("left:50%");customImgStyle.push("margin-left:-"+width/2+"px")}else{customImgStyle.push("right:"+hPx+"px")}}return customImgStyle.join(";")+";"};var drawCustomImg=function drawCustomImg(params,action,wpa){var kfuin=params.fkfuin,id=params.id,iframeId=conf.CUSTOM_IMG_ID_PREFIX+kfuin+"_"+id,iframeClassName=conf.CUSTOM_IMG_CLASS_NAME,cImg=params.custom.customImg,zoom=cImg.zoom,url=cImg.url,customImgStyle=getImgStyle(cImg),imgParentDomId=params.imgParentDomId,imgId=conf.WPA_ID_PREFIX+kfuin+"_"+params.id;var strImg="<img src=\""+url+"\" class=\""+iframeClassName+"\" style=\""+customImgStyle+"\" />";var img;try{img=document.createElement(strImg)}catch(e){img=document.createElement("img");img.style.cssText=customImgStyle;img.setAttribute("src",url);img.setAttribute("class",iframeClassName);img.setAttribute("id",imgId)}img.onload=function(){domEvent.addEvent(img,"click",function(e){wpa[action]&&wpa[action]();e.preventDefault()});popperWxkfQrcode(img,img,params)};if(imgParentDomId){doc.getElementById(imgParentDomId).appendChild(img)}else{body.appendChild(img)}};var bindCustomDom=function bindCustomDom(customEle,action,wpa){var domIdStr="";if(typeof customEle==="string"){if(customEle.indexOf("#")===0){customEle=customEle.substring(1)}domIdStr=customEle;customEle=doc.getElementById(customEle)}if(!customEle){var errorMsg="[Custom DOM id not exist]dom id:"+domIdStr;throw errorMsg;return}domEvent.addEvent(customEle,"click",function(){if(wpa.params.isSSO){if(wpa.hasGetVid){wpa[action]&&wpa[action]()}else{wpaSSO.callBeforeLogin(wpa)}}else{wpa[action]&&wpa[action]()}});popperWxkfQrcode(customEle,customEle,wpa.params);var hookName=window["__qq_qidian_wpa"];var sdkObj=window[hookName];if(sdkObj&&sdkObj._q){forEach(sdkObj._q,function(interfaceArr){var apiName=interfaceArr[0],args=interfaceArr[1];if(apiName==="afterLogin"&&args[0].key===wpa.params.key){wpa.afterLogin.apply(wpa,args)}})}};exports.getAction=function(params){var action=ACTIONS.callChat;if(params.cate==conf.TYPES.IM){action=ACTIONS.callIm}else if(params.cate==conf.TYPES.KFEXT){action=ACTIONS.callAddPal}else if(params.cate==conf.TYPES.AUDIO||params.cate==conf.TYPES.VIDEO){action=ACTIONS.callAudioVideo}else if(params.cate==conf.TYPES.WXKF){action=ACTIONS.openImUrl}return action};exports.custom=function(params){var self=this,action=ACTIONS.callChat,custom=params.custom||{},customType=custom.customType;if(params.cate==conf.TYPES.IM){action=ACTIONS.callIm}else if(params.cate==conf.TYPES.KFEXT){action=ACTIONS.callAddPal}else if(params.cate==conf.TYPES.AUDIO||params.cate==conf.TYPES.VIDEO){action=ACTIONS.callAudioVideo}else if(params.cate==conf.TYPES.WXKF){action=ACTIONS.openImUrl}if(customType==CUSTOM_TYPE_IMG){drawCustomImg(params,action,self)}else{var customEle=custom.domId;bindCustomDom(customEle,action,self)}__WPAV2.trigger("inited",self.params);this.trigger("render",extend({reportType:"render"},params))};function popperWxkfQrcode(referenceEl,triggerEl,params){if(params.cate!=12||conf.isMobile){return}var qrcode_container_style=["display: none","width: 92.22px","height: 105.06px","font-size: 12px","padding: 6px","text-align: center","box-sizing: border-box","background-color: #fff","z-index: 100","line-height: 20px!important","box-shadow: 0 10px 23px 0 rgba(38, 45, 61, 0.2)"].join(";"),qrcode_style=["width: 77.82px","height: 77.82px","box-sizing: border-box","text-align: center","vertical-align: bottom"].join(";"),text_style=["line-height: 20px"];tooltipClassName="wxkf_tooltip_container";var tooltipEl,GLOBAL_WXKF_TOOLTIP_COUNT=++win["GLOBAL_WXKF_TOOLTIP_COUNT"],tooltipId="wxkf_tooltip_"+GLOBAL_WXKF_TOOLTIP_COUNT,strTooltip="<div id=\""+tooltipId+"\" class=\""+tooltipClassName+"\" style=\""+qrcode_container_style+"\">"+"<img src=\""+params.qrcode+"\" class=\""+""+"\" style=\""+qrcode_style+"\" />"+"<div style='"+text_style+"'>\u626B\u7801\u8FDB\u884C\u54A8\u8BE2</div>"+"<div data-popper-arrow class='wxkf_popper_arrow'></div>"+"</div>";try{tooltipEl=document.createElement(strTooltip)}catch(e){tooltipEl=document.createElement("div");tooltipEl.style.cssText=qrcode_container_style;tooltipEl.innerHTML="<img src='"+params.qrcode+"' style='"+qrcode_style+"' />"+"<div style='"+text_style+"'>\u626B\u7801\u8FDB\u884C\u54A8\u8BE2</div>"+"<div data-popper-arrow class='wxkf_popper_arrow'></div>";tooltipEl.setAttribute("class",tooltipClassName);tooltipEl.setAttribute("id",tooltipId)}referenceEl.parentNode.appendChild(tooltipEl);var popperInstance=Popper.createPopper(referenceEl,tooltipEl,{placement:"right",modifiers:[{name:"offset",options:{offset:[0,18]}},{name:"flip",options:{fallbackPlacements:["left","top","right","bottom"]}}]});function show(){tooltipEl.setAttribute("data-show","");popperInstance.setOptions(function(options){return extend(options,{modifiers:[{name:"eventListeners",enabled:true}].concat(options.modifiers)})});popperInstance.update()}function hide(){tooltipEl.removeAttribute("data-show");popperInstance.setOptions(function(options){return extend(options,{modifiers:[{name:"eventListeners",enabled:false}].concat(options.modifiers)})})}var showEvents=["mouseenter","focus"];var hideEvents=["mouseleave","blur"];showEvents.forEach(function(event){triggerEl.addEventListener(event,show)});hideEvents.forEach(function(event){triggerEl.addEventListener(event,hide)})}exports.popperWxkfQrcode=popperWxkfQrcode;exports.generateWxkfStyle=function(){if(doc.getElementById(conf.QIDIAN_WXKF_STYLE)){return}var styleList=[".wxkf_tooltip_container[data-show] {display: block!important;}",".wxkf_popper_arrow,.wxkf_popper_arrow::before {position: absolute;width: 12px;height: 12px;background: #fff;z-index:-1;left:0}",".wxkf_popper_arrow {visibility: hidden;}",".wxkf_popper_arrow::before {visibility: visible;content: '';transform: rotate(45deg);}",".wxkf_tooltip_container[data-popper-placement^='top'] > .wxkf_popper_arrow {bottom: -6px;}",".wxkf_tooltip_container[data-popper-placement^='bottom'] > .wxkf_popper_arrow {top: -6px;}",".wxkf_tooltip_container[data-popper-placement^='left'] > .wxkf_popper_arrow {right: -6px;}",".wxkf_tooltip_container[data-popper-placement^='right'] > .wxkf_popper_arrow {left: -6px;}"].join("\n");var style=doc.createElement("style");style.type="text/css";style.id=conf.QIDIAN_WXKF_STYLE;try{style.appendChild(doc.createTextNode(styleList))}catch(ex){style.styleSheet.cssText=styleList}var head=doc.getElementsByTagName("head")[0];head.appendChild(style)}});LBF.define("wpa.conf.config",function(require,exports,module){var globalSettings=require("globalSettings"),staticBase=globalSettings.staticBase,base=globalSettings.base,protocol=globalSettings.protocol,browser=require("lang.browser"),isMobile=browser.isAndroid||browser.isIOS,isLocal=location.hostname.indexOf("local.qiye.qq.com")!==-1,isSSL=location.protocol.indexOf("https")!==-1,host="admin.qidian.qq.com",protocolUrl={common:host+"/tp/wpaCall/getProtocol",mp:host+"/tp/wpaCall/getMpProtocol"},getScaleInfoUrl=host+"/qbf/aBTest/getGrayLevel",gWin=getGlobalWin(),isFengLing=false;function getGlobalWin(){var gWin=window;if(location.href.indexOf("qdconnect.html")!==-1&&location.search.indexOf("wp.qiye.qq.com")!==-1){gWin=isMobile?top:parent;isFengLing=true}return gWin}var win=gWin,doc=win.document,body=doc.body,ua=navigator.userAgent.toLowerCase(),isInAdmin=win.location.href.indexOf("admin.qidian.qq.com/tp/wpa")!==-1?true:false;var REGEXP_IPHONE_QQ=/\bQQ\/([\d\.]+)/i,REGEXP_IPAD_QQ=/\bIPadQQ\/([\d\.]+).*?\bQQ\/([\d\.]+)/i,REGEXP_ANDROID_QQ=/\bV1_AND_SQI?_([\d\.]+)(.*? QQ\/([\d\.]+))?/i,isInMobileQQ=REGEXP_IPHONE_QQ.test(ua)||REGEXP_IPAD_QQ.test(ua)||REGEXP_ANDROID_QQ.test(ua)||/(ipad|iphone|ipod).*? (ipad)?qq\/([\d.]+)|\bv1_and_sqi?_([\d.]+)(.*? qq\/([\d.]+))?/i.test(ua),isInWX=ua.indexOf("micromessenger")!==-1,isIE=ua.indexOf("msie")!==-1||!!window.ActiveXObject||"ActiveXObject"in window;if(typeof win.__WPAV2==="undefined"){win.__WPAV2=window.__WPAV2}var envPrefix="",isDev=false,isOA=false;__WPAENV=typeof __WPAENV!=="undefined"?__WPAENV:"production";if(__WPAENV=="development"){envPrefix="dev";isDev=true}else if(__WPAENV=="test"){envPrefix="oa";isOA=true}var localImUrl="http://local.qiye.qq.com/mockup/socket.html",localSocketUrl="http://local.qiye.qq.com/mockup/status_socket.html",localImUrl="https://localhost/dist/pc/index.html",localSocketUrl="https://localhost/dist/status/index.html",imUrl="https://"+envPrefix+"webpage.qidian.qq.com/qidian/chatv3/h5.html",grayImUrl="https://"+envPrefix+"webpage.qidian.qq.com/qidian/chatv3-gray/h5.html",pcImUrl="https://"+envPrefix+"webpage.qidian.qq.com/qidian/chatv3/pc.html",grayPcImUrl="https://"+envPrefix+"webpage.qidian.qq.com/qidian/chatv3-gray/pc.html",socketUrl="https://"+envPrefix+"webpage.qidian.qq.com/qidian/chatv3/statusManager/index.html",displayUrl="https://"+envPrefix+"webpage.qidian.qq.com/qidian/chatv3/displayManager/index.html";localDisplayUrl="http://local.qiye.qq.com/mockup/status_socket.html";if(!isMobile){imUrl=pcImUrl;grayImUrl=grayPcImUrl}if(isLocal){grayImUrl=localImUrl}var ieVersion=8;if(ua.indexOf("msie")>-1){var msie_vers=ua.match(/msie\s\d+/),vers=msie_vers&&msie_vers[0].match(/\d+/),ieVersion=vers?Number(vers):ieVersion}var wxVersion="0.0.0";if(ua.indexOf("micromessenger")>-1){var wx_vers=ua.match(/micromessenger\/([\d\.]+)/);wxVersion=wx_vers&&wx_vers[1]?wx_vers[1]:wxVersion}module.exports={appid:6,imageBaseUrl:staticBase+"/images",customBaseUrl:base,isSSL:isSSL,tencentSig:"tencentSig",WPA_LOGIN_CONFIG:{aid:"qdwpa_saas_user_id",d2:"qdwpa_saas_d2",uuid:"qdwpa_saas_uuid",imd2:"qdim_saas_d2",imuuid:"qdim_saas_uuid"},QIDIAN_WXKF_STYLE:"QIDIAN_WXKF_STYLE",customExtraParams:"_qidian_custom_extra_params",cgiDomain:"https://"+envPrefix+"admin.qidian.qq.com",CGIS:{GET_SIGT:{development:protocol+"//dev"+protocolUrl.common,test:protocol+"//oa"+protocolUrl.common,production:protocol+"//"+protocolUrl.common},GET_MP_SIGT:{development:protocol+"//dev"+protocolUrl.mp,test:protocol+"//oa"+protocolUrl.mp,production:protocol+"//"+protocolUrl.mp},GET_SCALE_INFO:{development:protocol+"//dev"+getScaleInfoUrl,test:protocol+"//oa"+getScaleInfoUrl,production:protocol+"//"+getScaleInfoUrl},GET_QQ_INVITE_SIGT:"https://"+envPrefix+"admin.qidian.qq.com/tp/wpaCall/getProtocol",CLOSE_INVITE_REPORT:"https://"+envPrefix+"admin.qidian.qq.com/webim/commonRequest/winClose",PC_CHECK_CALL_QQ_STATUS:"https://"+envPrefix+"admin.qidian.qq.com/webim/webImLogin/getAIOStatus",GET_COMMON_SSO_VISITORID:protocol+"//"+(isOA?"test":"")+"sdk.qidian.qq.com/v1/interface/inner/cloudim_324034"},PAGES:{VOICE_JUMP_PAGE:"https://"+envPrefix+"lbs.qidian.qq.com/authorize/voiceShow"},host:host,ENV:typeof __WPAENV!=="undefined"?__WPAENV:"production",TYPES:{QQ:1,PHONE:2,PUB:3,GROUP:4,KFEXT:5,IM:7,AUDIO:10,VIDEO:11,WXKF:12},SCROLL_TOP_NAME:"__QD_SCROLL_TOP",GLOBAL_WPA:"__qd_wpas",KFUINS:"KFUINS",WPAS_BASED_ON_KFUIN:"WPAS_BASED_ON_KFUIN",CUSTOM_IMG_ID_PREFIX:"_qidian_wpa_img_",CUSTOM_IMG_CLASS_NAME:"qidian_wpa_img",SOCKET:{URL:isLocal?localSocketUrl:socketUrl,SOCKET_IFRAME_ID:"_QD_STATUS_MANAGE_SOCKET_IFRAME",ACTS:{SM_READY:"SM_READY",SM_INIT:"SM_INIT",SM_UNREAD:"SM_UNREAD",SM_INVITE_CONF:"SM_INVITE_CONF",SM_MANUAL_INVITE:"SM_MANUAL_INVITE",SM_INVITE_RET:"SM_INVITE_RET",SM_REFUSE:"SM_REFUSE",SMS_SM_FORCE_CONNECT:"SMS_SM_FORCE_CONNECT",SM_CHAT_OVER:"SM_CHAT_OVER",UPDATE_UNREAD:"UPDATE_UNREAD",DISCONNECT:"DISCONNECT",SM_BIND_WPA_IM_AID:"SM_BIND_WPA_IM_AID"}},DISPLAY:{DISPLAY_IFRAME_ID:"_QD_DISPLAY_IFRAME_SOCKET_IFRAME",DISPLAY_ID_IFRAME_ID:"_QD_DISPLAY_ID_IFRAME_SOCKET_IFRAME",URL:isLocal?localDisplayUrl:displayUrl,ACTS:{SM_DISPLAY:"SM_DISPLAY",IS_CLICKED_WPA:"IS_CLICKED_WPA",SM_DISPLAYED_COUNT:"SM_DISPLAYED_COUNT"}},INVITATION_TYPE:{OFFLINE:3,AUTO:4},UNREAD_MSG_INFO:"UNREAD_MSG_INFO",INVITE_IFRAME_ID_PREFIX:"_QD_INVITE_IFRAME_ID_PREFIX_",KFUIN_INVITED_TIMES:"KFUIN_INVITED_TIMES",WPA_ID_PREFIX:"qidian_wpa_",WEB_IM:{WEB_IM_IFRAMES_OBJ_NAME:"_QIDIAN_WEB_IM_IFRAMES",WEB_IM_IFRAME_ID:"_QIDIAN_WEB_IM_IFRAME_",WEB_IM_IFRAMES_LOADED:"_QIDIAN_WEB_IM_IFRAMES_LOADED",WPAS_IM_TYPE:"WPAS_IM_TYPE",POSITION_HELP_EL:"__QD_IM_POSITION_HELPER",URL:isLocal?localImUrl:imUrl,URL_SCALE:grayImUrl,ACTS:{DRAG_START:"DRAG_START",DRAG_END:"DRAG_END",DRAG_MOVE:"DRAG_MOVE",UNREAD:"UNREAD",OPEN:"OPEN",CLOSE:"CLOSE",INIT:"INIT",LAUNCH:"LAUNCH",INPUT:"INPUT",FOCUS:"FOCUS",BLUR:"BLUR",OPEN_IMG:"OPEN_IMG",SHOW:"SHOW",SIMUUNREAD:"SIMUUNREAD",AUTH:"AUTH",WPA_SSO_AUTH:"WPA_SSO_AUTH",ERROR_AUTH:"ERROR_AUTH",ON_IMSDK_READY:"ON_IMSDK_READY"},LAUNCH_TYPES:{QQ:"QQ",PHONE:"PHONE"}},isMobile:isMobile,isLocal:isLocal,isDev:isDev,isOA:isOA,isFengLing:isFengLing,gWin:gWin,ua:ua,eptype:isMobile?2:1,GLOBAL_INVITE_TPL_AND_CONF:"GLOBAL_INVITE_TPL_AND_CONF",winWidth:body.offsetWidth,winHeight:body.offsetHeight,IM_CHAT_IFRAME_OPENING:"IM_CHAT_IFRAME_OPENING",isInAdmin:isInAdmin,BROWSER_ENV:{isInMobileQQ:isInMobileQQ,isMqq:isInMobileQQ,isInWX:isInWX,wxVersion:wxVersion,isIE:isIE,ieVersion:ieVersion,isIOS:browser.isIOS,isAndroid:browser.isAndroid},ROLE_KEY:{QQ:"roleQQ",TEL:"roleTEL",KFEXT:"roleKFEXT",GROUP:"roleGROUP",PUB:"rolePUB",IM:"roleIM"},CLICK_TYPE:{QQ:1,TEL:2,KFEXT:5,GROUP:4,PUB:3,IM:6},TP_FORM:{ICON:1,LINK:2,QR:3},SANDBOX_ID:"__QIDIAN_SANDBOX",sandbox:win,IM_ORIGIN:"webpage.qidian.qq.com",IM_ORIGIN_REG:isLocal?/^((http(s)?:\/\/local.qiye.qq.com(\/)?)|(https?:\/\/localhost\/?))$/:/^http(s)?:\/\/(dev|oa)?webpage\.qidian\.qq.com(\/)?$/,badjs:{id:1367,random:1},POST_MESSAGE_FLAG:"QD_PM",POST_MESSAGE_FLAG_CONTENT:"WPA",IM_LANG:{key:"qidian_lang",defaultLang:"zh-cn",availableList:["zh-cn","en-us","zh-tw"]},INSTALL_QQ_IFRAME_ID_PREFIX:"_QD_INSTALL_QQ_IFRAME_ID_PREFIX_",DOWNLOAD_QQ_TIMEOUT:9000,DOWNLOAD_QQ_URL:{PC:"//im.qq.com/download",Android:"//a.app.qq.com/o/simple.jsp?pkgname=com.tencent.mobileqq",iOS:"//itunes.apple.com/cn/app/qq-2011/id444934666?mt=8"},WPA_SSO_AUTHTYPE:"tencentSSO"}});LBF.define("lang.browser",function(require,exports){var ua=navigator.userAgent.toLowerCase(),matched,browser;var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];var matchIe11;if(ua.indexOf("trident")>-1&&(matchIe11=/rv:([\d.]+)/.exec(ua))){match[1]="msie";match[2]=matchIe11[1]}matched={browser:match[1]||"",version:match[2]||"0"};if(matched.browser){exports[matched.browser]=true;exports.version=matched.version}if(exports.chrome){exports.webkit=true}else if(exports.webkit){exports.safari=true}var isIE=exports.msie,majorVersion=parseInt(exports.version,10);var isMobile=exports.isMobile=ua.match(/(nokia|iphone|android|motorola|^mot\-|softbank|foma|docomo|kddi|up\.browser|up\.link|htc|dopod|blazer|netfront|helio|hosin|huawei|novarra|CoolPad|webos|techfaith|palmsource|blackberry|alcatel|amoi|ktouch|nexian|samsung|^sam\-|s[cg]h|^lge|ericsson|philips|sagem|wellcom|bunjalloo|maui|symbian|smartphone|midp|wap|phone|windows ce|iemobile|^spice|^bird|^zte\-|longcos|pantech|gionee|^sie\-|portalmmm|jig\s browser|hiptop|^ucweb|^benq|haier|^lct|opera\s*mobi|opera\*mini|320x320|240x320|176x220)/i);exports.isWin=/windows|win32/.test(ua);exports.isMac=/Mac/.test(ua);exports.isIOS=/(?:iphone|ipad|ipod)/i.test(ua);exports.isAndroid=/android/i.test(ua);exports.browser=matched.browser||"";exports.majorVersion=majorVersion;exports.isIE6=isIE&&majorVersion===6;exports.isIE9=isIE&&majorVersion===9;exports.isIE9Below=isIE&&majorVersion<9;exports.isMobile=isMobile});LBF.define("wpa.protocol.Reporter",function(require,exports,module){var reportConst=require("wpa.conf.report"),JSON=require("lang.JSON"),removeCustomProp=require("wpa.util.removeCustomProperty"),formReport=require("wpa.util.formReport"),config=require("wpa.conf.config"),win=config.gWin,ENV=config.ENV,jsonp=require("util.jsonp"),browser=require("lang.browser"),extend=require("lang.extend"),globalSettings=require("globalSettings"),getCPType=require("wpa.proto.getCPType");var env={development:"devadmin.",test:"oaadmin.",production:"admin."},domainPrefix=env[globalSettings.debug]||"",REPORT_DOMAIN="https://"+domainPrefix+"qidian.qq.com",reportUrls={render:"/ar/ActCap/ActRpt",click:"/ar/ActCap/ActRpt",gdtReport:"/ar/actCap/gdtRpt"},EVENT_TYPE_LOAD=1,EVENT_TYPE_CLICK=2,cid=0,CB_NAME="jsonp_cb_",COMMON_REPORT="commonReport",GDT_REPORT="gdtReport",hostname=location.hostname;var getTaskIdInArticlePage=function getTaskIdInArticlePage(){var result={},articleDomains=["post.mp.qq.com","article.mp.qq.com","mp.weixin.qq.com","wap.qidian.qq.com"].join(",");if(articleDomains.indexOf(hostname)!==-1){var matchedTaskId=location.href.match(/taskid=\d+/);result.taskid=matchedTaskId?matchedTaskId[0].split("=")[1]:0;var matchedSceneid=location.href.match(/sceneid=\d+/);result.sceneid=matchedSceneid?matchedSceneid[0].split("=")[1]:0}return result};var report=function report(reportType,params){var reportUrl=REPORT_DOMAIN+reportUrls[reportType];if(reportType===GDT_REPORT&&win._gdtReportData!=0){formReport({action:reportUrl,data:win._gdtReportData});return}var actualKfext=params.fkfuin;switch(params.cate){case 1:{actualKfext=params.roleQQ.value==0?params.roleQQ.data:actualKfext;break}case 2:{actualKfext=params.roleTEL.value==0?params.roleTEL.data:actualKfext;break}case 3:{actualKfext=params.rolePUB.uin;break}case 4:{break}case 5:{actualKfext=params.roleKFEXT.data;break}}var commonOptions={mid:"",id:params.id,cate:params.cate,type:params.type,visitorid:params.guid,qidianid:params.guid,kfuin:params.fkfuin,kfext:actualKfext,ldpg:win.location.href,refurl:typeof document.referrer!=="undefined"?document.referrer:"",ua:window.navigator.userAgent,title:encodeURIComponent(document.title),eptype:browser.isMobile?2:1,pid:params.pid,qid:params.qid,env:ENV,isKfuin:params.roleQQ&&params.roleQQ.isKfuin||0};if(params.customEnterSwitch==1){commonOptions.qidian_src_desc=encodeURIComponent(win.qidian_src_desc)||"";commonOptions.qidian_track_id=win.qidian_track_id||""}extend(commonOptions,getTaskIdInArticlePage());if(reportType==="render"){dataObj=getVisitData(params,commonOptions)}else if(reportType==="click"){var tptype=getCPType(params);params.tptype=tptype.tptype;dataObj=extend({eventtp:EVENT_TYPE_CLICK,clickType:params.clickType,clickid:params.clickid||"",tpForm:params.tpForm},extend(commonOptions,tptype))}else{return}var GLOBAL=win;var HOOK_NAME="__qq_qidian_da_market";var EXPORT_NAME=GLOBAL[HOOK_NAME]||"qidianDA";if(!EXPORT_NAME){return}var qidianDA=GLOBAL[EXPORT_NAME];var wpa_tptype_name={0:"\u672A\u77E5",1:"\u4F01\u4E1AWPA",2:"\u5458\u5DE5WPA",3:"\u514D\u8D39\u7535\u8BDD",4:"\u52A0QQ\u7FA4",5:"\u52A0QQ\u597D\u53CB",6:"\u516C\u4F17\u53F7\u4EBA\u5DE5\u5BA2\u670D",7:"\u4F1A\u8BDD",8:"\u5173\u6CE8\u516C\u4F17\u53F7",9:"webim"};var wpa_category={1:"QQ\u63A5\u5F85",3:"\u516C\u4F17\u53F7\u63A8\u5E7F",4:"\u7FA4\u63A8\u5E7F",5:"\u5458\u5DE5\u63A8\u5E7F",7:"\u7F51\u9875\u63A5\u5F85",8:"\u4F01\u70B9\u63A5\u5F85",101:"\u7535\u8BDD\u63A5\u5F85"};function getUrlQuery(variable){var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable){return pair[1]}}return""};function checkExit(val){return Boolean(val||val===0)};var eventData={wpaid:checkExit(dataObj.id)?Number(dataObj.id):"",wpa_category_id:checkExit(dataObj.cate)?Number(dataObj.cate):"",wpa_category:checkExit(dataObj.cate)?String(wpa_category[dataObj.cate]||""):"",wpa_type:checkExit(dataObj.type)?Number(dataObj.type):"",kfext:checkExit(dataObj.kfext)?Number(dataObj.kfext):"",wpa_visitorid:checkExit(dataObj.visitorid)?Number(dataObj.visitorid):"",$url:decodeURI(dataObj.ldpg),$title:decodeURI(dataObj.title),wpa_cckey:String(getUrlQuery("cckey")||"")||"",wpa_eventtp:checkExit(dataObj.eventtp)?Number(dataObj.eventtp):"",wpa_tptype:checkExit(dataObj.tptype)?Number(dataObj.tptype):"",wpa_tptype_name:checkExit(dataObj.tptype)?String(wpa_tptype_name[dataObj.tptype]||""):""};if(reportType==="click"){eventData.wpa_clickid=checkExit(dataObj.clickid)?String(dataObj.clickid):""}var reportTypeMap={click:"im_wpa_click",render:"im_wpa_view"};if(!qidianDA){if(!GLOBAL["qidian_readyToRpt"]){GLOBAL["qidian_readyToRpt"]=[]}GLOBAL["qidian_readyToRpt"].push({type:reportTypeMap[reportType],data:eventData})}else{qidianDA("track",reportTypeMap[reportType],eventData)}};var getVisitData=function getVisitData(params,commonOptions){var obj=getCPType(params);obj.eventtp=EVENT_TYPE_LOAD;return extend(obj,commonOptions)};exports.report=report});LBF.define("wpa.proto.basicCgiCall",function(require,exports,module){var conf=require("wpa.conf.config"),win=conf.gWin,CGIS=conf.CGIS,ENV=conf.ENV,WPA=win.__WPAV2,WPAS_BASED_ON_KFUIN=conf.WPAS_BASED_ON_KFUIN,log=require("wpa.util.log"),removeCustomProp=require("wpa.util.removeCustomProperty"),jsonp=require("util.jsonp"),browser=require("lang.browser"),isMobile=browser.isAndroid||browser.isIOS;var TIMEOUT_GAP=1000,IS_GRAY=1;WPA.cgiCalls={};WPA.imUrls={};function setImUrl(options,kfuin){var result=options&&options.isGray||0;WPA.imUrls[kfuin]=conf.WEB_IM.URL;if(result==IS_GRAY){conf.WEB_IM.URL=conf.WEB_IM.URL_SCALE;WPA.imUrls[kfuin]=conf.WEB_IM.URL_SCALE}if(conf.isOA){var branch=window.__WEBIM_BRANCH;if(branch){conf.WEB_IM.URL=conf.WEB_IM.URL.replace(/chat(-gray|-customer)?[^/]*/,branch);WPA.imUrls[kfuin]=conf.WEB_IM.URL}}}function initWpaIm(wpa){wpa.trigger("initIm")}WPA.cgiCalls.getScaleInfo=exports.getScaleInfo=function(options,wpa){options=options||{};var isGrayInfoFetched=false;var defaultSetting={result:0};var kfuin=options.kfuin,url=CGIS.GET_SCALE_INFO[ENV],timeout=null;var cb=function cb(r){if(isGrayInfoFetched){return log("[getScaleInfo][callback] is fetched already")}clearTimeout(timeout);isGrayInfoFetched=true;r=r&&r.result||0;var result={isGray:r};conf.isGray=wpa.env.isGray=r;setImUrl(result,kfuin);initWpaIm(wpa)};if(conf.isLocal){url="http://localhost:3000/isGray"}var opts={kfuin:kfuin};jsonp(url,opts,cb);timeout=setTimeout(function(){log("[getScaleInfo]setTimeout executed");cb(defaultSetting)},TIMEOUT_GAP)}});LBF.define("wpa.util.getRootDomain",function(require,exports,module){var Cookie=require("util.Cookie"),conf=require("wpa.conf.config"),win=conf.gWin,inArray=require("lang.inArray");var doc=win.document,hostname=win.location.hostname,hostnameLength=hostname.length,domains=hostname.split("."),domainLength=domains.length,subDomain="",EXPIRES=1000*60*60*24*365,ROOT_DOMAIN_NAME="__root_domain_v",isCookieEnabled=win.navigator.cookieEnabled,rootDomain;var domainBlackList=[".qq.com"];var getRootDomain=function getRootDomain(){for(var i=domainLength-1;i>=0;i--){subDomain="."+domains[i]+subDomain;if(inArray(subDomain,domainBlackList)!==-1){continue}Cookie.set(ROOT_DOMAIN_NAME,subDomain,subDomain,"/",EXPIRES);if(Cookie.get(ROOT_DOMAIN_NAME)){rootDomain=subDomain;break}}subDomain="";return rootDomain};exports.getRootDomain=getRootDomain;exports.isCookieEnabled=isCookieEnabled});LBF.define("wpa.util.ids",function(require,exports,module){var conf=require("wpa.conf.config"),win=conf.gWin,doc=win.document,QID_PREFIX="QD.";var base36=function base36(num){return num.toString(36)};var hash=function hash(str){var hash=1;if(str){var charCode=0;hash=0;for(var i=str.length-1;i>=0;i--){charCode=str.charCodeAt(i);hash=(hash<<6&268435455)+charCode+(charCode<<14);charCode=hash&266338304;hash=charCode!=0?hash^charCode>>21:hash}}return hash};var random=function random(){var random;try{var arr=new Uint32Array(1);win.crypto.getRandomValues(arr);random=arr[0]&2147483647}catch(b){random=Math.floor(Math.random()*2147483648)}return random};var createPid=function createPid(needPrefix){var uaAndCookieAndRefAndHref=win.navigator.userAgent+(doc.cookie?doc.cookie:"")+(doc.referrer?doc.referrer:"")+win.location.href;var result=base36(random()^hash(uaAndCookieAndRefAndHref)&2147483647)+"."+base36(random())+"."+base36(+new Date);return needPrefix?QID_PREFIX+result:result};var createClickId=createPid;var createQid=createPid;var createRandomId=function createRandomId(){var chars="0123456789",randomId=[],i;randomId[0]=0|Math.random()*10||1;for(i=1;i<4;i++){randomId[i]=chars[0|Math.random()*10]}return randomId.join("")+new Date().getTime().toString().slice(2,13)};var createUuid32=function createUuid32(){return"xxxxxxxxxxxxxxxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})};exports.createPid=createPid;exports.createClickId=createClickId;exports.createQid=createQid;exports.createRandomId=createRandomId;exports.createUuid32=createUuid32});LBF.define("wpa.util.base64",function(require,exports,module){var version="3.7.5";var VERSION=version;var _hasatob=typeof atob==="function";var _hasbtoa=typeof btoa==="function";var _hasBuffer=typeof Buffer==="function";var _TD=typeof TextDecoder==="function"?new TextDecoder:undefined;var _TE=typeof TextEncoder==="function"?new TextEncoder:undefined;var b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var b64chs=Array.prototype.slice.call(b64ch);var b64tab=function(a){var tab={};a.forEach(function(c,i){return tab[c]=i});return tab}(b64chs);var b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;var _fromCC=String.fromCharCode.bind(String);var _U8Afrom=typeof Uint8Array.from==="function"?Uint8Array.from.bind(Uint8Array):function(it){return new Uint8Array(Array.prototype.slice.call(it,0))};var _mkUriSafe=function _mkUriSafe(src){return src.replace(/=/g,"").replace(/[+\/]/g,function(m0){return m0=="+"?"-":"_"})};var _tidyB64=function _tidyB64(s){return s.replace(/[^A-Za-z0-9\+\/]/g,"")};var btoaPolyfill=function btoaPolyfill(bin){var u32,c0,c1,c2,asc="";var pad=bin.length%3;for(var i=0;i<bin.length;){if((c0=bin.charCodeAt(i++))>255||(c1=bin.charCodeAt(i++))>255||(c2=bin.charCodeAt(i++))>255)throw new TypeError("invalid character found");u32=c0<<16|c1<<8|c2;asc+=b64chs[u32>>18&63]+b64chs[u32>>12&63]+b64chs[u32>>6&63]+b64chs[u32&63]}return pad?asc.slice(0,pad-3)+"===".substring(pad):asc};var _btoa=_hasbtoa?function(bin){return btoa(bin)}:_hasBuffer?function(bin){return Buffer.from(bin,"binary").toString("base64")}:btoaPolyfill;var _fromUint8Array=_hasBuffer?function(u8a){return Buffer.from(u8a).toString("base64")}:function(u8a){var maxargs=4096;var strs=[];for(var i=0,l=u8a.length;i<l;i+=maxargs){strs.push(_fromCC.apply(null,u8a.subarray(i,i+maxargs)))}return _btoa(strs.join(""))};var fromUint8Array=function fromUint8Array(u8a){var urlsafe=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return urlsafe?_mkUriSafe(_fromUint8Array(u8a)):_fromUint8Array(u8a)};var cb_utob=function cb_utob(c){if(c.length<2){var cc=c.charCodeAt(0);return cc<128?c:cc<2048?_fromCC(192|cc>>>6)+_fromCC(128|cc&63):_fromCC(224|cc>>>12&15)+_fromCC(128|cc>>>6&63)+_fromCC(128|cc&63)}else{var cc=65536+(c.charCodeAt(0)-55296)*1024+(c.charCodeAt(1)-56320);return _fromCC(240|cc>>>18&7)+_fromCC(128|cc>>>12&63)+_fromCC(128|cc>>>6&63)+_fromCC(128|cc&63)}};var re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g;var utob=function utob(u){return u.replace(re_utob,cb_utob)};var _encode=_hasBuffer?function(s){return Buffer.from(s,"utf8").toString("base64")}:_TE?function(s){return _fromUint8Array(_TE.encode(s))}:function(s){return _btoa(utob(s))};var encode=function encode(src){var urlsafe=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return urlsafe?_mkUriSafe(_encode(src)):_encode(src)};var encodeURI=function encodeURI(src){return encode(src,true)};var re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g;var cb_btou=function cb_btou(cccc){switch(cccc.length){case 4:var cp=(7&cccc.charCodeAt(0))<<18|(63&cccc.charCodeAt(1))<<12|(63&cccc.charCodeAt(2))<<6|63&cccc.charCodeAt(3),offset=cp-65536;return _fromCC((offset>>>10)+55296)+_fromCC((offset&1023)+56320);case 3:return _fromCC((15&cccc.charCodeAt(0))<<12|(63&cccc.charCodeAt(1))<<6|63&cccc.charCodeAt(2));default:return _fromCC((31&cccc.charCodeAt(0))<<6|63&cccc.charCodeAt(1));}};var btou=function btou(b){return b.replace(re_btou,cb_btou)};var atobPolyfill=function atobPolyfill(asc){asc=asc.replace(/\s+/g,"");if(!b64re.test(asc))throw new TypeError("malformed base64.");asc+="==".slice(2-(asc.length&3));var u24,bin="",r1,r2;for(var i=0;i<asc.length;){u24=b64tab[asc.charAt(i++)]<<18|b64tab[asc.charAt(i++)]<<12|(r1=b64tab[asc.charAt(i++)])<<6|(r2=b64tab[asc.charAt(i++)]);bin+=r1===64?_fromCC(u24>>16&255):r2===64?_fromCC(u24>>16&255,u24>>8&255):_fromCC(u24>>16&255,u24>>8&255,u24&255)}return bin};var _atob=_hasatob?function(asc){return atob(_tidyB64(asc))}:_hasBuffer?function(asc){return Buffer.from(asc,"base64").toString("binary")}:atobPolyfill;var _toUint8Array=_hasBuffer?function(a){return _U8Afrom(Buffer.from(a,"base64"))}:function(a){return _U8Afrom(_atob(a).split("").map(function(c){return c.charCodeAt(0)}))};var toUint8Array=function toUint8Array(a){return _toUint8Array(_unURI(a))};var _decode=_hasBuffer?function(a){return Buffer.from(a,"base64").toString("utf8")}:_TD?function(a){return _TD.decode(_toUint8Array(a))}:function(a){return btou(_atob(a))};var _unURI=function _unURI(a){return _tidyB64(a.replace(/[-_]/g,function(m0){return m0=="-"?"+":"/"}))};var decode=function decode(src){return _decode(_unURI(src))};var isValid=function isValid(src){if(typeof src!=="string")return false;var s=src.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(s)||!/[^\s0-9a-zA-Z\-_]/.test(s)};var _noEnum=function _noEnum(v){return{value:v,enumerable:false,writable:true,configurable:true}};var extendString=function extendString(){var _add=function _add(name,body){return Object.defineProperty(String.prototype,name,_noEnum(body))};_add("fromBase64",function(){return decode(this)});_add("toBase64",function(urlsafe){return encode(this,urlsafe)});_add("toBase64URI",function(){return encode(this,true)});_add("toBase64URL",function(){return encode(this,true)});_add("toUint8Array",function(){return toUint8Array(this)})};var extendUint8Array=function extendUint8Array(){var _add=function _add(name,body){return Object.defineProperty(Uint8Array.prototype,name,_noEnum(body))};_add("toBase64",function(urlsafe){return fromUint8Array(this,urlsafe)});_add("toBase64URI",function(){return fromUint8Array(this,true)});_add("toBase64URL",function(){return fromUint8Array(this,true)})};var extendBuiltins=function extendBuiltins(){extendString();extendUint8Array()};var gBase64={version:version,VERSION:VERSION,atob:_atob,atobPolyfill:atobPolyfill,btoa:_btoa,btoaPolyfill:btoaPolyfill,fromBase64:decode,toBase64:encode,encode:encode,encodeURI:encodeURI,encodeURL:encodeURI,utob:utob,btou:btou,decode:decode,isValid:isValid,fromUint8Array:fromUint8Array,toUint8Array:toUint8Array,extendString:extendString,extendUint8Array:extendUint8Array,extendBuiltins:extendBuiltins};exports.encode=encode;exports.decode=decode});LBF.define("wpa.util.log",function(require){var conf=require("wpa.conf.config");return function(str){if(typeof console!=="undefined"&&typeof console.log==="function"){if(conf.isOA)console.log(str)}}});LBF.define("util.Cookie",function(){var doc=document,isCookieAllowed=true;try{var c=doc.cookie}catch(e){isCookieAllowed=false}return{set:!isCookieAllowed?function(){}:function(name,value,domain,path,expires){if(expires){expires=new Date(+new Date+expires)}var tempcookie=name+"="+escape(value)+(expires?"; expires="+expires.toGMTString():"")+(path?"; path="+path:"")+(domain?"; domain="+domain:"");tempcookie+=";secure=true";if(tempcookie.length<4096){doc.cookie=tempcookie}return this},get:!isCookieAllowed?function(){return""}:function(name){var carr=doc.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));if(carr!=null){return unescape(carr[2])}return null},del:!isCookieAllowed?function(){}:function(name,domain,path){if(this.get(name)){doc.cookie=name+"="+(path?"; path="+path:"")+(domain?"; domain="+domain:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}return this},find:!isCookieAllowed?function(){}:function(pattern){return doc.cookie.match(pattern)}}});LBF.define("wpa.proto.chat",function(require,exports,module){var browser=require("lang.browser"),chatProtocol=require("wpa.protocol.chat"),chatConst=require("wpa.conf.chat"),getQQVersion=require("wpa.protocol.getQQVersion"),chatSelect=require("wpa.proto.chatSelect"),proxy=require("lang.proxy"),conf=require("wpa.conf.config"),report=require("util.report"),win=conf.gWin,log=require("wpa.util.log"),href=win.location.href,parseQS=require("wpa.util.parseQuerystring"),openMqqPage=require("wpa.util.openMqqPage");var ERROR_MSG_PC_NOT_ALLOWED="\u4EC5\u652F\u6301\u79FB\u52A8\u7AEF\u54A8\u8BE2\uFF0C\u8BF7\u91CD\u65B0\u4F7F\u7528\u624B\u673AQQ\u53D1\u8D77\u54A8\u8BE2",LAUNCH_MOBILE_QQ=chatConst.LAUNCH_MOBILE_QQ;exports.chat=function(cb){var wpa=this,onChat=proxy(function(){cb&&cb.apply(this,arguments);this.trigger("chat")},this),isMobile=browser.isIOS||browser.isAndroid,onlyMobile=this.params.onlyMobile;var type=parseInt(this.params.chatType||chatConst.CHAT_TYPE_AUTO,10);var kfuin=this.params.fkfuin,visitorId=this.params.guid,wpaId=this.params.id,pid=this.params.pid,qid=this.params.qid,key=this.params.key,clickid=this.params.clickid,roleValue=this.params.roleValue,roleData=this.params.roleData,env="";if(conf.ENV=="development"){env="dev"}else if(conf.ENV=="test"){env="oa"}if(this.params.videoSwitch==1){if(!isMobile){return}var reportUrl="https://"+env+"lbs.qidian.qq.com/videomp/openaio";try{var _appid=href.match(/_appid=\d+/)[0].split("=")[1],_code=href.match(/code=[a-z0-9]+/i)[0].split("=")[1];reportUrl+="?appid="+_appid+"&code="+_code;report(reportUrl)}catch(e){log("[chat.js][videoSwitch]get params error")}return}if(this.params.customEnterSwitch==1){var mediaId=this.params.mediaId,lbsUrl="https://"+env+"lbs.qidian.qq.com/authorize/show";if(this.params.voice){if(!isMobile){return alert("\u6682\u4E0D\u652F\u6301PC\u7AEF\u6253\u5F00")}lbsUrl=conf.PAGES.VOICE_JUMP_PAGE;lbsUrl+="?id="+wpaId+"&roleData="+roleData+"&roleValue="+roleValue+"&key="+key+"&qid="+qid+"&pid="+pid+"&voice=1&clickid="+clickid+"&mediaId="+mediaId+"&visitorId="+visitorId+"&kfuin="+kfuin+"&_bid=2399";return win.location.href=LAUNCH_MOBILE_QQ+"?mqqPage="+lbsUrl}if(this.params.paramSwitch){lbsUrl="https://"+env+"lbs.qidian.qq.com/location/update";var qidian_track_id=window.qidian_track_id||"",qidian_src_desc=window.qidian_src_desc||"",qidian_ex1=window.qidian_ex1||"",qidian_ex2=window.qidian_ex2||"",qidian_ex3=window.qidian_ex3||"",qidian_ex4=window.qidian_ex4||"",qidian_ex5=window.qidian_ex5||"",guestId=window.guestId||"";var lbsDataStr="cb=lbs_cb&guestId="+guestId+"&type=2&wpaId="+wpaId+"&mediaId="+mediaId+"&isMobile="+(isMobile?1:0)+"&kfuin="+kfuin+"&visitorId="+visitorId+"&roleData="+roleData+"&roleValue="+roleValue+"&qidian_track_id="+qidian_track_id+"&qidian_src_desc="+qidian_src_desc+"&qidian_ex1="+qidian_ex1+"&qidian_ex2="+qidian_ex2+"&qidian_ex3="+qidian_ex3+"&qidian_ex4="+qidian_ex4+"&qidian_ex5="+qidian_ex5+"&clickid="+clickid+"&wpa_type="+(this.params.LBSswitch?1:2)+"&pid="+pid+"&key="+key+"&qid="+qid,lbsData=parseQS(lbsDataStr);chatProtocol.LBSChat(lbsData,lbsUrl);return}lbsUrl+="?id="+wpaId+"&roleData="+roleData+"&roleValue="+roleValue+"&key="+key+"&qid="+qid+"&pid="+pid+"&clickid="+this.params.clickid+"&mediaId="+mediaId+"&visitorId="+visitorId+"&kfuin="+kfuin+"&_bid=2399";if(!isMobile){win.open(lbsUrl)}else{win.location.href=LAUNCH_MOBILE_QQ+"?fid="+wpaId+"&roleData="+roleData+"&roleValue="+roleValue+"&key="+key+"&kfuin="+kfuin+"&cate=1&mqqPage="+lbsUrl}return}if(onlyMobile&&!isMobile){if(this.params.isPub){var url=conf.host+"/template/blue/wpa/launch-qr-code.html?qrCodeImg="+this.params.qrCodeImg;if(conf.ENV==="development"){url="https://dev"+url}else if(conf.ENV==="test"){url="https://oa"+url}else{url="https://"+url}return window.open(url)}return alert(ERROR_MSG_PC_NOT_ALLOWED)}if(isMobile){return this.mobileChat(onChat)}if(type===chatConst.CHAT_TYPE_QQ){return this.PCChat(onChat)}return this.PCChat(onChat);if(!browser.msie){return this.PCChat(onChat)}getQQVersion(function(version){if(version){browser.msie&&wpa.PCChat(onChat);return}new chatSelect({onAIOChat:function onAIOChat(){wpa.PCChat(onChat)},onAnonyChat:function onAnonyChat(){wpa.anonyChat(onChat)}})})};exports.PCChat=function(onChat){var wpa=this;chatProtocol.PCChat(this.params,function(){onChat.apply(wpa,arguments);wpa.trigger("PCChat")})};exports.mobileChat=function(onChat){var wpa=this;chatProtocol.mobileChat(this.params,function(){onChat.apply(wpa,arguments);wpa.trigger("mobileChat")})};exports.anonyChat=function(onChat){var wpa=this;chatProtocol.anonyChat(this.params,function(){onChat.apply(wpa,arguments);wpa.trigger("anonyChat")})};exports.linkChat=function(onChat){var wpa=this;chatProtocol.linkChat(this.params,function(){onChat.apply(wpa,arguments);wpa.trigger("linkChat")})}});LBF.define("wpa.proto.phone",function(require,exports,module){var browser=require("lang.browser"),jsonp=require("util.jsonp"),isFunction=require("lang.isFunction"),conf=require("wpa.conf.config"),isInMobileQQ=conf.BROWSER_ENV.isInMobileQQ,win=conf.gWin;var CGIS=conf.CGIS,TYPE_PC=0,TYPE_MOBILE=1,isMobile=browser.isMobile,ENV=conf.ENV,envMapping={development:"devadmin.",test:"oaadmin.",production:"admin."};var ua=navigator.userAgent.toLowerCase(),body=document.getElementsByTagName("body")[0];exports.phone=function(cb){var params=this.params;if(!isMobile){return alert("\u6765\u7535\u4EC5\u9650\u79FB\u52A8\u7AEF\u547C\u8D77")}var URL="https://"+envMapping[ENV]+"qidian.qq.com/lighttalk/CallCheck?source=1&wpaId="+params.id+"&id="+params.fkfuin+"&vid="+params.guid+"&cate="+params.cate+"&wpa_type="+params.type+"&pid="+params.pid+"&clickid="+params.clickid+"&qid="+params.qid+"&sourceUrl="+win.location.href+"&refurl="+(typeof document.referrer!=="undefined"?document.referrer:""),LANDING_URL="https://"+envMapping[ENV]+"qidian.qq.com/template/blue/mp/menu/wx-jump-phone.html?url="+encodeURIComponent(URL);setTimeout(function(){if(isInMobileQQ){return win.location.href=URL}return win.location.href=LANDING_URL},500);return;if(!isInMobileQQ){var schema=getURL(LANDING_URL);if(browser.isIOS){return win.location.href=schema}var div=document.createElement("div"),start=+new Date;div.style.visibility="hidden";div.style.width=0;div.style.height=0;div.innerHTML="<iframe id=\"schema\" src=\""+schema+"\" scrolling=\"no\" width=\"0\" height=\"0\"></iframe>";body.appendChild(div);setTimeout(function(){var gap=+new Date-start;if(gap<1000){}body.removeChild(div);isFunction(cb)&&cb(params)},800)}else{win.location.href=URL}function getURL(jumpURL){var androidVersion=ua.match(/android\s\d\.\d\.\d/);androidVersion=androidVersion?androidVersion[0].replace("android ",""):"0.0.0";if(0&&browser.isAndroid&&androidVersion>"5"){return"intent://forward/url?src_type=web&style=default&=1&version=1&url_prefix="+btoa(jumpURL)+"#Intent;scheme=mqqapi;package=com.tencent.mobileqq;end"}else{return"mqqapi://forward/url?src_type=web&style=default&=1&version=1&url_prefix="+btoa(jumpURL)}}}});LBF.define("wpa.proto.add",function(require,exports,module){var browser=require("lang.browser"),jsonp=require("util.jsonp"),chatConst=require("wpa.conf.chat"),isFunction=require("lang.isFunction"),serialize=require("util.serialize"),conf=require("wpa.conf.config"),CLICK_TYPE=conf.CLICK_TYPE,launch=require("wpa.util.launch"),eptype=conf.eptype,removeCustomProp=require("wpa.util.removeCustomProperty"),win=conf.gWin;var CGIS=conf.CGIS,TYPE_PC=0,TYPE_MOBILE=1,isMobile=browser.isMobile,isInMobileQQ=conf.BROWSER_ENV.isInMobileQQ,ENV=conf.ENV,envMapping={development:"devadmin.",test:"oaadmin.",production:"admin."},LAUNCH_MOBILE_QQ=chatConst.LAUNCH_MOBILE_QQ;var ua=navigator.userAgent.toLowerCase(),body=document.getElementsByTagName("body")[0];exports.addPal=function(cb){var params=this.params,opts={kfuin:params.fkfuin,kfext:params.fkfext,visitorId:params.guid,visitorid:params.guid,fid:params.id,key:params.key,cate:params.cate,type:params.type,ftype:isMobile?TYPE_MOBILE:TYPE_PC,pid:params.pid,clickid:params.clickid,tpForm:params.tpForm,qid:params.qid,env:ENV,eptype:eptype,tptype:params.tptype,clickType:params.clickType,roleKey:params.roleKey,roleValue:params.roleValue,roleUin:params.roleUin,roleData:params.roleData};jsonp(CGIS.GET_SIGT[ENV],opts,function(rs){if(!rs||rs.r!==0||!rs.data){return alert(rs.data.message||ERROR_MSG_INVALID_STAFF)}var schema=rs.data.sign;if(isInMobileQQ){return win.location.href=schema}if(!isMobile){return launch(schema,{needMobileJump:true,targetPage:LAUNCH_MOBILE_QQ})}return win.location.href=LAUNCH_MOBILE_QQ+"?kfuin="+params.fkfuin+"&fid="+params.id+"&key="+params.key+"&protocol="+schema})};exports.addGroup=function(cb){var params=this.params,opts={kfuin:params.fkfuin,kfext:params.fkfext,visitorId:params.guid,visitorid:params.guid,fid:params.id,key:params.key,cate:params.cate,type:params.type,ftype:isMobile?TYPE_MOBILE:TYPE_PC,pid:params.pid,clickid:params.clickid,tpForm:params.tpForm,qid:params.qid,env:ENV,eptype:eptype,tptype:params.tptype,clickType:params.clickType,roleKey:params.roleKey,roleValue:params.roleValue,roleUin:params.roleUin,roleData:params.roleData};jsonp(CGIS.GET_SIGT[ENV],opts,function(rs){if(!rs||rs.r!==0||!rs.data){return alert(rs.data.message||ERROR_MSG_INVALID_STAFF)}var schema=rs.data.sign;if(isInMobileQQ){return win.location.href=schema}if(!isMobile){return launch(schema,{needMobileJump:true,targetPage:LAUNCH_MOBILE_QQ})}return win.location.href=LAUNCH_MOBILE_QQ+"?kfuin="+params.fkfuin+"&fid="+params.id+"&key="+params.key+"&protocol="+schema})};exports.addFan=function(cb){if(!browser.isMobile){return alert("\u52A0\u5173\u6CE8\u4EC5\u9650\u79FB\u52A8\u7AEF\u547C\u8D77")}var params=this.params,opts={kfuin:params.fkfuin,kfext:params.fkfext,visitorId:params.guid,visitorid:params.guid,fid:params.id,key:params.key,cate:params.cate,type:params.type,ftype:TYPE_MOBILE,pid:params.pid,clickid:params.clickid,tpForm:params.tpForm,qid:params.qid,env:ENV,eptype:eptype,clickType:params.clickType,tptype:params.tptype,roleKey:params.roleKey,roleValue:params.roleValue,roleUin:params.roleUin,roleData:params.roleData};jsonp(CGIS.GET_SIGT[ENV],opts,function(rs){if(!rs||rs.r!==0||!rs.data){return alert(rs.data.message||ERROR_MSG_INVALID_STAFF)}var schema=rs.data.sign;if(isInMobileQQ){return win.location.href=schema}return win.location.href=LAUNCH_MOBILE_QQ+"?"+serialize(opts)+"&protocol="+schema})};function getURL(jumpURL){var androidVersion=ua.match(/android\s\d\.\d\.\d/);androidVersion=androidVersion?androidVersion[0].replace("android ",""):"0.0.0";if(browser.isAndroid&&androidVersion>"5"){return"intent://forward/url?src_type=web&style=default&=1&version=1&url_prefix="+btoa(jumpURL)+"#Intent;scheme=mqqapi;package=com.tencent.mobileqq;end"}else{return"mqqapi://forward/url?src_type=web&style=default&=1&version=1&url_prefix="+btoa(jumpURL)}}});LBF.define("wpa.proto.im",function(require,exports,module){var conf=require("wpa.conf.config"),eptype=conf.eptype,KFUINS=conf.KFUINS,POST_MESSAGE_FLAG=conf.POST_MESSAGE_FLAG,POST_MESSAGE_FLAG_CONTENT=conf.POST_MESSAGE_FLAG_CONTENT,CLICK_TYPE=conf.CLICK_TYPE,isInAdmin=conf.isInAdmin,isMobile=conf.isMobile,localStorage=require("util.localStorage"),INVITATION_TYPE=conf.INVITATION_TYPE,extend=require("lang.extend"),ACTS=conf.WEB_IM.ACTS,SCROLL_TOP_NAME=conf.SCROLL_TOP_NAME,WEB_IM=conf.WEB_IM,WEB_IM_IFRAME_ID=WEB_IM.WEB_IM_IFRAME_ID,WPAS_IM_TYPE=WEB_IM.WPAS_IM_TYPE,GLOBAL_WPA_NAME=conf.GLOBAL_WPA,UNREAD_MSG_INFO=conf.UNREAD_MSG_INFO,POSITION_HELP_EL=conf.WEB_IM.POSITION_HELP_EL,GLOBAL_INVITE_TPL_AND_CONF=conf.GLOBAL_INVITE_TPL_AND_CONF,WEB_IM_IFRAMES_LOADED=conf.WEB_IM.WEB_IM_IFRAMES_LOADED,log=require("wpa.util.log"),offset=require("wpa.util.offset"),winWidth=offset.getClientWidth(),winHeight=offset.getClientHeight(),domEvent=require("wpa.util.domEvent"),UnreadMsgCircle=require("wpa.proto.UnreadMsgCircle"),Invite=require("wpa.invite.main"),ids=require("wpa.util.ids"),browser=require("lang.browser"),CustomParams=require("wpa.proto.CustomParams"),JSON=require("lang.JSON"),lang=require("wpa.im.lang"),LANG_KEY=conf.IM_LANG.key,dragging=false,moveOri={};var win=conf.gWin,doc=win.document,body=doc.body,closeStyleOffset={x:10,y:10},originalTopBodyCssText;var QD_WPA_BODY_CLASS_NAME="QD_WPA_BODY_CLASS_NAME",QD_WPA_STYLE_NODE_ID="QD_WPA_STYLE_NODE";var preventEvent=function preventEvent(e){e&&typeof e.preventDefault==="function"&&e.preventDefault()};win[SCROLL_TOP_NAME]=typeof win[SCROLL_TOP_NAME]!=="undefined"?win[SCROLL_TOP_NAME]:0;var iframeSizeInPC=function(){var height=600;if(winHeight>900){height=700}return{height:height}}();var styles={mobile:{open:["right:0;"].join(""),close:["right:-3000px;"].join("")},pc:{open:["right:10px","bottom:10px","width:360px","height:"+iframeSizeInPC.height+"px","border-bottom-left-radius:6px","border-bottom-right-radius:6px","display:block"].join(";")+";",close:["width:300px","height:50px","bottom:0"].join(";")+";"}},openStyle=isMobile?styles.mobile.open:styles.pc.open,closeStyle=isMobile?styles.mobile.close:styles.pc.close;var getTarget=function getTarget(options){var kfuin=options.kfuin,imIframe=doc.getElementById(WEB_IM_IFRAME_ID+kfuin);return{imIframe:imIframe}};exports.getwpaLoginConfig=function(kfuin,wpaData){if(wpaData.isSSO){return wpaData.authInfo}var WPA_LOGIN_CONFIG=conf.WPA_LOGIN_CONFIG;var localStorageKey={aid:"".concat(WPA_LOGIN_CONFIG.aid,"_").concat(kfuin),d2:"".concat(WPA_LOGIN_CONFIG.d2,"_").concat(kfuin),uuid:"".concat(WPA_LOGIN_CONFIG.uuid,"_").concat(kfuin),imd2:"".concat(WPA_LOGIN_CONFIG.imd2,"_").concat(kfuin),imuuid:"".concat(WPA_LOGIN_CONFIG.imuuid,"_").concat(kfuin)};var aid=localStorage.getItem(localStorageKey.aid);var d2=localStorage.getItem(localStorageKey.d2)||"";var uuid=localStorage.getItem(localStorageKey.uuid);if(!aid){aid=ids.createRandomId();localStorage.setItem(localStorageKey.aid,aid)}if(!uuid){uuid=ids.createUuid32();localStorage.setItem(localStorageKey.uuid,uuid)}var imd2=localStorage.getItem(localStorageKey.imd2)||"";var imuuid=localStorage.getItem(localStorageKey.imuuid)||"";if(imuuid){localStorage.setItem(localStorageKey.imd2,"");localStorage.setItem(localStorageKey.imuuid,"");imd2=""}return{aid:aid,d2:d2,uuid:uuid,imd2:imd2,imuuid:uuid}};exports.moveChatIframe=function(options){if(!dragging)return;var params=options,kfuin=params.fkfuin||params.kfuin||options.kfuin,target=getTarget({kfuin:kfuin}),imIframe=target.imIframe;var moveObj=params.data;var right=moveOri.x-moveObj.x;var bottom=moveOri.y-moveObj.y;if(right>0&&right+moveOri.w<moveOri.maxW){imIframe.style.right=right+"px"}if(bottom>0&&bottom+moveOri.h<moveOri.maxH){imIframe.style.bottom=bottom+"px"}};exports.moveChatIframeEnd=function(options){moveOri={};dragging=false};exports.moveChatIframeStart=function(options){var params=options,kfuin=params.fkfuin||params.kfuin||options.kfuin,target=getTarget({kfuin:kfuin}),imIframe=target.imIframe;var originB=imIframe.style.bottom;var originR=imIframe.style.right;var reg=/^(\d+)px$/;if(originR.match(reg)){originRNum=Number(originR.match(reg)[1])}if(originB.match(reg)){originBNum=Number(originB.match(reg)[1])}dragging=true;moveOri={x:originRNum,y:originBNum,h:parseInt(imIframe.style.height,10),w:parseInt(imIframe.style.width,10),maxH:window.innerHeight,maxW:window.innerWidth}};exports.openChatIframe=function(options){options=options||{};var isClickWpa=options.isClickWpa,invitationType=options.invitationType,seq=options.seq,B2Ckey=options.key,type=options.type,receptionUin=options.receptionUin,receptionName=options.receptionName||"",isDirectOpen=options.isDirectOpen,onlyOpen=options.onlyOpen,isB2C=options.isB2C,sendMsg;var params=isDirectOpen||onlyOpen?options:this.params||{},kfuin=params.fkfuin||params.kfuin||options.kfuin,target=getTarget({kfuin:kfuin}),imIframe=target.imIframe,id=params.id,visitorid=params.guid,roleIM=params.roleIM||params.roleQQ||{},roleValue=roleIM.value,roleData=roleIM.data,wpaKey=params.key,clickid=options.clickid||params.clickid||ids.createClickId(),gvid=visitorid||localStorage.getItem(conf.tencentSig)||localStorage.getItem("tencentSig"),translateSwitch=params.translateSwitch||0,WPA_LOGIN_CONFIG=this.getwpaLoginConfig(kfuin,params);if(!win[WEB_IM_IFRAMES_LOADED][kfuin]){return log(kfuin+" webim iframe is still initing...")}if(isClickWpa){var _params=this.params,clickWpaReportObj={cate:_params.cate,type:_params.type,pid:_params.pid,qid:_params.qid,clickType:_params.clickType,tptype:_params.tptype,tpForm:_params.tpForm,eptype:eptype}}if(isMobile){UnreadMsgCircle.removeAllRedCircles(kfuin)}if(win.__WPAV2[KFUINS]&&win.__WPAV2[KFUINS][kfuin]&&win.__WPAV2[KFUINS][kfuin].unread){win.__WPAV2[KFUINS][kfuin].unread.socket=0}Invite.clearInvitePanel({kfuin:kfuin});if(!imIframe||imIframe.getAttribute("data-isOpen")==1){return log("[im.js]no im iframe found")}win.__WPAV2.IM_CHAT_IFRAME_OPENING=1;if(isMobile){if(conf.ua.indexOf("ucbrowser")!==-1){if(!doc.getElementById(QD_WPA_STYLE_NODE_ID)){var hiddenOriginalBodyStyle=doc.createElement("style");hiddenOriginalBodyStyle.type="text/css";hiddenOriginalBodyStyle.id=QD_WPA_STYLE_NODE_ID;var parent=doc.getElementsByTagName("body")[0];parent.insertBefore(hiddenOriginalBodyStyle,parent.firstChild);var hiddenOriginalBodyCssText="."+QD_WPA_BODY_CLASS_NAME+" > * {visibility:hidden!important;}."+QD_WPA_BODY_CLASS_NAME+" {background: white!important;}";if(hiddenOriginalBodyStyle.styleSheet){hiddenOriginalBodyStyle.styleSheet.cssText=hiddenOriginalBodyCssText}else{hiddenOriginalBodyStyle.appendChild(doc.createTextNode(hiddenOriginalBodyCssText))}}body.className+=" "+QD_WPA_BODY_CLASS_NAME}originalTopBodyCssText=win.document.body.style.cssText;win[SCROLL_TOP_NAME]=offset.getNewScrollTop();win.document.body.style.cssText+="position:fixed;left:0;top:0;width:100%;";domEvent.addEvent(top,"touchmove",preventEvent)}imIframe.style.cssText+=openStyle;imIframe.setAttribute("data-isOpen","1");if(win.wpaShowItemId){options.wpaShowItemId=win.wpaShowItemId}var tencentToken=WPA_LOGIN_CONFIG.imd2;var tencentUuid=WPA_LOGIN_CONFIG.uuid;if(options.openUnread){options.act=ACTS.OPEN;options.visitorid=WPA_LOGIN_CONFIG.aid;options.translateSwitch=translateSwitch;options[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;options[LANG_KEY]=lang.getLang();options.token=tencentToken;options.tencentSig=gvid;if(!options.token){options.uuid=tencentUuid}CustomParams.setCustomParams(options);sendMsg=JSON.stringify(options);imIframe.contentWindow.postMessage(sendMsg,"*");return}if(isDirectOpen){sendMsg={kfuin:kfuin,seq:seq,roleData:receptionUin,roleValue:"0",invitationType:type,onlyOpen:onlyOpen,clickid:clickid,visitorid:WPA_LOGIN_CONFIG.aid,act:ACTS.OPEN,translateSwitch:translateSwitch,token:tencentToken,tencentSig:gvid};if(win.wpaShowItemId){sendMsg.wpaShowItemId=win.wpaShowItemId}if(!sendMsg.token){sendMsg.uuid=tencentUuid}sendMsg[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;sendMsg[LANG_KEY]=lang.getLang();CustomParams.setCustomParams(sendMsg);sendMsg=JSON.stringify(sendMsg);imIframe.contentWindow.postMessage(sendMsg,"*");return}var inviteConf=win.__WPAV2[GLOBAL_INVITE_TPL_AND_CONF][kfuin],key=inviteConf?inviteConf.key:null,openParam={kfuin:kfuin,wpaId:id,visitorid:gvid,wpaKey:wpaKey,roleValue:options.roleValue||roleValue,roleData:options.roleData||roleData,act:ACTS.OPEN,onlyOpen:onlyOpen,clickid:clickid,isClickWpa:isClickWpa?1:0,translateSwitch:translateSwitch,token:tencentToken};if(!openParam.token){openParam.uuid=tencentUuid}if(invitationType){openParam=extend(openParam,{invitationType:invitationType,key:key})}if(win.__WPAV2[UNREAD_MSG_INFO][kfuin]){if(!openParam.wpaId){var ctx=win.__WPAV2["WPAS_IM_TYPE"][kfuin]&&win.__WPAV2["WPAS_IM_TYPE"][kfuin][0];openParam.wpaId=ctx&&ctx.params.id}}if(win.__WPAV2[UNREAD_MSG_INFO][kfuin]&&!isClickWpa){}win.__WPAV2[UNREAD_MSG_INFO][kfuin]=undefined;if(isB2C){openParam.seq=seq;openParam.invitationType=type;openParam.key=B2Ckey}if(isClickWpa){openParam=extend(openParam,clickWpaReportObj)}openParam.visitorid=WPA_LOGIN_CONFIG.aid;openParam.tencentSig=gvid;if(win.wpaShowItemId){openParam.wpaShowItemId=win.wpaShowItemId}openParam[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;openParam[LANG_KEY]=lang.getLang();CustomParams.setCustomParams(openParam);openParam=JSON.stringify(openParam);imIframe.contentWindow.postMessage(openParam,"*");var resize=function resize(){if(!isMobile){if(imIframe.getAttribute("data-isOpen")==1){if(offset.getClientHeight()>900){imIframe.style.cssText+="height:700px"}else{imIframe.style.cssText+="height:600px"}}}};window.onresize=resize;resize()};exports.closeChatIframe=function(options){var kfuin=options.kfuin;var target=getTarget({kfuin:kfuin}),imIframe=target.imIframe;if(!imIframe||imIframe.getAttribute("data-isOpen")==0){return log("[im.js]no im iframe found or already closed")}win.__WPAV2.IM_CHAT_IFRAME_OPENING=0;if(isMobile){if(conf.ua.indexOf("ucbrowser")!==-1){body.className=body.className.replace(QD_WPA_BODY_CLASS_NAME,"")}clearTimeout(win.__qd_keyboard_interval);win.document.body.style.cssText=originalTopBodyCssText;win.scrollTo(0,win[SCROLL_TOP_NAME]||0);closeStyle="right:-3000px;";imIframe.style.cssText+=closeStyle;domEvent.removeEvent(top,"touchmove",preventEvent)}else{imIframe.style.cssText+=imIframe._styles.close}imIframe.setAttribute("data-isOpen","0")};exports.sendMsgToIM=function sendMsgToIM(options){var params=options;var kfuin=params.fkfuin||params.kfuin;var target=getTarget({kfuin:kfuin}),imIframe=target.imIframe;if(!imIframe||imIframe.getAttribute("data-isOpen")==0){return log("[im.js]no im iframe found or already closed")}var iWin=imIframe.contentWindow;var roleIM=params.roleIM||params.roleQQ||{},roleValue=roleIM.value,roleData=roleIM.data,WPA_LOGIN_CONFIG=this.getwpaLoginConfig(kfuin,params);var sendObj={act:ACTS.WPA_SSO_AUTH,kfuin:params.fkfuin,wpaId:params.id,wpaKey:params.key,isMobile:isMobile,visitorid:WPA_LOGIN_CONFIG.aid,auth:18,secretKey:params.secretKey,ssoAuthData:params.ssoAuthData,token:WPA_LOGIN_CONFIG.imd2,tencentSig:params.guid};if(!sendObj.token){sendObj.uuid=WPA_LOGIN_CONFIG.uuid}sendObj[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;sendObj=JSON.stringify(sendObj);iWin.postMessage(sendObj,"*")};var OPEN_TYPE_CURRENT=1,OPEN_TYPE_NEW=2,IM_WIDTH=760,IM_HEIGHT=640;var showImWin=function showImWin(params){var imUrl=params.imUrl,customParams=CustomParams.getCustomParams(),customParam;if(imUrl.indexOf("?")!==-1){imUrl+="&"}else{imUrl+="?"}imUrl+="visitorid="+params.guid+"&clickid="+params.clickid;customParams[LANG_KEY]=lang.getLang();for(customParam in customParams){imUrl+="&"+customParam+"="+customParams[customParam]}var QIDIAN_WPA_CUSTOMER=window.QIDIAN_WPA_CUSTOMER||{};if(QIDIAN_WPA_CUSTOMER.auth==1){imUrl+="&auth=1&auth_pid="+(QIDIAN_WPA_CUSTOMER.auth_pid||"")+"&auth_paccount="+(QIDIAN_WPA_CUSTOMER.auth_paccount||"")}var QIDIAN_WPA_USERINFO=window.QIDIAN_WPA_USERINFO||null;var QIDIAN_WPA_AUTH=window.QIDIAN_WPA_AUTH||"";var qidianWpaUserinfo="";if(QIDIAN_WPA_USERINFO){try{qidianWpaUserinfo=encodeURIComponent(JSON.stringify(QIDIAN_WPA_USERINFO))}catch(err){}}if(QIDIAN_WPA_AUTH){try{imUrl+="&auth="+QIDIAN_WPA_AUTH+"&userinfo="+qidianWpaUserinfo}catch(err){}}var left=(winWidth-IM_WIDTH)/2,top=(winHeight-IM_HEIGHT)/2;var imWin=win.open(encodeURI(imUrl),"_blank","top="+top+", left="+left+", width="+IM_WIDTH+", height="+IM_HEIGHT)};exports.im=function(params){var custom=params.custom||{},open=custom.open||OPEN_TYPE_CURRENT;if(params.isCustom&&open==OPEN_TYPE_NEW&&!isMobile){return showImWin(params)}var isGray=this.env.isGray;if(isInAdmin||this.params.isImForbidden){return alert("\u7F51\u9875\u63A5\u5F85\u7C7B\u578B\u63A5\u5F85\u7EC4\u4EF6\u6682\u4E0D\u652F\u6301\u529F\u80FD\u9884\u89C8")}if(conf.BROWSER_ENV.isIE&&conf.BROWSER_ENV.ieVersion<8){return alert("\u60A8\u7684\u6D4F\u89C8\u5668\u7248\u672C\u8FC7\u4F4E\uFF0C\u8BF7\u5347\u7EA7")}this.openChatIframe(params)};exports.set=function(key,value){if(key===conf.IM_LANG.key){lang.setLang(value)}}});LBF.define("wpa.im.init",function(require,exports,module){var browser=require("lang.browser"),conf=require("wpa.conf.config"),POST_MESSAGE_FLAG=conf.POST_MESSAGE_FLAG,POST_MESSAGE_FLAG_CONTENT=conf.POST_MESSAGE_FLAG_CONTENT,isInMobileQQ=conf.BROWSER_ENV.isInMobileQQ,KFUINS=conf.KFUINS,ROLE_KEY=conf.ROLE_KEY,WPAS_BASED_ON_KFUIN=conf.WPAS_BASED_ON_KFUIN,LANG_KEY=conf.IM_LANG.key,offset=require("wpa.util.offset"),onIframeLoaded=require("wpa.util.onIframeLoaded"),isMobile=conf.isMobile,GLOBAL_WPA_NAME=conf.GLOBAL_WPA,log=require("wpa.util.log"),JSON=require("lang.JSON"),launch=require("wpa.util.launch"),domEvent=require("wpa.util.domEvent"),JSON=require("lang.JSON"),platformAuthorization=require("wpa.util.platformAuthorization"),getAuthorizationPageUrl=require("wpa.util.getAuthorizationPageUrl"),serialize=require("util.serialize"),lang=require("wpa.im.lang"),UNREAD_MSG_INFO=conf.UNREAD_MSG_INFO,wpaSSO=require("wpa.proto.wpaSSO"),xssFilter=require("util.xssFilter"),Cookie=require("util.Cookie"),getRootDomain=require("wpa.util.getRootDomain"),im=require("wpa.proto.im"),SOCKET=conf.SOCKET,SOCKET_IFRAME_ID=SOCKET.SOCKET_IFRAME_ID;var win=conf.gWin,doc=win.document,body=doc.body,WPA=win.__WPAV2,POSITION_HELP_EL=conf.WEB_IM.POSITION_HELP_EL,initWidth=offset.getClientWidth(),initHeight=offset.getClientHeight(),WEB_IM_URL,WEB_IM_IFRAME_ID=conf.WEB_IM.WEB_IM_IFRAME_ID,WEB_IM_IFRAMES_OBJ_NAME=conf.WEB_IM.WEB_IM_IFRAMES_OBJ_NAME,WEB_IM_IFRAMES_LOADED=conf.WEB_IM.WEB_IM_IFRAMES_LOADED,ACTS=conf.WEB_IM.ACTS,SOCKET_ACTS=conf.SOCKET.ACTS,LAUNCH_TYPES=conf.WEB_IM.LAUNCH_TYPES,INIT_COMMON_WEB_IM_IFRAME_STYLE,COMMON_WEB_IM_IFRAME_STYLE=["position:fixed;","z-index:2000000010;"].join(""),imIframesNum=0,closeStyleOffset={x:10,y:10},CSS={PC:{right:10,width:300}},MOBILE_WEB_IM_IFRAME_STYLE=["width:100%","height:100%","border:none!important","transition: all .4s;","right:-3000px","top:0","bottom:0","visibility:visible!important"].join(";")+";",PC_WEB_IM_IFRAME_STYLE=["width: 300px","height: 50px","bottom:0","right:{right}","box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16)","border-top-left-radius: 6px","border-top-right-radius: 6px","border-bottom-left-radius: 0","border-bottom-right-radius: 0"].join(";")+";",imInitQueues={};INIT_COMMON_WEB_IM_IFRAME_STYLE=COMMON_WEB_IM_IFRAME_STYLE;if(isMobile){COMMON_WEB_IM_IFRAME_STYLE=COMMON_WEB_IM_IFRAME_STYLE+MOBILE_WEB_IM_IFRAME_STYLE}win[WEB_IM_IFRAMES_OBJ_NAME]=win[WEB_IM_IFRAMES_OBJ_NAME]?win[WEB_IM_IFRAMES_OBJ_NAME]:{};win[WEB_IM_IFRAMES_LOADED]=win[WEB_IM_IFRAMES_LOADED]?win[WEB_IM_IFRAMES_LOADED]:{};var isImIframeLoaded=exports.isImIframeLoaded=function(kfuin){return win[WEB_IM_IFRAMES_OBJ_NAME][kfuin]?true:false};var isImIframeReady=exports.isImIframeReady=function(kfuin){return win[WEB_IM_IFRAMES_LOADED][kfuin]?true:false};var cacheImMsg=exports.cacheImMsg=function(kfuin,msg){imInitQueues[kfuin]=imInitQueues[kfuin]?imInitQueues[kfuin]:[];imInitQueues[kfuin].push(msg)};var initIframe=exports.initIframe=function(params,wpa){params=params||{};var kfuin=params.fkfuin,id=params.id,iframeId=WEB_IM_IFRAME_ID+kfuin,visitorid=params.guid,WEB_IM_URL=conf.WEB_IM.URL,url=WPA.imUrls[kfuin],targetRole=params[ROLE_KEY.IM]||params[ROLE_KEY.QQ],roleValue=targetRole.value,roleData=targetRole.data,translateSwitch=params.translateSwitch||0,WPA_LOGIN_CONFIG=im.getwpaLoginConfig(kfuin,params),initObj={kfuin:kfuin,wpaId:id,opentype:params.custom&&params.custom.open,wpaKey:params.key,act:ACTS.INIT,isMobile:isMobile,visitorid:WPA_LOGIN_CONFIG.aid,roleData:roleData,roleValue:roleValue,translateSwitch:translateSwitch,tencentSig:visitorid};var QIDIAN_WPA_CUSTOMER=window.QIDIAN_WPA_CUSTOMER||{};if(QIDIAN_WPA_CUSTOMER.auth==1){initObj.auth=1;initObj.auth_pid=QIDIAN_WPA_CUSTOMER.auth_pid||"";initObj.auth_paccount=QIDIAN_WPA_CUSTOMER.auth_paccount||"";initObj.auth_mode=QIDIAN_WPA_CUSTOMER.auth_mode||""}var QIDIAN_WPA_USERINFO=window.QIDIAN_WPA_USERINFO||{};var QIDIAN_WPA_AUTH=window.QIDIAN_WPA_AUTH||"";if(QIDIAN_WPA_USERINFO){try{initObj.userInfo=encodeURIComponent(JSON.stringify(QIDIAN_WPA_USERINFO))}catch(err){}}if(QIDIAN_WPA_AUTH){try{initObj.auth=QIDIAN_WPA_AUTH}catch(err){}}if(params.isSSO){initObj.auth=conf.WPA_SSO_AUTHTYPE;initObj.secretKey=params.secretKey;initObj.isRoamMessage=params.isRoamMessage;initObj.ssoAuthData=params.ssoAuthData;initObj.token=WPA_LOGIN_CONFIG.d2}cacheImMsg(kfuin,initObj);if(!isImIframeLoaded(kfuin)){if(!isMobile){var actualPcRight=(CSS.PC.width+CSS.PC.right)*imIframesNum++ +CSS.PC.right+"px";COMMON_WEB_IM_IFRAME_STYLE=INIT_COMMON_WEB_IM_IFRAME_STYLE;COMMON_WEB_IM_IFRAME_STYLE=COMMON_WEB_IM_IFRAME_STYLE+PC_WEB_IM_IFRAME_STYLE.replace("{right}",actualPcRight);var PC_CLOSE_IFRAME_STYLE=COMMON_WEB_IM_IFRAME_STYLE;COMMON_WEB_IM_IFRAME_STYLE+="display:none;"}var strIframe="<iframe scrolling=\"no\" allow=\"camera *; microphone *\" id=\""+iframeId+"\" frameborder=\"0\" width=\"100%\" height=\"100%\" allowtransparency=\"true\" src=\""+url+"\" style=\""+COMMON_WEB_IM_IFRAME_STYLE+"\"></iframe>";var iframe;try{iframe=document.createElement(strIframe)}catch(e){iframe=document.createElement("iframe");iframe.width=initWidth;iframe.height=initHeight;iframe.id=iframeId;iframe.style.cssText=COMMON_WEB_IM_IFRAME_STYLE;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src",url);iframe.setAttribute("allow","camera *; microphone *")}iframe._styles={close:PC_CLOSE_IFRAME_STYLE};body.appendChild(iframe);if(isMobile){var resizeGap;domEvent.addEvent(win,"resize",function(){clearTimeout(resizeGap);resizeGap=setTimeout(function(){var w=offset.getClientWidth(),h=offset.getClientHeight(),isOpen=iframe.getAttribute("data-isOpen");if(isOpen==0){iframe.style.cssText+="right:-"+10*w+"px;"}else{}},300)})}win[WEB_IM_IFRAMES_OBJ_NAME][kfuin]=true;onIframeLoaded(iframe,function(){win[WEB_IM_IFRAMES_LOADED][kfuin]=true;postInitQueue(kfuin,iframe);iframe.setAttribute("data-isOpen","0");wpa&&wpa.trigger("imIframeLoaded")},true)}if(win[WEB_IM_IFRAMES_LOADED][kfuin]){if(iframe){postInitQueue(kfuin,iframe)}}};function postInitQueue(kfuin,iframe){var imInitQueue=imInitQueues[kfuin]||[],iWin=iframe.contentWindow;while(imInitQueue.length){var initObj=imInitQueue.shift();initObj[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;initObj[LANG_KEY]=lang.getLang();try{var VID_VAR_KEY="__QIDIAN";if(window[VID_VAR_KEY]&&window[VID_VAR_KEY].visitorId){initObj["__QIDIAN_WPA_VISITORID_FOR_RPT"]=window[VID_VAR_KEY].visitorId}}catch(e){console.log(e)}initObj=JSON.stringify(initObj);iWin.postMessage(initObj,"*")}}var initMessageListener=function initMessageListener(wpa){domEvent.addEvent(win,"message",function(data){if(!data||!data.data){return}var origin=data.origin||data.originalEvent.origin;if(!conf.IM_ORIGIN_REG.test(origin)){return}var r=data.data||{};if(typeof r==="string"){try{r=JSON.parse(r)}catch(e){log("JSON.parse error in initMessageListener");log(e)}}var kfuin=Number(r.kfuin)||0,wpaId=r.wpaId||0,act=r.act,wpaIden=r.kfuin+"_"+r.wpaId,type=r.type||"",sign=r.sign||"",protocol=r.protocol||"",rData=r.data||{},wpaKey=r.wpaKey;if(act===ACTS.UNREAD){var onlyOpen=r.data.onlyOpen;if(isMobile){var targetWpa=WPA[WPAS_BASED_ON_KFUIN][kfuin]&&WPA[WPAS_BASED_ON_KFUIN][kfuin][0];if(!targetWpa){return log("no wpa with kfuin ["+kfuin+"] found")}if(r.data.number==0){return targetWpa.removeUnreadMsgCircle(kfuin)}WPA[KFUINS][kfuin].unread.chat=r.data.number;if(typeof onlyOpen!=="undefined"&&!onlyOpen){WPA[KFUINS][kfuin].onlyOpen=onlyOpen;WPA[KFUINS][kfuin].onlyOpenParam=r;WPA[KFUINS][kfuin].onlyOpenParam.onlyOpen=false}targetWpa.updateUnreadMsgCircle(r.data.number)}else{if(typeof onlyOpen!=="undefined"){WPA[KFUINS][kfuin].onlyOpen=onlyOpen}}}else if(act===ACTS.CLOSE){WPA.IM.closeChatIframe({kfuin:kfuin})}else if(act===ACTS.LAUNCH){if(isMobile){if(isInMobileQQ&&sign&&xssFilter.isValidURL(sign)){return win.location.href=sign}if(xssFilter.isValidURL(protocol)){win.location.href=protocol}}else{xssFilter.isValidURL(protocol)&&launch(protocol)}}else if(act===ACTS.FOCUS){if(isMobile){var adjust=rData.adjust||80,delay=rData.delay||300;win.__qd_keyboard_interval=setTimeout(function(){var t=window.innerHeight+adjust;window.scrollY<t&&window.scrollTo(0,t);clearTimeout(win.__qd_keyboard_interval);win.__qd_keyboard_interval=setTimeout(arguments.callee,delay)},delay)}}else if(act===ACTS.BLUR){if(isMobile){clearTimeout(win.__qd_keyboard_interval);if(rData&&rData.isScrollWindow){win.scrollTo(0,0)}}}else if(act===ACTS.OPEN){if(!isMobile){var openPCFlag=true;if(typeof WPA[KFUINS][kfuin].onlyOpen!=="undefined"){openPCFlag=WPA[KFUINS][kfuin].onlyOpen}WPA[KFUINS][kfuin].onlyOpen=undefined;if(WPA[KFUINS][kfuin].unread.socket>0){openPCFlag=false}WPA.IM.openChatIframe({kfuin:kfuin,onlyOpen:openPCFlag})}}else if(act===ACTS.OPEN_IMG){var imgUrl=r.data&&r.data.url;if(!imgUrl){return log("[OPEN_IMG]imgUrl error")}if(!isMobile){win.open(imgUrl)}}else if(act===ACTS.SHOW){if(!isMobile){var iframeId=WEB_IM_IFRAME_ID+kfuin,targetIframe=document.getElementById(iframeId);targetIframe&&(targetIframe.style.cssText+="display:block;")}}else if(act===ACTS.SIMUUNREAD){if(!win.__WPAV2[UNREAD_MSG_INFO][kfuin]){win.__WPAV2[UNREAD_MSG_INFO][kfuin]={roleValue:0,roleData:r.receptionUin,extUin:r.receptionUin}}}else if(act===ACTS.AUTH){var authPath=getAuthorizationPageUrl({from:"webim"});if(authPath!==""){if(isMobile){var finalUrl=authPath+"&platform=h5";platformAuthorization({src:finalUrl,id:"wpaAuthorization"})}else{var finalUrl=authPath+"&platform=pc&"+serialize(r.data);platformAuthorization({src:finalUrl,id:"wpaAuthorization"})}}}else if(act===ACTS.DRAG_START){WPA.IM.moveChatIframeStart({kfuin:kfuin})}else if(act===ACTS.DRAG_MOVE){WPA.IM.moveChatIframe({kfuin:kfuin,data:rData})}else if(act===ACTS.DRAG_END){WPA.IM.moveChatIframeEnd({kfuin:kfuin})}else if(act===ACTS.ERROR_AUTH&&wpa.params.key===wpaKey){wpaSSO.callBeforeLogin(wpa)}else if(act==="NEW-WINDOW-CHAT-OPEN"){console.log("\u597D\u5BB6\u4F19\uFF0C\u7EC8\u4E8E\u8FDB\u6765\u4E86",win,conf)}else if(act==="UPDATE_AUTH"){var WPA_LOGIN_CONFIG=conf.WPA_LOGIN_CONFIG;var _kfuin=rData.kfuin;if(rData.visitorid){localStorage.setItem(WPA_LOGIN_CONFIG.aid+"_"+_kfuin,rData.visitorid)}if(rData.wpatoken){localStorage.setItem(WPA_LOGIN_CONFIG.d2+"_"+_kfuin,rData.wpatoken)}if(rData.uuid){localStorage.setItem(WPA_LOGIN_CONFIG.uuid+"_"+_kfuin,rData.uuid);localStorage.setItem(WPA_LOGIN_CONFIG.imd2+"_"+_kfuin,"")}if(rData.token){localStorage.setItem(WPA_LOGIN_CONFIG.imd2+"_"+_kfuin,rData.token);WPA[SOCKET_IFRAME_ID+"_"+_kfuin].postMessage(JSON.stringify({act:SOCKET_ACTS.SM_BIND_WPA_IM_AID,"kfuin":_kfuin,"webimAid":rData.visitorid,"wpaId":rData.wpaId}),"*")}if(rData.uuid){localStorage.setItem(WPA_LOGIN_CONFIG.uuid+"_"+_kfuin,rData.uuid)}}})};exports.imInit=function(params,cb){var self=this;if(params.isImForbidden){return}if(!WPA.isMsgListenerAdded){initMessageListener(self);WPA.isMsgListenerAdded=true}initIframe(params,self);if(typeof cb==="function"){cb()}}});LBF.define("wpa.invite.main",function(require,exports,module){var getInviteConf=require("wpa.invite.getInviteConf"),conf=require("wpa.conf.config"),POST_MESSAGE_FLAG=conf.POST_MESSAGE_FLAG,POST_MESSAGE_FLAG_CONTENT=conf.POST_MESSAGE_FLAG_CONTENT,ACTS=conf.SOCKET.ACTS,WEB_IM=conf.WEB_IM,WPAS_BASED_ON_KFUIN=conf.WPAS_BASED_ON_KFUIN,INVITATION_TYPE=conf.INVITATION_TYPE,WEB_IM_IFRAME_ID=WEB_IM.WEB_IM_IFRAME_ID,WEB_IM_IFRAMES_OBJ_NAME=WEB_IM.WEB_IM_IFRAMES_OBJ_NAME,INVITE_IFRAME_ID_PREFIX=conf.INVITE_IFRAME_ID_PREFIX,WPAS_IM_TYPE=conf.WEB_IM.WPAS_IM_TYPE,KFUIN_INVITED_TIMES=conf.KFUIN_INVITED_TIMES,Style=require("wpa.util.Style"),offset=require("wpa.util.offset"),browser=require("lang.browser"),isMobile=browser.isAndroid||browser.isIOS,extend=require("lang.extend"),report=require("util.report"),launch=require("wpa.util.launch"),tpl=require("wpa.invite.tpl"),ids=require("wpa.util.ids"),domEvent=require("wpa.util.domEvent"),onIframeLoaded=require("wpa.util.onIframeLoaded"),log=require("wpa.util.log"),jsonp=require("util.jsonp"),serialize=require("util.serialize"),JSON=require("lang.JSON"),chatConst=require("wpa.conf.chat"),CustomParams=require("wpa.proto.CustomParams"),SOCKET=conf.SOCKET,SOCKET_ACTS=SOCKET.ACTS,SOCKET_IFRAME_ID=SOCKET.SOCKET_IFRAME_ID,LAUNCH_LINK=chatConst.LAUNCH_LINK;var win=conf.gWin,doc=win.document,body=doc.body,WPA=win.__WPAV2,socketWin,inviteKfuinsObj={},initedKfuinInvite={},GLOBAL_INVITE_TPL_AND_CONF=conf.GLOBAL_INVITE_TPL_AND_CONF;win.__WPAV2[GLOBAL_INVITE_TPL_AND_CONF]=typeof win.__WPAV2[GLOBAL_INVITE_TPL_AND_CONF]!=="undefined"?win.__WPAV2[GLOBAL_INVITE_TPL_AND_CONF]:{};win.__WPAV2[KFUIN_INVITED_TIMES]=typeof win.__WPAV2[KFUIN_INVITED_TIMES]!=="undefined"?win.__WPAV2[KFUIN_INVITED_TIMES]:{};var ctxThis;var clearInvitePanel=exports.clearInvitePanel=function(options){log(options);var kfuin=options.kfuin,iframe=options.iframe||doc.getElementById(INVITE_IFRAME_ID_PREFIX+kfuin),$close=options.$close,$btn1=options.$btn1||{},$btn2=options.$btn2||{};$close=$btn1=$btn2=null;inviteKfuinsObj[kfuin]=false;if(iframe){iframe.parentNode&&iframe.parentNode.removeChild(iframe)}};var actions={qq:function qq(options){var param={kfuin:options.kfuin,isCorpUin:options.isCorpUin,clickId:ids.createClickId(),visitorId:WPA.visitorId,ftype:conf.isMobile?1:0,isB2C:options.isB2C,receptionUin:options.receptionUin,key:options.key||ctxThis.params.key,fid:ctxThis.params.id};clearInvitePanel(options);CustomParams.setCustomParams(param);setTimeout(function(){jsonp(conf.CGIS.GET_QQ_INVITE_SIGT,param,function(r){r=r||{};var data=r.data||{},sign=data.sign,message=data.message||"\u4F01\u4E1A\u63A5\u5F85\u6682\u65F6\u65E0\u6CD5\u4F7F\u7528\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5";if(r.r!=0){return alert(message)}launch(sign,{targetPage:LAUNCH_LINK,needMobileJump:true})})},10)},phone:function phone(){alert("phone")},im:function im(options,ctx){var self=ctx,kfuin=options.kfuin,isB2C=options.isB2C,seq=options.seq,key=options.key,type=options.type,receptionUin=options.receptionUin,clickid=ids.createClickId(),invitationType=isB2C?null:INVITATION_TYPE.AUTO,openParam={clickid:clickid,invitationType:invitationType};if(isB2C){openParam.isB2C=true;openParam.seq=seq;openParam.type=type;openParam.key=key;openParam.roleValue="0";openParam.roleData=receptionUin}else{var reception=options.autoInvited.reception;openParam.roleValue=(+reception.type-1).toString();openParam.roleData=reception.cuin}if(win[WEB_IM_IFRAMES_OBJ_NAME][kfuin]){log(kfuin+" exists");ctx.openChatIframe(openParam)}else{if(isMobile){alert("mobile im invite without im iframe")}else{alert("pc im invite without im iframe")}log(kfuin+" doesn't exist")}clearInvitePanel(options)}};var bindBtn=function bindBtn(btn,options,ctx){if(!btn){return}var kfuin=options.kfuin,isB2C=options.isB2C,seq=options.seq,type=options.type,receptionUin=options.receptionUin,e=btn.getAttribute("data-event"),isCorpUin=parseInt(btn.getAttribute("data-corpuin"),10);ctx=ctx||win.__WPAV2[WPAS_IM_TYPE][kfuin]&&win.__WPAV2[WPAS_IM_TYPE][kfuin][0]||win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin][0];if(!ctx){return log("no im wpa")}var sendMsg;domEvent.addEvent(btn,"click",function(){log("isB2C:"+isB2C);if(e=="close"){clearInvitePanel(options);win.__WPAV2.trigger("startInviteTimeout",kfuin);sendMsg={act:SOCKET_ACTS.SM_REFUSE,kfuin:kfuin};sendMsg[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;sendMsg=JSON.stringify(sendMsg);socketWin=WPA[SOCKET_IFRAME_ID+"_"+kfuin];socketWin.postMessage(sendMsg,"*");var reportUrl=conf.CGIS.CLOSE_INVITE_REPORT,reportObj={kfuin:kfuin,visitorId:__WPAV2.visitorId,isB2C:isB2C?1:0,key:options.key};reportUrl+="?"+serialize(reportObj);report(reportUrl)}else if(e==tpl.btnTypes.qq){actions.qq(extend(options,{isCorpUin:isCorpUin}))}else if(e==tpl.btnTypes.phone){actions.phone()}else if(e==tpl.btnTypes.im){actions.im(options,ctx)}})};var bindEvents=function bindEvents(iframe,inviteConf,options){var iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document,kfuin=inviteConf.kfuin,ctx=options.ctx,isB2C=options.isB2C,type=options.type,receptionUin=options.receptionUin,key=options.key,seq=options.seq;inviteKfuinsObj[kfuin]=true;if(true){var $close=iDoc.getElementById("invite_close"),$btn1=iDoc.getElementById("btn1"),$btn2=iDoc.getElementById("btn2");if($btn2&&$btn2.getAttribute("data-event")=="undefined"){$btn2.parentNode&&$btn2.parentNode.removeChild($btn2);setTimeout(function(){$btn2=null},10)}bindBtn($close,{kfuin:kfuin,iframe:iframe,$close:$close,$btn1:$btn1,$btn2:$btn2,isB2C:isB2C,seq:seq,key:key},ctx);bindBtn($btn1,extend(inviteConf,{kfuin:kfuin,iframe:iframe,$close:$close,$btn1:$btn1,$btn2:$btn2,isB2C:isB2C,seq:seq,type:type,key:key,receptionUin:receptionUin}),ctx);bindBtn($btn2,extend(inviteConf,{kfuin:kfuin,iframe:iframe,$close:$close,$btn1:$btn1,$btn2:$btn2,isB2C:isB2C,seq:seq,type:type,key:key,receptionUin:receptionUin}),ctx)}};var startInvitation=function startInvitation(options,ctx,extraOptions){extraOptions=extraOptions||{};var inviteTpl=options.inviteTpl,inviteConf=options.inviteConf,kfuin=inviteConf.kfuin,autoInvited=inviteConf.autoInvited||{},active=autoInvited.active,repeat=autoInvited.repeat||{},repeatActive=repeat.active||false,repeatInterval=repeat.finterval,repeatFrequency=Number(repeat.frequency),reception=autoInvited.reception||{},recType=reception.type,recCuin=reception.cuin,condition=autoInvited.condition||{},stayPeriod=condition.stayPeriod,deviceType=condition.deviceType,isInviteApi=extraOptions.isInviteApi;if(typeof win.__WPAV2[KFUIN_INVITED_TIMES][kfuin]==="undefined"){win.__WPAV2[KFUIN_INVITED_TIMES][kfuin]=repeatFrequency}if(isInviteApi||active){if(isInviteApi||deviceType==3||isMobile&&deviceType==1||!isMobile&&deviceType==2){if(isInviteApi||stayPeriod==0){showInvitation({inviteTpl:inviteTpl,inviteConf:inviteConf},ctx)}else{var timer=setTimeout(function(){showInvitation({inviteTpl:inviteTpl,inviteConf:inviteConf},ctx);clearTimeout(timer)},stayPeriod*1000)}}if(repeatActive){win.__WPAV2.on("startInviteTimeout",function(kfuin){if(win.__WPAV2[KFUIN_INVITED_TIMES][kfuin]<0){return log("auto invite reached max times")}win.__WPAV2.KFUINS[kfuin].setTimeoutInvite=setTimeout(function(){showInvitation({inviteTpl:inviteTpl,inviteConf:inviteConf},ctx)},repeatInterval*1000)})}}};var stopInvitation=function stopInvitation(){};var showInvitation=exports.showInvitation=function(options,ctx){var inviteTpl=options.inviteTpl,inviteConf=options.inviteConf,isB2C=options.isB2C,seq=options.seq,type=options.type,key=options.key,receptionUin=options.receptionUin,kfuin=inviteConf.kfuin,iframeId=INVITE_IFRAME_ID_PREFIX+kfuin,css=inviteTpl.css,iframeStyle=tpl.getIframeStyle(inviteTpl,inviteConf),style=iframeStyle.style,width=iframeStyle.width,height=iframeStyle.height,btns=inviteConf.btns||[],btnsNum=btns.length;if(win.__WPAV2.IM_CHAT_IFRAME_OPENING){return}if(doc.getElementById(iframeId)){return log("invite iframe "+kfuin+" already exists")}win.__WPAV2[KFUIN_INVITED_TIMES][kfuin]--;var strIframe="<iframe scrolling=\"no\" id=\""+iframeId+"\" frameborder=\"0\" width=\""+width+"\" height=\""+height+"\" allowtransparency=\"true\" src=\"about:blank\" style=\"{style}\" ></iframe>";strIframe=strIframe.replace("{style}",style);var iframe;try{iframe=doc.createElement(strIframe)}catch(e){iframe=doc.createElement("iframe");iframe.width=width;iframe.height=height;iframe.id=iframeId;iframe.style.cssText=style;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src","about:blank");if(!isMobile){iframe.width=width}}body.appendChild(iframe);var loaded=function loaded(){var iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document;iDoc.open();iDoc.write(["<!doctype html>","<html xmlns=\"http://www.w3.org/1999/xhtml\">","<head>","<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />",browser.msie&&iframe.src!=="about:blank"?"<script>document.domain='"+document.domain+"';</script>":"","</head>","<body>",inviteTpl.tpl,"</body>","</html>"].join(""));iDoc.close();var styleObj={name:"style",cssText:css,doc:iDoc};Style.commonAdd(styleObj);bindEvents(iframe,inviteConf,{ctx:ctx,isB2C:isB2C,seq:seq,type:type,key:key,receptionUin:receptionUin})};onIframeLoaded(iframe,loaded)};var defaultInviteStyle={"type":"1","title":"\u5BA2\u670D\u5728\u7EBF\uFF0C\u6B22\u8FCE\u54A8\u8BE2","content":"\u60A8\u597D\uFF0C\u5F53\u524D\u6709\u5BA2\u670D\u5728\u7EBF\uFF0C\u70B9\u51FB\u5373\u53EF\u54A8\u8BE2","btns":[{"type":"im","text":"\u7F51\u9875\u54A8\u8BE2"}],"theme":"1"};exports.init=function(options,extraOptions){ctxThis=this;extraOptions=extraOptions||{};var self=this,key=options.key,kfuin=this.params.fkfuin,inviteConf=options,invitedStyle=inviteConf.invitedStyle||defaultInviteStyle,inviteTpl=tpl.getTpl(invitedStyle),isInviteApi=extraOptions.isInviteApi;if(initedKfuinInvite[kfuin]&&!isInviteApi){return}initedKfuinInvite[kfuin]=true;inviteConf.kfuin=kfuin;win.__WPAV2[GLOBAL_INVITE_TPL_AND_CONF][kfuin]={tpl:inviteTpl,conf:inviteConf,key:key};startInvitation({inviteTpl:inviteTpl,inviteConf:inviteConf},self,extraOptions)};exports.getInviteConf=getInviteConf;exports.tpl=tpl});LBF.define("wpa.proto.socket",function(require,exports,module){var conf=require("wpa.conf.config"),POST_MESSAGE_FLAG=conf.POST_MESSAGE_FLAG,POST_MESSAGE_FLAG_CONTENT=conf.POST_MESSAGE_FLAG_CONTENT,KFUINS=conf.KFUINS,isMobile=conf.isMobile?1:0,WEB_IM_IFRAME_ID=conf.WEB_IM.WEB_IM_IFRAME_ID,WPAS_BASED_ON_KFUIN=conf.WPAS_BASED_ON_KFUIN,win=conf.gWin,doc=win.document,body=doc.body,log=require("wpa.util.log"),SOCKET=conf.SOCKET,ACTS=SOCKET.ACTS,SOCKET_IFRAME_ID=SOCKET.SOCKET_IFRAME_ID,INVITE_IFRAME_ID_PREFIX=conf.INVITE_IFRAME_ID_PREFIX,UNREAD_MSG_INFO=conf.UNREAD_MSG_INFO,WPAS_IM_TYPE=conf.WEB_IM.WPAS_IM_TYPE,Invite=require("wpa.invite.main"),InviteApi=require("wpa.invite.inviteApi"),domEvent=require("wpa.util.domEvent"),imInit=require("wpa.im.init"),UnreadMsgCircle=require("wpa.proto.UnreadMsgCircle"),onIframeLoaded=require("wpa.util.onIframeLoaded"),imMessageSender=require("wpa.im.imMessageSender"),_S=conf.sandbox,JSON=require("lang.JSON"),DISPLAY=conf.DISPLAY,DISPLAY_ACTS=DISPLAY.ACTS,DISPLAY_URL=DISPLAY_ACTS.URL,WPA_ID_PREFIX=conf.WPA_ID_PREFIX;var URL=SOCKET.URL;if(conf.isOA){var branch=window.__WEBIM_BRANCH;if(branch){conf.WEB_IM.URL=conf.WEB_IM.URL.replace(/chat(-gray|-customer)?[^/]*/,branch)}}var iframeStyle=["width:0","height:0","position:fixed","right:0","bottom:0"].join(";")+";";var isSocketEstablished=false,initObjList={},socketWin={};var referUrl=doc.referrer,ldpUrl=win.location.href,ldpTitle=doc.title;win.__WPAV2[UNREAD_MSG_INFO]={};var sendMsg;var initSocketListener=function initSocketListener(){domEvent.addEvent(win,"message",function(e){var r=e.data||{};var origin=e.origin||e.originalEvent.origin;if(!conf.IM_ORIGIN_REG.test(origin)){return}if(typeof r==="string"){try{r=JSON.parse(r)}catch(e){log("JSON.parse error in initSocketListener");log(e)}}var act=r.act,kfuin=r.kfuin,data=r.data||{};if(act==ACTS.SM_READY){postInitQueue(kfuin)}else if(act==ACTS.SM_UNREAD){var number=_S.Number(data.number),offlineMsgKey=data.offlineMsgKey,key=data.key,receptionUin=data.receptionUin,receptionName=data.receptionName,styleConfig=data.styleConfig;if(number>0){win.__WPAV2[UNREAD_MSG_INFO][kfuin]={offlineMsgKey:offlineMsgKey,key:key,roleValue:data.roleValue,receptionUin:receptionUin,receptionName:receptionName}}if(win.__WPAV2[KFUINS][kfuin]){win.__WPAV2[KFUINS][kfuin].unread.socket=number}if(isMobile){UnreadMsgCircle.showAllRedCircles(kfuin,number)}else{var imIframeId=WEB_IM_IFRAME_ID+kfuin,theme=_typeof(data.theme)!==undefined?data.theme:1;sendMsg={act:ACTS.UPDATE_UNREAD,kfuin:kfuin,offlineMsgKey:offlineMsgKey,key:key,theme:theme,roleValue:data.roleValue,receptionUin:receptionUin,receptionName:receptionName,number:number,styleConfig:styleConfig};sendMsg[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;imMessageSender.sendMsg(kfuin,sendMsg)}}else if(act==ACTS.SM_MANUAL_INVITE){log("SM_MANUAL_INVITE");var type=data.type,seq=data.seq,key=data.key,receptionUin=data.receptionUin;if(type==1){if(win.__WPAV2.GLOBAL_INVITE_TPL_AND_CONF[kfuin]){var inviteRule=win.__WPAV2.GLOBAL_INVITE_TPL_AND_CONF[kfuin],inviteTpl=inviteRule.tpl,inviteConf=inviteRule.conf;if(doc.getElementById(INVITE_IFRAME_ID_PREFIX+kfuin)){return log("invite panel already exists")}if(!imInit.isImIframeLoaded(kfuin)){imInit.initIframe({kfuin:kfuin})}else{Invite.showInvitation({inviteTpl:inviteTpl,inviteConf:inviteConf,isB2C:true,seq:seq,type:type,key:key,receptionUin:receptionUin},null)}}else{log("invite rule with kfuin "+kfuin+" does not exist")}}else if(type==2){win.__WPAV2.IM.openChatIframe({kfuin:kfuin,seq:seq,receptionUin:receptionUin,key:key,type:type,isDirectOpen:true})}else if(type==5){var imIframeId=WEB_IM_IFRAME_ID+kfuin,targetImIframe=document.getElementById(imIframeId);sendMsg=r;r.act=ACTS.SM_MANUAL_INVITE;sendMsg[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;sendMsg=JSON.stringify(sendMsg);targetImIframe.contentWindow.postMessage(sendMsg,"*")}var wpaId=r.data&&r.data.wpaId;var id=wpaId?wpaId:r.wpaId;var displayIframeId=DISPLAY.DISPLAY_IFRAME_ID+"_"+kfuin+"_"+id;var iframe=document.getElementById(displayIframeId);r.kfuin=kfuin;if(iframe){iframe.contentWindow.postMessage(r,"*")}}else if(act==ACTS.SM_INVITE_CONF){var inviteRule=r.inviteRule;inviteRule.kfuin=kfuin;if(typeof win.__WPAV2.GLOBAL_INVITE_TPL_AND_CONF[kfuin]==="undefined"){if(win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin]){for(var i=0,len=win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin].length;i<len;i++){var wpa=win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin][i];if(wpa.params.cate==conf.TYPES.QQ||wpa.params.cate==conf.TYPES.IM){break}}wpa.Invite.init.call(wpa,inviteRule);InviteApi.add(wpa,inviteRule)}}}else if(act==ACTS.SM_REFUSE){sendMsg={act:ACTS.SM_REFUSE,kfuin:kfuin};sendMsg[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;sendMsg=JSON.stringify(sendMsg);socketWin[kfuin].postMessage(sendMsg,"*")}else if(act==ACTS.SMS_SM_FORCE_CONNECT){sendMsg={act:ACTS.SMS_SM_FORCE_CONNECT};sendMsg[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;sendMsg=JSON.stringify(sendMsg);socketWin[kfuin].postMessage(sendMsg,"*")}else if(act==ACTS.SM_CHAT_OVER){win.__WPAV2.trigger("startInviteTimeout",kfuin)}else if(act==ACTS.DISCONNECT){var kfuinsObj=win.__WPAV2[KFUINS];for(var i in kfuinsObj){if(kfuinsObj.hasOwnProperty(i)){sendMsg={act:ACTS.DISCONNECT};sendMsg[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;sendMsg=JSON.stringify(sendMsg);doc.getElementById(WEB_IM_IFRAME_ID+i).contentWindow.postMessage(sendMsg,"*")}}}else if(act==DISPLAY_ACTS.SM_DISPLAY){var wpaId=r.data&&r.data.wpaId;var id=wpaId?wpaId:r.wpaId;var displayIframeId=DISPLAY.DISPLAY_IFRAME_ID+"_"+kfuin+"_"+id;if(r.msgDisplayId){win.__WPAV2[displayIframeId]=r.msgDisplayId}if(r.displayNum){win.__WPAV2[displayIframeId+"_num"]=r.displayNum}log("=====>r",r);if(!r.calHeight){var iframeStyle=["position:fixed","right:0","bottom:0"].join(";")+";";var strIframe="<iframe scrolling=\"no\" id=\""+displayIframeId+"\" frameborder=\"0\" width=\"0\" height=\"0\" allowtransparency=\"true\" src=\""+DISPLAY.URL+"\" style=\""+iframeStyle+"\"></iframe>";var iframe;try{iframe=doc.createElement(strIframe)}catch(e){iframe=doc.createElement("iframe");iframe.width="0";iframe.height="0";iframe.id=displayIframeId;iframe.style.cssText=iframeStyle;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src",DISPLAY.URL)}body.appendChild(iframe);onIframeLoaded(iframe,function(){var wpaId=r.data&&r.data.wpaId;var id=wpaId?wpaId:r.wpaId;var wpaIframeId=WPA_ID_PREFIX+kfuin+"_"+id;var targetWpaIframe=document.getElementById(wpaIframeId);var dir=calDir(targetWpaIframe);r.dir=dir;r.kfuin=kfuin;setTimeout(function(){iframe.contentWindow.postMessage(r,"*")},1000);win.__WPAV2[displayIframeId+"_dir"]=dir})}else{var wpaId=r.data&&r.data.wpaId;var id=wpaId?wpaId:r.wpaId;var wpaIframeId=WPA_ID_PREFIX+r.kfuin+"_"+id;var targetWpaIframe=document.getElementById(wpaIframeId);var targetDisplayIframe=document.getElementById(displayIframeId);if(targetDisplayIframe){targetDisplayIframe.width="300";targetDisplayIframe.height=r.offsetHeight;targetDisplayIframe.id=displayIframeId;targetDisplayIframe.style.width="300px;";targetDisplayIframe.style.height=r.offsetHeight+"px";if(win.__WPAV2[displayIframeId]&&win.__WPAV2[displayIframeId+"_dir"]&&win.__WPAV2[displayIframeId+"_dir"].left){if(targetWpaIframe.style.left){targetDisplayIframe.style.left=calOutOfPosition(Number(targetWpaIframe.style.left.split("px")[0]),targetDisplayIframe)}else{if(targetWpaIframe.style.right!=="0px"){targetDisplayIframe.style.left=calOutOfPosition(targetWpaIframe.offsetLeft,targetDisplayIframe)}}}else{if(targetWpaIframe.style.right){targetDisplayIframe.style.right=calOutOfPosition(Number(targetWpaIframe.style.right.split("px")[0]),targetDisplayIframe)}}if(win.__WPAV2[displayIframeId]&&win.__WPAV2[displayIframeId+"_dir"]&&win.__WPAV2[displayIframeId+"_dir"].top){if(targetWpaIframe.style.bottom!=""){var tmp=parseInt(targetWpaIframe.style.bottom.replace("px",""));targetDisplayIframe.style.bottom=tmp+parseInt(targetWpaIframe.height)+"px"}else{targetDisplayIframe.style.bottom=targetWpaIframe.offsetTop+"px"}}else{targetDisplayIframe.style.top=targetWpaIframe.offsetTop+targetWpaIframe.offsetHeight+"px"}}win.__WPAV2[displayIframeId]=r.msgDisplayId}}else if(act==conf.WEB_IM.ACTS.ON_IMSDK_READY){if(!data)return;var id=r.data&&r.data.wpaId;var kfuin=r.data&&r.data.kfuin;var displayIframeId=DISPLAY.DISPLAY_IFRAME_ID+"_"+kfuin+"_"+id;var displayIframe=document.getElementById(displayIframeId);displayIframe&&displayIframe.contentWindow.postMessage(r,"*")}})};function calDir(wpaIframe){var dir={left:true,top:true};var winHeight=window.innerHeight;if(wpaIframe.offsetTop-winHeight/2>0){dir.top=true}else{dir.top=false}var winWidth=window.innerWidth;if(wpaIframe.offsetLeft-winWidth/2>0){dir.left=false}else{dir.left=true}return dir}function calOutOfPosition(position,displayIframe){var calPosition=0;var displayIframeWidth=Number(displayIframe.width);var winWidth=window.innerWidth;if(position+displayIframeWidth<=winWidth){calPosition=position}return calPosition+"px"}var postInitQueue=function postInitQueue(kfuin){var kfuinWpa=initObjList[kfuin]||[];for(var i=0,len=kfuinWpa.length;i<len;i++){var obj=kfuinWpa[i];if(obj.kfuin==kfuin){obj[POST_MESSAGE_FLAG]=POST_MESSAGE_FLAG_CONTENT;socketWin[kfuin].postMessage(JSON.stringify(obj),"*")}}delete initObjList[kfuin]};var isSocketListenerAdded=false;exports.establishSocket=function(){var self=this,params=self.params,isGray=this.env.isGray,kfuin=params.fkfuin,visitorId=params.guid,iframeId=SOCKET_IFRAME_ID+"_"+kfuin,initParam={kfuin:kfuin,visitorId:visitorId,isMobile:isMobile,act:ACTS.SM_INIT,referUrl:referUrl,ua:window.navigator.userAgent,ldpUrl:decodeURIComponent(ldpUrl),ldpTitle:decodeURIComponent(ldpTitle),wpaId:params.id};var socketURL=URL+"?kfuin="+kfuin;initParam.WPA_LOGIN_CONFIG=this.getwpaLoginConfig(kfuin,params);if(!isSocketListenerAdded){isSocketListenerAdded=true;initSocketListener()}if(!((params.cate==conf.TYPES.IM||params.cate==conf.TYPES.QQ)&&!conf.isInAdmin)){return}if(!initObjList[kfuin]){initObjList[kfuin]=[initParam]}else{initObjList[kfuin].push(initParam)}if(!socketWin[kfuin]){if(!isSocketEstablished){var strIframe="<iframe scrolling=\"no\" id=\""+iframeId+"\" frameborder=\"0\" width=\"0\" height=\"0\" allowtransparency=\"true\" src=\""+socketURL+"\" style=\""+iframeStyle+"\"></iframe>";var iframe;try{iframe=doc.createElement(strIframe)}catch(e){iframe=doc.createElement("iframe");iframe.width=0;iframe.height=0;iframe.id=iframeId;iframe.style.cssText=iframeStyle;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src",socketURL)}body.appendChild(iframe);onIframeLoaded(iframe,function(){socketWin[kfuin]=win.__WPAV2[SOCKET_IFRAME_ID+"_"+kfuin]=iframe.contentWindow})}}}});LBF.define("wpa.proto.getGdtClickId",function(require,exports,module){var jsonp=require("util.jsonp"),removeCustomProp=require("wpa.util.removeCustomProperty"),extend=require("lang.extend"),conf=require("wpa.conf.config"),win=conf.gWin,getCPType=require("wpa.proto.getCPType"),CB_NAME="jsonp_cb_",cid=0;var url="https://t.gdt.qq.com/conv/web/cookies/jsonp",cbName=CB_NAME+cid++;var getGdtClickId=function getGdtClickId(params){if(typeof win._gdtClickId==="undefined"){var opts={cb:cbName,callback:cbName};jsonp(url,opts,function(rs){if(rs&&rs.ret==0){win._gdtReportData=extend({client_id:54,click_id:rs.click_id,visitorid:params.guid,kfuin:params.fkfuin,ldpg:win.location.href},getCPType(params))}else{win._gdtReportData=0}})}};module.exports=exports=getGdtClickId});LBF.define("wpa.proto.UnreadMsgCircle",function(require,exports,module){var browser=require("lang.browser"),getOffset=require("wpa.util.getOffset"),conf=require("wpa.conf.config"),WPAS_BASED_ON_KFUIN=conf.WPAS_BASED_ON_KFUIN,KFUINS=conf.KFUINS,isMobile=conf.isMobile,win=conf.gWin,CATE_WEB_IM=conf.TYPES.IM,CATE_QQ=conf.TYPES.QQ,WPAS_IM_TYPE=conf.WEB_IM.WPAS_IM_TYPE,Style=require("wpa.util.Style"),log=require("wpa.util.log"),wpaType=require("wpa.conf.wpaType"),domEvent=require("wpa.util.domEvent"),proxy=require("lang.proxy"),onIframeLoaded=require("wpa.util.onIframeLoaded"),mobileUnreadBar=require("wpa.proto.mobileUnreadBar");var CIRCLE_CLASS_NAME="qidian_wpa_unread_msg_circle",WIDTH=20,HEIGHT=20,WPA_ID_PREFIX=conf.WPA_ID_PREFIX,actualPosition="absolute",CIRCLE_ID_PREFIX="qidian_wpa_id_unread_msg_circle_",CIRCLE_INNER_CSS_TEXT=["* {margin:0;padding:0;}","body {font-family:\"PingFang SC\", \"Droid Sans Fallback\";background:#ff4222;color:#fff;font-size:12px;text-align:center;height:20px;line-height:20px;}","span {cursor: pointer;}"].join("");var doc=win.document,body=doc.body;var canShowUnreadMsg=function canShowUnreadMsg(cate){return cate==CATE_WEB_IM||cate==CATE_QQ};exports.showAllRedCircles=function(kfuin){if(!isMobile||!kfuin){return}var unreadNum=win.__WPAV2[KFUINS][kfuin].unread,number=unreadNum.chat+unreadNum.socket;if(number<=0){return}win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin]&&win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin][0].updateUnreadMsgCircle(number);return;var imWpas=win.__WPAV2.WPAS_IM_TYPE;if(imWpas[kfuin]){for(var i=0,len=imWpas[kfuin].length;i<len;i++){var imWpa=imWpas[kfuin][i],unreadNum=win.__WPAV2[KFUINS][kfuin].unread,number=unreadNum.chat+unreadNum.socket;imWpa.updateUnreadMsgCircle(number)}}};var removeUnreadMsgCircle=exports.removeUnreadMsgCircle=function(kfuin){if(!isMobile){return}if(!canShowUnreadMsg(this.params.cate)){return}mobileUnreadBar.removeUnreadMsgBar(kfuin)};exports.removeAllRedCircles=function(kfuin){if(!isMobile){return}var unreadNum=win.__WPAV2[KFUINS][kfuin].unread;unreadNum.chat=unreadNum.socket=0;win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin]&&win.__WPAV2[WPAS_BASED_ON_KFUIN][kfuin][0].removeUnreadMsgCircle(kfuin)};exports.updateUnreadMsgCircle=function(){if(!isMobile){return}var self=this,kfuin=this.params.fkfuin;if(!canShowUnreadMsg(this.params.cate)){return}var unreadNum=win.__WPAV2[KFUINS][kfuin].unread,number=unreadNum.chat+unreadNum.socket;mobileUnreadBar.drawBar({kfuin:kfuin,number:number})}});LBF.define("wpa.proto.wpaSSO",function(require,exports,module){var dialog=require("wpa.util.dialog");exports.getHookObj=getHookObj=function getHookObj(wpa){var hookName=window["__qq_qidian_wpa"];var sdkObj=window[hookName];return sdkObj},exports.callBeforeLogin=callBeforeLogin=function callBeforeLogin(wpa){var sdkObj=getHookObj(wpa);if(sdkObj&&sdkObj.beforeLogin){sdkObj.beforeLogin(wpa.params.key)}else{console.log("\u8BF7\u6309\u8BF4\u660E\u4F7F\u7528sso")}},exports.authError=function(err,wpa){err=_typeof(err)=="object"?err:{r:100,message:"\u9274\u6743\u5931\u8D25"};var sdkObj=getHookObj(wpa);if(sdkObj&&typeof sdkObj.onError=="function"){sdkObj.onError(err,wpa)}else{dialog.confirm({text:err.message+"\u3002\u662F\u5426\u91CD\u8BD5\uFF1F",confirmText:"\u91CD\u8BD5",confirmCallback:function confirmCallback(){callBeforeLogin(wpa)}})}}});LBF.define("wpa.util.requestXHR",function(require,exports,module){exports.request=function request(option){if(String(option)!=="[object Object]")return undefined;option.method=option.method?option.method.toUpperCase():"GET";option.data=option.data||{};var formData=[];for(var key in option.data){formData.push("".concat(key,"=",option.data[key]))}option.data=formData.join("&");if(option.method==="GET"){option.url+=option.url.indexOf("?")===-1?"".concat("?",option.data):"".concat("&",option.data)}var xhr=new XMLHttpRequest;xhr.responseType=option.responseType||"json";xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){if(option.success&&typeof option.success==="function"){option.success(xhr.response)}}else{if(option.error&&typeof option.error==="function"){option.error()}}}};xhr.open(option.method,option.url,true);if(option.method==="POST"){xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}xhr.send(option.method==="POST"?option.data:null)}});LBF.define("wpa.proto.addDa",function(require,exports,module){var localStorage=require("util.localStorage"),log=require("wpa.util.log"),conf=require("wpa.conf.config"),win=conf.gWin,doc=win.document,ENV=conf.ENV;win.__QIDIAN=win.__QIDIAN?win.__QIDIAN:{kfuins:{}};var globalKfuins=win.__QIDIAN.kfuins,pvData={mid:"",ldpg:win.location.href,refurl:typeof doc.referrer!=="undefined"?doc.referrer:"",ua:win.navigator.userAgent,title:encodeURIComponent(doc.title),eptype:conf.isMobile?2:1,env:ENV};var isDaAdded="isDaAdded",isFetchingDa="isFetchingDa",daList=[];var head=document.head||document.getElementsByTagName("head")[0]||document.documentElement,baseElement=head.getElementsByTagName("base")[0];var fetch=function fetch(uri,id,cb){var node=document.createElement("script");node.charset="utf-8";node.async=true;node.src=uri;node.id=id||"";var currentlyAddingScript=node;node.onreadystatechange=node.onload=function(){if(/loaded|complete|undefined/.test(node.readyState)&&typeof cb==="function"){cb();node.onreadystatechange=node.onload=null}};baseElement?head.insertBefore(node,baseElement):head.appendChild(node);currentlyAddingScript=null};var visitorId="",fetchedTencentSig=false;var _log=log;var qidianDAReport=function qidianDAReport(){try{var GLOBAL=win;var HOOK_NAME="__qq_qidian_da_market";var EXPORT_NAME=GLOBAL[HOOK_NAME]||"qidianDA";if(!EXPORT_NAME){return}var qidianDA=GLOBAL[EXPORT_NAME],nameAccount=daList.shift();if(!nameAccount){return}var kfuin=String(nameAccount);if(!globalKfuins[kfuin]){var getUrlQuery=function getUrlQuery(variable){var query=window.location.search.substring(1);var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==variable){return pair[1]}}return""};var checkExit=function checkExit(val){return Boolean(val||val===0)};globalKfuins[kfuin]=true;var qq="";try{var getRaw=function getRaw(key){var strcookie=window.document.cookie;var arrcookie=strcookie.split("; ");for(var i=0;i<arrcookie.length;i++){var arr=arrcookie[i].split("=");if(arr[0]===key){var str=arr[1];for(var i=0;i<1;i++){if(str[0]==="0"||str[0]==="o"||str[0]===" "){str=str.substr(1);i--}}return str}}return""};qq=Number(getRaw("uin")||getRaw("o_cookie")||getRaw("luin"))}catch(e){console.log("get qq cookie error")}var accountData={da_rpt_type:"wpa"};qq&&(accountData.qq=qq);qidianDA("setCommonData",{$url:decodeURI(pvData.ldpg),$title:decodeURI(pvData.title),wpa_visitorid:checkExit(pvData.visitorid)?Number(pvData.visitorid):"",wpa_cckey:String(getUrlQuery("cckey")||"")||""},accountData);var hasCreated=false;try{qidianDA("getIDs",function(ids){ids.qid&&(hasCreated=true)})}catch(e){console.log("no qidianDA created")}if(hasCreated){qidianDA("setValsByHand",{appkey:"",da_rpt_type:"wpa"})}else{qidianDA("setDomain","https://"+(window.__WPAENV==="test"?"oa.":"")+"v.qidian.qq.com");qidianDA("create",kfuin,"",{preventAutoTrack:false});qidianDA("setValsByHand",{appkey:"",da_rpt_type:"wpa"})}if(GLOBAL["qidian_readyToRpt"]){GLOBAL["qidian_readyToRpt"].forEach(function(event){qidianDA("track",event.type,event.data)});GLOBAL["qidian_readyToRpt"].length=0}}}catch(e){_log("[WPA][qidianDAReport]:error occured");_log(e)}};exports.addDa=function(nameAccount){if(!fetchedTencentSig){visitorId=localStorage.getItem(conf.tencentSig)||"";fetchedTencentSig=true}daList.push(nameAccount);if(!win[isFetchingDa]){win[isFetchingDa]=true;var path="https://bqq.gtimg.com/da_market/";path=window.__WPAENV==="test"?path+"i-oa.js":path+"i.js";fetch(path,"_da_market",function(){win[isDaAdded]=true;qidianDAReport()})}else{if(win[isDaAdded]){qidianDAReport()}}};exports.setGlobalVisitorId=function(data){var vid=data.vid,pid=data.pid,qid=data.qid;pvData.pid=pid;pvData.qid=qid;if(!win.__QIDIAN.visitorId){win.__QIDIAN.visitorId=vid}pvData.qidianid=pvData.visitorid=win.__QIDIAN.visitorId}});LBF.define("util.jsonp",function(require,exports,module){var request=require("util.request"),serialize=require("util.serialize"),dateTool=require("lang.dateTool");var cid=0;var CGI_TIMEOUT=1000*5,TIMEOUT=CGI_TIMEOUT+1000*2,setTimeoutObj={},hasQDWPABUS;module.exports=function(url,options,cb,charset){var cbName=options.cb||"JSONP_CB_"+ ++cid,script;cbName+="_"+ +new Date+"_"+Math.round(Math.random()*1000);options.cb=options.callback=cbName;hasQDWPABUS=window.__QDWPABUS?true:false;url+=url.indexOf("?")===-1?"?":"&";url+=serialize(options);(function(cbName){if(hasQDWPABUS){setTimeoutObj[cbName]=setTimeout(function(){var date=dateTool.format("Y-m-d H:i:s",new Date),e=new Error("[CGI NOT REACHED ERROR]["+date+"]cgi: "+url);__QDWPABUS.trigger("error",e)},TIMEOUT)}window[cbName]=function(json){clearTimeout(setTimeoutObj[cbName]);cb(json);setTimeout(function(){window[cbName]=null;if(script.parentNode){script.parentNode.removeChild(script)}},1)};return script=request(url,noop,charset)})(cbName)};function noop(){}});LBF.define("wpa.protocol.chat",function(require,exports){var browser=require("lang.browser"),SpeedReport=require("monitor.SpeedReport"),GUID=require("util.GUID"),domain=require("util.domain"),extend=require("lang.extend"),jsonp=require("util.jsonp"),onIframeLoaded=require("wpa.util.onIframeLoaded"),platformAuthorization=require("wpa.util.platformAuthorization"),getAuthorizationPageUrl=require("wpa.util.getAuthorizationPageUrl"),isFunction=require("lang.isFunction"),conf=require("wpa.conf.config"),CLICK_TYPE=conf.CLICK_TYPE,win=conf.gWin,eptype=conf.eptype,chatConst=require("wpa.conf.chat"),globalSettings=require("globalSettings"),kfuinCache=require("wpa.protocol.kfuin"),getReportData=require("wpa.util.getReportData"),serialize=require("util.serialize"),removeCustomProp=require("wpa.util.removeCustomProperty"),launchSchema=require("wpa.util.launch"),CustomParams=require("wpa.proto.CustomParams"),compareVersion=require("wpa.util.compareVersion"),domEvent=require("wpa.util.domEvent"),getLBSLocation=require("wpa.util.getLBSLocation"),protocol=globalSettings.protocol;var CHAT_TYPE_AUTO=chatConst.CHAT_TYPE_AUTO,CHAT_TYPE_ANONYMOUS=chatConst.CHAT_TYPE_ANONYMOUS,CHAT_TYPE_QQ=chatConst.CHAT_TYPE_QQ,PC_QQ_SCHEMA_CGI=chatConst.PC_QQ_SCHEMA_CGI,LAUNCH_MOBILE_QQ=chatConst.LAUNCH_MOBILE_QQ,LAUNCH_LINK=chatConst.LAUNCH_LINK;var CGIS=conf.CGIS,TYPE_PC=0,TYPE_MOBILE=1,ENV=conf.ENV,ERROR_INVALID_STAFF=50001,SUCCESS_RETURN_CODE=0,ERROR_MSG_INVALID_STAFF="\u62B1\u6B49\uFF0C\u4F01\u4E1A\u6682\u65F6\u65E0\u4EBA\u63A5\u5F85";var DISPLAY=conf.DISPLAY;try{(function(){if(!/eruda=true/.test(window.location)&&localStorage.getItem("active-eruda")!="true")return;var head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.type="text/javascript";script.onload=function(){eruda.init()};script.src="//cdn.jsdelivr.net/npm/eruda";head.appendChild(script)})();var body=document.getElementsByTagName("body")[0],isInMobileQQ=conf.BROWSER_ENV.isInMobileQQ,isInWX=conf.BROWSER_ENV.isInWX,wxVersion=conf.BROWSER_ENV.wxVersion,doc=document,head=doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement,baseElement=head.getElementsByTagName("base")[0],currentlyAddingScript,ua=navigator.userAgent;var fetch=function fetch(uri){var node=doc.createElement("script");node.charset="utf-8";node.async=false;node.src=uri;node.id="mqqjs";currentlyAddingScript=node;baseElement?head.insertBefore(node,baseElement):head.appendChild(node);currentlyAddingScript=null};if(ua.match(/QQ\/([\d.]+)/)&&ua.match(/Android/)){fetch("//open.mobile.qq.com/sdk/qqapi.wk.js?_bid=152")}}catch(err){alert("\u9519\u8BEF\u6D88\u606F:",err.message)}exports.PCChat=function(params,onChat){var authPath=getAuthorizationPageUrl();var opts={kfuin:params.fkfuin,kfext:params.fkfext,visitorId:params.guid,visitorid:params.guid,fid:params.id,key:params.key,cate:params.cate,type:params.type,ftype:TYPE_PC,tptype:params.tptype,tpForm:params.tpForm,roleKey:params.roleKey,roleValue:params.roleValue,roleUin:params.roleUin,pid:params.pid,clickid:params.clickid,qid:params.qid,env:ENV,eptype:eptype,clickType:params.clickType,roleData:params.roleData,isKfuin:params.isKfuin,isLBS:params.isLBS,isCustomEntry:params.isCustomEntry};if(win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid]){opts.ruleId=win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid]}if(win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid+"_num"]){opts.ruleNum=win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid+"_num"]}if(win.wpaShowItemId){opts.wpaShowItemId=win.wpaShowItemId}var getProtocolUrl=CGIS.GET_SIGT[ENV];if(params.isPub){getProtocolUrl=CGIS.GET_MP_SIGT[ENV]}CustomParams.setCustomParams(opts);var isJump=false,jumpUrl="",jumpWin=null;if(params.middlePage){isJump=parseInt(params.middlePage.pc)?true:false}if(params.cate==8){isJump=false}var createJumpPage=function createJumpPage(){jumpWin=win.open("","_blank");jumpWin.document&&jumpWin.document.write("\u6B63\u5728\u8DF3\u8F6C\uFF0C\u8BF7\u7A0D\u7B49...")};if(isJump){if(!opts.isLBS)createJumpPage()}var handleProtocol=function handleProtocol(rs){if(!rs||rs.r!==0||!rs.data){jumpWin&&jumpWin.close();return alert(rs.data.message||ERROR_MSG_INVALID_STAFF)}if(isJump){jumpUrl=LAUNCH_LINK+"?"+serialize(opts)+"&rkey="+rs.data.rkey+"&protocol="+rs.data.sign;jumpWin.location.href=jumpUrl;return}launchSchema(rs.data.sign,{checkCallQQStatus:true,rkey:rs.data.rkey,kfuin:opts.kfuin})};if(authPath!==""){var finalUrl=authPath+"&platform=pc&"+serialize(opts);platformAuthorization({src:finalUrl,id:"wpaAuthorization"});return}if(opts.isLBS){getLBSLocation(function(position){opts.longitude=position.coords.longitude;opts.latitude=position.coords.latitude;opts.coord_type=position.coord_type;if(isJump)createJumpPage();jsonp(getProtocolUrl,opts,handleProtocol)},function(positionError){if(isJump)createJumpPage();jsonp(getProtocolUrl,opts,handleProtocol)})}else{jsonp(getProtocolUrl,opts,handleProtocol)}};exports.mobileChat=function(params,onChat){var authPath=getAuthorizationPageUrl();var dm=domain.domain,fkfuin=params.fkfuin,fkfext=params.fkfext;var opts={kfuin:params.fkfuin,kfext:params.fkfext,visitorId:params.guid,visitorid:params.guid,fid:params.id,key:params.key,cate:params.cate,type:params.type,ftype:TYPE_MOBILE,pid:params.pid,clickid:params.clickid,tpForm:params.tpForm,qid:params.qid,env:ENV,eptype:eptype,clickType:params.clickType,tptype:params.tptype,roleKey:params.roleKey,roleValue:params.roleValue,roleUin:params.roleUin,roleData:params.roleData,isKfuin:params.isKfuin,isLBS:params.isLBS,isCustomEntry:params.isCustomEntry},getProtocolUrl=CGIS.GET_SIGT[ENV];if(win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid]){opts.ruleId=win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid]}if(win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid+"_num"]){opts.ruleNum=win.__WPAV2[DISPLAY.DISPLAY_IFRAME_ID+"_"+opts.kfuin+"_"+opts.fid+"_num"]}if(win.wpaShowItemId){opts.wpaShowItemId=win.wpaShowItemId}if(params.isPub){getProtocolUrl=CGIS.GET_MP_SIGT[ENV]}CustomParams.setCustomParams(opts);var isJump=true;if(params.middlePage){isJump=parseInt(params.middlePage.mobile)?true:false}if(params.cate==8){isJump=false}var handleProtocol=function handleProtocol(rs){if(!rs||rs.r!==0||!rs.data){return alert(rs.data.message||ERROR_MSG_INVALID_STAFF)}if(isInMobileQQ){return win.location.href=rs.data.sign}if(isInWX&&compareVersion(wxVersion,"6.5.6")>0){isJump=true}if(!isJump){launchSchema(rs.data.sign,{needMobileJump:false,checkCallQQStatus:true,kfuin:opts.kfuin});return}win.location.href=LAUNCH_LINK+"?"+serialize(opts)+"&protocol="+rs.data.sign};if(authPath!==""){var finalUrl=authPath+"&platform=h5&"+serialize(opts);platformAuthorization({src:finalUrl,id:"wpaAuthorization"});return}if(opts.isLBS){getLBSLocation(function(position){opts.longitude=position.coords.longitude;opts.latitude=position.coords.latitude;opts.coord_type=position.coord_type;jsonp(getProtocolUrl,opts,handleProtocol)},function(positionError){jsonp(getProtocolUrl,opts,handleProtocol)})}else{jsonp(getProtocolUrl,opts,handleProtocol)}};exports.LBSChat=function(data,url){jsonp(url,data,function(rs){if(!rs||rs.r!==0||!rs.data){return alert(rs.data.message||ERROR_MSG_INVALID_STAFF)}var schema=rs.data.sign;launchSchema(schema,{visitorId:data.visitorId,paramSwitch:1})})};exports.anonyChat=function(params,onChat){var url=chatConst.WPD_B_QQ_COM_WEBCHAT+"?nameAccount="+params.nameAccount,opener=win.open(url,"_blank","height=516, width=598,toolbar=no,scrollbars=no,menubar=no,status=no,location=no");opener.onload=function(){isFunction(onChat)&&onChat(params)}};exports.linkChat=function(params,onChat){var url=chatConst.LINK_CHAT+"?nameAccount="+params.nameAccount+"&id="+params.id,opener=win.open(url,"_blank","height=516, width=598,toolbar=no,scrollbars=no,menubar=no,status=no,location=no");opener.onload=function(){isFunction(onChat)&&onChat(params)}}});LBF.define("wpa.invite.inviteApi",function(require,exports,module){var conf=require("wpa.conf.config"),win=conf.gWin,WPA=win.__WPAV2,temp=[];WPA.inviteKfuinReadyState=[];WPA.on("inviteApi",function(kfuins){for(var i=0;i<temp.length;i++){if(!kfuins||kfuins.indexOf(temp[i].inviteRule.kfuin)!==-1){temp[i].wpa.Invite.init.call(temp[i].wpa,temp[i].inviteRule,{isInviteApi:true})}}});var add=function add(wpa,inviteRule){temp.push({wpa:wpa,inviteRule:inviteRule});WPA.inviteKfuinReadyState.push(inviteRule.kfuin);if(typeof window.__WPAV2InviteReady==="function"){window.__WPAV2InviteReady(WPA.inviteKfuinReadyState)}};var trigger=function trigger(kfuins){WPA.trigger("inviteApi",kfuins)};exports.add=add;exports.trigger=trigger});LBF.define("wpa.util.badjs",function(require,exports,module){var conf=require("wpa.conf.config"),badjsConf=conf.badjs,badjsConfId=badjsConf.id,badjsConfRandom=badjsConf.random;var BJ_REPORT_FOR_WPA=function(global){if(global.BJ_REPORT_FOR_WPA)return global.BJ_REPORT_FOR_WPA;var _error=[];var _config={id:0,uin:0,url:"",combo:1,ext:null,level:4,ignore:[],random:1,delay:1000,submit:null};var _isOBJByType=function _isOBJByType(o,type){return Object.prototype.toString.call(o)==="[object "+(type||"Object")+"]"};var _isOBJ=function _isOBJ(obj){var type=_typeof(obj);return type==="object"&&!!obj};var _isEmpty=function _isEmpty(obj){if(obj===null)return true;if(_isOBJByType(obj,"Number")){return false}return!obj};var _processError=function _processError(errObj){try{if(errObj.stack){var url=errObj.stack.match("https?://[^\n]+");url=url?url[0]:"";var rowCols=url.match(":(\\d+):(\\d+)");if(!rowCols){rowCols=[0,0,0]}var stack=_processStackMsg(errObj);return{msg:stack,rowNum:rowCols[1],colNum:rowCols[2],target:url.replace(rowCols[0],"")}}else{if(errObj.name&&errObj.message&&errObj.description){return{msg:JSON.stringify(errObj)}}return errObj}}catch(err){return errObj}};var _processStackMsg=function _processStackMsg(error){var stack=error.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,5).join("@").replace(/\?[^:]+/gi,"");var msg=error.toString();if(stack.indexOf(msg)<0){stack=msg+"@"+stack}return stack};var _error_tostring=function _error_tostring(error,index){var param=[];var params=[];var stringify=[];if(_isOBJ(error)){error.level=error.level||_config.level;for(var key in error){var value=error[key];if(!_isEmpty(value)){if(_isOBJ(value)){try{value=JSON.stringify(value)}catch(err){value="[BJ_REPORT_FOR_WPA detect value stringify error] "+err.toString()}}stringify.push(key+":"+value);param.push(key+"="+encodeURIComponent(value));params.push(key+"["+index+"]="+encodeURIComponent(value))}}}return[params.join("&"),stringify.join(","),param.join("&")]};var _imgs=[];var _submit=function _submit(url){if(_config.submit){_config.submit(url)}else{var _img=new Image;_imgs.push(_img);_img.src=url}};var error_list=[];var comboTimeout=0;var _send=function _send(isReoprtNow){if(!_config.report)return;while(_error.length){var isIgnore=false;var error=_error.shift();var error_str=_error_tostring(error,error_list.length);if(_isOBJByType(_config.ignore,"Array")){for(var i=0,l=_config.ignore.length;i<l;i++){var rule=_config.ignore[i];if(_isOBJByType(rule,"RegExp")&&rule.test(error_str[1])||_isOBJByType(rule,"Function")&&rule(error,error_str[1])){isIgnore=true;break}}}if(!isIgnore){if(_config.combo){error_list.push(error_str[0])}else{_submit(_config.report+error_str[2]+"&_t="+ +new Date)}_config.onReport&&_config.onReport(_config.id,error)}}var count=error_list.length;if(count){var comboReport=function comboReport(){clearTimeout(comboTimeout);_submit(_config.report+error_list.join("&")+"&count="+error_list.length+"&_t="+ +new Date);comboTimeout=0;error_list=[]};if(isReoprtNow){comboReport()}else if(!comboTimeout){comboTimeout=setTimeout(comboReport,_config.delay)}}};var _report={push:function push(msg){if(Math.random()>=_config.random){return _report}var data=_isOBJ(msg)?_processError(msg):{msg:msg};if(_config.ext&&!data.ext){data.ext=_config.ext}_error.push(data);_send();return _report},report:function report(msg){msg&&_report.push(msg);_send(true);return _report},info:function info(msg){if(!msg){return _report}if(_isOBJ(msg)){msg.level=2}else{msg={msg:msg,level:2}}_report.push(msg);return _report},debug:function debug(msg){if(!msg){return _report}if(_isOBJ(msg)){msg.level=1}else{msg={msg:msg,level:1}}_report.push(msg);return _report},init:function init(config){if(_isOBJ(config)){for(var key in config){_config[key]=config[key]}}var id=parseInt(_config.id,10);if(id){if(/qq\.com$/gi.test(location.hostname)){if(!_config.uin){_config.uin=parseInt((document.cookie.match(/\buin=\D+(\d+)/)||[])[1],10)}}if(!_config.url){_config.url="//badjs2.qq.com/badjs"}_config.report=(_config.url||"/badjs")+"?id="+id+"&uin="+_config.uin+"&from="+encodeURIComponent(location.href)+"&"}return _report},__onerror__:global.onerror};typeof console!=="undefined"&&console.error&&setTimeout(function(){var err=((location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)||[])[2];err&&console.error("BJ_ERROR",decodeURIComponent(err).replace(/(:\d+:\d+)\s*/g,"$1\n"))},0);global.BJ_REPORT_FOR_WPA=_report;return _report}(window);BJ_REPORT_FOR_WPA.init({id:badjsConfId,random:badjsConfRandom});exports.badjsReport=BJ_REPORT_FOR_WPA.report});LBF.define("lang.Class",function(require,exports,module){var toArray=require("lang.toArray"),extend=require("lang.extend");module.exports=inherit.call(Function,{initialize:function initialize(){},mixin:include});function inherit(ext){var args=toArray(arguments);var Class=function Class(){this.initialize.apply(this,arguments)};var Base=function Base(){};Base.prototype=this.prototype;var proto=new Base;proto.constructor=Class;proto.superclass=this;args.unshift(proto);extend.apply(args,args);Class.prototype=proto;extend(Class,{inherit:inherit,include:include,extend:inherit,superclass:this});return Class};function include(included){var args=toArray(arguments);args.unshift(this);extend.apply(this,args);return this}});LBF.define("lang.inArray",function(require,exports,module){module.exports=[].indexOf?function(elem,arr,i){return arr?[].indexOf.call(arr,elem,i):-1}:function(elem,arr,i){if(arr){var len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return-1}});LBF.define("wpa.util.onIframeLoaded",function(){return function(iframe,loaded,excludeUndefined){if(excludeUndefined){if(/loaded|complete/.test(iframe.readyState)){loaded()}else{if(iframe.attachEvent){var _handler3=function handler(){iframe.detachEvent("onload",_handler3);loaded()};iframe.attachEvent("onload",_handler3)}else{iframe.onload=function(){loaded();iframe.onload=null}}}}else{if(/loaded|complete|undefined/.test(iframe.readyState)){loaded()}else{if(iframe.attachEvent){var _handler3=function _handler2(){iframe.detachEvent("onload",_handler3);loaded()};iframe.attachEvent("onload",_handler3)}else{iframe.onload=function(){loaded();iframe.onload=null}}}}}});LBF.define("wpa.util.tmplCompiler",function(require){var xssFilter=require("util.xssFilter"),inArray=require("lang.inArray"),globalSettings=require("globalSettings"),isSSL=globalSettings.protocol.indexOf("https")!==-1?true:false,defaultConst=require("wpa.conf.defaultConst");var THEME_NAMES={1:"theme-1",2:"theme-2",3:"theme-3",4:"theme-4",5:"theme-5",6:"theme-6"};return{compile:function compile(options){var tpl=options.tpl,params=options.params,htmlRequired=options.htmlRequired||[],actualTheme=params.theme,tempObj={theme:THEME_NAMES[actualTheme],btnText:xssFilter.htmlEncode(params.btnText),title:xssFilter.htmlEncode(params.title),signature:xssFilter.htmlEncode(params.signature),avatar:params.avatar,qrcode:params.qrcode||"",closable:params.closable||"closable",btnBgColor:params.btnBgColor.value};if(params.cate==12){params.className+=" qidian_wxkf"}tpl=tpl.replace("{class}",params.className);if(!tempObj.avatar){tpl=tpl.replace("src=\"{avatar}\"","src=\"javascript:void(0);\" style=\"display:none!important;\"")}else if(/^https?:/.test(tempObj.avatar)){tempObj.avatar=tempObj.avatar.replace(/^https?:/,"")}for(var i=0,len=htmlRequired.length;i<len;i++){var r=htmlRequired[i],reg=new RegExp("\\{"+r+"\\}","g");tpl=tpl.replace(reg,tempObj[r])}return tpl}}});LBF.define("wpa.util.Style",function(require){var colors=require("wpa.conf.colors"),borderRadiusMixin=require("wpa.util.borderRadiusMixin"),inArray=require("lang.inArray"),getUrlBackground=require("wpa.util.urlBackground");var CSS={ELL:["word-break: break-all;","word-wrap:break-word;","text-overflow: ellipsis;","white-space: nowrap;","overflow: hidden;"].join(""),WORD_BREAK:["word-break: break-all;","word-wrap:break-word;"].join(""),BOX_SHADOW:["box-shadow:0 1px 15px rgba(0, 0, 0, 0.15);"].join(""),RESET:"margin:0;padding:0;",TEXT_SIZE_ADJUST:["-webkit-text-size-adjust:none;","text-size-adjust:none;"].join(""),TEXT_FAMILY:["font-family:\"PingFang SC\", \"Droid Sans Fallback\", \"microsoft yahei\";"].join(""),DIB:["display: inline-block;","*zoom: 1;","*display: inline;"].join("")};var CSS_COMMON=[CSS.TEXT_SIZE_ADJUST,CSS.TEXT_FAMILY,CSS.RESET].join("");return{load:function load(name,href,opts){opts=opts||{};var context=opts.context||document;var style=context.createElement("link");style.name=name;style.type="text/css";style.setAttribute("rel","stylesheet");style.setAttribute("href",href);(function(){try{var parent=context.getElementsByTagName("head")[0];parent.insertBefore(style,parent.firstChild)}catch(e){setTimeout(arguments.callee,1)}})();return style},add:function add(options){var name=options.name,self=options.self||{},dispType=options.dispType,cssText=options.cssText,htmlRequired=options.htmlRequired||{},borderRadius=options.borderRadius,doc=options.doc;var context=doc||document;var style=context.createElement("style");style.type="text/css";style.name=name;var parent=context.getElementsByTagName("body")[0];parent.insertBefore(style,parent.firstChild);cssText=cssText.replace(/\{ell\}/g,CSS.ELL).replace(/\{boxShadow\}/g,CSS.BOX_SHADOW).replace(/\{wordBreak\}/g,CSS.WORD_BREAK).replace(/\{dib\}/g,CSS.DIB).replace(/\{common\}/g,CSS_COMMON);if(style.styleSheet){style.styleSheet.cssText=cssText}else{style.appendChild(context.createTextNode(cssText))}return style},commonAdd:function commonAdd(options){var name=options.name,self=options.self||{},dispType=options.dispType,cssText=options.cssText,doc=options.doc;var context=doc||document;var style=context.createElement("style");style.type="text/css";style.name=name;var parent=context.getElementsByTagName("body")[0];parent.insertBefore(style,parent.firstChild);if(style.styleSheet){style.styleSheet.cssText=cssText}else{style.appendChild(context.createTextNode(cssText))}return style}}});LBF.define("wpa.conf.wpaType",function(require,exports,module){var defaultConst=require("wpa.conf.defaultConst"),POSITION=defaultConst.POSITION;var tpls={"11_12":function _12(params){if(!params){params={}}return{cate:params.cate||11,type:params.tplType||12,isPC:1,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]}},"11_13":function _13(params){if(!params){params={}}return{cate:params.cate||11,type:params.tplType||13,scene:1,isPC:1,borderRadius:"2px",htmlRequired:["title","signature","avatar","theme"],theme:["#fff","#00f"]}}};var wpaType={1:{1:{cate:1,type:1,scene:0,isPC:1,borderRadius:"2px",htmlRequired:["btnText","theme"],required:["btnText","theme","role"],role:["roleQQ"],theme:["#fff","#00f"]},2:{cate:1,type:2,scene:0,isPC:1,borderRadius:"2px",htmlRequired:["btnText","theme"],theme:["#fff","#00f"]},3:{cate:1,type:3,scene:1,isPC:1,borderRadius:"2px",htmlRequired:["title","signature","avatar"],theme:["#fff","#00f"]},4:{cate:1,type:4,isPC:1,floatStyle:{gap:{right:"10px"}},borderRadius:"2px",htmlRequired:["btnText","theme"]},5:{cate:1,type:5,isPC:1,floatStyle:{gap:{right:"10px"}},borderRadius:"2px",htmlRequired:["title","btnBgColor","avatar","btnText"]},6:{cate:1,type:6,isPC:1,floatStyle:{gap:{right:"10px",bottom:"20px"}},borderRadius:"2px",htmlRequired:["title","signature","btnBgColor","btnText","avatar"]},7:{cate:1,type:7,floatStyle:{gap:{right:"15px",bottom:"20px"}}},8:{cate:1,type:8,floatStyle:{gap:{right:"15px",bottom:"20px"}},htmlRequired:["btnText"]},9:{cate:1,type:9,htmlRequired:["closable","btnText","title","signature","theme","position","avatar"],tpl:3,tplOptions:{iconList:["icon-qq"],eventList:["callChat"],fixedBtnText:"\u5728\u7EBF\u54A8\u8BE2",hasBtnText:1,hasAvatar:1}},10:{cate:1,type:10,htmlRequired:["closable","btnText","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-qq"],eventList:["callChat"],fixedBtnText:"\u5728\u7EBF\u54A8\u8BE2",hasBtnText:1,hasAvatar:0}},11:{cate:1,type:11,htmlRequired:["closable","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-call","icon-qq"],eventList:["callPhone","callChat"],hasBtnText:0,hasAvatar:0}},12:{cate:1,type:12,htmlRequired:["closable","title","signature","theme","position","avatar"],tpl:3,tplOptions:{iconList:["icon-call","icon-qq"],eventList:["callPhone","callChat"],hasBtnText:0,hasAvatar:1}},13:{cate:1,type:13,htmlRequired:["title","signature","avatar","btnText"],isInQQ:1,tpl:4,tplOptions:{iconList:["icon-qq"],eventList:["callChat"],fixedBtnText:"\u5728\u7EBF\u54A8\u8BE2",hasBtnText:1,hasAvatar:1}},14:{cate:1,type:14,htmlRequired:["title","signature","avatar"],isInQQ:1,tpl:4,tplOptions:{iconList:["icon-call","icon-qq"],eventList:["callPhone","callChat"],hasBtnText:0,hasAvatar:1}},15:{cate:1,type:15,htmlRequired:["title","signature","avatar","qrcode","theme"],isInQQ:1,iframeBorder:{width:"1px",color:"#ebebeb"}},19:{cate:1,type:19,isPC:1,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]},20:{cate:1,type:20,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]}},2:{1:{cate:2,type:1,scene:0,htmlRequired:[],floatStyle:{gap:{right:"15px",bottom:"20px"}},required:["role"],role:["roleTEL"]},2:{cate:2,type:2,floatStyle:{gap:{right:"15px",bottom:"20px"}},htmlRequired:["btnText"]},3:{cate:2,type:3,htmlRequired:["closable","title","signature","theme","btnText","avatar","position"],tpl:3,tplOptions:{iconList:["icon-call"],eventList:["callPhone"],fixedBtnText:"\u514D\u8D39\u7535\u8BDD",hasBtnText:1,hasAvatar:1}},4:{cate:2,type:4,htmlRequired:["closable","title","signature","theme","btnText","position"],tpl:3,tplOptions:{iconList:["icon-call"],eventList:["callPhone"],fixedBtnText:"\u514D\u8D39\u7535\u8BDD",hasBtnText:1,hasAvatar:0}},5:{cate:2,type:5,htmlRequired:["closable","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-call","icon-qq"],eventList:["callPhone","callChat"],hasBtnText:0,hasAvatar:0}},6:{cate:2,type:6,htmlRequired:["closable","title","signature","theme","avatar","position"],tpl:3,tplOptions:{iconList:["icon-call","icon-qq"],eventList:["callPhone","callChat"],hasBtnText:0,hasAvatar:1}},7:{cate:2,type:7,htmlRequired:["title","signature","avatar"],tpl:4,isInQQ:1,tplOptions:{iconList:["icon-call"],eventList:["callPhone"],fixedBtnText:"\u514D\u8D39\u7535\u8BDD",hasBtnText:1,hasAvatar:1}},8:{cate:2,type:8,htmlRequired:["title","signature","avatar"],tpl:4,isInQQ:1,tplOptions:{iconList:["icon-call","icon-qq"],eventList:["callPhone","callChat"],hasBtnText:0,hasAvatar:1}}},3:{1:{cate:3,type:1,scene:0,isPC:1,htmlRequired:["title","signature","btnBgColor","btnText","avatar"],required:["title","signature","btnBgColor","btnText","avatar","role"],role:["rolePUB"],hasBoxShadow:1,btnBgColor:["#006600","#D58512","#0067ED"]},2:{cate:3,type:2,htmlRequired:["btnText","title","signature","btnBgColor","theme","closable","avatar","position"],tpl:6,tplOptions:{eventList:["callAddFan"],fixedBtnText:"\u5173\u6CE8",btnWithoutIconAdd:true,hasAvatar:1}},3:{cate:3,type:3,htmlRequired:["btnText","title","signature","btnBgColor","theme","closable","position"],tpl:6,tplOptions:{eventList:["callAddFan"],fixedBtnText:"\u5173\u6CE8",btnWithoutIconAdd:true,hasAvatar:0}}},4:{1:{cate:4,type:1,scene:0,isPC:1,htmlRequired:["title","signature","btnBgColor","btnText","avatar"],required:["title","signature","btnBgColor","btnText","avatar"],btnBgColor:["#006600","#D58512","#0067ED"]},2:{cate:4,type:2,htmlRequired:["btnText","title","signature","btnBgColor","theme","closable","position"],tpl:6,tplOptions:{eventList:["callAddGroup"],fixedBtnText:"QQ\u7FA4",hasAvatar:0}},3:{cate:4,type:3,htmlRequired:["btnText","title","signature","btnBgColor","theme","closable","position","avatar"],tpl:6,tplOptions:{eventList:["callAddGroup"],fixedBtnText:"QQ\u7FA4",hasAvatar:1}},4:{cate:4,type:4,htmlRequired:["title","signature","avatar"],isInQQ:1,tpl:5,tplOptions:{eventList:["callAddGroup"],fixedBtnText:"QQ\u7FA4",hasAvatar:1}}},5:{1:{cate:5,type:1,scene:0,isPC:1,hasBoxShadow:1,htmlRequired:["title","signature","btnBgColor","btnText","avatar"],required:["title","signature","btnBgColor","btnText","avatar","role"],role:["roleKFEXT"],btnBgColor:["#006600","#D58512","#0067ED"]},2:{cate:5,type:2,htmlRequired:["btnText","title","signature","btnBgColor","theme","closable","position"],tpl:6,tplOptions:{eventList:["callAddPal"],fixedBtnText:"\u597D\u53CB",hasAvatar:0}},3:{cate:5,type:3,htmlRequired:["btnText","title","signature","btnBgColor","theme","closable","position","avatar"],tpl:6,tplOptions:{eventList:["callAddPal"],fixedBtnText:"\u597D\u53CB",hasAvatar:1}},4:{cate:5,type:4,htmlRequired:["title","signature","avatar"],isInQQ:1,tpl:5,tplOptions:{eventList:["callAddPal"],fixedBtnText:"\u597D\u53CB",hasAvatar:1}}},7:{1:{cate:7,type:1,htmlRequired:["theme"],floatStyle:{gap:{right:"15px",bottom:"20px"}},fixedCircleOffset:{x:{key:"right",value:-5},y:{key:"bottom",value:30}}},2:{cate:7,type:2,floatStyle:{gap:{right:"15px",bottom:"20px"}},fixedCircleOffset:{x:{key:"right",value:-5},y:{key:"bottom",value:26}},htmlRequired:["btnText","theme"]},3:{cate:7,type:3,htmlRequired:["closable","btnText","title","signature","theme","position","avatar"],tpl:3,tplOptions:{iconList:["icon-im"],eventList:["callIm"],hasBtnText:1,hasAvatar:1},circleOffset:{x:{key:"right",value:-27},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:17},y:{key:"bottom",value:40}}},4:{cate:7,type:4,htmlRequired:["closable","btnText","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-im"],eventList:["callIm"],hasBtnText:1,hasAvatar:0},circleOffset:{x:{key:"right",value:-27},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:17},y:{key:"bottom",value:40}}},5:{cate:7,type:5,htmlRequired:["closable","title","signature","theme","position","avatar"],tpl:3,tplOptions:{iconList:["icon-call","icon-im"],eventList:["callPhone","callIm"],hasBtnText:0,hasAvatar:1},circleOffset:{x:{key:"right",value:-80},y:{key:"bottom",value:22}},fixedCircleOffset:{x:{key:"right",value:71},y:{key:"bottom",value:32}}},6:{cate:7,type:6,htmlRequired:["closable","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-call","icon-im"],eventList:["callPhone","callIm"],hasBtnText:0,hasAvatar:0},circleOffset:{x:{key:"right",value:-80},y:{key:"bottom",value:22}},fixedCircleOffset:{x:{key:"right",value:71},y:{key:"bottom",value:32}}},7:{cate:7,type:7,htmlRequired:["title","signature","avatar","btnText"],isInQQ:1,tpl:4,tplOptions:{iconList:["icon-im"],eventList:["callIm"],hasBtnText:1,hasAvatar:1},circleOffset:{x:{key:"right",value:-15},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:5},y:{key:"bottom",value:46}}},8:{cate:7,type:8,htmlRequired:["title","signature","avatar"],isInQQ:1,tpl:4,tplOptions:{iconList:["icon-call","icon-im"],eventList:["callPhone","callIm"],hasBtnText:0,hasAvatar:1},circleOffset:{x:{key:"right",value:-72},y:{key:"bottom",value:22}},fixedCircleOffset:{x:{key:"right",value:62},y:{key:"bottom",value:40}}},9:{cate:7,type:9,htmlRequired:["title","signature","avatar","qrcode","theme"],isInQQ:1,iframeBorder:{width:"1px",color:"#ebebeb"}},12:{cate:7,type:10,isPC:1,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]},13:{cate:7,type:13,isPC:1,floatStyle:{gap:{right:"10px"}},borderRadius:"4px",htmlRequired:["avatar","signature","theme"]},14:{cate:7,type:14,isPC:1,floatStyle:{gap:{right:"0"}},htmlRequired:["theme"]},19:{cate:7,type:19,isPC:1,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]},20:{cate:7,type:20,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]}},10:{1:{cate:10,type:3,htmlRequired:["closable","btnText","title","signature","theme","position","avatar"],tpl:3,tplOptions:{iconList:["icon-video"],eventList:["callAudioVideo"],hasBtnText:1,hasAvatar:1},circleOffset:{x:{key:"right",value:-27},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:17},y:{key:"bottom",value:40}}},2:{cate:10,type:4,isPC:1,floatStyle:{gap:{right:"10px"}},borderRadius:"2px",htmlRequired:["btnText","theme"]},3:tpls["11_12"]({cate:10,tplType:3}),4:tpls["11_13"]({cate:10,tplType:4}),5:{cate:10,type:4,htmlRequired:["closable","btnText","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-video"],eventList:["callAudioVideo"],hasBtnText:1,hasAvatar:0},circleOffset:{x:{key:"right",value:-27},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:17},y:{key:"bottom",value:40}}},7:{cate:10,type:7,htmlRequired:["title","signature","avatar","btnText"],isInQQ:1,tpl:4,tplOptions:{iconList:["icon-video"],eventList:["callAudioVideo"],hasBtnText:1,hasAvatar:1},circleOffset:{x:{key:"right",value:-15},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:5},y:{key:"bottom",value:46}}},9:{cate:10,type:9,htmlRequired:["title","signature","avatar","qrcode","theme"],isInQQ:1,iframeBorder:{width:"1px",color:"#ebebeb"}},12:tpls["11_12"]({cate:10}),13:tpls["11_13"]({cate:10}),19:{cate:10,type:19,isPC:1,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]},20:{cate:10,type:20,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]}},11:{1:{cate:11,type:1,htmlRequired:["closable","btnText","title","signature","theme","position","avatar"],tpl:3,tplOptions:{iconList:["icon-video"],eventList:["callAudioVideo"],hasBtnText:1,hasAvatar:1},circleOffset:{x:{key:"right",value:-27},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:17},y:{key:"bottom",value:40}}},2:{cate:11,type:2,isPC:1,floatStyle:{gap:{right:"10px"}},borderRadius:"2px",htmlRequired:["btnText","theme"]},3:tpls["11_12"]({tplType:3}),4:tpls["11_13"]({tplType:4}),5:{cate:11,type:5,htmlRequired:["closable","btnText","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-video"],eventList:["callAudioVideo"],hasBtnText:1,hasAvatar:0},circleOffset:{x:{key:"right",value:-27},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:17},y:{key:"bottom",value:40}}},6:{cate:11,type:6,htmlRequired:["closable","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-call","icon-im"],eventList:["callPhone","callIm"],hasBtnText:0,hasAvatar:0},circleOffset:{x:{key:"right",value:-80},y:{key:"bottom",value:22}},fixedCircleOffset:{x:{key:"right",value:71},y:{key:"bottom",value:32}}},7:{cate:11,type:7,htmlRequired:["title","signature","avatar","btnText"],isInQQ:1,tpl:4,tplOptions:{iconList:["icon-video"],eventList:["callAudioVideo"],hasBtnText:1,hasAvatar:1},circleOffset:{x:{key:"right",value:-15},y:{key:"bottom",value:15}},fixedCircleOffset:{x:{key:"right",value:5},y:{key:"bottom",value:46}}},8:{cate:11,type:8,htmlRequired:["title","signature","avatar"],isInQQ:1,tpl:4,tplOptions:{iconList:["icon-call","icon-im"],eventList:["callPhone","callIm"],hasBtnText:0,hasAvatar:1},circleOffset:{x:{key:"right",value:-72},y:{key:"bottom",value:22}},fixedCircleOffset:{x:{key:"right",value:62},y:{key:"bottom",value:40}}},9:{cate:11,type:9,htmlRequired:["title","signature","avatar","qrcode","theme"],isInQQ:1,iframeBorder:{width:"1px",color:"#ebebeb"}},12:tpls["11_12"](),13:tpls["11_13"](),14:{cate:11,type:14,isPC:1,floatStyle:{gap:{right:"0"}},htmlRequired:["theme"]},19:{cate:11,type:19,isPC:1,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]},20:{cate:11,type:20,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]}},12:{1:{cate:12,type:1,scene:0,isPC:1,borderRadius:"2px",htmlRequired:["btnText","theme"],required:["btnText","theme","role"],role:["roleQQ"],theme:["#fff","#00f"]},2:{cate:12,type:2,scene:0,isPC:1,borderRadius:"2px",htmlRequired:["btnText","theme"],theme:["#fff","#00f"]},3:{cate:12,type:3,scene:1,isPC:1,borderRadius:"2px",htmlRequired:["title","signature","avatar","qrcode"],theme:["#fff","#00f"]},4:{cate:12,type:4,isPC:1,floatStyle:{gap:{right:"10px"}},borderRadius:"2px",htmlRequired:["btnText","theme"]},5:{cate:12,type:5,isPC:1,floatStyle:{gap:{right:"10px"}},borderRadius:"2px",htmlRequired:["title","btnBgColor","avatar","btnText","qrcode"]},7:{cate:12,type:7,floatStyle:{gap:{right:"15px",bottom:"20px"}}},8:{cate:12,type:8,floatStyle:{gap:{right:"15px",bottom:"20px"}},htmlRequired:["btnText"]},9:{cate:12,type:9,htmlRequired:["closable","btnText","title","signature","theme","position","avatar"],tpl:3,tplOptions:{iconList:["icon-wechat"],eventList:["openImUrl"],fixedBtnText:"\u70B9\u51FB\u54A8\u8BE2",hasBtnText:1,hasAvatar:1}},10:{cate:12,type:10,htmlRequired:["closable","btnText","title","signature","theme","position"],tpl:3,tplOptions:{iconList:["icon-wechat"],eventList:["openImUrl"],fixedBtnText:"\u70B9\u51FB\u54A8\u8BE2",hasBtnText:1,hasAvatar:0}},15:{cate:12,type:15,htmlRequired:["title","signature","avatar","qrcode","theme"],iframeBorder:{width:"1px",color:"#ebebeb"}},20:{cate:12,type:20,floatStyle:{gap:{left:"10px",bottom:"10px"}},htmlRequired:["signature","avatar","theme"]}}};module.exports=wpaType});LBF.define("wpa.util.insertIframe",function(require,exports,module){var browser=require("lang.browser");var insertIframe=function insertIframe(params){var scripts=document.getElementsByTagName("script"),defaultLastScript=scripts[scripts.length-1];var ele=params.ele,lastScript=params.lastScript?params.lastScript:defaultLastScript,container=params.container;if(!container){lastScript.parentNode.insertBefore(ele,lastScript);return}if(typeof container==="string"){var targetEle=document.getElementById(container);if(!targetEle){throw new Error("\u65E0\u6CD5\u627E\u5230container\uFF0C\u8BE5container id\u5BF9\u5E94\u5143\u7D20\u4E0D\u5B58\u5728\u6216\u8005\u4E0D\u5728DOM\u4E2D")}var isQuirk=document.compatMode==="BackCompat";if(browser.msie&&parseInt(browser.version,10)<7||isQuirk){document.body.appendChild(ele)}else{targetEle.appendChild(ele)}return}if(typeof container.nodeType!=="undefined"){container.appendChild(ele);return}throw new Error("\u65E0\u6548\u7684container\uFF0C\u8BF7\u68C0\u67E5container\u53C2\u6570\uFF0C\u4EE5\u53CAcontainer id\u5BF9\u5E94\u7684\u5143\u7D20\u662F\u5426\u5408\u6CD5")};module.exports=insertIframe});LBF.define("wpa.conf.floatCss",function(require,exports){var browser=require("lang.browser"),defaultConst=require("wpa.conf.defaultConst"),P=defaultConst.POSITION,offset=require("wpa.util.offset");var POSITION_BOTTOM=1,MAX_Z_INDEX="z-index: 2000000000;",STYLE_FIXED="position:fixed;";exports.getFloatStyle=function(params){var position=params.position,location=params.location,defaultPosition=params.defaultPosition,isWidthNum=typeof params.width==="number"?true:false,width=isWidthNum?params.width:0,height=typeof params.height==="number"?params.height:0,gap="0px",floatStyle=params.floatStyle||{},floatGap=floatStyle.gap||{},top=floatGap.top||gap,bottom=floatGap.bottom||gap,right=floatGap.right||gap,left=floatGap.left||gap,offsetY=height/2,result="";if(location){var h=location.h||{},v=location.v||{},hType=h.type,hPx=h.px||0,vType=v.type,vPx=v.px||0;if(hType==1){result+="left:"+hPx+"px;"}else if(hType==2){result+="left: 50%;margin-left:-"+width/2+"px;"}else if(hType==3){result+="right:"+hPx+"px;"}if(vType==1){result+="top:"+vPx+"px;"}else if(vType==2){result+="top: 50%;margin-top:-"+height/2+"px;"}else if(vType==3){result+="bottom:"+vPx+"px;"}result+=STYLE_FIXED+MAX_Z_INDEX;return result}if(defaultPosition){switch(defaultPosition){case P[6]:{result="right:"+right+";top:50%;margin-top:-"+offsetY+"px;";break}case P[9]:{result="right:"+right+";bottom:"+bottom;break}case P[8]:{result="bottom:"+gap+";left:0;";break}case P[7]:{result="bottom:"+bottom+";left:"+left+";";break}}result+=";"+STYLE_FIXED+MAX_Z_INDEX}else if(typeof position!=="undefined"){if(position==POSITION_BOTTOM){result=STYLE_FIXED+"bottom:"+gap;if(!isWidthNum&params.width=="100%"){result+=";left: 0"}}result+=";"+MAX_Z_INDEX}return result}});LBF.define("wpa.conf.Events",function(require,exports,module){var Events={defaultEventType:"click"};return Events});LBF.define("lang.proxy",function(require,exports,module){module.exports=function(fn,context){return function(){return fn.apply(context,arguments)}}});LBF.define("wpa.conf.wpaTmpl",function(require,exports,module){var config=require("wpa.conf.config"),imageBaseUrl=config.imageBaseUrl,TYPES=config.TYPES,extend=require("lang.extend"),browser=require("lang.browser"),defaultConst=require("wpa.conf.defaultConst"),defaultEventTagName=defaultConst.defaultEventTagName,wpaType=require("wpa.conf.wpaType"),replaceImg3X=require("wpa.util.replaceImg3X"),getTpl=require("wpa.conf.tpl");var isAndroid=browser.isAndroid,isIOS=browser.isIOS,isMobile=isAndroid||isIOS;var COLORS={2:"#12b7f5",3:"#0067ed",4:"#ff9232",5:"#ee685d",6:"#25cd98"};var POSITION=defaultConst.POSITION,ratio,tpls,tmpls;var getSizeFunc=require("wpa.util.getSize");module.exports=exports={init:function init(options){options=options||{};var ratio=options.ratio||1,opts={ratio:ratio},getSize=getSizeFunc(options.ratio);tpls={1:getTpl(1,extend({hasAvatar:1},opts)),2:getTpl(2,opts),3:getTpl(1,opts),"1_9":getTpl(wpaType[TYPES.QQ][9].tpl,extend(wpaType[TYPES.QQ][9].tplOptions,opts)),"1_10":getTpl(wpaType[TYPES.QQ][10].tpl,extend(wpaType[TYPES.QQ][10].tplOptions,opts)),"1_11":getTpl(wpaType[TYPES.QQ][11].tpl,extend(wpaType[TYPES.QQ][11].tplOptions,opts)),"1_12":getTpl(wpaType[TYPES.QQ][12].tpl,extend(wpaType[TYPES.QQ][12].tplOptions,opts)),"1_13":getTpl(wpaType[TYPES.QQ][13].tpl,extend(wpaType[TYPES.QQ][13].tplOptions,opts)),"1_14":getTpl(wpaType[TYPES.QQ][14].tpl,extend(wpaType[TYPES.QQ][14].tplOptions,opts)),"2_3":getTpl(wpaType[TYPES.PHONE][3].tpl,extend(wpaType[TYPES.PHONE][3].tplOptions,opts)),"2_4":getTpl(wpaType[TYPES.PHONE][4].tpl,extend(wpaType[TYPES.PHONE][4].tplOptions,opts)),"2_5":getTpl(wpaType[TYPES.PHONE][5].tpl,extend(wpaType[TYPES.PHONE][5].tplOptions,opts)),"2_6":getTpl(wpaType[TYPES.PHONE][6].tpl,extend(wpaType[TYPES.PHONE][6].tplOptions,opts)),"2_7":getTpl(wpaType[TYPES.PHONE][7].tpl,extend(wpaType[TYPES.PHONE][7].tplOptions,opts)),"2_8":getTpl(wpaType[TYPES.PHONE][8].tpl,extend(wpaType[TYPES.PHONE][8].tplOptions,opts)),"3_2":getTpl(wpaType[TYPES.PUB][2].tpl,extend(wpaType[TYPES.PUB][2].tplOptions,opts)),"3_3":getTpl(wpaType[TYPES.PUB][3].tpl,extend(wpaType[TYPES.PUB][3].tplOptions,opts)),"4_2":getTpl(wpaType[TYPES.GROUP][2].tpl,extend(wpaType[TYPES.GROUP][2].tplOptions,opts)),"4_3":getTpl(wpaType[TYPES.GROUP][3].tpl,extend(wpaType[TYPES.GROUP][3].tplOptions,opts)),"4_4":getTpl(wpaType[TYPES.GROUP][4].tpl,extend(wpaType[TYPES.GROUP][4].tplOptions,opts)),"5_2":getTpl(wpaType[TYPES.KFEXT][2].tpl,extend(wpaType[TYPES.KFEXT][2].tplOptions,opts)),"5_3":getTpl(wpaType[TYPES.KFEXT][3].tpl,extend(wpaType[TYPES.KFEXT][3].tplOptions,opts)),"5_4":getTpl(wpaType[TYPES.KFEXT][4].tpl,extend(wpaType[TYPES.KFEXT][4].tplOptions,opts)),"7_3":getTpl(wpaType[TYPES.IM][3].tpl,extend(wpaType[TYPES.IM][3].tplOptions,opts)),"7_4":getTpl(wpaType[TYPES.IM][4].tpl,extend(wpaType[TYPES.IM][4].tplOptions,opts)),"7_5":getTpl(wpaType[TYPES.IM][5].tpl,extend(wpaType[TYPES.IM][5].tplOptions,opts)),"7_6":getTpl(wpaType[TYPES.IM][6].tpl,extend(wpaType[TYPES.IM][6].tplOptions,opts)),"7_7":getTpl(wpaType[TYPES.IM][7].tpl,extend(wpaType[TYPES.IM][7].tplOptions,opts)),"7_8":getTpl(wpaType[TYPES.IM][8].tpl,extend(wpaType[TYPES.IM][8].tplOptions,opts)),"11_1":getTpl(wpaType[TYPES.VIDEO][1].tpl,extend(wpaType[TYPES.VIDEO][1].tplOptions,opts)),"11_2":{width:70,height:70,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callAudioVideo\" name=\""+defaultEventTagName+"\">","<span class=\"icon-im\"></span>","<span class=\"btn-text\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {cursor:pointer;{dib}width: 68px;height: 68px;border-radius: 2px;border:1px solid #33cc99;position: relative;font-family:\"microsoft yahei\";font-size: 12px;text-align: center;top:0;}",".theme-1 {background: #33cc99;}",".theme-1 .btn-text {color: #fff;}",".theme-2 {background: #12b7f5;color:#fff;border-color: #12b7f5;}",".icon-im {{dib}width: 26px;height: 26px;position: absolute;top: 13px;left: 22px;}",".icon-im {background: url(\""+imageBaseUrl+"/video-nobg-white.png\") no-repeat;background-size: contain;}",".theme-3 {background: #0067ed;color: #fff;border-color: #0067ed;}",".theme-4 {background: #ff9232;color: #fff;border-color: #ff9232;}",".theme-5 {background: #ee685d;color: #fff;border-color: #ee685d;}",".theme-6 {background: #FFCD54;color: #fff;border-color: #FFCD54;}",".btn-text {{ell}max-width: 70px;color:#fff;display: block;position: relative;top: 43px;}"].join("")},"11_5":getTpl(wpaType[TYPES.VIDEO][5].tpl,extend(wpaType[TYPES.VIDEO][5].tplOptions,opts)),"11_7":getTpl(wpaType[TYPES.VIDEO][7].tpl,extend(wpaType[TYPES.VIDEO][7].tplOptions,opts)),"11_9":{width:"100%",height:270,accurateSize:0,tpl:["<div class=\"wpa-container theme-1\">","<div class=\"qr-code\">","<img src=\"{qrcode}\" class=\"qr-code-img\"/>","<img src=\"{avatar}\" class=\"avatar-in-qr-code\" />","</div>","<div class=\"info\">","<div class=\"avatar\">","<span class=\"title\">{title}</span>","</div>","<div class=\"signature\">","{signature}","</div>","</div>","</div>"].join(""),cssText:["* {{common}}",".wpa-container {z-index:1;{dib}position: relative;width: 100%;height: "+getSize(230)+"px;padding: "+getSize(20)+"px;}",".theme-1 {background: #fff;box-shadow: 0 0 0 1px #bbb;}",".theme-2 {background: #19212e;}",".theme-3 {background: #00a5e0;}",".theme-4 {background: #ff9232;}",".theme-5 {background: #ee685d;}",".theme-6 {background: #33cc99;}",".qr-code, .info, .title {{dib}}",".img-avatar {display: none;}",".qr-code {padding: "+getSize(15)+"px; background: #fff; position:relative; width: "+getSize(200)+"px; height: "+getSize(200)+"px;}",".qr-code-img {width: "+getSize(200)+"px;height: "+getSize(200)+"px;}",".theme-1 .qr-code {padding: 0; width: "+getSize(230)+"px; height: "+getSize(230)+"px;}",".theme-1 .qr-code-img {width: "+getSize(230)+"px;height: "+getSize(230)+"px;}",".avatar-in-qr-code {width: "+getSize(50)+"px; height: "+getSize(50)+"px; position:absolute;top: "+getSize(90)+"px;left: "+getSize(90)+"px;display:none;}",".info {position: absolute;left: "+getSize(270)+"px;top: "+getSize(63)+"px;}",".avatar img {border-radius: 50%;width: "+getSize(80)+"px;height: "+getSize(80)+"px;vertical-align: middle;}",".title {font-size: "+getSize(36)+"px;vertical-align: middle;margin-left: "+getSize(0)+"px;color: #fff;{ell}}",".signature {line-height: 1.6em;font-size: "+getSize(26)+"px;max-width: 85%;margin-top: "+getSize(16)+"px;color: #fff;{wordBreak}}",".theme-1 .signature {color: #999;}",".theme-1 .title {color: #000;}"].join("")},"11_12":{width:350,height:70,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callAudioVideo\" name=\""+defaultEventTagName+"\">","<span style=\"z-index:9999;\" class=\"icon-im\" ></span>","<img class=\"avatar\" src=\"{avatar}\" />","<div class=\"chat-bubble\">","<span class=\"triangle-back\"></span>","<span class=\"triangle-front\"></span>","<span class=\"vm\"></span>","<p class=\"content\">{signature}</p>","</div>","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;width: 350px;height: 70px;position: relative;line-height: 70px;}",".avatar {width: 60px;height: 60px;border-radius: 50%;position: relative;top: 5px;left: 0;z-index:0;}",".icon-im {display: inline-block;width: 25px;height: 25px;position: absolute;left: 46px;top: 0;background-repeat:no-repeat;z-index:10;background-size: contain;}",".chat-bubble {display:table-cell;vertical-align:middle;border-radius: 6px;border: 1px solid #dadee7;width: 270px;height: 63px;position: absolute;left:75px;top: 3px;font-size: 14px;color: #fff;white-space:nowrap;}",".vm {display:inline-block;vertical-align:middle;}",".content {max-width:240px;padding-left: 15px; white-space: normal;padding-right: 12px;line-height: 20px;display: inline-block;vertical-align: middle;position: relative;top: -3px;}",".chat-bubble {background: #fff;color: #1e2330;}",".triangle-back {display: inline-block;width: 0;height: 0;border: 8px solid transparent;position: absolute;left: -16px;top: 24px;z-index: 10;}",".triangle-front {display: none;width: 0;height: 0;border: 8px solid transparent;position: absolute;left: -14px;top: 24px;z-index: 11;}",".triangle-back {border-right-color: #dadee7;}",".triangle-front {border-right-color: #fff;display: inline-block;}",".theme-1 .icon-im {background-image:url("+imageBaseUrl+"/video-theme-1.png);}",".theme-2 .icon-im {background-image:url("+imageBaseUrl+"/video-theme-2.png);}",".theme-3 .icon-im {background-image:url("+imageBaseUrl+"/video-theme-3.png);}",".theme-4 .icon-im {background-image:url("+imageBaseUrl+"/video-theme-4.png);}",".theme-5 .icon-im {background-image:url("+imageBaseUrl+"/video-theme-5.png);}",".theme-6 .icon-im {background-image:url("+imageBaseUrl+"/video-theme-6.png);}"].join("")},"11_13":{width:255,height:85,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callAudioVideo\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\"{avatar}\" />","<span class=\"icon-im\"></span>","<span class=\"title\">{title}</span>","<span class=\"signature\">{signature}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}width: 253px;height: 83px;border-radius: 2px;position: relative;font-family:\"microsoft yahei\";font-size: 14px;background: #fff;border: 1px solid #dadee7;box-shadow:0 1px 3px rgba(30, 36, 49, 0.15);cursor: pointer;}",".avatar {width: 85px;height: 83px;position: absolute;left:0;top: 0;}",".icon-im {{dib}width: 22px;height: 18px;background-size: contain;background-repeat: no-repeat;position: absolute;left: 97px;top: 22px;}",".title {{dib}{ell}max-width: 125px;font-size: 20px;position: absolute;left: 126px;top: 16px;color:#1e2330;}",".signature {{dib}{ell}max-width: 150px;position: absolute;left: 97px;top: 50px;text-align: left;}",".theme-1 .icon-im {background-image:url("+imageBaseUrl+"/video-nobg-theme-1.png);}",".theme-2 .icon-im {background-image:url("+imageBaseUrl+"/video-nobg-theme-2.png);}",".theme-3 .icon-im {background-image:url("+imageBaseUrl+"/video-nobg-theme-3.png);}",".theme-4 .icon-im {background-image:url("+imageBaseUrl+"/video-nobg-theme-4.png);}",".theme-5 .icon-im {background-image:url("+imageBaseUrl+"/video-nobg-theme-5.png);}",".theme-6 .icon-im {background-image:url("+imageBaseUrl+"/video-nobg-theme-6.png);}"].join("")},"11_19":{width:60,height:60,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callAudioVideo\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\""+imageBaseUrl+"/video-{theme}.png\" />","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;position: relative;}",".avatar {width: 60px;height: 60px;}"].join("")},"11_20":{width:100,height:100,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callAudioVideo\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\""+imageBaseUrl+"/video-{theme}.png\" />","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;position: relative;}",".avatar {width: 50px;height: 50px;}"].join("")},"12_9":getTpl(wpaType[TYPES.WXKF][9].tpl,extend(wpaType[TYPES.WXKF][9].tplOptions,opts)),"12_10":getTpl(wpaType[TYPES.WXKF][10].tpl,extend(wpaType[TYPES.WXKF][10].tplOptions,opts))},tmpls={defaultEventTagName:defaultEventTagName,1:{1:{width:96,height:30,accurateSize:1,tpl:["<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" class=\"wpa-container {theme}\" data-event=\"callChat\">","<span class=\"icon-qq\"></span>","<span class=\"btn-text\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {text-align: center;{dib}width: 94px;height: 28px;line-height:28px;text-decoration: none;border:1px solid #dadee7;border-radius: 2px; font-size: 14px;font-family:\"microsoft yahei\";}",".icon-qq {{dib}vertical-align: middle;width: 18px;height: 18px;margin-right: 3px;margin-top:-3px;}",".theme-1 {background: #fff;color: #1e2330;}",".theme-1 .icon-qq {background: url(\""+imageBaseUrl+"/1_1_1.png\") no-repeat;}",".theme-2 {background: #12b7f5;color: #fff;border-color: #12b7f5;}",".icon-qq {background: url(\""+imageBaseUrl+"/1_1_2.png\") no-repeat;}",".theme-3 {background: #0067ed;color: #fff;border-color: #0067ed;}",".theme-4 {background: #ff9232;color: #fff;border-color: #ff9232;}",".theme-5 {background: #ee685d;color: #fff;border-color: #ee685d;}",".theme-6 {background: #33cc99;color: #fff;border-color: #33cc99;}",".btn-text {{dib}vertical-align: middle;font-size: 14px;height: 28px;line-height: 28px;margin-top:-3px;{ell}}"].join("")},2:{width:150,height:45,accurateSize:1,tpl:["<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" class=\"wpa-container {theme}\" data-event=\"callChat\">","<span class=\"icon-qq\"></span>","<span class=\"btn-text\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {text-align: center;{dib}width: 148px;height: 43px;line-height:42px;text-decoration: none;border-radius: 2px; border:1px solid #dadee7;font-size: 14px;font-family:\"microsoft yahei\";}",".icon-qq {{dib}vertical-align: middle;width: 26px;height: 26px;margin-right: 10px;}",".theme-1 {background: #fff;color: #1e2330;}",".theme-1 .icon-qq {background: url(\""+imageBaseUrl+"/1_2_1.png\") no-repeat;}",".theme-2 {background: #12b7f5;color: #fff;border-color: #12b7f5;}",".icon-qq {background: url(\""+imageBaseUrl+"/1_2_2.png\") no-repeat;}",".theme-3 {background: #0067ed;color: #fff;border-color: #0067ed;}",".theme-4 {background: #ff9232;color: #fff;border-color: #ff9232;}",".theme-5 {background: #ee685d;color: #fff;border-color: #ee685d;}",".theme-6 {background: #33cc99;color: #fff;border-color: #33cc99;}",".btn-text {{dib}vertical-align: middle;font-size: 16px;height: 45px;line-height: 45px;position:relative;top:-2px;{ell}}"].join("")},3:{width:255,height:85,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\"{avatar}\" />","<span class=\"icon-qq\"></span>","<span class=\"title\">{title}</span>","<span class=\"signature\">{signature}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}width: 253px;height: 83px;border-radius: 2px;position: relative;font-family:\"microsoft yahei\";font-size: 14px;background: #fff;border: 1px solid #dadee7;box-shadow:0 1px 3px rgba(30, 36, 49, 0.15);cursor: pointer;}",".avatar {width: 85px;height: 83px;position: absolute;left:0;top: 0;}",".icon-qq {{dib}width: 22px;height: 22px;background: url(\""+imageBaseUrl+"/1_4.png\") no-repeat;position: absolute;left: 97px;top: 18px;}",".title {{dib}{ell}max-width: 125px;font-size: 20px;position: absolute;left: 126px;top: 16px;color:#1e2330;}",".signature {{dib}{ell}max-width: 150px;position: absolute;left: 97px;top: 50px;text-align: left;}"].join("")},4:{width:70,height:70,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<span class=\"icon-qq\"></span>","<span class=\"btn-text\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {cursor:pointer;{dib}width: 68px;height: 68px;border-radius: 2px;border:1px solid #dadee7;position: relative;font-family:\"microsoft yahei\";font-size: 12px;text-align: center;top:0;}",".theme-1 {background: #fff;}",".theme-1 .btn-text {color:#1e2330;}",".theme-2 {background: #12b7f5;color:#fff;border-color: #12b7f5;}",".icon-qq {{dib}width: 26px;height: 26px;position: absolute;top: 13px;left: 22px;}",".theme-1 .icon-qq {background: url(\""+imageBaseUrl+"/1_2_1.png\") no-repeat;}",".icon-qq {background: url(\""+imageBaseUrl+"/1_2_2.png\") no-repeat;}",".theme-3 {background: #0067ed;color: #fff;border-color: #0067ed;}",".theme-4 {background: #ff9232;color: #fff;border-color: #ff9232;}",".theme-5 {background: #ee685d;color: #fff;border-color: #ee685d;}",".theme-6 {background: #33cc99;color: #fff;border-color: #33cc99;}",".btn-text {{ell}max-width: 70px;color:#fff;display: block;position: relative;top: 43px;}"].join("")},5:{width:106,height:165,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<span class=\"title\">{title}</span>","<img class=\"avatar\" src=\"{avatar}\" />","<span class=\"btn-area\" style=\"background: {btnBgColor}\">","<span class=\"icon-qq\"></span>","<span class=\"btn-text\">{btnText}</span>","</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}{boxShadow}width: 104px;height: 165px;border-radius: 2px;position: relative;font-family:\"microsoft yahei\";font-size: 14px;background: #fff;border: 1px solid #dadee7;{boxShadow}cursor: pointer;text-align: center;}",".title {{dib}color: #000;margin-top: 9px;color:#1e2330;}",".avatar {width: 80px;height: 80px;border-radius: 50%;margin-top: 9px;}",".btn-area {{dib}width: 106px;height: 35px;line-height: 35px;position: absolute;bottom: -1px;left: -1px;text-align: center;margin-right: 6px;border-bottom-left-radius: 2px;border-bottom-right-radius: 2px;}",".icon-qq {{dib}width: 22px;height: 22px;vertical-align: middle;background: url(\""+imageBaseUrl+"/1_1_2.png\") no-repeat;margin-top:1px;}",".btn-text {{ell}color: #fff;max-width: 100px;}"].join("")},6:{width:404,height:200,accurateSize:1,defaultPosition:POSITION[9],tpl:["<div class=\"wpa-container\">","<a class=\"close\" data-event=\"callClose\" name=\""+defaultEventTagName+"\" href=\"javascript:void(0);\"></a>","<img class=\"avatar\" src=\"{avatar}\" />","<div class=\"content\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<a class=\"btn-area\" data-event=\"callChat\" name=\""+defaultEventTagName+"\" style=\"background: {btnBgColor}\">","<span class=\"icon-qq\"></span>","<span class=\"btn-text\">{btnText}</span>","</a>","</div>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}width: 402px;height: 198px;border-radius: 2px;position: relative;border:1px solid #dadee7;background: #fff;/*border: 1px solid #ebedf2;*/font-family:\"microsoft yahei\";font-size: 14px;{boxShadow}}",".close {position: absolute;top: 15px;right: 15px;{dib}width: 14px;height: 14px;background: url("+imageBaseUrl+"/icon-close.png) no-repeat;}",".avatar {position: absolute;top: 0;left: 0;width: 150px;height: 198px;}",".content {position: absolute;top: 30px;left: 170px;}",".title {{ell}font-size: 22px;color:#1e2330;}",".icon-qq {{dib}width: 22px;height: 22px;margin-left: 1px;margin-top:1px;vertical-align: middle;background: url(\""+imageBaseUrl+"/1_1_2.png\") no-repeat;}",".signature {color: #777;line-height: 24px;margin-top: 10px;width: 215px;}",".btn-area {{ell}text-decoration: none;color: #fff;position: absolute;right: 15px;bottom: 15px;width: 100px;border-radius: 2px;text-align: center;height: 35px;line-height: 35px;cursor:pointer;}"].join("")},7:{width:88,height:90,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a class=\"wpa-container\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<span class=\"icon-qq\"></span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}line-height:1;width: "+getSize(84)+"px;height: "+getSize(84)+"px;border-radius: 50%;background: #fff;border: 1px solid #dadee7;cursor: pointer;text-align: center;}",".icon-qq {{dib}position:relative;top:"+getSize(20)+"px;width: "+getSize(37)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+replaceImg3X("/icon-qq-44-2x.png",ratio)+") no-repeat;background-size: "+getSize(37)+"px "+getSize(44)+"px;}"].join("")},8:{width:250,height:78,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a class=\"wpa-container\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<span class=\"v\"></span>","<span class=\"icon-qq\"></span>","<span class=\"btnText\">\u5728\u7EBF\u54A8\u8BE2</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}font-size:0;-webkit-text-size-adjust:none;width: "+getSize(246)+"px;height: "+getSize(74)+"px;border-radius: "+getSize(100)+"px;background: #fff;border: 1px solid #dadee7;cursor: pointer;text-align: center;position:relative;}",".v {{dib}vertical-align:middle;line-height:"+getSize(74)+"px;width:1px;height:"+getSize(74)+"px;}",".icon-qq {{dib}vertical-align:middle;width: "+getSize(37)+"px;height: "+getSize(44)+"px;background: url("+imageBaseUrl+replaceImg3X("/icon-qq-44-2x.png",ratio)+") no-repeat;background-size: "+getSize(37)+"px "+getSize(44)+"px;margin-right:8px;}",".btnText {{dib}{ell}vertical-align:middle;font-size: "+getSize(34)+"px;max-width: "+getSize(140)+"px;color: #1e2330;line-height:1;}"].join("")},9:{width:"100%",height:130,accurateSize:0,tpl:tpls["1_9"]().tpl,cssText:tpls["1_9"]().cssText},10:{width:"100%",height:130,accurateSize:0,tpl:tpls["1_10"]().tpl,cssText:tpls["1_10"]().cssText},11:{width:"100%",height:130,accurateSize:0,tpl:tpls["1_11"]().tpl,cssText:tpls["1_11"]().cssText},12:{width:"100%",height:130,accurateSize:0,tpl:tpls["1_12"]().tpl,cssText:tpls["1_12"]().cssText},13:{width:"100%",height:140,accurateSize:0,tpl:tpls["1_13"]().tpl,cssText:tpls["1_13"]().cssText},14:{width:"100%",height:140,accurateSize:0,tpl:tpls["1_14"]().tpl,cssText:tpls["1_14"]().cssText},15:{width:"100%",height:270,accurateSize:0,tpl:["<div class=\"wpa-container theme-1\">","<div class=\"qr-code\">","<img src=\"{qrcode}\" class=\"qr-code-img\"/>","<img src=\"{avatar}\" class=\"avatar-in-qr-code\" />","</div>","<div class=\"info\">","<div class=\"avatar\">","<span class=\"title\">{title}</span>","</div>","<div class=\"signature\">","{signature}","</div>","</div>","</div>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}position: relative;width: 100%;height: "+getSize(230)+"px;padding: "+getSize(20)+"px;}",".theme-1 {background: #fff;box-shadow: 0 0 0 1px #bbb;}",".theme-2 {background: #19212e;}",".theme-3 {background: #00a5e0;}",".theme-4 {background: #ff9232;}",".theme-5 {background: #ee685d;}",".theme-6 {background: #33cc99;}",".qr-code, .info, .title {{dib}}",".img-avatar {display: none;}",".qr-code {padding: "+getSize(15)+"px; background: #fff; position:relative; width: "+getSize(200)+"px; height: "+getSize(200)+"px;}",".qr-code-img {width: "+getSize(200)+"px;height: "+getSize(200)+"px;}",".theme-1 .qr-code {padding: 0; width: "+getSize(230)+"px; height: "+getSize(230)+"px;}",".theme-1 .qr-code-img {width: "+getSize(230)+"px;height: "+getSize(230)+"px;}",".avatar-in-qr-code {width: "+getSize(50)+"px; height: "+getSize(50)+"px; position:absolute;top: "+getSize(90)+"px;left: "+getSize(90)+"px;display:none;}",".info {position: absolute;left: "+getSize(270)+"px;top: "+getSize(63)+"px;}",".avatar img {border-radius: 50%;width: "+getSize(80)+"px;height: "+getSize(80)+"px;vertical-align: middle;}",".title {font-size: "+getSize(36)+"px;vertical-align: middle;margin-left: "+getSize(0)+"px;color: #fff;{ell}}",".signature {line-height: 1.6em;font-size: "+getSize(26)+"px;max-width: 85%;margin-top: "+getSize(16)+"px;color: #fff;{wordBreak}}",".theme-1 .signature {color: #999;}",".theme-1 .title {color: #000;}"].join("")},19:{width:60,height:60,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\""+imageBaseUrl+"/common-{theme}.png\" />","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;position: relative;}",".avatar {width: 60px;height: 60px;}"].join("")},20:{width:100,height:100,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\""+imageBaseUrl+"/common-{theme}.png\" />","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;position: relative;}",".avatar {width: 50px;height: 50px;}"].join("")}},2:{1:{width:88,height:88,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a href=\"javascript:void(0);\" class=\"wpa-container\" name=\""+defaultEventTagName+"\" data-event=\"callPhone\">","<img class=\"icon-call\" src=\""+imageBaseUrl+"/icon-call-44-2x.png\" srcset=\""+imageBaseUrl+"/icon-call-44-2x.png 1x, "+imageBaseUrl+"/icon-call-44-3x.png 2x\" />","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}width: "+getSize(84)+"px;height: "+getSize(84)+"px;text-decoration: none;text-align: center;border-radius: 100%;border: 1px solid #dadee7;background:#fff;line-height: "+getSize(78)+"px;}",".wpa-container img {vertical-align: middle; width: "+getSize(42)+"px; height: "+getSize(42)+"px;}"].join("")},2:{width:250,height:78,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a class=\"wpa-container\" data-event=\"callPhone\" name=\""+defaultEventTagName+"\">","<span class=\"v\"></span>","<span class=\"icon-call\"></span>","<span class=\"btnText\">\u514D\u8D39\u7535\u8BDD</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}font-size:0;-webkit-text-size-adjust:none;width: "+getSize(246)+"px;height: "+getSize(74)+"px;border-radius: "+getSize(100)+"px;background: #fff;border: 1px solid #dadee7;cursor: pointer;text-align: center;position:relative;}",".v {{dib}vertical-align:middle;line-height:"+getSize(74)+"px;width:1px;height:"+getSize(74)+"px;}",".icon-call {{dib}vertical-align:middle;width: "+getSize(37)+"px;height: "+getSize(44)+"px;background: url("+imageBaseUrl+replaceImg3X("/icon-call-30-2x.png",ratio)+") no-repeat;background-size: "+getSize(37)+"px "+getSize(44)+"px;margin-right:8px;}",".btnText {{dib}{ell}vertical-align:middle;font-size: "+getSize(34)+"px;max-width: "+getSize(140)+"px;color: #1e2330;line-height:"+(isAndroid?"41px":"1")+";}"].join("")},3:{width:"100%",height:130,accurateSize:0,tpl:tpls["2_3"]().tpl,cssText:tpls["2_3"]().cssText},4:{width:"100%",height:130,accurateSize:0,tpl:tpls["2_4"]().tpl,cssText:tpls["2_4"]().cssText},5:{width:"100%",height:130,accurateSize:0,tpl:tpls["2_5"]().tpl,cssText:tpls["2_5"]().cssText},6:{width:"100%",height:130,accurateSize:0,tpl:tpls["2_6"]().tpl,cssText:tpls["2_6"]().cssText},7:{width:"100%",height:140,accurateSize:0,tpl:tpls["2_7"]().tpl,cssText:tpls["2_7"]().cssText},8:{width:"100%",height:140,accurateSize:0,tpl:tpls["2_8"]().tpl,cssText:tpls["2_8"]().cssText}},3:{1:{width:404,height:200,accurateSize:1,defaultPosition:POSITION[9],tpl:tpls[2]({event:5}).tpl,cssText:tpls[2]({event:5}).cssText},2:{width:"100%",height:140,accurateSize:0,tpl:tpls["3_2"]().tpl,cssText:tpls["3_2"]().cssText},3:{width:"100%",height:140,accurateSize:0,tpl:tpls["3_3"]().tpl,cssText:tpls["3_3"]().cssText}},4:{1:{width:404,height:200,accurateSize:1,defaultPosition:POSITION[9],tpl:tpls[2]({event:4}).tpl,cssText:tpls[2]({event:4}).cssText},2:{width:"100%",height:140,accurateSize:0,tpl:tpls["4_2"]().tpl,cssText:tpls["4_2"]().cssText},3:{width:"100%",height:140,accurateSize:0,tpl:tpls["4_3"]().tpl,cssText:tpls["4_3"]().cssText},4:{width:"100%",height:140,accurateSize:0,tpl:tpls["4_4"]().tpl,cssText:tpls["4_4"]().cssText}},5:{1:{width:404,height:200,accurateSize:1,defaultPosition:POSITION[9],tpl:["<div class=\"wpa-container\">","<a class=\"close\" data-event=\"callClose\" name=\""+defaultEventTagName+"\" href=\"javascript:void(0);\"></a>","<img class=\"avatar\" src=\"{avatar}\" />","<div class=\"content\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<a class=\"btn\" style=\"background:{btnBgColor};\" href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"callAddPal\">{btnText}</a>","</div>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}width: 404px;height: 200px;border-radius: 2px;position: relative;background: #fff;/*border: 1px solid #ebedf2;*/font-family:\"microsoft yahei\";font-size: 14px;{boxShadow}}",".close {position: absolute;top: 15px;right: 15px;{dib}width: 14px;height: 14px;background: url("+imageBaseUrl+"/icon-close.png) no-repeat;}",".avatar {position: absolute;top: 0;left: 0;width: 150px;height: 200px;}",".content {position: absolute;top: 30px;left: 170px;}",".title {{ell}font-size: 18px;}",".signature {color: #777;line-height: 24px;margin-top: 10px;width: 215px;}",".btn {{ell}text-decoration: none;color: #fff;position: absolute;right: 15px;bottom: 15px;width: 100px;border-radius: 2px;text-align: center;height: 35px;line-height: 35px;}"].join("")},2:{width:"100%",height:140,accurateSize:0,tpl:tpls["5_2"]().tpl,cssText:tpls["5_2"]().cssText},3:{width:"100%",height:140,accurateSize:0,tpl:tpls["5_3"]().tpl,cssText:tpls["5_3"]().cssText},4:{width:"100%",height:140,accurateSize:0,tpl:tpls["5_4"]().tpl,cssText:tpls["5_4"]().cssText}},7:{1:{width:88,height:90,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callIm\" name=\""+defaultEventTagName+"\">","<span class=\"icon-im\"></span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}line-height:1;width: "+getSize(84)+"px;height: "+getSize(84)+"px;border-radius: 50%;border: 1px solid #dadee7;cursor: pointer;text-align: center;}",".icon-im {{dib}position:relative;top:"+getSize(20)+"px;width: "+getSize(44)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+replaceImg3X("/icon-im-44-white-2x.png",ratio)+") no-repeat;background-size: "+getSize(44)+"px "+getSize(44)+"px;}",".theme-1 {background: #fff;}",".theme-1 .icon-im {background: url("+imageBaseUrl+replaceImg3X("/icon-im-44-blue-2x.png",ratio)+") no-repeat;background-size: "+getSize(44)+"px "+getSize(44)+"px;}",".theme-2 {background: #12b7f5;border-color: #12b7f5;}",".theme-3 {background: #0067ed;border-color: #0067ed;}",".theme-4 {background: #ff9232;border-color: #ff9232;}",".theme-5 {background: #ee685d;border-color: #ee685d;}",".theme-6 {background: #25cd98;border-color: #25cd98;}"].join("")},2:{width:250,height:78,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callIm\" name=\""+defaultEventTagName+"\">","<span class=\"v\"></span>","<span class=\"icon-im\"></span>","<span class=\"btnText\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}font-size:0;-webkit-text-size-adjust:none;width: "+getSize(246)+"px;height: "+getSize(74)+"px;border-radius: "+getSize(100)+"px;background: #fff;border: 1px solid #dadee7;cursor: pointer;text-align: center;position:relative;}",".v {{dib}vertical-align:middle;line-height:"+getSize(74)+"px;width:1px;height:"+getSize(74)+"px;}",".icon-im {{dib}vertical-align:middle;width: "+getSize(44)+"px;height: "+getSize(44)+"px;background: url("+imageBaseUrl+replaceImg3X("/icon-im-44-white-2x.png",ratio)+") no-repeat;background-size: "+getSize(44)+"px "+getSize(44)+"px;margin-right:8px;}",".btnText {{dib}{ell}vertical-align:middle;font-size: "+getSize(34)+"px;max-width: "+getSize(140)+"px;color: #fff;line-height:1;}",".theme-1 {background:#fff;}",".theme-1 .icon-im {background: url("+imageBaseUrl+replaceImg3X("/icon-im-44-blue-2x.png",ratio)+") no-repeat;background-size: "+getSize(44)+"px "+getSize(44)+"px;}",".theme-1 .btnText {color: #1e2330;}",".theme-2 {background: #12b7f5;border-color: #12b7f5;}",".theme-3 {background: #0067ed;border-color: #0067ed;}",".theme-4 {background: #ff9232;border-color: #ff9232;}",".theme-5 {background: #ee685d;border-color: #ee685d;}",".theme-6 {background: #25cd98;border-color: #25cd98;}"].join("")},3:{width:"100%",height:130,accurateSize:0,tpl:tpls["7_3"]().tpl,cssText:tpls["7_3"]().cssText},4:{width:"100%",height:130,accurateSize:0,tpl:tpls["7_4"]().tpl,cssText:tpls["7_4"]().cssText},5:{width:"100%",height:130,accurateSize:0,tpl:tpls["7_5"]().tpl,cssText:tpls["7_5"]().cssText},6:{width:"100%",height:130,accurateSize:0,tpl:tpls["7_6"]().tpl,cssText:tpls["7_6"]().cssText},7:{width:"100%",height:140,accurateSize:0,tpl:tpls["7_7"]().tpl,cssText:tpls["7_7"]().cssText},8:{width:"100%",height:140,accurateSize:0,tpl:tpls["7_8"]().tpl,cssText:tpls["7_8"]().cssText},9:{width:"100%",height:270,accurateSize:0,tpl:["<div class=\"wpa-container theme-1\">","<div class=\"qr-code\">","<img src=\"{qrcode}\" class=\"qr-code-img\"/>","<img src=\"{avatar}\" class=\"avatar-in-qr-code\" />","</div>","<div class=\"info\">","<div class=\"avatar\">","<span class=\"title\">{title}</span>","</div>","<div class=\"signature\">","{signature}","</div>","</div>","</div>"].join(""),cssText:["* {{common}}",".wpa-container {z-index:1;{dib}position: relative;width: 100%;height: "+getSize(230)+"px;padding: "+getSize(20)+"px;}",".theme-1 {background: #fff;box-shadow: 0 0 0 1px #bbb;}",".theme-2 {background: #19212e;}",".theme-3 {background: #00a5e0;}",".theme-4 {background: #ff9232;}",".theme-5 {background: #ee685d;}",".theme-6 {background: #33cc99;}",".qr-code, .info, .title {{dib}}",".img-avatar {display: none;}",".qr-code {padding: "+getSize(15)+"px; background: #fff; position:relative; width: "+getSize(200)+"px; height: "+getSize(200)+"px;}",".qr-code-img {width: "+getSize(200)+"px;height: "+getSize(200)+"px;}",".theme-1 .qr-code {padding: 0; width: "+getSize(230)+"px; height: "+getSize(230)+"px;}",".theme-1 .qr-code-img {width: "+getSize(230)+"px;height: "+getSize(230)+"px;}",".avatar-in-qr-code {width: "+getSize(50)+"px; height: "+getSize(50)+"px; position:absolute;top: "+getSize(90)+"px;left: "+getSize(90)+"px;display:none;}",".info {position: absolute;left: "+getSize(270)+"px;top: "+getSize(63)+"px;}",".avatar img {border-radius: 50%;width: "+getSize(80)+"px;height: "+getSize(80)+"px;vertical-align: middle;}",".title {font-size: "+getSize(36)+"px;vertical-align: middle;margin-left: "+getSize(0)+"px;color: #fff;{ell}}",".signature {line-height: 1.6em;font-size: "+getSize(26)+"px;max-width: 85%;margin-top: "+getSize(16)+"px;color: #fff;{wordBreak}}",".theme-1 .signature {color: #999;}",".theme-1 .title {color: #000;}"].join("")},12:{width:350,height:70,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callIm\" name=\""+defaultEventTagName+"\">","<span style=\"z-index:9999;\" class=\"icon-im\" ></span>","<img class=\"avatar\" src=\"{avatar}\" />","<div class=\"chat-bubble\">","<span class=\"triangle-back\"></span>","<span class=\"triangle-front\"></span>","<span class=\"vm\"></span>","<p class=\"content\">{signature}</p>","</div>","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;width: 350px;height: 70px;position: relative;line-height: 70px;}",".avatar {width: 60px;height: 60px;border-radius: 50%;position: relative;top: 5px;left: 0;z-index:0;}",".icon-im {display: inline-block;width: 25px;height: 25px;position: absolute;left: 46px;top: 0;background-repeat:no-repeat;z-index:10;}",".chat-bubble {display:table-cell;vertical-align:middle;border-radius: 6px;border: 1px solid #dadee7;width: 270px;height: 63px;position: absolute;left:75px;top: 3px;font-size: 14px;color: #fff;white-space:nowrap;}",".vm {display:inline-block;vertical-align:middle;}",".content {max-width:240px;padding-left: 15px; white-space: normal;padding-right: 12px;line-height: 20px;display: inline-block;vertical-align: middle;position: relative;top: -3px;}",".theme-1 .chat-bubble {background: #fff;color: #1e2330;}",".theme-2 .chat-bubble {background: "+COLORS[2]+";border-color: "+COLORS[2]+";}",".theme-3 .chat-bubble {background: "+COLORS[3]+";border-color: "+COLORS[3]+";}",".theme-4 .chat-bubble {background: "+COLORS[4]+";border-color: "+COLORS[4]+";}",".theme-5 .chat-bubble {background: "+COLORS[5]+";border-color: "+COLORS[5]+";}",".theme-6 .chat-bubble {background: "+COLORS[6]+";border-color: "+COLORS[6]+";}",".triangle-back {display: inline-block;width: 0;height: 0;border: 8px solid transparent;position: absolute;left: -16px;top: 24px;z-index: 10;}",".triangle-front {display: none;width: 0;height: 0;border: 8px solid transparent;position: absolute;left: -14px;top: 24px;z-index: 11;}",".theme-1 .triangle-back {border-right-color: #dadee7;}",".theme-1 .triangle-front {border-right-color: #fff;display: inline-block;}",".theme-2 .triangle-back {border-right-color: "+COLORS[2]+";}",".theme-3 .triangle-back {border-right-color: "+COLORS[3]+";}",".theme-4 .triangle-back {border-right-color: "+COLORS[4]+";}",".theme-5 .triangle-back {border-right-color: "+COLORS[5]+";}",".theme-6 .triangle-back {border-right-color: "+COLORS[6]+";}",".theme-1 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme2.png);}",".theme-2 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme2.png);}",".theme-3 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme3.png);}",".theme-4 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme4.png);}",".theme-5 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme5.png);}",".theme-6 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme6.png);}"].join("")},13:{width:106,height:140,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callIm\" name=\""+defaultEventTagName+"\">","<img src=\"{avatar}\" class=\"avatar\" />","<span style=\"z-index:9999;\" class=\"icon-im\"></span>","<p class=\"signature\">{signature}</p>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {display:block;cursor:pointer;width: 104px;height: 138px;position: relative;text-align: center;font-size: 14px;color: #1e2330;border: 1px solid #dadee7;border-radius: 4px;background: #fff;}",".avatar {width: 80px;height: 80px;border-radius: 50%;display: inline-block;position:absolute;left:12px;top: 16px;z-index:0;}",".signature {position: relative;top:109px;}",".icon-im {display: inline-block;width: 25px;height: 25px;background-repeat: no-repeat;position: absolute;top: 14px;right: 4px;z-index: 10;}",".theme-2 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme2.png);}",".theme-3 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme3.png);}",".theme-4 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme4.png);}",".theme-5 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme5.png);}",".theme-6 .icon-im {background-image:url("+imageBaseUrl+"/im-bubble-pc-theme6.png);}"].join("")},14:{width:80,height:160,accurateSize:1,defaultPosition:POSITION[6],tpl:["<div class=\"wpa-container {theme}\">","<a class=\"btn-qq btn\" data-event=\"callChat\" name=\""+defaultEventTagName+"\">","<span class=\"icon-qq btn-icon\"></span><br/>","<span class=\"btn-text\">QQ</span>","</a>","<span class=\"spliter\"></span>","<a class=\"btn-im btn\" data-event=\"callIm\" name=\""+defaultEventTagName+"\">","<span class=\"icon-im btn-icon\"></span><br/>","<span class=\"btn-text\">\u54A8\u8BE2</span>","</a>","</div>"].join(""),cssText:["* {{common}}",".wpa-container {width: 80px;height: 160px;position: relative;text-align: center;font-size: 16px;color: #fff;border-top-left-radius: 4px;border-bottom-left-radius: 4px;}",".theme-2 {background: "+COLORS[2]+";}",".theme-3 {background: "+COLORS[3]+";}",".theme-4 {background: "+COLORS[4]+";}",".theme-5 {background: "+COLORS[5]+";}",".theme-6 {background: "+COLORS[6]+";}",".btn {display:block;text-align: center;position: relative;width: 100%;height: 80px;top: 17px;cursor: pointer;}",".spliter {display: inline-block;width: 100%;height: 1px;background: #fff;position: absolute;top: 50%;left: 0;}",".icon-qq {display: inline-block;width: 22px;height: 26px;background: url("+imageBaseUrl+"/icon-qq-white-small.png) no-repeat;}",".icon-im {display: inline-block;width: 25px;height: 25px;background: url("+imageBaseUrl+"/im-bubble-pc-white.png) no-repeat;}"].join("")},19:{width:60,height:60,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callIm\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\""+imageBaseUrl+"/common-{theme}.png\" />","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;position: relative;}",".avatar {width: 60px;height: 60px;}"].join("")},20:{width:100,height:100,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"callIm\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\""+imageBaseUrl+"/common-{theme}.png\" />","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;position: relative;}",".avatar {width: 50px;height: 50px;}"].join("")}},10:{1:{width:"100%",height:130,accurateSize:0,tpl:tpls["11_1"]().tpl,cssText:tpls["11_1"]().cssText},2:tpls["11_2"],3:tpls["11_12"],4:tpls["11_13"],5:{width:"100%",height:130,accurateSize:0,tpl:tpls["11_5"]().tpl,cssText:tpls["11_5"]().cssText},7:{width:"100%",height:140,accurateSize:0,tpl:tpls["11_7"]().tpl,cssText:tpls["11_7"]().cssText},9:tpls["11_9"],12:tpls["11_12"],13:tpls["11_13"],19:tpls["11_19"],20:tpls["11_20"]},11:{1:{width:"100%",height:130,accurateSize:0,tpl:tpls["11_1"]().tpl,cssText:tpls["11_1"]().cssText},2:tpls["11_2"],3:tpls["11_12"],4:tpls["11_13"],5:{width:"100%",height:130,accurateSize:0,tpl:tpls["11_5"]().tpl,cssText:tpls["11_5"]().cssText},7:{width:"100%",height:140,accurateSize:0,tpl:tpls["11_7"]().tpl,cssText:tpls["11_7"]().cssText},9:tpls["11_9"],12:tpls["11_12"],13:tpls["11_13"],19:tpls["11_19"],20:tpls["11_20"]},12:{1:{width:96,height:30,accurateSize:1,tpl:["<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" class=\"wpa-container {theme}\" data-event=\"openImUrl\">","<span class=\"icon-wechat\"></span>","<span class=\"btn-text\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {text-align: center;{dib}width: 94px;height: 28px;line-height:28px;text-decoration: none;border:1px solid #dadee7;border-radius: 2px; font-size: 14px;font-family:\"microsoft yahei\";background: #fff;color: #1e2330;}",".icon-wechat {{dib}vertical-align: middle;width: 20px;height: 16.22px;margin-right: 3px;margin-top:-3px;}",".theme-1 {background: #fff;color: #1e2330;}",".theme-1 .icon-wechat {background: url(\""+imageBaseUrl+"/wechat.png\") no-repeat;background-size: contain;}",".icon-wechat {background: url(\""+imageBaseUrl+"/wechat.png\") no-repeat;background-size: contain;}",".btn-text {{dib}vertical-align: middle;font-size: 14px;height: 28px;line-height: 28px;margin-top:-3px;{ell}}"].join("")},2:{width:150,height:45,accurateSize:1,tpl:["<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" class=\"wpa-container {theme}\" data-event=\"openImUrl\">","<span class=\"icon-wechat\"></span>","<span class=\"btn-text\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {text-align: center;{dib}width: 148px;height: 43px;line-height:42px;text-decoration: none;border-radius: 2px; border:1px solid #dadee7;font-size: 14px;font-family:\"microsoft yahei\";background: #fff;color: #1e2330;}",".icon-wechat {{dib}vertical-align: middle;width: 26px;height: 21.09px;margin-right: 10px;}",".theme-1 {background: #fff;color: #1e2330;}",".theme-1 .icon-wechat {background: url(\""+imageBaseUrl+"/wechat.png\") no-repeat;background-size: contain;}",".icon-wechat {background: url(\""+imageBaseUrl+"/wechat.png\") no-repeat;background-size: contain;}",".btn-text {{dib}vertical-align: middle;font-size: 16px;height: 45px;line-height: 45px;position:relative;top:-2px;{ell}}"].join("")},3:{width:255,height:85,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container\" data-event=\"openImUrl\" name=\""+defaultEventTagName+"\">","<span class=\"qrcode\">"+"<img class=\"qrcode_img\" src=\"{qrcode}\" />"+"<img class=\"avatar\" src=\"{avatar}\" />"+"</span>","<span class=\"icon-wechat\"></span>","<span class=\"title\">{title}</span>","<span class=\"signature\">{signature}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}width: 253px;height: 83px;border-radius: 2px;position: relative;font-family:\"microsoft yahei\";font-size: 14px;background: #fff;border: 1px solid #dadee7;box-shadow:0 1px 3px rgba(30, 36, 49, 0.15);cursor: pointer;}",".qrcode {display:inline-block;width: 74px;height: 74px;margin:5.5px;position: absolute;left:0;top: 0;}",".qrcode_img {width:100%;height:100%}",".avatar {width: 27.02px;height: 27.02px;position: absolute;left:50%;top: 50%;transform:translate(-50%,-50%)}",".icon-wechat {{dib}width: 24px;height: 19.47px;background: url(\""+imageBaseUrl+"/wechat.png\") no-repeat;position: absolute;left: 97px;top: 21px;background-size: cover;}",".title {{dib}{ell}max-width: 125px;font-size: 20px;position: absolute;left: 126px;top: 16px;color:#1e2330;}",".signature {{dib}{ell}max-width: 150px;position: absolute;left: 97px;top: 50px;text-align: left;}"].join("")},4:{width:70,height:70,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container {theme}\" data-event=\"openImUrl\" name=\""+defaultEventTagName+"\">","<img class=\"icon-wechat\" src=\""+imageBaseUrl+"/wechat.png\" />","<span class=\"btn-text\">{btnText}</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {cursor:pointer;{dib}width: 68px;height: 68px;border-radius: 2px;border:1px solid #dadee7;position: relative;font-family:\"microsoft yahei\";font-size: 12px;text-align: center;top:0;background: #fff;}",".theme-1 {background: #fff;}",".theme-1 .btn-text {color:#1e2330;}",".icon-wechat {{dib}width: 36px;height: 29.2px;position: absolute;top: 10px;left: 16px;}",".btn-text {{ell}max-width: 70px;color:#1F232F;display: block;position: relative;top: 45px;}"].join("")},5:{width:106,height:165,accurateSize:1,defaultPosition:POSITION[6],tpl:["<a class=\"wpa-container\" data-event=\"openImUrl\" name=\""+defaultEventTagName+"\">","<span class=\"title\">{title}</span>","<span class=\"qrcode\">"+"<img class=\"qrcode_img\" src=\"{qrcode}\" />"+"<img class=\"avatar\" src=\"{avatar}\" />"+"</span>","<span class=\"btn-area\" style=\"background: {btnBgColor}\">","<span class=\"icon-wechat\"></span>","<span class=\"btn-text\">{btnText}</span>","</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}{boxShadow}width: 104px;height: 165px;border-radius: 2px;position: relative;font-family:\"microsoft yahei\";font-size: 14px;background: #fff;border: 1px solid #dadee7;{boxShadow}cursor: pointer;text-align: center;}",".title {{dib}color: #000;margin-top: 9px;color:#1e2330;}",".qrcode {display:inline-block;width: 80px;height: 80px;position: relative;margin-top: 9px;}",".qrcode_img {width:100%;height:100%}",".avatar {width: 24.99px;height: 24.99px;position:absolute;left:50%;top: 50%;transform:translate(-50%,-50%);}",".btn-area {{dib}width: 106px;height: 35px;line-height: 35px;position: absolute;bottom: -1px;left: -1px;text-align: center;margin-right: 6px;border-bottom-left-radius: 2px;border-bottom-right-radius: 2px;background-color:#56CB6C!important}",".icon-wechat {{dib}width: 22px;height: 17.85px;vertical-align: middle;background: url(\""+imageBaseUrl+"/wechat_white.png\") no-repeat;background-size: cover;margin-right:5px}",".btn-text {{ell}color: #fff;max-width: 100px;}"].join("")},7:{width:100,height:100,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a class=\"wpa-container\" data-event=\"openImUrl\" name=\""+defaultEventTagName+"\">","<span class=\"icon-wechat\"></span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}line-height:1;width:48px;height:48px;"+"border-radius: 50%;background: #fff;border: 1px solid #dadee7;cursor: pointer;text-align: center;}",".icon-wechat {{dib}position:relative;top:12px;width: 32px;height:25.96px;vertical-align: middle;background: url("+imageBaseUrl+replaceImg3X("/wechat.png",ratio)+") no-repeat;background-size:contain;}"].join("")},8:{width:250,height:78,accurateSize:1,defaultPosition:POSITION[9],tpl:["<a class=\"wpa-container\" data-event=\"openImUrl\" name=\""+defaultEventTagName+"\">","<span class=\"v\"></span>","<span class=\"icon-wechat\"></span>","<span class=\"btnText\">\u70B9\u51FB\u54A8\u8BE2</span>","</a>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}font-size:0;-webkit-text-size-adjust:none;width: "+getSize(246)+"px;height: "+getSize(74)+"px;border-radius: "+getSize(100)+"px;background: #fff;border: 1px solid #dadee7;cursor: pointer;text-align: center;position:relative;}",".v {{dib}vertical-align:middle;line-height:"+getSize(74)+"px;width:1px;height:"+getSize(74)+"px;}",".icon-wechat {{dib}vertical-align:middle;width: 27px;height:21.9px;"+"background: url("+imageBaseUrl+replaceImg3X("/wechat.png",ratio)+") no-repeat;background-size:cover;margin-right:8px;}",".btnText {{dib}{ell}vertical-align:middle;font-size: "+getSize(34)+"px;max-width: "+getSize(140)+"px;color: #1e2330;line-height:1;}"].join("")},9:{width:"100%",height:130,accurateSize:0,tpl:tpls["12_9"]().tpl,cssText:tpls["12_9"]().cssText},10:{width:"100%",height:130,accurateSize:0,tpl:tpls["12_10"]().tpl,cssText:tpls["12_10"]().cssText},15:{width:698,height:272,accurateSize:0,tpl:["<div class=\"wpa-container theme-1\">","<div class=\"qr-code\">","<img src=\"{qrcode}\" class=\"qr-code-img\"/>","<img src=\"{avatar}\" class=\"avatar-in-qr-code\" />","</div>","<div class=\"info\">","<div class=\"avatar\">","<span class=\"title\">{title}</span>","</div>","<div class=\"signature\">","{signature}","</div>","</div>","</div>"].join(""),cssText:["* {{common}}",".wpa-container {{dib}position: relative;width: 350px;height:138px;padding:12px;background: #fff;box-sizing:border-box}",".theme-1 {background: #fff;box-shadow: 0 0 0 1px #bbb;}",".theme-2 {background: #19212e;}",".theme-3 {background: #00a5e0;}",".theme-4 {background: #ff9232;}",".theme-5 {background: #ee685d;}",".theme-6 {background: #33cc99;}",".qr-code, .info, .title {{dib}}",".img-avatar {display: none;}",".qr-code {padding: 13px;background: #fff; position:relative; width:164px;height:138px}",".qr-code-img {width: 112px;height:112px }",".theme-1 .qr-code {padding: 0; width: "+getSize(230)+"px; height: "+getSize(230)+"px;}",".theme-1 .qr-code-img {width: "+getSize(230)+"px;height: "+getSize(230)+"px;}",".avatar-in-qr-code {width: 37.82px; "+"height: 37.82px;"+"position:absolute;top: 38.59px;left: 38.59px;"+"}",".info {position: absolute;left: "+getSize(270)+"px;top: "+getSize(63)+"px;}",".avatar img {border-radius: 50%;width: "+getSize(80)+"px;height: "+getSize(80)+"px;vertical-align: middle;}",".title {font-size: "+getSize(36)+"px;vertical-align: middle;margin-left: "+getSize(0)+"px;color: #fff;{ell}}",".signature {line-height: 1.6em;font-size: "+getSize(26)+"px;max-width: 93%;margin-top: "+getSize(16)+"px;color: #fff;{wordBreak}}",".theme-1 .signature {color: #999;}",".theme-1 .title {color: #000;}"].join("")},20:{width:100,height:100,accurateSize:1,defaultPosition:POSITION[7],tpl:["<a class=\"wpa-container {theme}\" data-event=\"openImUrl\" name=\""+defaultEventTagName+"\">","<img class=\"avatar\" src=\""+imageBaseUrl+"/wechat_hasborder.png\" />","</a>"].join(""),cssText:["* {{common}background: transparent;}",".wpa-container {z-index:1;display:block;cursor:pointer;position: relative;}",".avatar {width: 50px;height: 50px;}"].join("")}}}},get:function get(cate,type){return tmpls[cate][type]},defaultEventTagName:defaultEventTagName}});LBF.define("wpa.util.domEvent",function(require,exports){exports.addEvent=window.addEventListener?function(node,type,event){node.addEventListener(type,event);return node}:function(node,type,event){node.attachEvent("on"+type,event);return node};exports.removeEvent=window.removeEventListener?function(node,type,event){node.removeEventListener(type,event);return node}:function(node,type,event){node.detachEvent("on"+type,event);return node}});LBF.define("wpa.conf.defaultConst",function(require,exports,module){var config=require("wpa.conf.config");module.exports={THEME:1,TITLE:["","\u5728\u7EBF\u54A8\u8BE2","\u514D\u8D39\u7535\u8BDD","\u5173\u6CE8","\u52A0\u7FA4","\u597D\u53CB","","\u7F51\u9875\u54A8\u8BE2"],SIGNATURE:["","\u5728\u7EBF\u54A8\u8BE2","\u514D\u8D39\u7535\u8BDD","\u5173\u6CE8","\u52A0\u7FA4","\u597D\u53CB","","\u7F51\u9875\u54A8\u8BE2"],BTN_TEXT:["","\u5728\u7EBF\u54A8\u8BE2","\u514D\u8D39\u7535\u8BDD","\u5173\u6CE8","QQ\u7FA4","\u597D\u53CB","","\u7F51\u9875\u54A8\u8BE2"],BTN_COLOR:"#12b7f5",POSITION:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},defaultEventTagName:"e"}});LBF.define("wpa.util.getSize",function(require,exports,module){module.exports=exports=function exports(ratio){return function(size){if(typeof size!=="number"){return size}var r=Math.ceil(size/2);return r}}});LBF.define("wpa.util.bindLogicEvents",function(require,exports,module){var Events=require("wpa.conf.Events"),proxy=require("lang.proxy"),domEvent=require("wpa.util.domEvent");module.exports=function(eventNodes,context){if(!eventNodes.length){return}for(var i=0,len=eventNodes.length;i<len;i++){var eventNode=eventNodes[i];var dataEventAttr=eventNode.attributes["data-event"].nodeValue;var dataEvent=dataEventAttr.split(";");var apiName=dataEvent[0];var type=dataEvent[1]||Events.defaultEventType;var api=proxy(context[apiName],context);if(api){domEvent.addEvent(eventNode,type,api)}}}});LBF.define("wpa.util.htReport",function(require,exports,module){var conf=require("wpa.conf.config"),BROWSER_ENV=conf.BROWSER_ENV,isIOS=BROWSER_ENV.isIOS,isAndroid=BROWSER_ENV.isAndroid;var flags={iconInit:31,customDOMInit:32,customImgInit:33},platform="pc";var flag1=21848,flag2=1,flag3=1,reportCgi="https://report.huatuo.qq.com/report.cgi";if(isIOS){platform="ios"}else if(isAndroid){platform="android"}module.exports=exports=function exports(sTime,flag){var eTime=+new Date,timeCost=eTime-sTime,r=new Image,params="flag1="+flag1+"&flag2="+flag2+"&flag3="+flag3+"&"+flag+"="+timeCost;r.src=reportCgi+"?platform="+platform+"&appid=20282&speedparams="+encodeURIComponent(params)}});LBF.define("lang.trim",function(require,exports,module){var trimReg=/(^[\s\xA0]+)|([\s\xA0]+$)/g;module.exports=String.prototype.trim?function(text){return String.prototype.trim.call(text||"")}:function(text){return(text||"").toString().replace(trimReg,"")}});LBF.define("wpa.conf.chat",function(require,exports,module){var globalSettings=require("globalSettings"),apiBase=globalSettings.apiBase;var env="";if(apiBase.indexOf("dev")!==-1){env="dev"}else if(apiBase.indexOf("oa")!==-1){env="oa"}var host="https://{env}admin.qidian.qq.com".replace("{env}",env);return{CHAT_TYPE_AUTO:1,CHAT_TYPE_ANONYMOUS:2,CHAT_TYPE_QQ:3,PC_QQ_SCHEMA_CGI:apiBase+"/wpaInfo/TS",WPL_B_QQ_COM_CONV:apiBase+"/wpaInfo/numberInfo",MQQWPA:"mqqwpa://im/chat",WPD_B_QQ_COM_INFO:"http://wpd.b.qq.com/page/info.php",WPD_B_QQ_COM_WEBCHAT:"http://wpd.b.qq.com/page/webchat.html",LINK_CHAT:apiBase.replace("https:","http:")+"/wpaCall/sslCall",LAUNCH_MOBILE_QQ:host+"/template/blue/wpa/link.html",LAUNCH_LINK:host+"/template/blue/wpa/link.html"}});LBF.define("wpa.util.offset",function(require,exports){var conf=require("wpa.conf.config"),win=conf.gWin,doc=win.document,isStandardMode=doc.compatMode==="CSS1Compat",docElem=doc.documentElement,body=doc.body;exports.getScrollTop=function(){return Math.max(docElem.scrollTop,body.scrollTop)};exports.getClientWidth=isStandardMode?function(){return docElem.clientWidth}:function(){return body.clientWidth};exports.getClientHeight=isStandardMode?function(){return docElem.clientHeight}:function(){return body.clientHeight};exports.getNewScrollTop=function(){var top=doc.documentElement.scrollTop||win.pageYOffset||doc.body.scrollTop;return top}});LBF.define("wpa.conf.report",function(require,exports,module){var reportBase=require("globalSettings").apiBase+"/wpaReport";module.exports={render:reportBase+"/track",click:reportBase+"/click"}});LBF.define("lang.JSON",function(){if((typeof JSON==="undefined"?"undefined":_typeof(JSON))!=="object"){JSON={}}(function(){"use strict";function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\"":"\\\"","\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?"\""+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+"\"":"\""+string+"\""}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&_typeof(value)==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(_typeof(value)){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&_typeof(rep)==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v;}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(_typeof(replacer)!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&_typeof(value)==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();return JSON});LBF.define("wpa.util.removeCustomProperty",function(require,exports,module){var props=["toJSONString"];var removeCustomProperty=function removeCustomProperty(obj){for(var i=0,len=props.length;i<len;i++){var p=props[i];obj[p]=null}};module.exports=exports=removeCustomProperty});LBF.define("wpa.util.formReport",function(require,exports,module){var form,fixedFormId="__post_form",fixedIframeName="__post_iframe",_formId,_iframeName,isIE=!!(window.ActiveXObject||window.msIsStaticHTML),cid=1,iframe,_formList=window._formList=[],_iframeList=window._iframeList=[];var cb=function cb(){setTimeout(function(){var form=_formList.shift(),iframe=_iframeList.shift();try{if(form){document.body.removeChild(form)}if(iframe){document.body.removeChild(iframe)}}catch(e){}},1000)};var preSend=function preSend(form,iframe,data){var inputEle,docFragment=document.createDocumentFragment();try{for(var i in data){inputEle=document.createElement("<input name=\""+i+"\"/>");inputEle.value=data[i];inputEle.type="hidden";docFragment.appendChild(inputEle)}}catch(e){for(var i in data){inputEle=document.createElement("input");inputEle.type="hidden";inputEle.name=i;inputEle.value=data[i];docFragment.appendChild(inputEle)}}form.appendChild(docFragment);form.submit();cb()};module.exports=exports=function exports(options){if(!options.action){return}_formId=fixedFormId+cid;_iframeName=fixedIframeName+cid;cid++;var cForm=document.getElementById(_formId),cIframe=document.getElementById(_iframeName);var action=options.action;var data=options.data||{};try{form=document.createElement("<form id=\""+_formId+"\" method=\"post\" action=\""+action+"\" target=\""+_iframeName+"\"></form>");iframe=document.createElement("<iframe name=\""+_iframeName+"\" id=\""+_iframeName+"\" src=\"javascript:false;\"></iframe>")}catch(e){form=document.createElement("form");form.id=_formId;form.method="post";form.action=action;form.target=_iframeName;iframe=document.createElement("iframe");iframe.name=_iframeName;iframe.id=_iframeName}iframe.style.cssText="width:1px;height:0;display:none;";document.body.appendChild(iframe);document.body.appendChild(form);_formList.push(form);_iframeList.push(iframe);preSend(form,iframe,data)}});LBF.define("wpa.proto.getCPType",function(require,exports,module){var CPTTP_NONE=0,CPTTP_CORPWPA=1,CPTTP_STAFFWPA=2,CPTTP_FREETEL=3,CPTTP_JOINGROUP=4,CPTTP_ADDFRIEND=5,CPTTP_WXMANUAL=6,CPTTP_CHAT=7,CPTTP_ADDATTENT=8,CPTTP_IM=9;module.exports=exports=function exports(params){var temp,result=CPTTP_NONE;if(typeof params._tptype!=="undefined"){return{tptype:params._tptype}}if(temp=params.roleQQ){result=temp.value?CPTTP_CORPWPA:CPTTP_STAFFWPA}else if(params.roleTEL){result=CPTTP_FREETEL}else if(params.roleKFEXT){result=CPTTP_ADDFRIEND}else if(params.roleGROUP){result=CPTTP_JOINGROUP}else if(params.rolePUB){result=CPTTP_ADDATTENT}else if(params.roleIM){result=CPTTP_IM}return{tptype:result}}});LBF.define("wpa.protocol.getQQVersion","globalSettings,lang.browser,util.events",function(require){var globalSettings=require("globalSettings"),browser=require("lang.browser"),events=require("wpa.util.domEvent");var version;return function(callback){if(typeof version!=="undefined"){callback(version);return}if(browser.msie){try{var xmlhttp=new ActiveXObject("TimwpDll.TimwpCheck");version=xmlhttp.GetHummerQQVersion()}catch(e){version=null}callback(version);return}if(browser.mozilla||browser.webkit){var body=document.getElementsByTagName("body")[0],iframe=document.createElement("iframe"),proxyPage=globalSettings.base+"/protocol/getQQVersion.html";iframe.style.display="none";events.addEvent(window,"message",function(event){if(/https?:\/\/combo\.b\.qq\.com/.test(event.origin)){return}version=event.data;callback(version);events.removeEvent(window,"message",arguments.callee);iframe.parentNode.removeChild(iframe)});iframe.src=proxyPage;body.insertBefore(iframe,body.firstChild);return}version=null;callback(version)}});LBF.define("wpa.proto.chatSelect",function(require,exports,module){var Style=require("wpa.util.Style"),domEvent=require("wpa.util.domEvent"),offset=require("wpa.util.offset"),browser=require("lang.browser"),css=require("wpa.util.css"),proxy=require("lang.proxy"),extend=require("lang.extend");var NODE_TYPE_ELEMENT=1;var doc=document,isQuirk=doc.compatMode==="BackCompat";noPosFix=browser.msie&&browser.majorVersion<7||isQuirk;var SETTINGS={container:doc.getElementsByTagName("body")[0],template:["<div class=\"WPA3-SELECT-PANEL\">","<div class=\"WPA3-SELECT-PANEL-TOP\">","<a id=\"WPA3-SELECT-PANEL-CLOSE\" href=\"javascript:;\" class=\"WPA3-SELECT-PANEL-CLOSE\"></a>","</div>","<div class=\"WPA3-SELECT-PANEL-MAIN\">","<p class=\"WPA3-SELECT-PANEL-GUIDE\">\u8BF7\u9009\u62E9\u53D1\u8D77\u804A\u5929\u7684\u65B9\u5F0F\uFF1A</p>","<div class=\"WPA3-SELECT-PANEL-SELECTS\">","<a id=\"WPA3-SELECT-PANEL-AIO-CHAT\" href=\"javascript:;\" class=\"WPA3-SELECT-PANEL-CHAT WPA3-SELECT-PANEL-AIO-CHAT\">","<span class=\"WPA3-SELECT-PANEL-QQ WPA3-SELECT-PANEL-QQ-AIO\"></span>","<span class=\"WPA3-SELECT-PANEL-LABEL\">QQ\u5E10\u53F7\u804A\u5929</span>","</a>","</div>","</div>","<div class=\"WPA3-SELECT-PANEL-BOTTOM\">","<a target=\"_blank\" href=\"http://im.qq.com\" class=\"WPA3-SELECT-PANEL-INSTALL\">\u5B89\u88C5QQ</a>","</div>","</div>"].join(""),cssText:[".WPA3-SELECT-PANEL { z-index:2147483647; width:463px; height:292px; margin:0; padding:0; border:1px solid #d4d4d4; background-color:#fff; border-radius:5px; box-shadow:0 0 15px #d4d4d4;}",".WPA3-SELECT-PANEL * { position:static; z-index:auto; top:auto; left:auto; right:auto; bottom:auto; width:auto; height:auto; max-height:auto; max-width:auto; min-height:0; min-width:0; margin:0; padding:0; border:0; clear:none; clip:auto; background:transparent; color:#333; cursor:auto; direction:ltr; filter:; float:none; font:normal normal normal 12px \"Helvetica Neue\", Arial, sans-serif; line-height:16px; letter-spacing:normal; list-style:none; marks:none; overflow:visible; page:auto; quotes:none; -o-set-link-source:none; size:auto; text-align:left; text-decoration:none; text-indent:0; text-overflow:clip; text-shadow:none; text-transform:none; vertical-align:baseline; visibility:visible; white-space:normal; word-spacing:normal; word-wrap:normal; -webkit-box-shadow:none; -moz-box-shadow:none; -ms-box-shadow:none; -o-box-shadow:none; box-shadow:none; -webkit-border-radius:0; -moz-border-radius:0; -ms-border-radius:0; -o-border-radius:0; border-radius:0; -webkit-opacity:1; -moz-opacity:1; -ms-opacity:1; -o-opacity:1; opacity:1; -webkit-outline:0; -moz-outline:0; -ms-outline:0; -o-outline:0; outline:0; -webkit-text-size-adjust:none; font-family:Microsoft YaHei,Simsun;}",".WPA3-SELECT-PANEL a { cursor:auto;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-TOP { height:25px;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-CLOSE { float:right; display:block; width:47px; height:25px; background:url(http://combo.b.qq.com/crm/wpa/release/3.3/wpa/views/SelectPanel-sprites.png) no-repeat;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-CLOSE:hover { background-position:0 -25px;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-MAIN { padding:23px 20px 45px;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-GUIDE { margin-bottom:42px; font-family:\"Microsoft Yahei\"; font-size:16px;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-SELECTS { width:246px; height:111px; margin:0 auto;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-CHAT { float:right; display:block; width:88px; height:111px; background:url(http://combo.b.qq.com/crm/wpa/release/3.3/wpa/views/SelectPanel-sprites.png) no-repeat 0 -80px;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-CHAT:hover { background-position:-88px -80px;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-AIO-CHAT { float:left;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-QQ { display:block; width:76px; height:76px; margin:6px; background:url(http://combo.b.qq.com/crm/wpa/release/3.3/wpa/views/SelectPanel-sprites.png) no-repeat -50px 0;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-QQ-ANONY { background-position:-130px 0;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-LABEL { display:block; padding-top:10px; color:#00a2e6; text-align:center;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-BOTTOM { padding:0 20px; text-align:right;}",".WPA3-SELECT-PANEL .WPA3-SELECT-PANEL-INSTALL { color:#8e8e8e;}"].join(""),modal:true};Style.add({name:"_WPA_SELECT_PANEL_STYLE",cssText:SETTINGS.cssText});var SelectPanel=function SelectPanel(opts){this.opts=extend({},SETTINGS,opts);this.render()};SelectPanel.prototype={render:function render(){var panel=this,opts=this.opts,body=this.container=opts.container;var frag=doc.createElement("div"),frame;frag.innerHTML=opts.template;this.el=frame=frag.firstChild;(function(){try{body.appendChild(frame)}catch(e){setTimeout(arguments.callee,1);return}domEvent.addEvent(doc.getElementById("WPA3-SELECT-PANEL-CLOSE"),"click",function(){panel.remove();opts.onClose&&opts.onClose()});domEvent.addEvent(doc.getElementById("WPA3-SELECT-PANEL-AIO-CHAT"),"click",function(){panel.remove();opts.onAIOChat&&opts.onAIOChat()});panel.renderModal();panel.setCenter()})()},show:function show(){css(this.el,"display","block");css(this.modal,"display","block")},remove:function remove(){this.el.parentNode.removeChild(this.el);this.modal.parentNode.removeChild(this.modal)},setCenter:function setCenter(){css(this.el,{position:"absolute",top:"50%",left:"50%"});var styles={position:"fixed",marginLeft:"-"+this.outerWidth()/2+"px",marginTop:"-"+this.outerHeight()/2+"px"};if(noPosFix){styles.position="absolute";styles.marginTop=0;var top=styles.top=(offset.getClientHeight()-this.outerHeight())/2;setInterval(proxy(this.el,function(){this.style.top=offset.getScrollTop()+top+"px"}),128)}css(this.el,styles)},renderModal:function renderModal(){var container=this.container,width=css(container,"width"),height=css(container,"height"),overflow=css(container,"overflow");var modalLayer=doc.createElement("div"),styles={position:"fixed",top:0,left:0,zIndex:2147483647,width:offset.getClientWidth()+"px",height:offset.getClientHeight()+"px",backgroundColor:"white",opacity:0.1,filter:"alpha(opacity=10)"};if(noPosFix){styles.position="absolute";setInterval(proxy(modalLayer,function(){this.style.top=offset.getScrollTop()+"px"}),128)}css(modalLayer,styles);container.insertBefore(modalLayer,this.el);this.modal=modalLayer;domEvent.addEvent(window,"resize",proxy(modalLayer,function(){css(this.el,{width:offset.getClientWidth()+"px",height:offset.getClientHeight()+"px"})}))},outerWidth:function outerWidth(){return this.el.offsetWidth},outerHeight:function outerHeight(){return this.el.offsetHeight}};module.exports=SelectPanel});LBF.define("util.report",function(){var logs={};return function(url){var now=+new Date,name="log_"+now,img=logs[name]=new Image;img.onload=img.onerror=function(){logs[name]=null};url+=(url.indexOf("?")>-1?"&":"?")+now;img.src=url;return arguments.callee}});LBF.define("wpa.util.parseQuerystring",function(require,exports,module){module.exports=exports=function exports(str){var r={};var strs=str.split("&");for(var i=0,len=strs.length;i<len;i++){var s=strs[i],k=s.split("=")[0],v=s.split("=")[1];r[k]=v}return r}});LBF.define("wpa.util.openMqqPage",function(require,exports,module){var browser=require("lang.browser"),conf=require("wpa.conf.config");var CGIS=conf.CGIS,TYPE_PC=0,TYPE_MOBILE=1,isMobile=conf.isMobile,ENV=conf.ENV,envMapping={development:"devadmin.",test:"oaadmin.",production:"admin."};var browserEnv=function(){var ua=navigator.userAgent.toLowerCase();var ua2=navigator.userAgent;var platform=function platform(os){var ver=(""+(new RegExp(os+"(\\d+((\\.|_)\\d+)*)").exec(ua)||[,0])[1]).replace(/_/g,".");return!!parseFloat(ver)};return{is_mqq:/(iPad|iPhone|iPod).*? (IPad)?QQ\/([\d\.]+)/.test(ua2)||/\bV1_AND_SQI?_([\d\.]+)(.*? QQ\/([\d\.]+))?/.test(ua2),is_ios:platform("os "),is_android:platform("android[/ ]"),is_pc:!platform("os ")&&!platform("android[/ ]")}}();function getUrlParam(name,url){var reg=new RegExp("(^|&|\\?|#)"+name+"=([^&]*?)(&|#|$)");url=url||location.href;return url;var tempHash=url.match(/#.*/)?url.match(/#.*/)[0]:"";url=url.replace(/#.*/,"");if(reg.test(tempHash)){return decodeURIComponent(tempHash.match(reg)[2])}else if(reg.test(url)){return decodeURIComponent(url.match(reg)[2])}else{return""}}function callQQ(url,options){var whiteListVerification=function whiteListVerification(url){var reg=/^http(s)?:\/\/([\w\-]+[\.])+qq\.com($|\/)/;return reg.test(url)};url=whiteListVerification(url)?url:"";var settings={env:options&&options.env||"unknown"};var jumpIframe=document.createElement("iframe");jumpIframe.style.cssText="display:none; width:0px; height:0px;";if(settings.env=="android"){url="mqqapi://forward/url?plg_auth=1&url_prefix="+btoa(url)}else if(settings.env=="ios"){url="mqqapi://forward/url?version=1&src_type=web&url_prefix="+btoa(url);setTimeout(function(){location.href=url},300);return}setTimeout(function(){jumpIframe.src=url;document.body.appendChild(jumpIframe)},500)}exports=module.exports=function(url){if(!browser.isMobile){return alert("\u4EC5\u9650\u79FB\u52A8\u7AEF\u547C\u8D77")}if(browserEnv.is_ios){callQQ(getUrlParam("url",url),{env:"ios"})}else if(browserEnv.is_android){callQQ(getUrlParam("url",url),{env:"android"})}}});LBF.define("util.serialize",function(require,exports,module){module.exports=function(obj,delimiterInside,delimiterBetween){var stack=[];delimiterInside=delimiterInside||"=";delimiterBetween=delimiterBetween||"&";for(var key in obj){if(obj.hasOwnProperty(key)){stack.push(key+delimiterInside+(obj[key]||""))}}return stack.join(delimiterBetween)}});LBF.define("wpa.util.launch",function(require,exports,module){var browser=require("lang.browser"),conf=require("wpa.conf.config"),chatConf=require("wpa.conf.chat"),serialize=require("util.serialize"),jsonp=require("util.jsonp"),showInstallQQ=require("wpa.util.showInstallQQ"),LAUNCH_LINK=chatConf.LAUNCH_LINK,LAUNCH_MOBILE_QQ=chatConf.LAUNCH_MOBILE_QQ,BROWSER_ENV=conf.BROWSER_ENV,isMobile=conf.isMobile,isSSL=conf.isSSL,isIOS=browser.isIOS,isAndroid=browser.isAndroid,isInMobileQQ=BROWSER_ENV.isInMobileQQ,isInWX=BROWSER_ENV.isInWX,DOWNLOAD_QQ_TIMEOUT=conf.DOWNLOAD_QQ_TIMEOUT,launchDelay=isMobile?500:0;var win=conf.gWin,doc=win.document,body=doc.body,ua=navigator.userAgent.toLowerCase(),cid=0;var iframeJump=function iframeJump(schema){var div=doc.createElement("div");div.style.visibility="hidden";div.style.width=0;div.style.height=0;div.innerHTML="<iframe id=\"_qd_schema_"+cid+"\" src=\""+schema+"\" scrolling=\"no\" width=\"0\" height=\"0\"></iframe>";cid++;setTimeout(function(){body.appendChild(div)},launchDelay)};module.exports=exports=function exports(protocol,options){options=options||{};var needMobileJump=typeof options.needMobileJump!=="undefined"?options.needMobileJump:true,checkCallQQStatus=typeof options.checkCallQQStatus!=="undefined"?options.checkCallQQStatus:false,serializedOpts=serialize(options),targetPage=options.targetPage,kfuin=options.kfuin,url=targetPage||LAUNCH_MOBILE_QQ;if(isMobile){if(isInMobileQQ){setTimeout(function(){win.location.href=protocol},launchDelay)}else if(needMobileJump){win.location.href=url+"?"+serializedOpts+"&protocol="+protocol}else{if(isIOS){setTimeout(function(){win.location.href=protocol},launchDelay)}else{iframeJump(protocol)}}var mobileTimeout,lastHidden;if(checkCallQQStatus){mobileTimeout=setTimeout(function(){showInstallQQ({kfuin:kfuin})},DOWNLOAD_QQ_TIMEOUT);doc.addEventListener("visibilitychange",function(){var docHidden=doc.hidden;if(docHidden===lastHidden)return;lastHidden=docHidden;if(docHidden){clearTimeout(mobileTimeout)}})}}else{if(isSSL&&!conf.BROWSER_ENV.isIE){win.location.href=protocol}else{iframeJump(protocol)}var rkey=options.rkey,pcInterval,pcTimeout;if(checkCallQQStatus&&rkey){pcInterval=setInterval(function(){var opts={kfuin:kfuin,rkey:rkey};jsonp(conf.CGIS.PC_CHECK_CALL_QQ_STATUS,opts,function(rs){if(rs&&rs.r==0){var data=rs.data||{},status=data.status;if(status){clearTimeout(pcTimeout);clearTimeout(pcInterval)}}})},500);pcTimeout=setTimeout(function(){clearInterval(pcInterval);showInstallQQ({kfuin:kfuin})},DOWNLOAD_QQ_TIMEOUT)}}}});LBF.define("wpa.proto.CustomParams",function(require,exports,module){var conf=require("wpa.conf.config"),extend=require("lang.extend"),gWin=conf.gWin,forEach=require("lang.forEach");exports.setCustomParams=function(obj){var r=this.getCustomParams();var customExtraParams=gWin[conf.customExtraParams],customExtraParamsObj={},objKey=obj.key||obj.wpaKey,objKfuin=obj.kfuin;if(!isArray(customExtraParams)){customExtraParams=[]}forEach(customExtraParams,function(params){if(isObject(params)){if(objKfuin==params.kfuin&&objKey==params.key){extend(customExtraParamsObj,params.data||{})}}});extend(customExtraParamsObj,obj);extend(obj,customExtraParamsObj,r)};exports.getCustomParams=function(){var r={};if(typeof gWin.qidian_track_id!=="undefined"){r.qidian_track_id=gWin.qidian_track_id}if(typeof gWin.qidian_src_desc!=="undefined"){r.qidian_src_desc=gWin.qidian_src_desc}if(typeof gWin.qidian_ex1!=="undefined"){r.qidian_ex1=gWin.qidian_ex1}if(typeof gWin.qidian_ex2!=="undefined"){r.qidian_ex2=gWin.qidian_ex2}if(typeof gWin.qidian_ex3!=="undefined"){r.qidian_ex3=gWin.qidian_ex3}if(typeof gWin.qidian_ex4!=="undefined"){r.qidian_ex4=gWin.qidian_ex4}if(typeof gWin.qidian_ex5!=="undefined"){r.qidian_ex5=gWin.qidian_ex5}if(typeof gWin.guestId!=="undefined"){r.guestId=gWin.guestId}if(typeof gWin.wpaShowItemId!=="undefined"){r.wpaShowItemId=gWin.wpaShowItemId}if(typeof gWin.qidian_ex6!=="undefined"){r.qidian_ex6=gWin.qidian_ex6}if(typeof gWin.qidian_ex7!=="undefined"){r.qidian_ex7=gWin.qidian_ex7}if(typeof gWin.DisplayinAIO!=="undefined"){r.DisplayinAIO=gWin.DisplayinAIO}return r}});LBF.define("wpa.im.lang",function(require,exports,module){var inArray=require("lang.inArray"),i18n=require("wpa.im.i18n"),conf=require("wpa.conf.config"),CustomParams=require("wpa.proto.CustomParams"),gWin=conf.gWin,DEFAULT_LANG=conf.IM_LANG.defaultLang,AVAILABLE_LIST=conf.IM_LANG.availableList;var currLang=DEFAULT_LANG;exports.setLang=function(lang){if(inArray(lang,AVAILABLE_LIST)!==-1){currLang=lang}};exports.getLang=function(){return currLang};exports.getText=function(key){var lang=this.getLang();return i18n[lang][key]}});LBF.define("wpa.util.platformAuthorization",function(require,exports,module){module.exports=exports=function exports(params){if(document.querySelector("#"+params.id)==null){var newIframe=document.createElement("iframe");newIframe.src=params.src;newIframe.setAttribute("id",params.id);newIframe.style.cssText="position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: 999; border: none";document.body.insertBefore(newIframe,document.body.firstChild);if(!window[params.id+"BindMessage"]){window.addEventListener("message",function(e){if(e.data&&e.data.id===params.id){if(e.data.cmd==="close"){newIframe.parentNode.removeChild(newIframe);window[params.id+"BindMessage"]=false}}});window[params.id+"BindMessage"]=true}return true}return false}});LBF.define("wpa.util.getAuthorizationPageUrl",function(require,exports,module){module.exports=exports=function exports(params){var QIDIAN_WPA_CUSTOMER=window.QIDIAN_WPA_CUSTOMER||{};var data=params||{};if(QIDIAN_WPA_CUSTOMER.auth!=1){return""}var authQueryString="";var pageHost=window.location.host;var authPath="https://admin.qidian.qq.com/hb/view/pc/wpa_authorization";if(pageHost.indexOf("local.qiye.qq.com")>-1||pageHost.indexOf("localhost")>-1){authPath="https://local.qiye.qq.com:8001/page/wpa-authorization/pc/index.html"}else if(pageHost.indexOf("oaadmin.qidian.qq.com")>-1||pageHost.indexOf("shpqc.dsnq.qq.com")>-1){authPath="https://oaadmin.qidian.qq.com/hb/view/pc/wpa_authorization"}authQueryString="auth_pid="+(QIDIAN_WPA_CUSTOMER.auth_pid||"")+"&auth_paccount="+(QIDIAN_WPA_CUSTOMER.auth_paccount||"")+"&auth_mode="+(QIDIAN_WPA_CUSTOMER.auth_mode||0)+"&from="+(data.from||"wpa");return authPath+"?"+authQueryString}});LBF.define("util.xssFilter",function(){return{htmlEncode:function htmlEncode(str){return(str+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/ /g,"&nbsp;").replace(/=/g,"&#61;").replace(/`/g,"&#96;")},uriComponentEncode:function uriComponentEncode(str){str=encodeURIComponent(str+"");return str.replace(/~/g,"%7E").replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/'/g,"%27").replace(/\?/g,"%3F").replace(/;/g,"%3B")},isValidURL:function isValidURL(sUrl){return!!(/^(https?:\/\/)?[\w\-.]+\.(qq|tencent)\.com($|\/|\\)/i.test(sUrl)||/^(mqq|mqqwpa|tencent):\/\/[\w][\w/.\-_%]+($|\/|\\)/i.test(sUrl)||/^[\w][\w/.\-_%]+$/i.test(sUrl)||/^[/\\][^/\\]/i.test(sUrl))},cssEncode:function cssEncode(str){return(str+"").replace(/\b/g,"\\08 ").replace(/\t/g,"\\09 ").replace(/\n/g,"\\0A ").replace(/\f/g,"\\0C ").replace(/\r/g,"\\0D ").replace(/'/g,"\\27 ").replace(/"/g,"\\22 ").replace(/\\/g,"\\5C ").replace(/&/g,"\\26 ").replace(/\//g,"\\2F ").replace(/</g,"\\3C ").replace(/>/g,"\\3E ").replace(/\u2028/g,"\\002028 ").replace(/\u2029/g,"\\002029 ")},cssColorValidate:function cssColorValidate(str){var CSS_HEX_COLOR_REGEX=/#[0-9a-fA-f]{3}([0-9a-fA-f]{3})?/,CSS_NAMED_COLOR_REGEX=/[a-zA-Z]{1,20}/;return CSS_HEX_COLOR_REGEX.test(sStr)&&CSS_NAMED_COLOR_REGEX.test(sStr)}}});LBF.define("wpa.invite.getInviteConf",function(require,exports,module){var jsonp=require("util.jsonp"),conf=require("wpa.conf.config"),host=conf.host,url=host+"/webim/Invitation/config";var testConf={"key":"fafeaewf123","autoInvited":{"active":1,"reception":{"type":1,"cuin":1232132},"repeat":{"active":true,"finterval":2,"frequency":1},"condition":{"stayPeriod":2,"deviceType":1}},"invitedStyle":{"kfuin":"","type":"1","title":"\u5BA2\u670D\u5728\u7EBF\uFF0C\u6B22\u8FCE\u54A8\u8BE2","content":"\u60A8\u597D\uFF0C\u5F53\u524D\u6709\u5BA2\u670D\u5728\u7EBF\uFF0C\u70B9\u51FB\u5373\u53EF\u54A8\u8BE2","btns":[{"type":"im","text":"\u7F51\u9875\u54A8\u8BE2"}],"theme":"1",avatar:"https://oa.gtimg.com/qidian/src/sites/srv/wpa/conf/wpa/avatar/1-1.png",xc:"http://www.shiseido.co.jp/cms/products/sg/ei/img/BRND_WD_BNR_4W.jpg"}},defaultInviteStyle={"type":"1","title":"\u5BA2\u670D\u5728\u7EBF\uFF0C\u6B22\u8FCE\u54A8\u8BE2","content":"\u60A8\u597D\uFF0C\u5F53\u524D\u6709\u5BA2\u670D\u5728\u7EBF\uFF0C\u70B9\u51FB\u5373\u53EF\u54A8\u8BE2","btns":[{"type":"im","text":"\u7F51\u9875\u54A8\u8BE2"}],"theme":"1"};module.exports=exports=function exports(opts,cb){var self=this;var conf2={"kfuin":2852199000,"key":"fafeaewf123","autoInvited":{"active":1,"reception":{"type":1,"cuin":1232132},"repeat":{"active":true,"finterval":2,"frequency":1},"condition":{"stayPeriod":2,"deviceType":1}},"invitedStyle":{"type":"1","title":"\u5BA2\u670D\u5728\u7EBF\uFF0C\u6B22\u8FCE\u54A8\u8BE2","content":"\u60A8\u597D\uFF0C\u5F53\u524D\u6709\u5BA2\u670D\u5728\u7EBF\uFF0C\u70B9\u51FB\u5373\u53EF\u54A8\u8BE2","btns":[{"type":"im","text":"\u7F51\u9875\u54A8\u8BE2"}],"theme":"1",avatar:"https://oa.gtimg.com/qidian/src/sites/srv/wpa/conf/wpa/avatar/1-1.png",xc:"http://www.shiseido.co.jp/cms/products/sg/ei/img/BRND_WD_BNR_4W.jpg"}};cb(conf2)}});LBF.define("wpa.invite.tpl",function(require,exports,module){var config=require("wpa.conf.config"),imageBaseUrl=config.imageBaseUrl,log=require("wpa.util.log"),browser=require("lang.browser"),isMobile=browser.isAndroid||browser.isIOS,xssFilter=require("util.xssFilter"),replaceImg3X=require("wpa.util.replaceImg3X");var COLORS={1:"#0067ed",2:"#12b7f5",3:"#ff9232",4:"#ee685d",5:"#25cd98"};var commonCss={mobile:{iframe:["position:fixed","z-index: 2000001000","top: 0","left: 0"].join(";")+";",innerBody:["* {margin: 0;padding: 0;font-family: \"PingFang SC\", \"Droid Sans Fallback\", \"microsoft yahei\";background: transparent;}"].join(""),shadow:["box-shadow: 0 0 15px 1px rgba(0,0,0,.15);"].join(""),holder1:[".wpa-invite-holder {position: relative;height: 155px;width: 100%;}"].join(""),holder2:[".wpa-invite-holder {position: relative;height: 180px;width: 100%;}"].join("")},pc:{iframe:["position:fixed","z-index: 2000001000","top: 25%","left: 50%","box-shadow: 0 0 15px 1px rgba(0,0,0,.15)"].join(";")+";",innerBody:["* {margin: 0;padding: 0;font-family: \"microsoft yahei\";}"].join("")}};commonCss=isMobile?commonCss.mobile:commonCss.pc;commonCss.themeColors=COLORS;var btnTypes=exports.btnTypes={qq:"qq",phone:"phone",im:"im"};var btnIconNames={qq:"icon-qq",phone:"icon-phone",im:"icon-im"};var defaultConf={title:"\u5BA2\u670D\u5728\u7EBF\uFF0C\u6B22\u8FCE\u54A8\u8BE2",content:"\u60A8\u597D\uFF0C\u5F53\u524D\u6709\u5BA2\u670D\u5728\u7EBF\uFF0C\u70B9\u51FB\u5373\u53EF\u54A8\u8BE2",theme:1,btns:{qq:{type:btnTypes.qq,text:"QQ\u4EA4\u8C08"},phone:{type:btnTypes.phone,text:"\u514D\u8D39\u7535\u8BDD"},im:{type:btnTypes.im,text:"\u7ACB\u5373\u54A8\u8BE2"}}};var closeTpl={mobile:{tpl:["<a href=\"javascript:void(0);\" id=\"invite_close\" data-event=\"close\" class=\"icon-close\">","<img src=\""+imageBaseUrl+"/invite/icon-close-2x.png\" />","</a>"].join(""),css:[".icon-close {position: fixed;top: 6px;right: 35px;}",".icon-close img {width: 27px;height: 27px;}"].join("")},pc:{tpl:["<a href=\"javascript:void(0);\" id=\"invite_close\" class=\"icon-close\">","<img src=\""+imageBaseUrl+"/invite/icon-close-2x.png\" />","</a>"].join(""),css:[".icon-close {position: absolute;right: -2px;top: -2px;z-index: 1000;}"].join("")}};closeTpl=isMobile?closeTpl.mobile:closeTpl.pc;var defaultAvatar=imageBaseUrl+"/default-avatar.png";__WPAV2.replaceErrAvatar=function(img){img.src=defaultAvatar;img.onerror=null};var tpls={mobile:{1:{required:["title","content","btn1","btn2","theme"],width:"100%",height:155,tpl:["<div class=\"wpa-invite-holder\">","<div class=\"wpa-invite {theme}\">","<div class=\"main\">","<p class=\"title\">{title}</p>","<p class=\"content\">{content}</p>","</div>","<div class=\"btns {is-multi-btn}\">","<div class=\"btn\" id=\"btn1\" data-event=\"{btn1Event}\" data-corpuin=\"{btn1CorpUin}\">","<span class=\"btn-icon {btn1Icon}\"></span>","<span class=\"btn-text\">{btn1Text}</span>","</div>","<div class=\"btn\" id=\"btn2\" data-event=\"{btn2Event}\" data-corpuin=\"{btn2CorpUin}\">","<span class=\"btn-icon {btn2Icon}\"></span>","<span class=\"btn-text\">{btn2Text}</span>","</div>","</div>","</div>",closeTpl.tpl,"</div>"].join(""),css:[commonCss.innerBody,commonCss.holder1,".wpa-invite {background:#fff;height: 123px;border-radius: 3px;position:absolute;bottom:15px;left:48px;right:48px;"+commonCss.shadow+"}",".main {background: #fff url(\""+imageBaseUrl+"/invite/icon-bg-bubble.png\") no-repeat;background-size: 62px 53px;height: 85px;width: 100%;text-align: center;position: relative;border-top-left-radius:3px;}",".title {font-size: 18px;color: #1e2300;position: relative;top: 20px;}",".content {font-size: 12px;color: #777;position: relative;top: 23px;}",".btns {height: 40px;line-height: 40px;border-bottom-left-radius: 3px;border-bottom-right-radius: 3px;text-align: center;}",".theme-1 .btns {background: "+commonCss.themeColors[1]+";}",".theme-2 .btns {background: "+commonCss.themeColors[2]+";}",".theme-3 .btns {background: "+commonCss.themeColors[3]+";}",".theme-4 .btns {background: "+commonCss.themeColors[4]+";}",".theme-5 .btns {background: "+commonCss.themeColors[5]+";}",".btn {cursor: pointer;color: #fff;font-size: 15px;display: inline-block;}",".btn span {position:relative;top:-1px;}",".btn .btn-icon {top:-2px;}",".btn:last-child {display:none;}",".btn-text {display:inline-block;padding-left:3px;}",".multi-btn {display: flex;}",".multi-btn .btn {flex: 1;}",".multi-btn .btn:last-child {display:inline-block;border-left: 1px solid #fff;}",".btn:first-child {display:inline-block!important;}",".btn-icon {display: inline-block;width: 24px;height: 24px;vertical-align: middle;}",".icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-white.png\") no-repeat;background-size: 24px 24px;}",".icon-phone {background: url(\""+imageBaseUrl+"/invite/icon-phone-white.png\") no-repeat;background-size: 24px 24px;}",".icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-white.png\") no-repeat;background-size: 24px 24px;}",closeTpl.css].join("")},2:{required:["content","btn1","btn2","theme","avatar"],width:"100%",height:155,tpl:["<div class=\"wpa-invite-holder\">","<div class=\"wpa-invite {theme}\">","<div class=\"avatar\">","<img src=\"{avatar}\" onerror=\"javascript:parent.__WPAV2.replaceErrAvatar(this);\"/>","</div>","<div class=\"content\">{content}</div>","<div class=\"btns  {is-multi-btn}\">","<div class=\"btn\" id=\"btn1\" data-event=\"{btn1Event}\" data-corpuin=\"{btn1CorpUin}\">","<span class=\"btn-icon {btn1Icon}\"></span>","<span class=\"btn-text\">{btn1Text}</span>","</div>","<div class=\"btn\" id=\"btn2\" data-event=\"{btn2Event}\" data-corpuin=\"{btn2CorpUin}\">","<span class=\"btn-icon {btn2Icon}\"></span>","<span class=\"btn-text\">{btn2Text}</span>","</div>","</div>","</div>",closeTpl.tpl,"</div>"].join(""),css:[commonCss.innerBody,commonCss.holder1,".wpa-invite {background:#fff;position: absolute;left: 48px;right: 48px;bottom: 15px;height: 123px;border-radius: 3px;box-shadow: 0 0 15px 1px rgba(0,0,0,.15);}",".avatar {position: absolute;top: 20px;left: 15px;}",".avatar img {width: 50px;height: 50px;border-radius: 50%;}",".content {font-size: 16px;color: #1e2330;position: absolute;top: 20px;left: 80px;width: 210px;line-height: 24px;}",".btn {display: inline-block;margin-left: 20px;vertical-align: middle;}",".btn-icon {display: inline-block;width: 24px;height: 24px;vertical-align: middle;background-size: 24px 24px!important;position:relative;top:-1px;}",".btn-text {font-size: 15px;}",".btn:last-child {display:none;}",".btn:first-child {display:inline-block!important;}",".btns {position: absolute;bottom: 12px;right: 15px;}",".multi-btn .btn:last-child {display:inline-block;}",".btn-text {display:inline-block;padding-left:3px;}",".theme-1 .btn {color: "+commonCss.themeColors[1]+";}",".theme-2 .btn {color: "+commonCss.themeColors[2]+";}",".theme-3 .btn {color: "+commonCss.themeColors[3]+";}",".theme-4 .btn {color: "+commonCss.themeColors[4]+";}",".theme-5 .btn {color: "+commonCss.themeColors[5]+";}",".theme-1 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-theme1-2x.png\") no-repeat;}",".theme-2 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-theme2-2x.png\") no-repeat;}",".theme-3 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-theme3-2x.png\") no-repeat;}",".theme-4 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-theme4-2x.png\") no-repeat;}",".theme-5 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-theme5-2x.png\") no-repeat;}",".theme-1 .icon-phone {background: url(\""+imageBaseUrl+"/invite/icon-phone-theme1-2x.png\") no-repeat;}",".theme-2 .icon-phone {background: url(\""+imageBaseUrl+"/invite/icon-phone-theme2-2x.png\") no-repeat;}",".theme-3 .icon-phone {background: url(\""+imageBaseUrl+"/invite/icon-phone-theme3-2x.png\") no-repeat;}",".theme-4 .icon-phone {background: url(\""+imageBaseUrl+"/invite/icon-phone-theme4-2x.png\") no-repeat;}",".theme-5 .icon-phone {background: url(\""+imageBaseUrl+"/invite/icon-phone-theme5-2x.png\") no-repeat;}",".theme-1 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-theme1-2x.png\") no-repeat;}",".theme-2 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-theme2-2x.png\") no-repeat;}",".theme-3 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-theme3-2x.png\") no-repeat;}",".theme-4 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-theme4-2x.png\") no-repeat;}",".theme-5 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-theme5-2x.png\") no-repeat;}",closeTpl.css].join("")},3:{required:["xc","btn1","btn2","theme"],width:"100%",height:180,tpl:["<div class=\"wpa-invite-holder\">","<div class=\"wpa-invite {theme}\">","<div class=\"xc\">","<img src=\"{xc}\" />","</div>","<div class=\"btns {is-multi-btn}\">","<div class=\"btn\" id=\"btn1\" data-event=\"{btn1Event}\" data-corpuin=\"{btn1CorpUin}\">","<span class=\"btn-icon {btn1Icon}\"></span>","<span class=\"btn-text\">{btn1Text}</span>","</div>","<div class=\"btn\" id=\"btn2\" data-event=\"{btn2Event}\" data-corpuin=\"{btn2CorpUin}\">","<span class=\"btn-icon {btn2Icon}\"></span>","<span class=\"btn-text\">{btn2Text}</span>","</div>","</div>","</div>",closeTpl.tpl,"</div>"].join(""),css:[commonCss.innerBody,commonCss.holder2,".wpa-invite {background:#fff;position: absolute;left: 48px;right: 48px;bottom: 15px;height: 148px;border-radius: 3px;"+commonCss.shadow+"}",".xc img {width: 100%;height: 95px;border-bottom:1px solid #ebedf2;}",".btns {text-align: center;position: absolute;bottom: 10px;left: 50%;transform: translateX(-50%);width: 100%;}",".btn {display: inline-block;width: 170px;height: 35px;line-height: 35px;border-radius: 3px;color: #fff;font-size: 15px;text-align: center;}",".btn:last-child {display:none;}",".multi-btn .btn {width: 120px;}",".multi-btn .btn:last-child {display:inline-block;margin-left: 15px;}",".btn:first-child {display:inline-block!important;}",".theme-1 .btn {background: "+commonCss.themeColors[1]+";}",".theme-2 .btn {background: "+commonCss.themeColors[2]+";}",".theme-3 .btn {background: "+commonCss.themeColors[3]+";}",".theme-4 .btn {background: "+commonCss.themeColors[4]+";}",".theme-5 .btn {background: "+commonCss.themeColors[5]+";}",".btn-text {display:inline-block;padding-left:3px;}",".btn-icon {display: inline-block;width: 24px;height: 24px;vertical-align: middle;}",".icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-white.png\") no-repeat;background-size: 24px 24px;}",".icon-phone {background: url(\""+imageBaseUrl+"/invite/icon-phone-white.png\") no-repeat;background-size: 24px 24px;}",".icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-white.png\") no-repeat;background-size: 24px 24px;}",closeTpl.css].join("")}},pc:{1:{required:["title","content","btn1","btn2","theme"],width:368,height:228,tpl:["<div class=\"wpa-invite {theme}\">","<a href=\"javascript:void(0);\" id=\"invite_close\" data-event=\"close\" class=\"icon-close\">","<img src=\""+imageBaseUrl+"/invite/close_white.png\" />","</a>","<div class=\"main\">","<div class=\"title\">{title}</div>","<div class=\"content\">{content}</div>","</div>","<div class=\"btns {is-multi-btn}\">","<div class=\"btn\" id=\"btn1\" data-event=\"{btn1Event}\" data-corpuin=\"{btn1CorpUin}\">","<span class=\"btn-icon {btn1Icon}\"></span>","<span class=\"btn-text\">{btn1Text}</span>","</div>","<span class=\"spliter\"></span>","<div class=\"btn\" id=\"btn2\" data-event=\"{btn2Event}\" data-corpuin=\"{btn2CorpUin}\">","<span class=\"btn-icon {btn2Icon}\"></span>","<span class=\"btn-text\">{btn2Text}</span>","</div>","</div>","</div>"].join(""),css:[commonCss.innerBody,".wpa-invite {width: 368px;height: 228px;background:#fff;border-radius: 4px;border: 1px solid #dadee7;font-family: \"microsoft yahei\";position: relative;}",closeTpl.css,".main {width: 370px;height: 176px;text-align: center;color: #fff;position: absolute;top: -1px;left: -1px;border-top-left-radius: 4px;border-top-right-radius: 4px;position: relative;overflow: hidden;background: url(\""+imageBaseUrl+"/invite/bubble.png\") no-repeat;background-position: right center;}",".theme-1 .main {background-color: #0067ed;}",".theme-2 .main {background-color: #12b7f5;}",".theme-3 .main {background-color: #ff9232;}",".theme-4 .main {background-color: #ee685d;}",".theme-5 .main {background-color: #25cd98;}",".title {font-size: 24px;margin-top: 50px;}",".content {font-size: 16px;margin-top: 10px;}",".btn-icon {margin-right:7px;vertical-align: middle;display: inline-block;width: 24px;height: 24px;}",".theme-1 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-pc1.png\") no-repeat;}",".theme-2 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-pc2.png\") no-repeat;}",".theme-3 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-pc3.png\") no-repeat;}",".theme-4 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-pc4.png\") no-repeat;}",".theme-5 .icon-qq {background: url(\""+imageBaseUrl+"/invite/icon-qq-pc5.png\") no-repeat;}",".theme-1 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-pc1.png\") no-repeat;}",".theme-2 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-pc2.png\") no-repeat;}",".theme-3 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-pc3.png\") no-repeat;}",".theme-4 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-pc4.png\") no-repeat;}",".theme-5 .icon-im {background: url(\""+imageBaseUrl+"/invite/icon-im-pc5.png\") no-repeat;}",".btns {text-align: center;}",".btn-text {vertical-align:middle;}",".btn {font-size: 16px;color: #1e2330;text-align: center;height: 54px;line-height: 48px;cursor: pointer;}",".btn:last-child {display: none;}",".btn:first-child {display: block;}",".spliter {display: none;width: 1px;height: 27px;vertical-align: middle;background: #dadee7;}",".multi-btn .btn {display: inline-block;width: 178px;}",".multi-btn .spliter {display: inline-block;}"].join("")},2:{required:["content","btn1","btn2","theme","avatar"],width:258,height:318,tpl:["<div class=\"wpa-invite {theme}\">","<a href=\"javascript:void(0);\" id=\"invite_close\" data-event=\"close\" class=\"icon-close\">","<img src=\""+imageBaseUrl+"/invite/close_black.png\" />","</a>","<img src=\"{avatar}\" class=\"avatar\" onerror=\"javascript:parent.__WPAV2.replaceErrAvatar(this);\"/>","<div class=\"main\">","<div class=\"title\">{title}</div>","<div class=\"content\">{content}</div>","</div>","<div class=\"btns {is-multi-btn}\">","<div class=\"btn\" id=\"btn1\" data-event=\"{btn1Event}\" data-corpuin=\"{btn1CorpUin}\">","<span class=\"btn-icon {btn1Icon}\"></span>","<span class=\"btn-text\">{btn1Text}</span>","</div><div class=\"btn\" id=\"btn2\" data-event=\"{btn2Event}\" data-corpuin=\"{btn2CorpUin}\">","<span class=\"btn-icon {btn2Icon}\"></span>","<span class=\"btn-text\">{btn2Text}</span>","</div>","</div>","</div>"].join(""),css:[commonCss.innerBody,".wpa-invite {width: 258px;height: 318px;border-radius: 4px;position: relative;text-align: center;background: #fff;}",".icon-close {position: absolute;right: -2px;top: -2px;z-index: 10;}",closeTpl.css,".avatar {margin:0 auto;width: 120px;height: 120px;border-radius: 50%;position: absolute;top: 30px;left:70px;}",".main {position: relative;top: 166px;}",".title {font-size: 24px;color: #1e2330;}",".content {font-size: 16px;color: #777;margin-top: 6px;}",".btns {position: absolute;left: 0;bottom: 0;width: 100%;height: 54px;line-height: 54px;color: #fff;}",".icon-im {margin-top:-1px;display: inline-block;width: 24px;height: 24px;background: url(\""+imageBaseUrl+"/invite/im-bubble-pc-white.png\") no-repeat;}",".icon-qq {margin-top:-1px;display: inline-block;width: 24px;height: 24px;background: url(\""+imageBaseUrl+"/invite/icon-qq-white-small.png\") no-repeat;}",".btn-icon {margin-right: 7px;vertical-align: middle;}",".btn-text {vertical-align: top;display:inline-block;}",".btn {position:relative;font-size: 16px;cursor: pointer;border-bottom-left-radius: 4px;border-bottom-right-radius: 4px;height: 54px;}",".btn:last-child {display: none;}",".btn:first-child {display: block;}",".multi-btn .btn {display: inline-block;width: 128.5px;}",".multi-btn .btn:first-child {float: left;border-bottom-left-radius: 4px;border-bottom-right-radius: 0;}",".multi-btn .btn:last-child {float: right;border-bottom-left-radius: 0;border-bottom-right-radius: 4px;}",".theme-1 .btn {background: "+COLORS[1]+";}",".theme-2 .btn {background: "+COLORS[2]+";}",".theme-3 .btn {background: "+COLORS[3]+";}",".theme-4 .btn {background: "+COLORS[4]+";}",".theme-5 .btn {background: "+COLORS[5]+";}"].join("")},3:{required:["xc","btn1","btn2","theme"],width:368,height:292,tpl:["<div class=\"wpa-invite {theme}\">","<a href=\"javascript:void(0);\" id=\"invite_close\" data-event=\"close\" class=\"icon-close\">","<img src=\""+imageBaseUrl+"/invite/close_black.png\" />","</a>","<img src=\"{xc}\" class=\"xc\" />","<div class=\"btns {is-multi-btn}\">","<div class=\"btn\" id=\"btn1\" data-event=\"{btn1Event}\" data-corpuin=\"{btn1CorpUin}\">","<span class=\"btn-icon {btn1Icon}\"></span>","<span class=\"btn-text\">{btn1Text}</span>","</div><div class=\"btn\" id=\"btn2\" data-event=\"{btn2Event}\" data-corpuin=\"{btn2CorpUin}\">","<span class=\"btn-icon {btn2Icon}\"></span>","<span class=\"btn-text\">{btn2Text}</span>","</div>","</div>","</div>"].join(""),css:[commonCss.innerBody,".wpa-invite {width: 368px;height: 292px;border-radius: 4px;border: 1px solid #dadee7;position: relative;background: #fff;}",closeTpl.css,".xc {border-bottom:1px solid #ebedf2;width: 370px;height: 210px;position: relative;left: -1px;top: -1px;}",".btn {width:330px;}",".btn:last-child {display: none;}",".btn:first-child {display: inline-block;}",".multi-btn .btn {display: inline-block;*display:inline;*zoom:1;width: 155px;}",".multi-btn .btn:first-child {margin-right: 10px;}",".icon-im {display: inline-block;width: 24px;height: 24px;background: url(\""+imageBaseUrl+"/invite/im-bubble-pc-white.png\") no-repeat;}",".icon-qq {display: inline-block;width: 24px;height: 24px;background: url(\""+imageBaseUrl+"/invite/icon-qq-white-small.png\") no-repeat;}",".btns {text-align: center;height: 84px;line-height: 84px;position: relative;left: 0;top: -5px;}",".btn {cursor:pointer;display:inline-block;*display:inline;*zoom:1;height:44px;line-height: 44px;font-size: 16px;color: #fff;text-align: center;border-radius: 4px;}",".btn-icon, .btn-text {vertical-align: middle;}",".btn-text {display:inline-block;margin-top:-3px;vertical-align: middle;}",".btn-icon {margin-right: 7px;margin-top:-1px;}",".theme-1 .btn {background: "+COLORS[1]+";}",".theme-2 .btn {background: "+COLORS[2]+";}",".theme-3 .btn {background: "+COLORS[3]+";}",".theme-4 .btn {background: "+COLORS[4]+";}",".theme-5 .btn {background: "+COLORS[5]+";}"].join("")}}};var getBtn=function getBtn(){};var compileTpl=function compileTpl(targetTpl,conf){var required=targetTpl.required,css=targetTpl.css,tpl=targetTpl.tpl,btns=conf.btns,avatar=conf.avatar,title=conf.title||defaultConf.title,content=conf.content||defaultConf.content,xc=conf.xc,theme="theme-"+(conf.theme||defaultConf.theme),isMultiBtn=btns.length>1?true:false,isMultiBtnClass=isMultiBtn?"multi-btn":"",btn1=btns[0],btn1Type=btn1.type,btn1Text=btn1.text||defaultConf.btns[btn1Type].text,btn1Icon=btnIconNames[btn1Type],btn1CorpUin=btn1.isCorpUin?parseInt(btn1.isCorpUin,10):0,btn2=btns[1]||{},btn2Type=btn2.type,btn2Text=btn2.text,btn2Icon=btnIconNames[btn2Type],btn2CorpUin=btn2.isCorpUin?parseInt(btn2.isCorpUin,10):0,r;r=tpl.replace("{title}",xssFilter.htmlEncode(title)).replace("{content}",xssFilter.htmlEncode(content)).replace("{theme}",xssFilter.htmlEncode(theme)).replace("{avatar}",xssFilter.htmlEncode(avatar)).replace("{xc}",xssFilter.htmlEncode(xc)).replace("{is-multi-btn}",isMultiBtnClass).replace("{btn1Text}",xssFilter.htmlEncode(btn1Text)).replace("{btn2Text}",xssFilter.htmlEncode(btn2Text)).replace("{btn1Icon}",btn1Icon).replace("{btn2Icon}",btn2Icon).replace("{btn1Event}",btn1Type).replace("{btn2Event}",btn2Type).replace("{btn1CorpUin}",btn1CorpUin).replace("{btn2CorpUin}",btn2CorpUin);return{css:css,tpl:r,height:targetTpl.height,width:targetTpl.width}};exports.getTpl=function(conf){var type=conf.type,targetTpl=isMobile?tpls.mobile[type]:tpls.pc[type],actualTpl=compileTpl(targetTpl,conf);return actualTpl};exports.getIframeStyle=function(tpl,conf){var style=commonCss.iframe,width=tpl.width,height=tpl.height;if(!isMobile){var ml=width/2;style=style+"margin-left:-"+ml+"px"}return{style:style,width:width,height:height}}});LBF.define("wpa.im.imMessageSender",function(require,exports,module){var imInit=require("wpa.im.init");var conf=require("wpa.conf.config"),WEB_IM_IFRAME_ID=conf.WEB_IM.WEB_IM_IFRAME_ID;exports.sendMsg=function(kfuin,sendMsg){var imIframeId=WEB_IM_IFRAME_ID+kfuin;if(imInit.isImIframeReady(kfuin)){sendMsg=JSON.stringify(sendMsg);var targetPCImIframe=document.getElementById(imIframeId);targetPCImIframe.contentWindow.postMessage(sendMsg,"*")}else{imInit.cacheImMsg(kfuin,sendMsg)}}});LBF.define("wpa.util.getOffset",function(require,exports,module){module.exports=exports=function exports(dom,options){if(!dom){return}options=options||{};var parent=dom.offsetParent,x=dom.offsetLeft,y=dom.offsetTop;if(options.isAbsolute){while(parent){x+=parent.offsetLeft;y+=parent.offsetTop;parent=parent.offsetParent}}return{offsetParent:parent,x:x,y:y}}});LBF.define("wpa.proto.mobileUnreadBar",function(require,exports,module){var browser=require("lang.browser"),getOffset=require("wpa.util.getOffset"),conf=require("wpa.conf.config"),KFUINS=conf.KFUINS,isMobile=conf.isMobile,isIOS=conf.BROWSER_ENV.isIOS,isFengLing=conf.isFengLing,win=conf.gWin,WEB_IM_CATE=conf.TYPES.IM,WPAS_IM_TYPE=conf.WEB_IM.WPAS_IM_TYPE,Style=require("wpa.util.Style"),extend=require("lang.extend"),log=require("wpa.util.log"),wpaType=require("wpa.conf.wpaType"),domEvent=require("wpa.util.domEvent"),proxy=require("lang.proxy"),onIframeLoaded=require("wpa.util.onIframeLoaded"),lang=require("wpa.im.lang");var BAR_CLASS_NAME="qidian_wpa_unread_msg_bar",WPA_ID_PREFIX=conf.WPA_ID_PREFIX,WPA=win.__WPAV2,WIDTH=120,HEIGHT=35,actualPosition="fixed",CIRCLE_ID_PREFIX="qidian_wpa_id_unread_msg_bar_",total=0,barsGap=45,initBottomStyle=80;var doc=win.document,body=doc.body;var barTpl=["<div id=\"unreadBar\">","<span id=\"unreadNum\">9+</span>\u6761\u65B0\u6D88\u606F","</div>"].join("");var gapObj={};var CIRCLE_INNER_CSS_TEXT=["* {margin:0;padding:0;}","#unreadBar {font-family:\"PingFang SC\", \"Droid Sans Fallback\";background:#4fbcfb;color:#fff;font-size:14px;width:120px;text-align:center;height:35px;line-height:35px;border-top-left-radius:50px;border-bottom-left-radius:50px;}"].join("");var barIframeStyle=["position:fixed","right:0"].join(";")+";";exports.drawBar=function(options){var kfuin=options.kfuin;var actualNumber=typeof options.number!=="undefined"?options.number:0,number=actualNumber;var unreadMsgId=CIRCLE_ID_PREFIX+kfuin;if(typeof gapObj[kfuin]==="undefined"){gapObj[kfuin]=total++}if(document.getElementById(unreadMsgId)){return updateUnreadMsgBar(options)}var cssBottom=initBottomStyle+gapObj[kfuin]*barsGap;var style=barIframeStyle+"bottom:"+cssBottom+"px;";var strIframe="<iframe scrolling=\"no\" class=\""+BAR_CLASS_NAME+"\" id=\""+unreadMsgId+"\" frameborder=\"0\" width=\""+WIDTH+"\" height=\""+HEIGHT+"\" allowtransparency=\"true\" src=\"about:blank\" style=\"{style}\"></iframe>";strIframe=strIframe.replace("{style}",style);var iframe;try{iframe=doc.createElement(strIframe)}catch(e){iframe=doc.createElement("iframe");iframe.width=WIDTH;iframe.height=HEIGHT;iframe.id=unreadMsgId;iframe.style.cssText=style;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src","about:blank");iframe.setAttribute("class",BAR_CLASS_NAME)}body.appendChild(iframe);setTimeout(function(){if(browser.msie){try{var accessTest=iframe.contentWindow.document}catch(e){iframe.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close()})())"}}var loaded=function loaded(){var iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document;iDoc.open();iDoc.write(["<!doctype html>","<html xmlns=\"http://www.w3.org/1999/xhtml\">","<head>","<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />",browser.msie&&iframe.src!=="about:blank"?"<script>document.domain='"+document.domain+"';</script>":"","<style>"+CIRCLE_INNER_CSS_TEXT+"</style>","</head>","<body>","<div id=\"unreadBar\">","<span id=\"number\" data-number=\""+actualNumber+"\">"+number+"</span>"+lang.getText("common_new_message"),"</div>","</body>","</html>"].join(""));iDoc.close();if(isFengLing&&(browser.isIOS||browser.isAndroid)){try{iDoc.body.addEventListener("touchmove",function(event){event.preventDefault()},false)}catch(e){}}var api=function api(){var unreadNum=win.__WPAV2[KFUINS][kfuin].unread,onlyOpen=win.__WPAV2[KFUINS][kfuin].onlyOpen;if(typeof onlyOpen!=="undefined"&&!onlyOpen){var param=extend(win.__WPAV2[KFUINS][kfuin].onlyOpenParam||{},{kfuin:kfuin,openUnread:true});return WPA.IM.openChatIframe(param)}onlyOpen=false;if(unreadNum){var socketNum=unreadNum.socket,unreadNum=unreadNum.chat;if(unreadNum>0&&socketNum==0){onlyOpen=true}}WPA.IM.openChatIframe({kfuin:kfuin,onlyOpen:onlyOpen})};domEvent.addEvent(iDoc.getElementById("unreadBar"),"click",api)};onIframeLoaded(iframe,loaded)},100)};function updateUnreadMsgBar(options){log("[mobileUnreadBar][updateUnreadMsgBar]");var kfuin=options.kfuin,number=options.number,id=CIRCLE_ID_PREFIX+kfuin,iframe=document.getElementById(id),iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document,domNumber=iDoc.getElementById("number");domNumber.innerHTML=getDisplayNumber(number);domNumber.setAttribute("data-number",number)};function getDisplayNumber(number){return number>9?"9+":number}function removeUnreadMsgBar(kfuin){var iframe=document.getElementById(CIRCLE_ID_PREFIX+kfuin);if(iframe){iframe.parentNode.removeChild(iframe)}}exports.removeUnreadMsgBar=removeUnreadMsgBar});LBF.define("wpa.util.dialog",function(require,exports,module){var conf=require("wpa.conf.config"),tpl=require("wpa.invite.tpl"),Style=require("wpa.util.Style"),domEvent=require("wpa.util.domEvent"),browser=require("lang.browser"),onIframeLoaded=require("wpa.util.onIframeLoaded"),extend=require("lang.extend");var win=conf.gWin,doc=win.document,body=doc.body,INVITE_IFRAME_ID_PREFIX=conf.INVITE_IFRAME_ID_PREFIX,isMobile=browser.isAndroid||browser.isIOS;var defaultConf={text:"",confirmText:"\u786E\u5B9A",cancelText:"\u53D6\u6D88",confirmCallback:function confirmCallback(){},cancelCallback:function cancelCallback(){},extCss:"",width:240,height:120};exports.confirm=function(config){config=extend(defaultConf,config);var btnConfirm="<span class=\"btn btn-yes\" id=\"btnYes\">"+config.confirmText+"</span>";var btnCancel="<span class=\"btn btn-no\" id=\"btnNo\">"+config.cancelText+"</span>";var css=[];css.push("html{height: 100%}","body{padding: 0; margin: 0; height: 100%;}",".confirm{width: 100%; height: 100%; border-radius: 3px; font-size: 14px; color: #000; background:#fff; box-shadow: rgb(0 0 0 / 15%) 0px 0px 15px 1px;}",".confirm .text{padding: 16px; line-height: 1.5; min-height: 44px}",".confirm .btn-wrap{ text-align: right; padding: 0 16px 16px 16px; }",".confirm .btn-wrap .btn{ cursor:pointer; display: inline-block; padding:0 8px; height: 26px; line-height: 26px; text-align: center; font-size: 13px; font-weight: 500; color: #262D3D; border: 1px solid #E1E6F0; border-radius: 3px; }",".confirm .btn-wrap .btn:first-child{margin-right: 8px;}",".confirm .btn-wrap .btn-yes{background: #4A70FF; color: #fff;}");config.css=css.join("")+config.extCss;var btns=[];btns.push(btnConfirm,btnCancel);var iframeBody="<div class=\"confirm\"><div class=\"text\">"+config.text+"</div><div class=\"btn-wrap\"> "+btns.join("")+" </div></div>";createIframe(iframeBody,config)};function createIframe(iframeBody,config){var css=config.css||"";var iframeStyle=tpl.getIframeStyle(config),iframeId=INVITE_IFRAME_ID_PREFIX+"_dialog_"+ +new Date,style=iframeStyle.style,width=iframeStyle.width,height=iframeStyle.height;var strIframe="<iframe scrolling=\"no\" id=\""+iframeId+"\" frameborder=\"0\" width=\""+width+"\" height=\""+height+"\" allowtransparency=\"true\" src=\"about:blank\" style=\"{style}\" ></iframe>";strIframe=strIframe.replace("{style}",style);var iframe;try{iframe=doc.createElement(strIframe)}catch(e){iframe=doc.createElement("iframe");iframe.width=width;iframe.height=height;iframe.id=iframeId;iframe.style.cssText=style;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src","about:blank");if(!isMobile){iframe.width=width}}body.appendChild(iframe);var loaded=function loaded(){var iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document;iDoc.open();iDoc.write(["<!doctype html>","<html xmlns=\"http://www.w3.org/1999/xhtml\">","<head>","<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />",browser.msie&&iframe.src!=="about:blank"?"<script>document.domain='"+document.domain+"';</script>":"","</head>","<body>",iframeBody,"</body>","</html>"].join(""));iDoc.close();var styleObj={name:"style",cssText:css,doc:iDoc};Style.commonAdd(styleObj);var btnYes=iDoc.getElementById("btnYes");var btnNo=iDoc.getElementById("btnNo");domEvent.addEvent(btnYes,"click",function(){typeof config.confirmCallback=="function"&&config.confirmCallback();closeIframe(iframe)});domEvent.addEvent(btnNo,"click",function(){typeof config.cancelCallback=="function"&&config.cancelCallback();closeIframe(iframe)});btnYes.add;return iframe};onIframeLoaded(iframe,loaded)}function closeIframe(iframe){iframe.parentNode&&iframe.parentNode.removeChild(iframe)}});LBF.define("lang.dateTool",function(){var ONE_DAY=1000*3600*24;var fullMonthName=["January","February","March","April","May","June","July","August","September","October","November","December"],fullWeekName=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],fillZero=function fillZero(num){return num<10?"0"+num:num},timeDist=function timeDist(date1,date2){date2=date2||new Date(date1.getFullYear(),0,1);return date1-date2},pri={d:function d(_d){return fillZero(this.j(_d))},D:function D(d){return this.l(d).substr(0,3)},j:function j(d){return d.getDate()},l:function l(d){return fullWeekName[d.getDay()]},N:function N(d){return this.w(d)||7},w:function w(d){return d.getDay()},z:function z(d){return Math.floor(timeDist(d)/86400000)},F:function F(d){return fullMonthName[d.getMonth()]},m:function m(d){return fillZero(this.n(d))},n:function n(d){return d.getMonth()+1},M:function M(d){return this.F(d).substr(0,3)},Y:function Y(d){return d.getFullYear()},y:function y(d){return this.Y(d).toString().slice(-2)},a:function a(d){return d.getHours()<12?"am":"pm"},A:function A(d){return this.a(d).toUpperCase()},g:function g(d){return d.getHours()%12||12},G:function G(d){return d.getHours()},h:function h(d){return fillZero(this.g(d))},H:function H(d){return fillZero(this.G(d))},i:function i(d){return fillZero(d.getMinutes())},s:function s(d){return fillZero(d.getSeconds())}};var dateTool={format:function format(expr,date){expr=expr||"Y-m-d H:i:s";if(arguments.length==1){date=new Date}else if(!(date instanceof Date)){date=new Date(parseInt(date)||0)}return expr.replace(/\\?([a-z])/gi,function(str,$1){if(pri[str]){return pri[str].call(pri,date)}else{return $1}})},isLeapYear:function isLeapYear(year){year.getTime&&(year=dateTool.format("Y",year));year=parseInt(year,10);return!!(0==year%4&&(year%100!=0||year%400==0))},lastDay:function lastDay(date){return new Date(+date-ONE_DAY)},nextDay:function nextDay(date){return new Date(+date+ONE_DAY)},lastMonth:function lastMonth(date){var cloned=new Date(+date);cloned.setMonth(cloned.getMonth()-1);return cloned},nextMonth:function nextMonth(date){var cloned=new Date(+date);cloned.setMonth(cloned.getMonth()+1);return cloned},lastYear:function lastYear(date){var cloned=new Date(+date);cloned.setYear(cloned.getFullYear()-1);return cloned},nextYear:function nextYear(date){var cloned=new Date(+date);cloned.setYear(cloned.getFullYear()+1);return cloned},daysBetween:function daysBetween(start,end){var timeZoneExtTime=new Date().getTimezoneOffset()*60*1000;return parseInt((+end-timeZoneExtTime)/ONE_DAY,10)-parseInt((+start-timeZoneExtTime)/ONE_DAY,10)},isSameDay:function isSameDay(date1,date2){date1=new Date(date1);date2=new Date(date2);date1=new Date(date1.getFullYear(),date1.getMonth(),date1.getDate());date2=new Date(date2.getFullYear(),date2.getMonth(),date2.getDate());return dateTool.daysBetween(date1,date2)===0},timestamp:function timestamp(date){return parseInt(+date/1000,10)}};return dateTool});LBF.define("monitor.SpeedReport",function(require){var report=require("util.report"),Class=require("lang.Class"),serialize=require("util.serialize"),Attribute=require("util.Attribute");var defaults={url:"http://isdspeed.qq.com/cgi-bin/r.cgi",rate:1,calGap:false};var PointReport=Class.inherit(Attribute,{initialize:function initialize(options){this.set(defaults).set({points:[],start:+new Date}).set(options)},add:function add(time,pos){var points=this.get("points");time=time||+new Date;pos=pos||points.length;points[pos]=time;return this},send:function send(){var points=this.get("points").splice(0);if(Math.random()>this.get("rate")){return this}var start=this.get("start"),f1=this.get("flag1"),f2=this.get("flag2"),f3=this.get("flag3"),url=this.get("url")+"?flag1="+f1+"&flag2="+f2+"&flag3="+f3+"&",proxy=this.get("proxy"),i;if(this.get("calGap")){for(i=points.length-1;i>0;i--){points[i-1]=points[i-1]||0;points[i]-=points[i-1]}}else{for(i=points.length-1;i>0;i--){if(points[i]){points[i]-=start}}}url=url+serialize(points);if(proxy){url=proxy.replace("{url}",encodeURIComponent(url))}report(url)}});var reportPerformance=function reportPerformance(options){var f1=options.flag1,f2=options.flag2,f3_ie=options.flag3IE,f3_c=options.flag3Chrome,d0=options.initTime,proxy=options.proxy;var _t,_p=window.performance||window.webkitPerformance||window.msPerformance,_ta=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],_da=[],_t0,_tmp,f3=f3_ie;if(_p&&(_t=_p.timing)){if(typeof _t.msFirstPaint!="undefined"){_ta.push("msFirstPaint")}else{if(f3_c){f3=f3_c}}_t0=_t[_ta[0]];for(var i=1,l=_ta.length;i<l;i++){_tmp=_t[_ta[i]];_tmp=_tmp?_tmp-_t0:0;if(_tmp>0){_da.push(i+"="+_tmp)}}if(d0){_da.push("30="+(d0-_t0))}var url="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1="+f1+"&flag2="+f2+"&flag3="+f3+"&"+_da.join("&");if(proxy){url=proxy.replace("{url}",encodeURIComponent(url))}report(url)}};return{create:function create(options){return new PointReport(options)},reportPerformance:reportPerformance}});LBF.define("util.domain",function(){var domain={},dm=document.domain;try{domain.url=location.href}catch(e){domain.url=""}domain.topDomain=function(){var reg1=/\.(?:(?:edu|gov|com|org|net)\.cn|co\.nz)$/,reg2=/^[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d$/,slicePos=reg1.test(dm)?-3:reg2.test(dm)?0:-2;return dm.split(".").slice(slicePos).join(".")}();domain.domain=function(){var reg=/(?::[\/]{2}|:[\\]{3})([a-zA-Z0-9_\.]+)/;try{var ret=reg.exec(domain.url);return ret?ret[1]||dm:dm}catch(e){return dm}}();return domain});LBF.define("wpa.util.getReportData",function(require,exports,module){var extend=require("lang.extend"),browser=require("lang.browser"),conf=require("wpa.conf.config"),win=conf.gWin,JSON=require("lang.JSON");var EVENT_TYPE_LOAD=1,EVENT_TYPE_CLICK=2,TYPE_NAME_CLICK="click",TYPE_NAME_RENDER="render";var CPTTP_NONE=0,CPTTP_CORPWPA=1,CPTTP_STAFFWPA=2,CPTTP_FREETEL=3,CPTTP_JOINGROUP=4,CPTTP_ADDFRIEND=5,CPTTP_WXMANUAL=6,CPTTP_CHAT=7,CPTTP_ADDATTENT=8;var getCPType=function getCPType(params){var temp,result=CPTTP_NONE;if(temp=params.roleQQ){result=temp.value?CPTTP_CORPWPA:CPTTP_STAFFWPA}else if(params.roleTEL){result=CPTTP_FREETEL}else if(params.roleKFEXT){result=CPTTP_ADDFRIEND}else if(params.roleGROUP){result=CPTTP_JOINGROUP}else if(params.rolePUB){result=CPTTP_ADDATTENT}return{tptype:result}};module.exports=exports=function exports(params,type,serialize){type=type||TYPE_NAME_CLICK;var commonOptions={mid:"",id:params.id,visitorid:params.guid,kfuin:params.fkfuin,kfext:params.fkfext,ldpg:win.location.href,refurl:typeof document.referrer!=="undefined"?document.referrer:"",ua:window.navigator.userAgent,eptype:browser.isMobile?2:1},tptypeObj=getCPType(params),reportData=extend(commonOptions,tptypeObj);if(type==TYPE_NAME_CLICK){reportData=extend(reportData,{visitorId:params.visitorId,url:win.location.href,clickId:params.clickId,eventtp:EVENT_TYPE_CLICK,title:encodeURIComponent(document.title)})}return serialize?JSON.stringify(reportData):reportData}});LBF.define("wpa.util.compareVersion",function(require,exports,module){module.exports=function(a,b){var i,l,r,len;a=String(a).split(".");b=String(b).split(".");for(i=0,len=Math.max(a.length,b.length);i<len;i++){l=isFinite(a[i])&&Number(a[i])||0;r=isFinite(b[i])&&Number(b[i])||0;if(l<r){return-1}else if(l>r){return 1}}return 0}});LBF.define("wpa.util.getLBSLocation",function(require,exports,module){module.exports=exports=function exports(successFn,errorFn){if(!navigator.geolocation){alert(当前浏览器不支持获取位置信息);errorFn({code:5,message:"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u83B7\u53D6\u4F4D\u7F6E\u4FE1\u606F"});return}if(typeof mqq!=="undefined"&&(location.href.indexOf(".qidian.qq.com")>-1||location.href.indexOf(".dsnq.qq.com")>-1)){mqq.sensor&&mqq.sensor.getLocation({},function(retCode,latitude,longitude){if(retCode===0){successFn({coords:{latitude:latitude,longitude:longitude},coord_type:2})}else{alert("\u4ECE\u7AEF\u4E2D\u83B7\u53D6\u4F4D\u7F6E\u5931\u8D25");errorFn({code:6,message:"\u4ECE\u7AEF\u4E2D\u83B7\u53D6\u4F4D\u7F6E\u5931\u8D25"})}})}else{navigator.geolocation.getCurrentPosition(function(position){position.coord_type=1;successFn(position)},function(error){alert("\u83B7\u53D6\u5730\u7406\u4F4D\u7F6E\u4FE1\u606F\u88AB\u62D2\u7EDD");errorFn(error)})}}});LBF.define("wpa.conf.colors",function(require,exports,module){var getBackground=require("wpa.util.backgroundMixin"),config=require("wpa.conf.config"),baseUrl=config.imageBaseUrl,png8Url=config.png8Url;var colors={4:{0:{n:{s:"#3e87d5",e:"#327ccb",p:"#278cde"},h:{s:"#499ef8",e:"#327dcc",p:"#4ea9e9"}},1:{n:{s:"#0aa60a",e:"#009900",p:"#009900"},h:{s:"#14b914",e:"#009a00",p:"#3aa93a"}},2:{n:{s:"#f5b400",e:"#e0a501",p:"#f5b400"},h:{s:"#ffc934",e:"#e1a602",p:"#ffc934"}},3:{n:{s:"#ee685e",e:"#e05248",p:"#ee685e"},h:{s:"#f4867e",e:"#e05348",p:"#f3837b"}}},5:{0:{n:{p:"#278cde"}},1:{n:{p:"#009900"}},2:{n:{p:"#f5b400"}},3:{n:{p:"#ee685e"}},4:{n:{p:"#ffffff"}}},6:{0:{n:{p:"#278cde"},h:{p:"#4ea9e9"}},1:{n:{p:"#009900"},h:{p:"#3aa93a"}},2:{n:{p:"#f5b400"},h:{p:"#ffc934"}},3:{n:{p:"#ee685e"},h:{p:"#f3837b"}}},8:{0:{n:{p:baseUrl+"dialog1_bg_blue.png",p_png8:png8Url+"dialog1_bg_blue.png"},h:{p:"#278cde"}},1:{n:{p:baseUrl+"dialog1_bg_green.png",p_png8:png8Url+"dialog1_bg_green.png"},h:{p:"#009900"}},2:{n:{p:baseUrl+"dialog1_bg_yellow.png",p_png8:png8Url+"dialog1_bg_yellow.png"},h:{p:"#f5b400"}},3:{n:{p:baseUrl+"dialog1_bg_pink.png",p_png8:png8Url+"dialog1_bg_pink.png"},h:{p:"#ee685e"}}}};var backgrounds={4:{0:{n:getBackground({tmpl:1,colors:colors[4][0].n}),h:getBackground({tmpl:1,colors:colors[4][0].h})},1:{n:getBackground({tmpl:1,colors:colors[4][1].n}),h:getBackground({tmpl:1,colors:colors[4][1].h})},2:{n:getBackground({tmpl:1,colors:colors[4][2].n}),h:getBackground({tmpl:1,colors:colors[4][2].h})},3:{n:getBackground({tmpl:1,colors:colors[4][3].n}),h:getBackground({tmpl:1,colors:colors[4][3].h})}},5:{0:{n:getBackground({tmpl:2,colors:colors[5][0].n})},1:{n:getBackground({tmpl:2,colors:colors[5][1].n})},2:{n:getBackground({tmpl:2,colors:colors[5][2].n})},3:{n:getBackground({tmpl:2,colors:colors[5][3].n})}},6:{0:{n:getBackground({tmpl:2,colors:colors[6][0].n}),h:getBackground({tmpl:2,colors:colors[6][0].h})},1:{n:getBackground({tmpl:2,colors:colors[6][1].n}),h:getBackground({tmpl:2,colors:colors[6][1].h})},2:{n:getBackground({tmpl:2,colors:colors[6][2].n}),h:getBackground({tmpl:2,colors:colors[6][2].h})},3:{n:getBackground({tmpl:2,colors:colors[6][3].n}),h:getBackground({tmpl:2,colors:colors[6][3].h})}},8:{0:{n:getBackground({tmpl:3,colors:colors[8][0].n}),h:getBackground({tmpl:2,colors:colors[8][0].h})},1:{n:getBackground({tmpl:3,colors:colors[8][1].n}),h:getBackground({tmpl:2,colors:colors[8][1].h})},2:{n:getBackground({tmpl:3,colors:colors[8][2].n}),h:getBackground({tmpl:2,colors:colors[8][2].h})},3:{n:getBackground({tmpl:3,colors:colors[8][3].n}),h:getBackground({tmpl:2,colors:colors[8][3].h})}}};module.exports=exports=backgrounds});LBF.define("wpa.util.borderRadiusMixin",function(require,exports,module){var getBorderRadius=function getBorderRadius(radius){return["-webkit-border-radius: {{radius}}px;","-moz-border-radius: {{radius}}px;","border-radius: {{radius}}px;"].join("").replace(/\{\{radius\}\}/g,radius||5)};var getTopBorderRadius=function getTopBorderRadius(radius){return["-webkit-border-top-left-radius: {{radius}}px;","-moz-border-top-left-radius: {{radius}}px;","border-top-left-radius: {{radius}}px;","-webkit-border-top-right-radius: {{radius}}px;","-moz-border-top-right-radius: {{radius}}px;","border-top-right-radius: {{radius}}px;"].join("").replace(/\{\{radius\}\}/g,radius||5)};var getBottomBorderRadius=function getBottomBorderRadius(radius){return["-webkit-border-bottom-left-radius: {{radius}}px;","-moz-border-bottom-left-radius: {{radius}}px;","border-bottom-left-radius: {{radius}}px;","-webkit-border-bottom-right-radius: {{radius}}px;","-moz-border-bottom-right-radius: {{radius}}px;","border-bottom-right-radius: {{radius}}px;"].join("").replace(/\{\{radius\}\}/g,radius||5)};module.exports=exports={getBorderRadius:getBorderRadius,getTopBorderRadius:getTopBorderRadius,getBottomBorderRadius:getBottomBorderRadius}});LBF.define("wpa.util.urlBackground",function(require,exports,module){var globalSettings=require("globalSettings"),png8Url=globalSettings.png8Url;var colors={4:{blue:png8Url+"fixed4_white_qq_blue.png",green:png8Url+"fixed4_white_qq_green.png",yellow:png8Url+"fixed4_white_qq_yellow.png",pink:png8Url+"fixed4_white_qq_pink.png"}};module.exports=exports=function exports(dispType,color){if(colors[dispType]){return colors[dispType][color]}}});LBF.define("wpa.util.replaceImg3X",function(require,exports){return function(url,ratio){return ratio>2?url.replace(/2x\.png/g,"3x.png"):url}});LBF.define("wpa.conf.tpl",function(require,exports,module){var config=require("wpa.conf.config"),imageBaseUrl=config.imageBaseUrl,browser=require("lang.browser"),defaultConst=require("wpa.conf.defaultConst"),defaultEventTagName=defaultConst.defaultEventTagName;var ACTIONS={1:"callChat",2:"callPhone",3:"callAddPal",4:"callAddGroup",5:"callAddFan"};var MEDIA_QUERY={IP5:["@media only screen ","and (min-device-width : 320px) ","and (max-device-width : 568px) "].join(""),IP6P:["@media only screen ","and (min-device-width : 414px) ","and (max-device-width : 736px) "].join("")};var isRatioSet=false,css;var TPLS={1:{tpl:["<div class=\"wpa-container {theme} {closable} {has-avatar} {class}\">","<div style=\"float:left;\">","<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"callClose\" class=\"icon-close\"></a>","<img class=\"avatar\" src=\"{avatar}\" />","</div>","<div style=\"overflow:hidden;\">","<div class=\"texts\" style=\"width:calc(73%);\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<a class=\"btnText\" style=\"background:{btnBgColor}\" name=\""+defaultEventTagName+"\" data-event=\"{event}\">{btnText}</a>","</div>","</div>"].join("")},2:{tpl:["<div class=\"wpa-container\">","<a class=\"close\" data-event=\"callClose\" name=\""+defaultEventTagName+"\" href=\"javascript:void(0);\"></a>","<img class=\"avatar\" src=\"{avatar}\" />","<div class=\"content\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<a class=\"btn\" style=\"background: {btnBgColor};\" href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"{event}\">{btnText}</a>","</div>"].join("")},3:{tpl:["<div class=\"wpa-container {theme} {closable} {has-avatar} {class}\">","<div style=\"float:left;\">","<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"callClose\" class=\"icon-close\"></a>","<img class=\"avatar\" src=\"{avatar}\" />","</div>","<div style=\"overflow:hidden;\">","<div class=\"texts\" style=\"width:{calc};\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<div class=\"actions {has-btnText}\">","<a class=\"action {hasAction2}\" href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"{event2}\"><span class=\"{icon2} icon\"></span>","</a><span class=\"spliter {spliterLength}\"></span><a class=\"action\" href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"{event1}\">","<span class=\"{icon1} icon\"></span><br/>","<span class=\"btnText\">{fixedBtnText}</span>","</a>","</div>","</div>","</div>"].join("")},4:{tpl:["<div class=\"wpa-container {has-avatar}\">","<div style=\"float:left;\">","<img class=\"avatar\" src=\"{avatar}\" />","</div>","<div style=\"overflow:hidden;\">","<div class=\"texts\" style=\"width:{calc};\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<div class=\"actions {has-btnText}\">","<a class=\"action {hasAction2}\" href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"{event2}\"><span class=\"{icon2} icon\"></span>","</a><span class=\"spliter {spliterLength}\"></span><a class=\"action\" href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"{event1}\">","<span class=\"{icon1} icon\"></span>","<span class=\"btnText\">{fixedBtnText}</span>","</a>","</div>","</div>","</div>"].join("")},5:{tpl:["<div class=\"wpa-container {has-avatar}\">","<div style=\"float:left;\">","<img class=\"avatar\" src=\"{avatar}\" />","</div>","<div style=\"overflow:hidden;\">","<div class=\"texts\" style=\"width:calc(73%);\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"{event1}\" class=\"button {btnWithoutIconAdd}\">","<span class=\"icon-add {btnWithoutIconAdd}\"></span>","<span>{fixedBtnText}</span>","</a>","</div>","</div>"].join("")},6:{tpl:["<div class=\"wpa-container {theme} {closable} {has-avatar} {class}\">","<div style=\"float:left;\">","<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"callClose\" class=\"icon-close\"></a>","<img class=\"avatar\" src=\"{avatar}\" />","</div>","<div style=\"overflow:hidden;\">","<div class=\"texts\" style=\"width:calc(73%);\">","<p class=\"title\">{title}</p>","<p class=\"signature\">{signature}</p>","</div>","<a href=\"javascript:void(0);\" name=\""+defaultEventTagName+"\" data-event=\"{event1}\" class=\"button {btnWithoutIconAdd}\">","<span class=\"icon-add\"></span>","<span>{fixedBtnText}</span>","</a>","</div>","</div>"].join("")}};var getSizeFunc=require("wpa.util.getSize");var getCssTpl=function getCssTpl(params){var ratio=params.ratio,type=params.type,getSize=getSizeFunc(ratio);if(!isRatioSet){css={1:{cssText:["* {{common}margin: 0;padding: 0;}",".wpa-container {{dib}position: relative;width: 100%;height: "+getSize(130)+"px;line-height: "+getSize(126)+"px;}",".theme-1 {background: #fff;}",".theme-2 {background-color: rgba(0, 0, 0, 0.8);}",".theme-3 {background: #f0f0f0;}",".wpa-container.middle {background: transparent;}",".avatar {width: "+getSize(86)+"px;height: "+getSize(86)+"px;border-radius: 50%;vertical-align: middle;margin-left: "+getSize(30)+"px;display: none;}",".has-avatar .avatar {{dib}}",".has-avatar .texts, .closable .texts {margin-left: "+getSize(10)+"px;}",".closable .avatar {margin-left: "+getSize(20)+"px;}",MEDIA_QUERY.IP5+"{.closable .avatar {margin-left:"+getSize(20)+"px;}}",MEDIA_QUERY.IP6P+"{.closable .avatar {margin-left:"+getSize(30)+"px;}}",".closable .icon-close {{dib}}",".middle.closable .icon-close {display:none;}",".middle.closable .texts {margin-left: "+getSize(30)+"px;}",".icon-qq {{dib}width: "+getSize(37)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-qq-44-2x.png) no-repeat;background-size:"+getSize(37)+"px "+getSize(44)+"px;}",".icon-close {display: none;width: "+getSize(20)+"px;height: "+getSize(20)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-close-2x.png) no-repeat;margin-left: "+getSize(20)+"px;background-size:"+getSize(20)+"px "+getSize(20)+"px;}",MEDIA_QUERY.IP5+"{.icon-close {margin-left:"+getSize(20)+"px;}}",MEDIA_QUERY.IP6P+"{.icon-close {margin-left:"+getSize(30)+"px;}}",".theme-2 .icon-close {background: url("+imageBaseUrl+"/icon-close-for-black-2x.png) no-repeat;background-size:"+getSize(20)+"px "+getSize(20)+"px;}",".texts {{dib}vertical-align: middle;line-height: "+getSize(40)+"px;margin-top: "+getSize(0)+"px;margin-left: "+getSize(30)+"px;position:relative;top:-2px;}",".title {font-size: "+getSize(34)+"px;color: #000;}",".signature {font-size: "+getSize(28)+"px;color: #777;position:relative;top: 6px;}",".theme-2 .title, .theme-2 .signature {color: #fff;}",".middle .title {color: #000!important;}",".middle .signature {color: #999!important;}",".btnText {cursor: pointer;background: #0067ed;border-radius: "+getSize(10)+"px;{dib}font-size: "+getSize(28)+"px;color: #fff;height: "+getSize(26)+"px;max-width: "+getSize(147)+"px;line-height: "+getSize(26)+"px;padding: "+getSize(17)+"px "+getSize(18)+"px;position: absolute;top: "+getSize(35)+"px;right: "+getSize(30)+"px;margin-left: "+getSize(30)+"px;{ell}}",".theme-2 .btnText {background: transparent!important;border: "+getSize(2)+"px solid #fff;padding: "+getSize(15)+"px "+getSize(16)+"px;height: "+getSize(22)+"px;line-height:"+getSize(22)+"px;}"].join("")},2:{cssText:["* {{common}margin: 0;padding: 0;}",".wpa-container {{dib}width: 402px;height: 198px;border-radius: 2px;position: relative;background: #fff;border: 1px solid #dadee7;font-family:\"microsoft yahei\";font-size: 14px;{boxShadow}}",".close {position: absolute;top: 15px;right: 15px;{dib}width: 14px;height: 14px;background: url("+imageBaseUrl+"/icon-close.png) no-repeat;background-size:14px 14px;}",".avatar {position: absolute;top: 26px;left: 26px;border-radius: 100%;width: 94px;height: 94px;}",".content {position: absolute;top: 30px;left: 135px;}",".title {font-size: 22px;{ell}}",".signature {color: #777;line-height: 24px;margin-top: 10px;width: 226px;}",".btn {{ell}text-decoration: none;color: #fff;position: absolute;right: 15px;bottom: 15px;width: 100px;border-radius: 2px;text-align: center;height: 35px;line-height: 35px;}"].join("")},3:{cssText:["* {{common}margin: 0;padding: 0;}",".wpa-container {{dib}position: relative;width: 100%;height: "+getSize(130)+"px;line-height: "+getSize(126)+"px;}",".theme-1 {background: #fff;}",".theme-2 {background-color: rgba(0, 0, 0, 0.8);}",".theme-3 {background: #f0f0f0;}",".wpa-container.middle {background: transparent!important;}",".wpa-container.qidian_wxkf {background:#F6F7FA}",".wpa-container.qidian_wxkf .signature,.wpa-container.qidian_wxkf .btnText{color:#78849E}",".theme-2.qidian_wxkf {background-color: rgba(0, 0, 0, 0.8);}",".theme-2.wpa-container.qidian_wxkf .signature,.theme-2.wpa-container.qidian_wxkf .btnText{color:#fff}",".avatar {width: "+getSize(86)+"px;height: "+getSize(86)+"px;border-radius: 50%;vertical-align: middle;margin-left: "+getSize(30)+"px;display: none;}",".has-avatar .avatar {{dib}}",".has-avatar .texts, .closable .texts {margin-left: "+getSize(18)+"px;}",MEDIA_QUERY.IP5+"{.has-avatar .texts, .closable .texts {margin-left: "+getSize(18)+"px;}}",MEDIA_QUERY.IP6P+"{.has-avatar .texts, .closable .texts {margin-left: "+getSize(30)+"px;}}",".closable .avatar {margin-left: "+getSize(18)+"px;}",MEDIA_QUERY.IP5+"{.closable .avatar {margin-left:"+getSize(20)+"px;}}",MEDIA_QUERY.IP6P+"{.closable .avatar {margin-left:"+getSize(30)+"px;}}",".closable .icon-close {{dib}}",".middle.closable .icon-close {display:none;}",".action .icon {position:relative; top: "+getSize(44)+"px;display: none;}",".action .icon.icon-qq {{dib}width: "+getSize(37)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-qq-44-2x.png) no-repeat;background-size:"+getSize(37)+"px "+getSize(44)+"px;}",".action .icon.icon-im {{dib}width: "+getSize(44)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-im-44-blue-2x.png) no-repeat;background-size:"+getSize(44)+"px "+getSize(44)+"px;}",".action .icon.icon-call {{dib}width: "+getSize(40)+"px;height: "+getSize(42)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-call-44-2x.png) no-repeat;background-size:"+getSize(40)+"px "+getSize(42)+"px;}",".action .icon.icon-video {{dib}width: "+getSize(44)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/video-nobg-theme-1.png) no-repeat;background-size:contain"+";}",".action .icon.icon-wechat {{dib}width: "+getSize(44)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/wechat.png) no-repeat;background-size:contain"+";}",".icon-close {display: none;width: "+getSize(20)+"px;height: "+getSize(20)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-close-2x.png) no-repeat;margin-left: "+getSize(20)+"px;background-size:"+getSize(20)+"px "+getSize(20)+"px;}",MEDIA_QUERY.IP5+"{.icon-close {margin-left:"+getSize(20)+"px;}}",MEDIA_QUERY.IP6P+"{.icon-close {margin-left:"+getSize(30)+"px;}}",".theme-2 .icon-close {background: url("+imageBaseUrl+"/icon-close-for-black-2x.png) no-repeat;background-size:"+getSize(20)+"px "+getSize(20)+"px;}",".texts {{dib}vertical-align: middle;line-height: "+getSize(40)+"px;margin-top: "+getSize(-4)+"px;margin-left: "+getSize(30)+"px;}",".title {font-size: "+getSize(34)+"px;color: #000;{ell}}",".signature {font-size: "+getSize(28)+"px;color: #777;{ell}position:relative;top: "+getSize(5)+"px;}",".theme-2 .title, .theme-2 .signature {color: #fff;}",".middle .title {color: #000!important;}",".middle .signature {color: #999!important;}",".spliter {{dib}vertical-align: middle;height: "+getSize(56)+"px;width: 1px;background: #d6d6d6;}",".spliter.spliter-long {height: "+getSize(80)+"px;}",".theme-2 .spliter {background: #565656;}",".middle .spliter {background: #d6d6d6!important;}",".actions {{dib}vertical-align: middle;position: absolute;right: 0;top: 0;height: "+getSize(130)+"px;}",".actions span.icon {cursor: pointer;}",".btnText {font-size: "+getSize(22)+"px;color: #777;display: none;}",".theme-2 .btnText, .theme-2 .title, .theme-2 .signature {color: #fff;}",".middle .btnText {color: #777!important;}",".action {margin-top: -3px;{dib}vertical-align: middle;text-align: center;line-height: "+getSize(40)+"px;position: relative;width: "+getSize(100)+"px;height: "+getSize(130)+"px;}",MEDIA_QUERY.IP5+"{.action {width: "+getSize(100)+"px;}}",MEDIA_QUERY.IP6P+"{.action {width: "+getSize(120)+"px;}}",".has-btnText .action {width: "+getSize(150)+"px;}",".has-btnText .action .icon {top: "+getSize(28)+"px;}",".action.no-action2 {display:none;}",".has-btnText .action .btnText {{dib}position: relative;top: "+getSize(30)+"px;{ell}}"].join("")},4:{cssText:["* {{common}margin: 0;padding: 0;}",".wpa-container {{dib}position: relative;width: 100%;height: "+getSize(140)+"px;line-height: "+getSize(136)+"px;background: transparent;}",".avatar {width: "+getSize(100)+"px;height: "+getSize(100)+"px;border-radius: 50%;vertical-align: middle;margin-left: "+getSize(0)+"px;display: none;}",".has-avatar .avatar {{dib}}",".has-avatar .texts {margin-left: "+getSize(22)+"px;}",".action .icon {position: absolute;top: "+getSize(44)+"px;left: "+getSize(40)+"px;display: none;}",".has-btnText .action .icon {left: "+getSize(57)+"px;}",".action .icon.icon-qq {{dib}width: "+getSize(37)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-qq-44-2x.png) no-repeat;background-size:"+getSize(37)+"px "+getSize(44)+"px;}",".action .icon.icon-im {{dib}width: "+getSize(44)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-im-44-blue-2x.png) no-repeat;background-size:"+getSize(44)+"px "+getSize(44)+"px;}",".action .icon.icon-call {{dib}width: "+getSize(40)+"px;height: "+getSize(42)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-call-44-2x.png) no-repeat;background-size:"+getSize(40)+"px "+getSize(42)+"px;}",".action .icon.icon-video {{dib}width: "+getSize(44)+"px;height: "+getSize(44)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/video-nobg-theme-1.png) no-repeat;background-size:contain"+"}",".texts {{dib}vertical-align: middle;line-height: "+getSize(40)+"px;margin-top: "+getSize(-4)+"px;margin-left: "+getSize(30)+"px;}",".title {font-size: "+getSize(34)+"px;color: #000;}",".signature {font-size: "+getSize(28)+"px;color: #777;position:relative; top:"+getSize(5)+"px;}",".spliter {{dib}vertical-align: middle;height: "+getSize(56)+"px;width: 1px;background: #d6d6d6;}",".spliter.spliter-long {height: "+getSize(80)+"px;}",".actions {{dib}vertical-align: middle;position: absolute;right: "+getSize(-20)+"px;top: 0;height: "+getSize(140)+"px;}",".actions span.icon {cursor: pointer;}",".btnText {font-size: "+getSize(22)+"px;color: #777;display: none;{ell}}",".action {{dib}vertical-align: middle;text-align: center;line-height: "+getSize(40)+"px;position: relative;width: "+getSize(122)+"px;height: "+getSize(140)+"px;}",MEDIA_QUERY.IP5+".action {{width: "+getSize(100)+"px;}}",MEDIA_QUERY.IP6P+".action {{width: "+getSize(120)+"px;}}",".has-btnText .action {width: "+getSize(150)+"px;}",".has-btnText .action .icon {top: "+getSize(28)+"px;}",".action.no-action2 {display:none;}",".has-btnText .action .btnText {{dib}{ell}position: relative;top: "+getSize(77)+"px;}"].join("")},5:{cssText:["* {{common}margin: 0;padding: 0;}",".wpa-container {{dib}position: relative;width: 100%;height: "+getSize(140)+"px;line-height: "+getSize(136)+"px;background: transparent;}",".avatar {width: "+getSize(100)+"px;height: "+getSize(100)+"px;border-radius: 50%;vertical-align: middle;margin-left: "+getSize(0)+"px;display: none;}",".has-avatar .avatar {{dib}}",".has-avatar .texts {margin-left: "+getSize(22)+"px;}",".texts {{dib}vertical-align: middle;line-height: "+getSize(40)+"px;margin-top: "+getSize(0)+"px;margin-left: "+getSize(30)+"px;position:relative;top:-2px;}",".title {font-size: "+getSize(34)+"px;color: #000;}",".signature {font-size: "+getSize(28)+"px;color: #777;position:relative;top:6px;}",".button {{dib}text-decoration: none;color: #00a5e0;font-size: "+getSize(24)+"px;padding: "+getSize(12)+"px "+getSize(16)+"px;max-width: "+getSize(110)+"px;height: "+getSize(24)+"px;line-height: "+getSize(24)+"px;text-align: center;border-radius: "+getSize(10)+"px;border: "+getSize(2)+"px solid #00a5e0;position: absolute;right: "+getSize(0)+"px;top: "+getSize(45)+"px;}",".btn-without-icon-add {padding: "+getSize(12)+"px "+getSize(30)+"px;}",".button.btn-without-icon-add .icon-add {display:none;}",".icon-add {{dib}width: "+getSize(18)+"px;height: "+getSize(18)+"px;background: url("+imageBaseUrl+"/icon-add-2x.png) no-repeat;margin-right:"+getSize(10)+"px;background-size:"+getSize(18)+"px "+getSize(18)+"px;}"].join("")},6:{cssText:["* {{common}margin: 0;padding: 0;}",".wpa-container {{dib}position: relative;width: 100%;height: "+getSize(140)+"px;line-height: "+getSize(136)+"px;background: transparent;}",".theme-1 {background: #fff;}",".theme-2 {background-color: rgba(0, 0, 0, 0.8);}",".theme-3 {background: #f0f0f0;}",".wpa-container.middle {background: transparent;}",".closable .avatar {margin-left: "+getSize(20)+"px;}",MEDIA_QUERY.IP5+"{.closable .avatar {margin-left:"+getSize(20)+"px;}}",MEDIA_QUERY.IP6P+"{.closable .avatar {margin-left:"+getSize(30)+"px;}}",".closable .icon-close {{dib}}",".middle.closable .icon-close {display:none;}",".middle.closable .texts {margin-left: "+getSize(30)+"px;}",".avatar {width: "+getSize(100)+"px;height: "+getSize(100)+"px;border-radius: 50%;vertical-align: middle;margin-left: "+getSize(30)+"px;display: none;}",".icon-close {display: none;width: "+getSize(20)+"px;height: "+getSize(20)+"px;vertical-align: middle;background: url("+imageBaseUrl+"/icon-close-2x.png) no-repeat;margin-left: "+getSize(20)+"px;background-size:"+getSize(20)+"px "+getSize(20)+"px;}",MEDIA_QUERY.IP5+"{.icon-close {margin-left:"+getSize(20)+"px;}}",MEDIA_QUERY.IP6P+"{.icon-close {margin-left:"+getSize(30)+"px;}}",".has-avatar .avatar {{dib}}",".has-avatar .texts {margin-left: "+getSize(22)+"px;}",".texts {{dib}vertical-align: middle;line-height: "+getSize(40)+"px;margin-top: "+getSize(0)+"px;margin-left: "+getSize(30)+"px;position:relative;top:-2px;}",".title {font-size: "+getSize(34)+"px;color: #000;}",".signature {font-size: "+getSize(28)+"px;color: #777;position:relative;top:6px;}",".theme-2 .icon-close {background: url("+imageBaseUrl+"/icon-close-for-black-2x.png) no-repeat;background-size:"+getSize(20)+"px "+getSize(20)+"px;}",".button {{dib}text-decoration: none;color: #00a5e0;font-size: "+getSize(24)+"px;padding: "+getSize(12)+"px "+getSize(16)+"px;height: "+getSize(24)+"px;line-height: "+getSize(24)+"px;text-align: center;border-radius: "+getSize(10)+"px;border: "+getSize(2)+"px solid #00a5e0;position: absolute;right: "+getSize(30)+"px;top: "+getSize(45)+"px;}",MEDIA_QUERY.IP5+"{.button {top: "+getSize(45)+"px;padding: "+getSize(12)+"px "+getSize(16)+"px;font-size: "+getSize(24)+"px;height: "+getSize(24)+"px;line-height: "+getSize(24)+"px;}}",MEDIA_QUERY.IP6P+"{.button {top: "+getSize(38)+"px;padding: "+getSize(12)+"px "+getSize(24)+"px;font-size: "+getSize(28)+"px;height: "+getSize(36)+"px;line-height: "+getSize(36)+"px;}}",".icon-add {{dib}width: "+getSize(18)+"px;height: "+getSize(18)+"px;background: url("+imageBaseUrl+"/icon-add-2x.png) no-repeat;margin-right:"+getSize(10)+"px;background-size:"+getSize(18)+"px "+getSize(18)+"px;}",".theme-2 .title, .theme-2 .signature, .theme-2 .button {color: #fff;}",".theme-2 .button {border-color: #fff;}",".theme-2 .icon-add {background: url("+imageBaseUrl+"/icon-add-for-black-2x.png) no-repeat;background-size:9px 9px;}",".middle .title {color: #000!important;}",".middle .signature {color: #999!important;}",".middle .button {color: #00a5e0!important;border-color: #00a5e0!important;}",".btn-without-icon-add {padding: "+getSize(12)+"px "+getSize(30)+"px;}",".button.btn-without-icon-add .icon-add {display:none;}",".middle .icon-add {background: url("+imageBaseUrl+"/icon-add-2x.png) no-repeat;background-size:9px 9px;}"].join("")}};isRatioSet=true}return css[type].cssText};module.exports=exports=function exports(type,options){type=type||1;options=options||{};var targetTpl=TPLS[type],ratio=options.ratio,tpl=targetTpl.tpl,cssText=getCssTpl({type:type,ratio:ratio}),hasBtnText=_typeof(options.hasBtnText)!==undefined&&options.hasBtnText?"has-btnText":"",hasAvatar=_typeof(options.hasAvatar)!==undefined&&options.hasAvatar?"has-avatar":"",eventList=options.eventList||[],fixedBtnText=options.fixedBtnText||"",iconList=options.iconList||[],btnWithoutIconAdd=options.btnWithoutIconAdd?"btn-without-icon-add":"",event1=eventList[0]||"",event2=eventList[1]||"",icon1=iconList[0]||"",icon2=iconList[1]||"",hasAction2=icon2?"":"no-action2",isSpliterLong=!icon2?"spliter-long":"",calc=icon2?"calc(60%)":"calc(73%)";if(hasBtnText&&!fixedBtnText){tpl=tpl.replace(/fixedBtnText/,"btnText")}var compiledTpl=tpl.replace(/\{has-avatar\}/g,hasAvatar).replace(/\{has-btnText\}/g,hasBtnText).replace(/\{fixedBtnText\}/g,fixedBtnText).replace(/\{icon1\}/g,icon1).replace(/\{icon2\}/g,icon2).replace(/\{event1\}/g,event1).replace(/\{event2\}/g,event2).replace(/\{spliterLength\}/g,isSpliterLong).replace(/\{hasAction2\}/g,hasAction2).replace(/\{btnWithoutIconAdd\}/g,btnWithoutIconAdd).replace(/\{calc\}/g,calc);return function(params){params=params||{};var eventName=ACTIONS[params.event]||ACTIONS[1];var result=compiledTpl.replace(/\{event\}/g,eventName);if(ratio>2){cssText=cssText.replace(/2x\.png/g,"3x.png")}return{tpl:result,cssText:cssText}}}});LBF.define("wpa.util.css",function(require,exports,module){var contains=require("util.contains"),conf=require("wpa.conf.config"),win=conf.gWin,doc=win.document;var getStyle=doc.defaultView&&doc.defaultView.getComputedStyle?function(node,style){style=style.replace(/([A-Z])/g,"-$1").toLowerCase();var s=doc.defaultView.getComputedStyle(node,"");return s&&s.getPropertyValue(style)}:function(node,style){return node.currentStyle[style]};var inDom=function inDom(node,fn){if(!contains(node,doc)){return fn()}var inVisible={opacity:0,filter:"alpha(opacity=0)"},parent=node.parentNode,nextSibling=node.nextSibling,div=doc.createElement("div"),returnValue;div.appendChild(node);doc.body.appendChild(div);returnValue=fn();nextSibling?parent.insertBefore(node,nextSibling):parent.appendChild(node);div.parentNode.removeChild(div);return returnValue};module.exports=function(node,style,value){var cssText;if(!value){if(typeof style==="string"){return inDom(node,function(){return getStyle(node,style)})}if(_typeof(style)!=="object"){new TypeError("Arg style should be string or object")}cssText=[];for(var styleName in style){cssText.push(styleName+":"+style[styleName])}cssText=cssText.join(";")}else{cssText=style+":"+value}cssText=cssText.replace(/([A-Z])/g,"-$1").toLowerCase();node.style.cssText+=";"+cssText;return node}});LBF.define("wpa.util.showInstallQQ",function(require,exports,module){var browser=require("lang.browser"),conf=require("wpa.conf.config"),onIframeLoaded=require("wpa.util.onIframeLoaded"),Style=require("wpa.util.Style"),domEvent=require("wpa.util.domEvent"),isMobile=conf.isMobile,imageBaseUrl=conf.imageBaseUrl,isIOS=browser.isIOS,isAndroid=browser.isAndroid,INSTALL_QQ_IFRAME_ID_PREFIX=conf.INSTALL_QQ_IFRAME_ID_PREFIX,DOWNLOAD_QQ_URL=conf.DOWNLOAD_QQ_URL;var win=conf.gWin,doc=win.document,body=doc.body;function getIframeStyle(){if(isMobile){return{style:["position: fixed","z-index: 2000001000","top: 0","bottom: 0","left: 0","right: 0"].join(";"),width:"100%",height:"100%"}}return{style:["position: fixed","z-index: 2000001000","top: 0","left: 50%","margin-left: -220px","background-color: #fff","box-shadow: 0 0 15px 1px rgba(0, 0, 0, .15)"].join(";"),width:440,height:173}}function getTplContent(){var commonTpl=["<div class=\"wpa-install-qq\">","<div class=\"main\">","<p class=\"title\">\u6B63\u5728\u4E3A\u4F60\u6253\u5F00QQ</p>","<p class=\"content\">\u6CA1\u6709\u5B89\u88C5QQ\uFF1F\u8BF7\u70B9\u51FB\u4E0B\u8F7D</p>","</div>","{btns}","</div>"].join(""),closeTpl=["<a href=\"javascript:void(0);\" id=\"btn-close\" class=\"icon-close\" data-event=\"close\"><i></i></a>"].join("");if(isMobile){return["<div class=\"wpa-install-qq-holder\">",commonTpl.replace("{btns}",["<div class=\"btns\">","<div class=\"btn\" id=\"btn-download\" data-event=\"download\">\u53BB\u4E0B\u8F7D</div>","</div>",closeTpl].join("")),"</div>"].join("")}return commonTpl.replace("{btns}",["<div class=\"btns\">","<div class=\"btn btn--primary\" id=\"btn-download\" data-event=\"download\">\u53BB\u4E0B\u8F7D</div>","<div class=\"btn btn--default btn--cancel\" id=\"btn-cancel\" data-event=\"close\">\u53D6\u6D88</div>","</div>"].join(""))}function getTplCss(){var commonCss=["* {margin: 0; padding: 0; font-family: \"PingFang SC\", \"Droid Sans Fallback\", \"microsoft yahei\"; background: transparent; }","body { visibility: visible !important; }"].join(""),closeCss=[".icon-close { position: absolute; width: 20px; height: 20px; top: 10px; right: 10px; text-align: center; }",".icon-close i { display: inline-block; width: 13px; height: 13px; background-size: 13px 13px; background-image: url(\""+imageBaseUrl+"/icon-close-2x.png\"); }",".icon-close:hover i { background-image: url(\""+imageBaseUrl+"/icon-close-for-black-2x.png\"); }"].join("");if(isMobile){return[commonCss,closeCss,".wpa-install-qq-holder { position: absolute; width: 100%; height: 172px; top: 50%; margin-top: -86px; }",".wpa-install-qq { position: absolute; height: 169px; left: 39px; right: 39px; background-color: #fff; box-shadow: 0 0 15px 1px rgba(0, 0, 0, .15); border-top: 3px solid #3481f7; }",".wpa-install-qq .main { position: relative; text-align: center; }",".wpa-install-qq .main .title { font-size: 20px; color: #1e2330; line-height: 1; margin-top: 35px; }",".wpa-install-qq .main .content { font-size: 16px; color: #66686c; line-height: 1; margin-top: 20px; }",".wpa-install-qq .btns { position: absolute; bottom: 0; left: 0; right: 0; border-top: 1px solid #ebedf2; }",".wpa-install-qq .btns .btn { font-size: 18px; line-height: 45px; color: #0067ed; text-align: center; }"].join("")}return[commonCss,closeCss,".wpa-install-qq { position: relative; }",".wpa-install-qq .main { text-align: left; padding: 32px 0 0 30px; }",".wpa-install-qq .main .title { font-size: 24px; color: #1e2330; line-height: 1; }",".wpa-install-qq .main .content { font-size: 14px; color: #66686c; line-height: 1; margin-top: 12px; }",".wpa-install-qq .btns { font-size: 0; text-align: right; margin-top: 35px; }",".wpa-install-qq .btns .btn { display: inline-block; text-align: center; width: 107px; height: 36px; font-size: 12px; line-height: 36px; border-radius: 2px; cursor: pointer; transition: border-color .25s, background-color .25s; }",".wpa-install-qq .btns .btn--primary { color: #fff; background-color: #0067ed; border: 1px solid #0067ed; }",".wpa-install-qq .btns .btn--primary:hover { color: #fff; background-color: #197dff; border: 1px solid #197dff; }",".wpa-install-qq .btns .btn--default { background-color: #fff; border: 1px solid #dadee7; }",".wpa-install-qq .btns .btn--default:hover { border: 1px solid #a8abb3; }",".wpa-install-qq .btns .btn--cancel { margin: 0 18px 0 15px; }"].join("")}function bindBtn($btn,options){if(!$btn){return}var event=$btn.getAttribute("data-event");domEvent.addEvent($btn,"click",function(){if(event==="close"){clearInstallQQPanel(options)}else if(event==="download"){if(isMobile){if(isIOS){win.location.href=DOWNLOAD_QQ_URL.iOS}else if(isAndroid){win.open(DOWNLOAD_QQ_URL.Android)}}else{win.open(DOWNLOAD_QQ_URL.PC)}}})}function bindEvents(iframe,options){var iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document,kfuin=options.kfuin,$close=iDoc.getElementById("btn-close"),$download=iDoc.getElementById("btn-download"),$cancel=iDoc.getElementById("btn-cancel");bindBtn($close,{iframe:iframe,kfuin:kfuin});bindBtn($cancel,{iframe:iframe,kfuin:kfuin});bindBtn($download,{iframe:iframe,kfuin:kfuin})}function clearInstallQQPanel(options){var kfuin=options.kfuin,iframe=options.iframe||doc.getElementById(INSTALL_QQ_IFRAME_ID_PREFIX+kfuin);if(iframe){iframe.parentNode&&iframe.parentNode.removeChild(iframe)}}module.exports=exports=function exports(options){var kfuin=options.kfuin,iframeId=INSTALL_QQ_IFRAME_ID_PREFIX+kfuin,iframeStyle=getIframeStyle(),style=iframeStyle.style,width=iframeStyle.width,height=iframeStyle.height;if(doc.getElementById(iframeId))return;var strIframe="<iframe scrolling=\"no\" id=\""+iframeId+"\" frameborder=\"0\" width=\""+width+"\" height=\""+height+"\" allowtransparency=\"true\" src=\"about:blank\" style=\"{style}\" ></iframe>";strIframe=strIframe.replace("{style}",style);var iframe;try{iframe=doc.createElement(strIframe)}catch(e){iframe=doc.createElement("iframe");iframe.width=width;iframe.height=height;iframe.id=iframeId;iframe.style.cssText=style;iframe.setAttribute("scrolling","no");iframe.setAttribute("frameborder",0);iframe.setAttribute("allowtransparency",true);iframe.setAttribute("src","about:blank");if(!isMobile){iframe.width=width}}body.appendChild(iframe);var loaded=function loaded(){var iWin=iframe.contentWindow,iDoc=iframe.contentDocument||iWin.document;iDoc.open();iDoc.write(["<!DOCTYPE html>","<html xmlns=\"http://www.w3.org/1999/xhtml\">","<head>","<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />","</head>","<body style=\"visibility: hidden;\">",getTplContent(),"</body>","</html>"].join(""));iDoc.close();var styleObj={name:"style",cssText:getTplCss(),doc:iDoc};Style.commonAdd(styleObj);bindEvents(iframe,options)};onIframeLoaded(iframe,loaded)}});LBF.define("wpa.im.i18n",function(require,exports,module){module.exports={"zh-cn":{"common_new_message":"\u6761\u65B0\u6D88\u606F"},"en-us":{"common_new_message":" new message"},"zh-tw":{"common_new_message":"\u689D\u65B0\u6D88\u606F"}}});LBF.define("util.Attribute",function(require,exports,module){var extend=require("lang.extend");var ATTR="_ATTRIBUTES",VALIDATES="_VALIDATES";exports.set=function(attr,val,options){var attrs=this[ATTR];if(!attrs){attrs=this[ATTR]={}}if(_typeof(attr)!=="object"){var oAttr=attrs[attr];attrs[attr]=val;if(!this.validate(attrs)){attrs[attr]=oAttr}else{if(val!==oAttr&&(!options||!options.silence)&&this.trigger){this.trigger("change:"+attr,[attrs[attr],oAttr]);this.trigger("change",[attrs])}}return this}options=val;var obj=extend({},attrs,attr);if(this.validate(obj)){this[ATTR]=obj;if((!options||!options.silence)&&this.trigger){var changedCount=0;for(var i in attr){if(attr.hasOwnProperty(i)&&obj[i]!==attrs[i]){changedCount++;this.trigger("change:"+i,[obj[i],attrs[i]])}}changedCount>0&&this.trigger("change",[obj])}}return this};exports.get=function(attr){return!this[ATTR]?null:this[ATTR][attr]};exports.attributes=function(){return this[ATTR]||{}};exports.addValidate=function(validate){var validates=this[VALIDATES];if(!validates){validates=this[VALIDATES]=[]}validates.push(validate);return this};exports.removeValidate=function(validate){if(!validate){this[VALIDATES]=null;return this}var valArr=this[VALIDATES];for(var i=0,len=valArr.length;i<len;i++){if(valArr[i]===validate){valArr.splice(i,1);--i;--len}}return this};exports.validate=function(attrs){var valArr=this[VALIDATES];if(!valArr){return true}attrs=attrs||this[ATTR];for(var i=0,len=valArr.length;i<len;i++){if(valArr[i].call(this,attrs)===false){return false}}return true}});LBF.define("wpa.util.backgroundMixin",function(require,exports,module){var backgroundTmpls={1:["background: {{p}};","background: -moz-linear-gradient(top, {{s}} 0%, {{e}} 100%);","background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,{{s}}), color-stop(100%,{{e}}));","background: -webkit-linear-gradient(top, {{s}} 0%,{{e}} 100%);","background: -o-linear-gradient(top, {{s}} 0%,{{e}} 100%);","background: -ms-linear-gradient(top, {{s}} 0%,{{e}} 100%);","background: linear-gradient(to bottom, {{s}} 0%,{{e}} 100%);","filter: progid:DXImageTransform.Microsoft.gradient( startColorstr=\"{{s}}\", endColorstr=\"{{e}}\",GradientType=0 );"].join(""),2:"background: {{p}};",3:"background: url({{p}});_background: url({{p_png8}});"};var getBackground=function getBackground(params){var tmpl;switch(params.tmpl){case 1:tmpl=1;break;case 2:tmpl=2;break;case 3:tmpl=3;break;default:tmpl=1;};return backgroundTmpls[tmpl].replace(/\{\{p\}\}/g,params.colors.p).replace(/\{\{s\}\}/g,params.colors.s).replace(/\{\{e\}\}/g,params.colors.e).replace(/\{\{p_png8\}\}/g,params.colors.p_png8||"")};module.exports=exports=getBackground});LBF.define("util.contains",function(){return document.createElement("div").compareDocumentPosition?function(parent,child,containSelf){if(!containSelf&&parent===child){return false}var res=parent.compareDocumentPosition(child);return res==20||res==0}:function(parent,child,containSelf){if(!containSelf&&parent===child){return false}return child==document?parent.contains(document.body):parent.contains(child)}});LBF.use("wpa.app",function(app){app.init();app.lbf=LBF;LBF.noConflict()});
//# sourceMappingURL=pk1.js.map
