# 安全
---

# 一、关于加密技术

加密技术是对信息进行编码和解码的技术，编码是把原来可读信息（又称明文）译成代码形式（又称密文），其逆过程就是解码，加密技术的要点是加密算法，加密算法可以分为三类：

> Base64不是加密算法，它是⼀种数据编码⽅式，虽然是可逆的，但是它的编码⽅式是公开的，⽆所谓加密。

## （一）对称加密，加密与解密的密钥相同，如：DES、AES

- 原理：将明文分成N个组，然后使用密钥对各个组进行加密，形成各自的密文，最后把所有的分组密文进行合并，形成最终的密文。

- 优势：算法公开、计算量小、加密速度快、加密效率高

- 缺陷：双方都使用同样密钥，安全性得不到保证

### 1.DES
DES是⼀种对称加密算法，⼜称为美国数据加密标准。是1972年美国IBM公司研制的对称密码体制加密算法。 明文按64位进行分组，密钥长64位，密钥事实上是56位参与DES运算（第8、16、24、32、40、48、56、64位是校验位， 使得每个密钥都有奇数个1）分组后的明文组和56位的密钥按位替代或交换的方法形成密文组的加密方法。

其入口参数有三个：key、data、mode。key为加密解密使用的密钥，data为加密解密的数据，mode为其工作模式。当模式为加密模式时，明文按照64位进行分组，形成明文组，key用于对数据加密，当模式为解密模式时，key用于对数据解密。实际运用中，密钥只用到了64位中的56位，这样才具有高的安全性。

DES算法具有极高安全性，除了用穷举搜索法对DES算法进行攻击外，还没有发现更有效的办法。而56位长的密钥的穷举空间为2^56，这意味着如果一台计算机的速度是每一秒钟检测一百万个密钥，则它搜索完全部密钥就需要将近2285年的时间，可见，这是难以实现的。然而，这并不等于说DES是不可破解的。而实际上，随着硬件技术和Internet的发展，其破解的可能性越来越大，而且，所需要的时间越来越少。使用经过特殊设计的硬件并行处理要几个小时。

DES有ECB（电⼦密码本）和CBC（加密块）等加密模式。

DES算法的安全性很⾼，⽬前除了穷举搜索破解外，尚⽆更好的的办法来破解。其密钥长度越长，破解难度就越⼤。填充和去填充函数。

### 2.AES
AES，即⾼级加密标准（Advanced Encryption Standard），是⼀个对称分组密码算法，旨在取代DES成为⼴泛使⽤的标准。

AES中常见的有三种解决⽅案，分别为AES-128、AES-192和AES-256。

AES加密过程涉及到4种操作：字节替代（SubBytes）、⾏移位（ShiftRows）、列混淆（MixColumns）和轮密钥加（AddRoundKey）。

解密过程分别为对应的逆操作。由于每⼀步操作都是可逆的，按照相反的顺序进行解密即可恢复明文。加解密中每轮的密钥分别由初始密钥扩展得到。算法中16字节的明⽂、密⽂和轮密钥都以⼀个4x4的矩阵表⽰。

AES 有五种加密模式：
- 电码本模式（Electronic Codebook Book (ECB)）
- 密码分组链接模式（Cipher Block Chaining (CBC)）
- 计算器模式（Counter (CTR)）
- 密码反馈模式（Cipher FeedBack (CFB)）
- 输出反馈模式（Output FeedBack (OFB)）
      

## （二）非对称加密，加密与解密的密钥不相同，如：RSA

- 原理：RSA公开密钥密码体制的原理是：根据数论，寻求两个大素数比较简单，而将它们的乘积进行因式分解却极其困难，因此可以将乘积公开作为加密密钥。首先同时生成两把密钥：私钥和公钥，私钥隐秘保存，公钥下发给信任的客户端
    - 私钥加密，持有私钥或公钥才可以解密
    - 公钥加密，持有私钥才可解密
    
> 首先使用openssl生成公私钥，使用RSA的时候需要提供公钥和私钥，可以通过openss来生成对应的pem格式的公钥和私钥匙

- RSA算法历史：1977年，三位数学家 Rivest、Shamir 和 Adleman 设计了一种算法，可以实现非对称加密。这种算法用他们三个人的名字缩写：RSA
    - 优点：安全，难以破解
    - 缺点：算法比较耗时
    
### 1.RSA
RSA公开密钥密码体制是一种使用不同的加密密钥与解密密钥，“由已知加密密钥推导出解密密钥在计算上是不可行的”密码体制。

在公开密钥密码体制中，加密密钥（即公开密钥）PK是公开信息，而解密密钥（即秘密密钥）SK是需要保密的。加密算法E和解密算法D也都是公开的。虽然解密密钥SK是由公开密钥PK决定的，但却不能根据PK计算出SK。

正是基于这种理论，1978年出现了著名的RSA算法，它通常是先生成一对RSA密钥，其中之一是保密密钥，由用户保存；另一个为公开密钥，可对外公开，甚至可在网络服务器中注册。为提高保密强度，RSA密钥至少为500位长，一般推荐使用1024位。这就使加密的计算量很大。为减少计算量，在传送信息时，常采用传统加密方法与公开密钥加密方法相结合的方式，即信息采用改进的DES或IDEA对话密钥加密，然后使用RSA密钥加密对话密钥和信息摘要。对方收到信息后，用不同的密钥解密并可核对信息摘要 [2]  。
        
## （三）不可逆加密: 对应函数称为：散列函数/hash函数/哈希函数，如：MD5、SHA、HMAC 等

- 原理：加密过程中不需要使用密钥，输入明文后由系统直接经过加密算法处理成密文，这种加密后的数据是无法被解密的，无法根据密文推算出明文。

- 应用：作为签名算法, 主要⽤于验证，防⽌信息被修改, 如：⽂件校验、数字签名、鉴权协议

### 1.MD5
MD5信息摘要算法（英语：MD5 Message-Digest Algorithm），一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。

MD5由美国密码学家罗纳德·李维斯特（Ronald Linn Rivest）设计，于1992年公开，用以取代MD4算法。 这套算法的程序在 RFC 1321 标准中被加以规范。

1996年后该算法被证实存在弱点，可以被加以破解，对于需要高度安全性的数据，专家一般建议改用其他算法，如SHA-2。2004年，证实MD5算法无法防止碰撞（collision），因此不适用于安全性认证，如SSL公开密钥认证或是数字签名等用途。

原理可简要的叙述为：
1. MD5码以512位分组来处理输入的信息，且每一分组又被划分为16个32位子分组
2. 经过了一系列的处理后，算法的输出由四个32位分组组成
3. 将这四个32位分组级联后将生成一个128位散列值

### 2.SHA
有一种散列函数被称为安全散列算法（secure hash algorithm ，SHA ）函数。它给定一个字符串，SHA返回其散列值，即SHA 根据字符串生成另一个字符串。对于每个不同的字符串，SHA 生成的散列值都不同。

和MD5算法类似，SHA (Security Hash Algorithm) 算法也是一种信息摘要生成算法，SHA 是美国的 NIST 和 NSA 设计的一种标准的 Hash 算法。

事实上，SHA算法包含了几个种类，包括SHA-0、SHA-1、SHA-2、SHA-3等，其实这是一个迭代的过程，最先有SHA-0和SHA-1，但是某一些密码分析攻击在理论上已经有可能对SHA-1造成威胁，并且由于SHA-2与SHA-1具有相同的结构特性，所以在理论上也有可能攻破SHA-2。因此，NIST开始了SHA-3的征集工作。并在2012年最终确定Keccak作为散列算法。虽然指定了新一代SHA算法，但是，并不是说前几代的SHA算法就已经失效了，实际上，SHA-2在目前仍被认为时安全的，它仍是NIST所支持的一种HASH算法。为了安全性，甚至可以将这两种算法一起使用。

SSL行业选择SHA作为数字签名的散列算法，从2011到2015，一直以SHA-1位主导算法。但随着互联网技术的提升，SHA-1的缺点越来越突显。

目前SHA-2已经成为新的标准，所以现在签发的SSL证书，必须使用SHA-2算法签名。也许有人偶尔会看到SHA-2 384位的证书，很少会看到224位，因为224位不允许用于公共信任的证书，512位，不被软件支持。

SHA-2与SHA-1两者在表面上似乎没有什么特别，但是数字签名对于SSL / TLS的安全性具有重要的作用。哈希值越大，组合越多，其安全性就越高，SHA-2比SHA-1安全的多。

加密哈希算法的一个重要功能是产生独特的散列，当两个不同的值或文件可以产生相同的散列，则会产生所谓的碰撞。只有在不发生碰撞时，才能保证数字签名的安全性。碰撞对于哈希算法来说是极其危险的，因为碰撞允许两个文件产生相同的签名。当计算机检查签名时，即使该文件未真正签署，也会被计算机识别为有效的。

SHA 还有一个重要特征，那就是局部不敏感的。假设你有一个字符串，并计算了其散列值，如果你修改其中的一个字符，再计算其散列值，结果将截然不同。这很好，让攻击者无法通过比较散列值是否类似来破解密码。
但有时希望散列函数是局部敏感（locality sensitive hash）的。在这种情况下，可使用Simhash算法。如果你对字符串做细微的修改，Simhash生成的散列值也只存在细微的差别。这让你能够通过比较散列值来判断两个字符串的相似程度，如用来论文查重。

#### （1）SHA-1
SHA-1 是第一代 SHA 算法标准

##### 1)SHA-1和MD5的区别
1. 摘要长度不同：MD5的摘要的长度尽128bit(16字节)，SHA-1摘要长度160bit(20字节)。多出32bit意味着什么呢？不同明文的碰撞几率降低了2^32 = 324294967296倍。
2. 性能略有差别：由于SHA-1摘要比MD5摘要长，因而SHA-1生成摘要的性能比MD5略低。

#### （2）SHA-2
​SHA-2，全称Secure Hash Algorithm 2，中文名称2代安全散列算法，由美国国家安全局研制，算是SHA-1算法的后继者。

其中，SHA-2有细分了六个不同的算法标准,这些算法的差异在于，生成摘要的长度、循环的次数等一些比较微小的差距，其算法的基本结构是一致的。显然，信息摘要越长，发生碰撞的几率就越低，破解的难度就越大。但同时，耗费的性能和占用的空间也就越高。其中包括
- SHA-224、
- SHA-256、
- SHA-384、
- SHA-512、
- SHA-512/224、
- SHA-512/256

因为总体结构是一致的，那就着重SHA-2中比较经典常用的一种，也就是SHA-256，为比特币使用的哈希算法。

#### SHA-3
同样是SHA算法家族中的一个，SHA-3已经于2015年问世，最开始意图为取代SHA-2算法，但SHA-2算法至今仍然安全，所以SHA-2与SHA-3算法是目前都是安全、可行且流行的散列算法。而且SHA-3系列的算法是跟SHA-2及之前的算法的架构完全不同的。目前，以太坊中的哈希算法就是采用的SHA-3。


### 3.HMAC
HMAC是密钥相关的哈希运算消息认证码（Hash-based Message Authentication Code）的缩写，由H.Krawezyk，M.Bellare，R.Canetti于1996年提出的一种基于Hash函数和密钥进行消息认证的方法，并于1997年作为RFC2104被公布，并在IPSec和其他网络协议（如SSL）中得以广泛应用，现在已经成为事实上的Internet安全标准。它可以与任何迭代散列函数捆绑使用。

HMAC的一个典型应用是用在“挑战/响应”（Challenge/Response）身份认证中，认证流程如下：
1. 先由客户端向服务器发出一个验证请求。
2. 服务器接到此请求后生成一个随机数并通过网络传输给客户端（此为挑战）。
3. 客户端将收到的随机数提供给ePass，由ePass使用该随机数与存储在ePass中的密钥进行HMAC-MD5运算并得到一个结果作为认证证据传给服务器（此为响应）。
4. 与此同时，服务器也使用该随机数与存储在服务器数据库中的该客户密钥进行HMAC-MD5运算，如果服务器的运算结果与客户端传回的响应结果相同，则认为客户端是一个合法用户

HMAC算法更像是一种加密算法，它引入了密钥，其安全性已经不完全依赖于所使用的Hash算法，安全性主要有以下几点保证。
（1）使用的密钥是双方事先约定的，第三方不可能知道。作为非法截获信息的第三方，能够得到的信息只有作为“挑战”的随机数和作为“响应”的HMAC 结果，无法根据这两个数据推算出密钥。由于不知道密钥，所以无法仿造出一致的响应。
（2）HMAC与一般的加密重要的区别在于它具有“瞬时"性，即认证只在当时有效，而加密算法被破解后，以前的加密结果就可能被解密。
